/**
 * @preserve
 * @name 3dio
 * @version 1.0.5
 * @date 2017/10/06 23:12
 * @branch master
 * @commit 966024f8b2e58d3e1455d714ff2368c62983938e
 * @description toolkit for interior apps
 * @see https://3d.io
 * @tutorial https://github.com/archilogic-com/3dio-js
 * @author archilogic <dev.rocks@archilogic.com> (https://archilogic.com)
 * @license MIT
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.io3d=t()}(this,function(){"use strict";function e(e){var t;for(t=0;t<e.length;t+=1)e[t](bs)}function t(){var t=ws;_s&&(t.length&&(ws=[],e(t)),Cs(bs))}function n(){_s||(_s=!0,vs&&clearInterval(vs),t())}function r(e){if(ys)return _s?e(bs):ws.push(e),As;console.error("runtime.domReady requires a browser environment and will be ignored.")}function i(e,t){return t={exports:{}},e(t,t.exports),t.exports}function o(e){return"function"==typeof e}function a(e){return null!=e&&"object"==typeof e}function s(){try{return Ms.apply(this,arguments)}catch(e){return Ls.errorObject.e=e,Ls.errorObject}}function l(e){return Ms=e,s}function c(e){return e.reduce(function(e,t){return e.concat(t instanceof Gs.UnsubscriptionError?t.errors:t)},[])}function u(e,t,n){if(e){if(e instanceof nl.Subscriber)return e;if(e[qs.rxSubscriber])return e[qs.rxSubscriber]()}return e||t||n?new nl.Subscriber(e,t,n):new nl.Subscriber(Ys.empty)}function p(e){if(!Tl)throw e||"Sorry this feature requires a browser environment."}function h(){var e="undefined"!=typeof document?document.createElement("canvas"):null;if(!e)return null;var t=e.getContext("webgl")||e.getContext("experimental-webgl")||e.getContext("webgl",{antialias:!1})||e.getContext("experimental-webgl",{antialias:!1});if(!t)return null;var n=t.getExtension("WEBGL_debug_renderer_info"),r=t.getExtension("WEBGL_compressed_texture_s3tc");return{shadingLanguageVersion:t.getParameter(t.SHADING_LANGUAGE_VERSION),renderer:t.getParameter(t.RENDERER),vendor:t.getParameter(t.VENDOR),unmaskedRenderer:n&&t.getParameter(n.UNMASKED_RENDERER_WEBGL),unmaskedVendor:n&&t.getParameter(n.UNMASKED_VENDOR_WEBGL),maxTextureSize:t.getParameter(t.MAX_TEXTURE_SIZE),maxRenderbufferSize:t.getParameter(t.MAX_RENDERBUFFER_SIZE),supportsDds:!!r}}function f(){var e;if("undefined"!=typeof navigator&&(navigator.userAgent||navigator.vendor))e=navigator.userAgent||navigator.vendor;else{if("undefined"==typeof window||!window.opera)return!1;e=window.opera}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}function d(){return void 0!==document.hidden?!document.hidden:void 0!==document.webkitHidden?!document.webkitHidden:void 0!==document.mozHidden?!document.mozHidden:void 0!==document.msHidden?!document.msHidden:void 0}function m(e){var t=Zl[e];if(t)Ul.setLevel(t),Hl.logLevel=e;else{var n='Unknown log level "'+e+'". Possible are: "'+Object.keys(Zl).join('", "')+'". ';if(Hl.logLevel)n+='Log level remains "'+Hl.logLevel;else{var r=Wl.logLevel;n+='Fallback to default "'+r+'".',Ul.setLevel(Zl[r]),Hl.logLevel=r}console.error(n)}}function g(){if(!Nl.isBrowser)return null;var e;if(document.currentScript)e=document.currentScript.getAttribute("src");else for(var t,n=document.getElementsByTagName("script"),r=new RegExp("(/3dio.js|/3dio.min.js)"),i=n.length-1;i>-1;i--)if(t=n[i].getAttribute("src"),r.exec(t)){e=t;break}var o=/pk=([^&]+)/i.exec(e);return o?o[1]:null}function v(e,t){return e.three&&!Nl.has.three?y(e.onError,t,"Sorry: THREE not available."):e.aframe&&!Nl.has.aframe?y(e.onError,t,"Sorry: AFRAME not available."):"function"==typeof t?t():t}function y(e,t,n){return e&&e(n),"function"==typeof t&&function(){throw new Error(n)}}function _(){try{var e=Xl;return Xl=null,e.apply(this,arguments)}catch(e){return Kl.e=e,Kl}}function b(e){return Xl=e,_}function w(e){return null==e||!0===e||!1===e||"string"==typeof e||"number"==typeof e}function C(e){return"function"==typeof e||"object"==typeof e&&null!==e}function A(e){return w(e)?new Error(F(e)):e}function E(e,t){var n,r=e.length,i=new Array(r+1);for(n=0;n<r;++n)i[n]=e[n];return i[n]=t,i}function k(e,t,n){if(!zl.isES5)return{}.hasOwnProperty.call(e,t)?e[t]:void 0;var r=Object.getOwnPropertyDescriptor(e,t);return null!=r?null==r.get&&null==r.set?r.value:n:void 0}function x(e,t,n){if(w(e))return e;var r={value:n,configurable:!0,enumerable:!1,writable:!0};return zl.defineProperty(e,t,r),e}function j(e){throw e}function I(e){try{if("function"==typeof e){var t=zl.names(e.prototype),n=zl.isES5&&t.length>1,r=t.length>0&&!(1===t.length&&"constructor"===t[0]),i=$l.test(e+"")&&zl.names(e).length>0;if(n||r||i)return!0}return!1}catch(e){return!1}}function S(e){function t(){}t.prototype=e;for(var n=8;n--;)new t;return e}function T(e){return ec.test(e)}function P(e,t,n){for(var r=new Array(e),i=0;i<e;++i)r[i]=t+i+n;return r}function F(e){try{return e+""}catch(e){return"[no string representation]"}}function R(e){return null!==e&&"object"==typeof e&&"string"==typeof e.message&&"string"==typeof e.name}function O(e){try{x(e,"isOperational",!0)}catch(e){}}function D(e){return null!=e&&(e instanceof Error.__BluebirdErrorTypes__.OperationalError||!0===e.isOperational)}function N(e){return R(e)&&zl.propertyIsWritable(e,"stack")}function V(e){return{}.toString.call(e)}function L(e,t,n){for(var r=zl.names(e),i=0;i<r.length;++i){var o=r[i];if(n(o))try{zl.defineProperty(t,o,zl.getDescriptor(e,o))}catch(e){}}}function M(e){return oc?process.env[e]:void 0}function B(){if("function"==typeof Promise)try{var e=new Promise(function(){});if("[object Promise]"==={}.toString.call(e))return Promise}catch(e){}}function U(e,t){return e.bind(t)}function W(e,t,n,r,i){for(var o=0;o<i;++o)n[o+r]=e[o+t],e[o+t]=void 0}function Z(e){this._capacity=e,this._length=0,this._front=0}function H(){this._customScheduler=!1,this._isTickUsed=!1,this._lateQueue=new mc(16),this._normalQueue=new mc(16),this._haveDrainedQueues=!1,this._trampolineEnabled=!0;var e=this;this.drainQueues=function(){e._drainQueues()},this._schedule=dc}function G(e,t,n){this._lateQueue.push(e,t,n),this._queueTick()}function z(e,t,n){this._normalQueue.push(e,t,n),this._queueTick()}function Q(e){this._normalQueue._pushOne(e),this._queueTick()}function K(e,t){function n(r){if(!(this instanceof n))return new n(r);wc(this,"message","string"==typeof r?r:t),wc(this,"name",e),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this)}return bc(n,Error),n}function X(e){if(!(this instanceof X))return new X(e);wc(this,"name","OperationalError"),wc(this,"message",e),this.cause=e,this.isOperational=!0,e instanceof Error?(wc(this,"message",e.message),wc(this,"stack",e.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}function Y(e){return e instanceof Error&&zl.getPrototypeOf(e)===Error.prototype}function q(e){var t;if(Y(e)){(t=new Bc(e)).name=e.name,t.message=e.message,t.stack=e.stack;for(var n=zl.keys(e),r=0;r<n.length;++r){var i=n[r];Uc.test(i)||(t[i]=e[i])}return t}return sc.markAsOriginatingFromRejection(e),e}function J(e,t){return function(n,r){if(null!==e){if(n){var i=q(Mc(n));e._attachExtraTrace(i),e._reject(i)}else if(t){for(var o=arguments.length,a=new Array(Math.max(o-1,0)),s=1;s<o;++s)a[s-1]=arguments[s];e._fulfill(a)}else e._fulfill(r);e=null}}}function $(){try{Promise===mu&&(Promise=du)}catch(e){}return mu}function ee(){this._openRequests={},this._closedRequestIds=[]}function te(e,t,n){t=t||{};var r=(n=n||{}).secretApiKey||Hl.secretApiKey,i=n.publishableApiKey||Hl.publishableApiKey,o=_u.createRequest(e,t);return ne(o,r,i),o.promise}function ne(e,t,n){var r=Nl.isBrowser&&window.location.href.match(/^[^\:]+:\/\/([^\.]+\.)?(3d\.io|archilogic.com|localhost)(:\d+)?\//),i={"Content-Type":"application/json"};t&&(i["X-Secret-Key"]=t),n&&(i["X-Publishable-Key"]=n),Gl(Hl.servicesUrl,{body:JSON.stringify(e.message),method:"POST",headers:i,credentials:r?"include":"omit"}).then(function(t){return t.text().then(function(e){var t;try{t=JSON.parse(e)}catch(t){return gu.reject('JSON parsing Error: "'+t+'" Response body: "'+e+'"')}_u.handleResponse(t)}).catch(function(n){var r="";if(n instanceof Error||"string"==typeof n)r=n;else try{r=JSON.stringify(n,null,2)}catch(e){r=n&&n.toString?n.toString():""}var i="API request to "+Hl.servicesUrl+" failed: "+t.status+": "+t.statusText+"\n"+r+"\nOriginal JSON-RPC2 request to 3d.io: "+JSON.stringify(e.message,null,2);e.cancel(i)})}).catch(function(t){e.cancel('Error sending request to 3d.io API: "'+(t.code||JSON.stringify(t))+'"')})}function re(e,t){var n={};return n.meshes=ae(e.meshes,t),n.materials=le(e.materials),e.alternativeMaterialsByMeshKey&&(n.alternativeMaterialsByMeshKey=JSON.parse(JSON.stringify(e.alternativeMaterialsByMeshKey))),e._params&&(n._params=e._params),e.position&&(n.position=e.position.slice(0)),e.rotDeg&&(n.rotDeg=e.rotDeg.slice(0)),e.rotRad&&(n.rotRad=e.rotRad.slice(0)),e.children&&(n.children=e.children.map(function(e){return re(e,t)})),n}function ie(e){return re(e,{clonePositions:!0,cloneNormals:!0,cloneUvs:!0,cloneUvsLightmap:!0})}function oe(e,t){return ae({x:e},t).x}function ae(e,t){if(!e)return{};for(var n,r,i,o=!!(t=t||{}).clonePositions,a=!!t.cloneNormals,s=!!t.cloneUvs,l=!!t.cloneUvsLightmap,c=Object.keys(e),u={},p=0,h=c.length;p<h;p++)i={},(r=e[n=c[p]]).positions&&(o&&(r.positions instanceof Array||r.positions instanceof Float32Array)?i.positions=r.positions.slice(0):i.positions=r.positions),r.normals&&(a&&(r.normals instanceof Array||r.normals instanceof Float32Array)?i.normals=r.normals.slice(0):i.normals=r.normals),r.uvs&&(s&&(r.uvs instanceof Array||r.uvs instanceof Float32Array)?i.uvs=r.uvs.slice(0):i.uvs=r.uvs),r.uvsLightmap&&(l&&(r.uvsLightmap instanceof Array||r.uvsLightmap instanceof Float32Array)?i.uvsLightmap=r.uvsLightmap.slice(0):i.uvsLightmap=r.uvsLightmap),r.matrix&&(i.matrix=r.matrix.slice(0)),r.uvMatrix&&(i.uvMatrix=r.uvMatrix.slice(0)),r.meshKeys&&(i.meshKeys=r.meshKeys.slice(0)),r.position&&(i.position=r.position.slice(0)),r.rotDeg&&(i.rotDeg=r.rotDeg.slice(0)),r.rotRad&&(i.rotRad=r.rotRad.slice(0)),r.scale&&(i.scale=r.scale.slice(0)),r.v&&(i.v=r.v),r.vertexMode&&(i.vertexMode=r.vertexMode),r.side&&(i.side=r.side),r.material&&(i.material=r.material),r.visibleInPersonView&&(i.visibleInPersonView=r.visibleInPersonView),r.visibleInBirdView&&(i.visibleInBirdView=r.visibleInBirdView),r.visibleInFloorplanView&&(i.visibleInFloorplanView=r.visibleInFloorplanView),u[n]=i;return u}function se(e){return le({x:e}).x}function le(e){if(!e)return{};var t,n,r,i,o,a,s,l,c;if(r=Object.keys(e),n={},0===r.length)return{};e[r[0]].attributes?(c=!0,n=JSON.parse(JSON.stringify(e))):c=!1;for(var u=0,p=r.length;u<p;u++)if(t=r[u],"string"==typeof(i=c?e[t].attributes:e[t]))c?n[t].attributes=i:n[t]=i;else if(i){l={};for(var h=0,f=(o=Object.keys(i)).length;h<f;h++)"string"==(s=typeof i[a=o[h]])||"number"===s||"boolean"===s?l[a]=i[a]:i[a]&&(3===i[a].length?l[a]=[i[a][0],i[a][1],i[a][2]]:2===i[a].length&&(l[a]=[i[a][0],i[a][1]]));c?n[t].attributes=l:n[t]=l}return n}function ce(){this.__data__=[],this.size=0}function ue(e,t){return e===t||e!==e&&t!==t}function pe(e,t){for(var n=e.length;n--;)if(Eu(e[n][0],t))return n;return-1}function he(e){var t=this.__data__,n=ku(t,e);return!(n<0||(n==t.length-1?t.pop():ju.call(t,n,1),--this.size,0))}function fe(e){var t=this.__data__,n=ku(t,e);return n<0?void 0:t[n][1]}function de(e){return ku(this.__data__,e)>-1}function me(e,t){var n=this.__data__,r=ku(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}function ge(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function ve(){this.__data__=new Fu,this.size=0}function ye(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function _e(e){return this.__data__.get(e)}function be(e){return this.__data__.has(e)}function we(e){var t=Gu.call(e,Qu),n=e[Qu];try{e[Qu]=void 0;var r=!0}catch(e){}var i=zu.call(e);return r&&(t?e[Qu]=n:delete e[Qu]),i}function Ce(e){return Yu.call(e)}function Ae(e){return null==e?void 0===e?$u:Ju:ep&&ep in Object(e)?Ku(e):qu(e)}function Ee(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function ke(e){if(!np(e))return!1;var t=tp(e);return t==ip||t==op||t==rp||t==ap}function xe(e){return!!up&&up in e}function je(e){if(null!=e){try{return fp.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Ie(e){return!(!np(e)||pp(e))&&(sp(e)?wp:gp).test(dp(e))}function Se(e,t){return null==e?void 0:e[t]}function Te(e,t){var n=Ap(e,t);return Cp(n)?n:void 0}function Pe(){this.__data__=Ip?Ip(null):{},this.size=0}function Fe(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}function Re(e){var t=this.__data__;if(Ip){var n=t[e];return n===Pp?void 0:n}return Rp.call(t,e)?t[e]:void 0}function Oe(e){var t=this.__data__;return Ip?void 0!==t[e]:Np.call(t,e)}function De(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Ip&&void 0===t?Lp:t,this}function Ne(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Ve(){this.size=0,this.__data__={hash:new Bp,map:new(xp||Fu),string:new Bp}}function Le(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}function Me(e,t){var n=e.__data__;return Wp(t)?n["string"==typeof t?"string":"hash"]:n.map}function Be(e){var t=Zp(this,e).delete(e);return this.size-=t?1:0,t}function Ue(e){return Zp(this,e).get(e)}function We(e){return Zp(this,e).has(e)}function Ze(e,t){var n=Zp(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}function He(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Ge(e,t){var n=this.__data__;if(n instanceof Fu){var r=n.__data__;if(!xp||r.length<Xp-1)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new Kp(r)}return n.set(e,t),this.size=n.size,this}function ze(e){var t=this.__data__=new Fu(e);this.size=t.size}function Qe(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e}function Ke(e,t,n){"__proto__"==t&&eh?eh(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function Xe(e,t,n){var r=e[t];rh.call(e,t)&&Eu(r,n)&&(void 0!==n||t in e)||th(e,t,n)}function Ye(e,t,n,r){var i=!n;n||(n={});for(var o=-1,a=t.length;++o<a;){var s=t[o],l=r?r(n[s],e[s],s,n,e):void 0;void 0===l&&(l=e[s]),i?th(n,s,l):ih(n,s,l)}return n}function qe(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}function Je(e){return null!=e&&"object"==typeof e}function $e(e){return sh(e)&&tp(e)==lh}function et(){return!1}function tt(e,t){return!!(t=null==t?_h:t)&&("number"==typeof e||bh.test(e))&&e>-1&&e%1==0&&e<t}function nt(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=Ch}function rt(e){return sh(e)&&Ah(e.length)&&!!Kh[tp(e)]}function it(e){return function(t){return e(t)}}function ot(e,t){var n=gh(e),r=!n&&dh(e),i=!n&&!r&&yh(e),o=!n&&!r&&!i&&ef(e),a=n||r||i||o,s=a?ah(e.length,String):[],l=s.length;for(var c in e)!t&&!nf.call(e,c)||a&&("length"==c||i&&("offset"==c||"parent"==c)||o&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||wh(c,l))||s.push(c);return s}function at(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||of)}function st(e,t){return function(n){return e(t(n))}}function lt(e){if(!af(e))return cf(e);var t=[];for(var n in Object(e))pf.call(e,n)&&"constructor"!=n&&t.push(n);return t}function ct(e){return null!=e&&Ah(e.length)&&!sp(e)}function ut(e){return ff(e)?rf(e):hf(e)}function pt(e,t){return e&&oh(t,df(t),e)}function ht(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}function ft(e){if(!np(e))return gf(e);var t=af(e),n=[];for(var r in e)("constructor"!=r||!t&&yf.call(e,r))&&n.push(r);return n}function dt(e){return ff(e)?rf(e,!0):_f(e)}function mt(e,t){return e&&oh(t,bf(t),e)}function gt(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}function vt(e,t){for(var n=-1,r=null==e?0:e.length,i=0,o=[];++n<r;){var a=e[n];t(a,n,e)&&(o[i++]=a)}return o}function yt(){return[]}function _t(e,t){return oh(e,Tf(e),t)}function bt(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}function wt(e,t){return oh(e,Vf(e),t)}function Ct(e,t,n){var r=t(e);return gh(e)?r:Ff(r,n(e))}function At(e){return Mf(e,df,Tf)}function Et(e){return Mf(e,bf,Vf)}function kt(e){var t=e.length,n=e.constructor(t);return t&&"string"==typeof e[0]&&ud.call(e,"index")&&(n.index=e.index,n.input=e.input),n}function xt(e){var t=new e.constructor(e.byteLength);return new fd(t).set(new fd(e)),t}function jt(e,t){var n=t?dd(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}function It(e,t){return e.set(t[0],t[1]),e}function St(e,t,n,r){var i=-1,o=null==e?0:e.length;for(r&&o&&(n=e[++i]);++i<o;)n=t(n,e[i],i,e);return n}function Tt(e){var t=-1,n=Array(e.size);return e.forEach(function(e,r){n[++t]=[r,e]}),n}function Pt(e,t,n){var r=t?n(yd(e),_d):yd(e);return vd(r,gd,new e.constructor)}function Ft(e){var t=new e.constructor(e.source,wd.exec(e));return t.lastIndex=e.lastIndex,t}function Rt(e,t){return e.add(t),e}function Ot(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n}function Dt(e,t,n){var r=t?n(Ed(e),kd):Ed(e);return vd(r,Ad,new e.constructor)}function Nt(e){return Id?Object(Id.call(e)):{}}function Vt(e,t){var n=t?dd(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function Lt(e,t,n,r){var i=e.constructor;switch(t){case Md:return dd(e);case Pd:case Fd:return new i(+e);case Bd:return md(e,r);case Ud:case Wd:case Zd:case Hd:case Gd:case zd:case Qd:case Kd:case Xd:return Td(e,r);case Rd:return bd(e,r,n);case Od:case Vd:return new i(e);case Dd:return Cd(e);case Nd:return xd(e,r,n);case Ld:return Sd(e)}}function Mt(e){return"function"!=typeof e.constructor||af(e)?{}:$d(Of(e))}function Bt(e,t,n,r,i,o){var a,s=t&tm,l=t&nm,c=t&rm;if(n&&(a=i?n(e,r,i,o):n(e)),void 0!==a)return a;if(!np(e))return e;var u=gh(e);if(u){if(a=pd(e),!s)return Af(e,a)}else{var p=ld(e),h=p==cm||p==um;if(yh(e))return Cf(e,s);if(p==fm||p==im||h&&!i){if(a=l||h?{}:em(e),!s)return l?Lf(e,wf(a,e)):Pf(e,mf(a,e))}else{if(!Tm[p])return i?e:{};a=Yd(e,p,Bt,s)}}o||(o=new qp);var f=o.get(e);if(f)return f;o.set(e,a);var d=c?l?Uf:Bf:l?keysIn:df,m=u?void 0:d(e);return Jp(m||e,function(r,i){m&&(r=e[i=r]),ih(a,i,Bt(r,t,n,i,e,o))}),a}function Ut(e){return Pm(e,Fm)}function Wt(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function Zt(e){return e}function Ht(e,t,n){return t=Nm(void 0===t?e.length-1:t,0),function(){for(var r=arguments,i=-1,o=Nm(r.length-t,0),a=Array(o);++i<o;)a[i]=r[t+i];i=-1;for(var s=Array(t+1);++i<t;)s[i]=r[i];return s[t]=n(a),Om(e,this,s)}}function Gt(e){return function(){return e}}function zt(e){var t=0,n=0;return function(){var r=Zm(),i=Wm-(r-n);if(n=r,i>0){if(++t>=Um)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}function Qt(e,t){return zm(Vm(e,t,Dm),e+"")}function Kt(e,t,n){if(!np(n))return!1;var r=typeof t;return!!("number"==r?ff(n)&&wh(t,n.length):"string"==r&&t in n)&&Eu(n[t],e)}function Xt(e){return Qm(function(t,n){var r=-1,i=n.length,o=i>1?n[i-1]:void 0,a=i>2?n[2]:void 0;for(o=e.length>3&&"function"==typeof o?(i--,o):void 0,a&&Km(n[0],n[1],a)&&(o=i<3?void 0:o,i=1),t=Object(t);++r<i;){var s=n[r];s&&e(t,s,r,o)}return t})}function Yt(e,t,n,r){return void 0===e||Eu(e,Jm[n])&&!$m.call(r,n)?t:e}function qt(e,t){var n=Jt(e),r=Jt(t);return Object.keys(e).forEach(function(e){r[e]-n[e]>180&&(r[e]-=360)}),{start:n,end:r}}function Jt(e){return{x:e.x%360,y:e.y%360,z:e.z%360}}function $t(e,t){var n=parseFloat(t.x)-parseFloat(e.x),r=parseFloat(t.y)-parseFloat(e.y),i=parseFloat(t.z)-parseFloat(e.z);return Math.sqrt(Math.pow(n,2)+Math.pow(r,2)+Math.pow(i,2))}function en(e){return"object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName}function tn(e){for(var t=0,n=e.length,r="";t<n;t++)r+=String.fromCharCode(e[t]);return r}function nn(e){for(var t="",n=123===e[0]||91===e[1]?0:1,r=e.length-20,i=e.length;n<r;n+=20)t+=String.fromCharCode(e[n],e[n+1],e[n+2],e[n+3],e[n+4],e[n+5],e[n+6],e[n+7],e[n+8],e[n+9],e[n+10],e[n+11],e[n+12],e[n+13],e[n+14],e[n+15],e[n+16],e[n+17],e[n+18],e[n+19]);for(;n<i;n++)t+=String.fromCharCode(e[n]);return t}function rn(e){if(Nl.isBrowser&&window.TextDecoder){var t=new window.TextDecoder(e);return t.decode.bind(t)}return ig[e]}function on(e){return gh(e)||dh(e)||!!(ag&&e&&e[ag])}function an(e,t,n,r,i){var o=-1,a=e.length;for(n||(n=sg),i||(i=[]);++o<a;){var s=e[o];t>0&&n(s)?t>1?an(s,t-1,n,r,i):Ff(i,s):r||(i[i.length]=s)}return i}function sn(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}function ln(e){return this.__data__.set(e,ug),this}function cn(e){return this.__data__.has(e)}function un(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new Kp;++t<n;)this.add(e[t])}function pn(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function hn(e,t){return e.has(t)}function fn(e,t,n,r,i,o){var a=n&gg,s=e.length,l=t.length;if(s!=l&&!(a&&l>s))return!1;var c=o.get(e);if(c&&o.get(t))return c==t;var u=-1,p=!0,h=n&vg?new fg:void 0;for(o.set(e,t),o.set(t,e);++u<s;){var f=e[u],d=t[u];if(r)var m=a?r(d,f,u,t,e,o):r(f,d,u,e,t,o);if(void 0!==m){if(m)continue;p=!1;break}if(h){if(!dg(t,function(e,t){if(!mg(h,t)&&(f===e||i(f,e,n,r,o)))return h.push(t)})){p=!1;break}}else if(f!==d&&!i(f,d,n,r,o)){p=!1;break}}return o.delete(e),o.delete(t),p}function dn(e,t,n,r,i,o,a){switch(n){case Pg:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case Tg:return!(e.byteLength!=t.byteLength||!o(new fd(e),new fd(t)));case wg:case Cg:case kg:return Eu(+e,+t);case Ag:return e.name==t.name&&e.message==t.message;case xg:case Ig:return e==t+"";case Eg:var s=yd;case jg:var l=r&_g;if(s||(s=Ed),e.size!=t.size&&!l)return!1;var c=a.get(e);if(c)return c==t;r|=bg,a.set(e,t);var u=yg(s(e),s(t),r,i,o,a);return a.delete(e),u;case Sg:if(Rg)return Rg.call(e)==Rg.call(t)}return!1}function mn(e,t,n,r,i,o){var a=n&Dg,s=Bf(e),l=s.length;if(l!=Bf(t).length&&!a)return!1;for(var c=l;c--;){var u=s[c];if(!(a?u in t:Vg.call(t,u)))return!1}var p=o.get(e);if(p&&o.get(t))return p==t;var h=!0;o.set(e,t),o.set(t,e);for(var f=a;++c<l;){var d=e[u=s[c]],m=t[u];if(r)var g=a?r(m,d,u,t,e,o):r(d,m,u,e,t,o);if(!(void 0===g?d===m||i(d,m,n,r,o):g)){h=!1;break}f||(f="constructor"==u)}if(h&&!f){var v=e.constructor,y=t.constructor;v!=y&&"constructor"in e&&"constructor"in t&&!("function"==typeof v&&v instanceof v&&"function"==typeof y&&y instanceof y)&&(h=!1)}return o.delete(e),o.delete(t),h}function gn(e,t,n,r,i,o){var a=gh(e),s=gh(t),l=a?Ug:ld(e),c=s?Ug:ld(t),u=(l=l==Bg?Wg:l)==Wg,p=(c=c==Bg?Wg:c)==Wg,h=l==c;if(h&&yh(e)){if(!yh(t))return!1;a=!0,u=!1}if(h&&!u)return o||(o=new qp),a||ef(e)?yg(e,t,n,r,i,o):Og(e,t,l,n,r,i,o);if(!(n&Mg)){var f=u&&Hg.call(e,"__wrapped__"),d=p&&Hg.call(t,"__wrapped__");if(f||d){var m=f?e.value():e,g=d?t.value():t;return o||(o=new qp),i(m,g,n,r,o)}}return!!h&&(o||(o=new qp),Lg(e,t,n,r,i,o))}function vn(e,t,n,r,i){return e===t||(null==e||null==t||!sh(e)&&!sh(t)?e!==e&&t!==t:Gg(e,t,n,r,vn,i))}function yn(e,t,n,r){var i=n.length,o=i,a=!r;if(null==e)return!o;for(e=Object(e);i--;){var s=n[i];if(a&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++i<o;){var l=(s=n[i])[0],c=e[l],u=s[1];if(a&&s[2]){if(void 0===c&&!(l in e))return!1}else{var p=new qp;if(r)var h=r(c,u,l,e,t,p);if(!(void 0===h?zg(u,c,Qg|Kg,r,p):h))return!1}}return!0}function _n(e){return e===e&&!np(e)}function bn(e){for(var t=df(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,Yg(i)]}return t}function wn(e,t){return function(n){return null!=n&&n[e]===t&&(void 0!==t||e in Object(n))}}function Cn(e){var t=qg(e);return 1==t.length&&t[0][2]?Jg(t[0][0],t[0][1]):function(n){return n===e||Xg(n,e,t)}}function An(e){return"symbol"==typeof e||sh(e)&&tp(e)==ev}function En(e,t){if(gh(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!tv(e))||rv.test(e)||!nv.test(e)||null!=t&&e in Object(t)}function kn(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError(ov);var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var a=e.apply(this,r);return n.cache=o.set(i,a)||o,a};return n.cache=new(kn.Cache||Kp),n}function xn(e){var t=av(e,function(e){return n.size===sv&&n.clear(),e}),n=t.cache;return t}function jn(e){if("string"==typeof e)return e;if(gh(e))return cg(e,jn)+"";if(tv(e))return gv?gv.call(e):"";var t=e+"";return"0"==t&&1/e==-dv?"-0":t}function In(e){return null==e?"":vv(e)}function Sn(e,t){return gh(e)?e:iv(e,t)?[e]:fv(yv(e))}function Tn(e){if("string"==typeof e||tv(e))return e;var t=e+"";return"0"==t&&1/e==-bv?"-0":t}function Pn(e,t){for(var n=0,r=(t=_v(t,e)).length;null!=e&&n<r;)e=e[wv(t[n++])];return n&&n==r?e:void 0}function Fn(e,t,n){var r=null==e?void 0:Cv(e,t);return void 0===r?n:r}function Rn(e,t){return null!=e&&t in Object(e)}function On(e,t,n){for(var r=-1,i=(t=_v(t,e)).length,o=!1;++r<i;){var a=wv(t[r]);if(!(o=null!=e&&n(e,a)))break;e=e[a]}return o||++r!=i?o:!!(i=null==e?0:e.length)&&Ah(i)&&wh(a,i)&&(gh(e)||dh(e))}function Dn(e,t){return null!=e&&kv(e,t,Ev)}function Nn(e,t){return iv(e)&&Yg(t)?Jg(wv(e),t):function(n){var r=Av(n,e);return void 0===r&&r===t?xv(n,e):zg(t,r,jv|Iv)}}function Vn(e){return function(t){return null==t?void 0:t[e]}}function Ln(e){return function(t){return Cv(t,e)}}function Mn(e){return iv(e)?Tv(wv(e)):Pv(e)}function Bn(e){return"function"==typeof e?e:null==e?Dm:"object"==typeof e?gh(e)?Sv(e[0],e[1]):$g(e):Fv(e)}function Un(e){return function(t,n,r){for(var i=-1,o=Object(t),a=r(t),s=a.length;s--;){var l=a[e?s:++i];if(!1===n(o[l],l,o))break}return t}}function Wn(e,t){return e&&Nv(e,t,df)}function Zn(e,t){return function(n,r){if(null==n)return n;if(!ff(n))return e(n,r);for(var i=n.length,o=t?i:-1,a=Object(n);(t?o--:++o<i)&&!1!==r(a[o],o,a););return n}}function Hn(e,t){var n=-1,r=ff(e)?Array(e.length):[];return Bv(e,function(e,i,o){r[++n]=t(e,i,o)}),r}function Gn(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}function zn(e,t){if(e!==t){var n=void 0!==e,r=null===e,i=e===e,o=tv(e),a=void 0!==t,s=null===t,l=t===t,c=tv(t);if(!s&&!c&&!o&&e>t||o&&a&&l&&!s&&!c||r&&a&&l||!n&&l||!i)return 1;if(!r&&!o&&!c&&e<t||c&&n&&i&&!r&&!o||s&&n&&i||!a&&i||!l)return-1}return 0}function Qn(e,t,n){for(var r=-1,i=e.criteria,o=t.criteria,a=i.length,s=n.length;++r<a;){var l=Zv(i[r],o[r]);if(l)return r>=s?l:l*("desc"==n[r]?-1:1)}return e.index-t.index}function Kn(e,t,n){var r=-1;t=cg(t.length?t:[Dm],Yh(Rv));var i=Uv(e,function(e,n,i){return{criteria:cg(t,function(t){return t(e)}),index:++r,value:e}});return Wv(i,function(e,t){return Hv(e,t,n)})}function Xn(e){var e=e||{};this.maxResolvedCache=e.maxResolvedCache||1e3,this._pendingPromises={},this._resolvedPromises={}}function Yn(e){if(Nl.assertBrowser('Please use "require()" to fetch modules in server environment.'),window.___modules=window.___modules||{},window.___modules[e])return Promise.resolve(window.___modules[e]);var t=Kv.get(e);if(t)return t;var n=Gl(e).then(function(t){if(!t.ok)throw"Could not load script from URL: "+e;return t.text()}).then(function(t){var n;n=t.indexOf("define(function()")>-1?t+'\nfunction define(cb){ window.___modules["'+e+'"] = cb(); };':'window.___modules["'+e+'"] = (function(){ var exports = {}, module = {exports:exports};'+t+"\nreturn module.exports\n})()";var r=document.createElement("script");try{r.appendChild(document.createTextNode(n)),document.body.appendChild(r)}catch(e){r.text=n,document.body.appendChild(r)}return window.___modules[e]});return Kv.add(e,n),n}function qn(e){var t=$v.get(e);return t||(t=fetch(Jv+e).then(function(t){return t.json().catch(function(t){return console.log('ERROR parsing gblock API server response JSON.\nRequested Model: "'+e+'"\nError: "'+JSON.stringify(t)+'"'),gu.reject("gblock API server error. Check console for details.")}).then(function(n){return t.ok?n.gltfUrl:(console.error('ERROR loading gblock model "'+e+'" : '+t.status+' "'+n.message),gu.reject(n.message))})}),$v.add(e,t)),t}function Jn(){return ty||(THREE.___OriginalGLTFLoader=THREE.GLTFLoader,ty=Yn(qv).then(function(){function e(){t.call(this);var e=this;this._parse=this.parse,this.parse=function(t,n,r,i){var o=JSON.parse(og.utf8(t));Object.keys(o.shaders).forEach(function(e,t){e.indexOf("fragment")>-1?o.shaders[e].uri=Xv.base64:e.indexOf("vertex")>-1&&(o.shaders[e].uri=Yv.base64)});var a=new TextEncoder("utf-8").encode(JSON.stringify(o));e._parse.call(e,a,n,r,i)}}var t=THREE.GLTFLoader;return THREE.GLTFLoader=THREE.___OriginalGLTFLoader,e.prototype=t.prototype,e})),ty}function $n(e,t){var n=document.createElement("a-entity");Object.keys(e).forEach(function(t){n.setAttribute(t,e[t])}),t.appendChild(n)}function er(){function e(){window.io3d.aframe.pluginsLoaded||Yn(cy).catch(function(e){console.error("Could not load inspector plugins: "+e)})}window.AFRAME&&window.AFRAME.INSPECTOR&&window.AFRAME.INSPECTOR.opened?e():window.addEventListener("inspector-loaded",e)}function tr(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function nr(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}function rr(e,t,n,r){for(var i=n*r*4,o=new Uint8Array(e,t,i),a=new Uint8Array(i),s=0,l=0,c=0;c<r;c++)for(var u=0;u<n;u++){var p=o[l],h=o[++l],f=o[++l],d=o[++l];l++,a[s]=f,a[++s]=h,a[++s]=p,a[++s]=d,s++}return a}function ir(e,t){var n={mipmaps:[],width:0,height:0,format:null,mipmapCount:1},r=new Int32Array(e,0,31);if(r[0]!==py)return console.error("THREE.DDSLoader.parse: Invalid magic number in DDS header."),n;if(!r[20]&dy)return console.error("THREE.DDSLoader.parse: Unsupported format, must contain a FourCC code."),n;var i,o=r[21],a=!1;switch(o){case my:i=8,n.format=THREE.RGB_S3TC_DXT1_Format;break;case gy:i=16,n.format=THREE.RGBA_S3TC_DXT3_Format;break;case vy:i=16,n.format=THREE.RGBA_S3TC_DXT5_Format;break;default:if(!(32==r[22]&&16711680&r[23]&&65280&r[24]&&255&r[25]&&4278190080&r[26]))return console.error("THREE.DDSLoader.parse: Unsupported FourCC code ",nr(o)),n;a=!0,i=64,n.format=THREE.RGBAFormat}n.mipmapCount=1,r[2]&hy&&!1!==t&&(n.mipmapCount=Math.max(1,r[7])),n.isCubemap=!!(r[28]&fy),n.width=r[4],n.height=r[3];for(var s=r[1]+4,l=n.width,c=n.height,u=n.isCubemap?6:1,p=0;p<u;p++){for(var h=0;h<n.mipmapCount;h++){var f,d;a?d=(f=rr(e,s,l,c)).length:(d=Math.max(4,l)/4*Math.max(4,c)/4*i,f=new Uint8Array(e,s,d));var m={data:f,width:l,height:c};n.mipmaps.push(m),s+=d,l=Math.max(.5*l,1),c=Math.max(.5*c,1)}l=n.width,c=n.height}return n}function or(e){return Math.log(e)/Math.LN2}function ar(e){return new gu(function(t,n){var r=new XMLHttpRequest;r.onload=function(i){if(r.status>=200&&r.status<300){var o,a=r.response;try{o=ir(a,!0)}catch(t){var s="Error Loading DDS Texture\n"+e+"\n"+t.name+": "+t.message;return console.error(s),void n(s)}var l=or(Math.max(o.width,o.height))+1;if(o.mipmapCount!=l)return console.error("Reading DDS texture failed: "+e+"\nmipmaps counted: "+o.mipmapCount+", should be: "+l+"\nPlease make sure you have mipmap generation enabled when creating DDS textures from images."),void n("Error parsing DDS. Wrong mipmaps count. "+e);var c=new THREE.CompressedTexture;c.format=o.format,c.mipmaps=o.mipmaps,c.image.width=o.width,c.image.height=o.height,c.image.src=e,c.sourceFile=e,c.url=e,c.bufferByteLength=a.byteLength,c.generateMipmaps=!1,t(c)}else n({message:"Http Request error",url:e,status:r.status,headers:r.getAllResponseHeaders(),event:i})},r.onerror=function(t){n({message:"Http Request error",url:e,status:r.status,headers:r.getAllResponseHeaders(),event:t})},r.open("GET",e,!0),r.crossOrigin="Anonymous",r.responseType="arraybuffer",r.send(null)})}function sr(e){return 0==(e&e-1)&&0!==e}function lr(e){if(e>yy)return yy;var t=Math.log(e)/Math.LN2;return Math.pow(2,Math.round(t))}function cr(e,t){var n=lr(e.width),r=lr(e.height),i=document.createElement("canvas");return i.width=n,i.height=r,i.getContext("2d").drawImage(e,0,0,n,r),console.log("Image size not compatible. Image has been resized from "+e.width+"x"+e.height+"px to "+i.width+"x"+i.height+"px.\n"+t),i}function ur(e){return new gu(function(t,n){var r=document.createElement("img");r.crossOrigin="Anonymous",r.onload=function(){var n=new THREE.Texture;n.sourceFile=e,n.url=e;var i=sr(r.width)&&sr(r.height),o=r.width<=yy&&r.height<=yy;i&&o?n.image=r:(n.image=cr(r,e),n.image.src=e),t(n)};var i=!1;r.onerror=function(){i?n("Error loading texture "+e):(i=!0,-1===e.indexOf("?")?e+="?cacheBust="+(new Date).getTime():e+="&cacheBust="+(new Date).getTime(),r.src=e)},r.src=e})}function pr(e){var t=Ey[e],n=performance.now()/1e3;t.timeFirst?(t.timeFirst=n,t.timeLast=n):t.timeLast=n,t.requestCount++,jy[e]+=1,xy++,Ay=!0,Cy[e].shift().start()}function hr(){for(var e=null,t=0;t<ky;t++){for(var n=by[t];Cy[n].length>0&&xy<_y;)pr(n);if(null===e&&0!==jy[n]&&(e=t),null!==e&&(wy[n]||t-e>0))break}}function fr(e,t){return Cy[e]||(e&&console.error("onknown queue ",e),e=by[0]),new Promise(function(n,r){setTimeout(function(){var r=Cy[e];r[r.length]={url:t,start:n},hr()},1)})}function dr(e,t){var n=Ey[e];n?(n.timeLastFinished=performance.now()/1e3,jy[e]-=1,xy-=1,Ay=!0,hr()):e&&console.warn('Queue info not found for queue name "'+e+'"')}function mr(e,t){var n=e,r=Fy.get(n);if(r)return r;var i=e.match(/\.[A-Za-z]+(?=\?|$)/i),o=i?i[0].toLowerCase():".jpg";Ry[o]||(console.warn("Unknown texture type "+o+". Trying to load as JPG."),o=".jpg");var a=Py.enqueue(t,e).then(function(){return Ry[o](e)}).then(function(n){return Py.dequeue(t,e),n}).catch(function(n){return Py.dequeue(t,e),gu.reject(n)});return Fy.add(n,a),a}function gr(e){console.error("Texture could not been loaded: ",e)}function vr(e){void 0!==e&&(Ny[e]?Ny[e]++:Ny[e]=1)}function yr(){var e=this,t=this.url;t&&Ny[t]?0==--Ny[t]&&e.dispose():e.dispose()}function _r(e,t,n,r,i,o,a){var s,l,c,u,p,h=[],f=[],d=[],m=0,g=!1,v=o?o.geometry:null,y=v?v.attributes:null,_=y&&y.uv&&y.uv.count>0,b=y&&y.uv2&&y.uv2.count>0;for(j=0,I=t.UV1.length;j<I;j++){if(u=t.UV1[j],s=r[u],c=Oy[u],l=i[c],s){if(!_){console.error("Texture "+s+" could not be assigned because geometry has no UV vertices.");continue}g=!0}s?(p=!0,T=Dy[r.wrap]||Dy.repeat,l&&T!==l.wrapS&&(l.wrapS=T,l.wrapT=T,l.needsUpdate=!0),l&&l.url&&s===l.url&&(p=!1),p&&l&&a&&(i[c]&&i[c].disposeIfPossible&&i[c].disposeIfPossible(),i[c]=null),p&&(d[m]=mr(s,e).catch(gr),f[m]=u,h[m]=c,m++,i.needsUpdate=!0)):i[c]&&(i[c]&&i[c].disposeIfPossible&&i[c].disposeIfPossible(),i[c]=null,i.needsUpdate=!0)}if(y){if(g&&r.size){var w=r.size[0],C=r.size[1],A=y.uv._scaleU||1,E=y.uv._scaleV||1;if(w!==A||C!==E){y.uv._source||(y.uv._source=y.uv.array);for(var k=y.uv._source,x=new Float32Array(k.length),j=0,I=x.length;j<I;j+=2)x[j]=k[j]/w,x[j+1]=k[j+1]/C;y.uv.array=x,y.uv._scaleU=w,y.uv._scaleV=C,y.uv.needsUpdate=!0}}r[t.UV2]&&(b?(u=t.UV2,s=r[u],d[m]=mr(s,e).catch(gr),f[m]=u,h[m]=Oy[u],m++):console.error("Lightmap "+r[t.UV2]+" could not be assigned because geometry has no lightmap UV (UV2) vertices."))}var S,T,P,F;return m?S=gu.all(d).then(function(e){for(T=Dy[r.wrap]||Dy.repeat,j=0;j<m;j++)P=e[j]instanceof THREE.CompressedTexture||e[j]instanceof THREE.Texture,F=e[j]&&e[j].url===i._texturesToBeLoaded[f[j]],P&&F&&(vr(e[j].url),e[j].disposeIfPossible=yr,e[j].wrapS=T,e[j].wrapT=T,e[j].anisotropy=2,i[h[j]]&&i[h[j]].disposeIfPossible&&i[h[j]].disposeIfPossible(),i[h[j]]=e[j],i.uniforms[h[j]].value=e[j],i[h[j]].needsUpdate=!0);i.needsUpdate=!0,o&&o.geometry&&(o.geometry.buffersNeedUpdate=!0,o.geometry.uvsNeedUpdate=!0),n&&n.viewport.render()}):(S=gu.resolve(),n&&n.viewport.render()),S}function br(e){var t=e.vm,n=e.material3d,r=e.mesh3d,i=e.attributes||{},o=void 0===e.reset||e.reset,a=e.loadingQueuePrefix,s=e.onFirstTextureSetLoaded,l=e.lightMapIntensity,c=e.lightMapExposure;n.userData=n.userData||{},n.userData.data3dMaterial=e.attributes,void 0!==i.opacity&&i.opacity<1?(n.transparent=!0,n.opacity=i.opacity):i.mapAlpha?(n.transparent=!0,n.opacity=1):(n.transparent=!1,n.opacity=1),n.uniforms.opacity={value:n.opacity},n.normalScale=void 0!==i.mapNormalFactor?new THREE.Vector2(i.mapNormalFactor,i.mapNormalFactor):new THREE.Vector2(.8,.8),n.uniforms.normalScale.value=n.normalScale,n.shininess=void 0!==i.specularCoef?i.specularCoef:.1,n.uniforms.shininess.value=n.shininess;var u={};i.colorDiffuse?(u.r=i.colorDiffuse[0],u.g=i.colorDiffuse[1],u.b=i.colorDiffuse[2]):o&&(i.mapDiffuse?(u.r=1,u.g=1,u.b=1):(u.r=.85,u.g=.85,u.b=.85)),n.color=u,n.uniforms.color.value=new THREE.Color(u.r,u.g,u.b);var p={};i.colorSpecular?(p.r=i.colorSpecular[0],p.g=i.colorSpecular[1],p.b=i.colorSpecular[2]):o&&(p.r=.25,p.g=.25,p.b=.25),n.specular=p,n.uniforms.specular.value=new THREE.Color(p.r,p.g,p.b);var h={};if(i.colorEmissive)h.r=i.colorEmissive[0],h.g=i.colorEmissive[1],h.b=i.colorEmissive[2];else if(i.lightEmissionCoef){var f=i.lightEmissionCoef/10;i.colorDiffuse?(h.r=i.colorDiffuse[0],h.g=i.colorDiffuse[1],h.b=i.colorDiffuse[2]):(h.r=1,h.g=1,h.b=1),h.r*=f,h.g*=f,h.b*=f}else o&&(h.r=0,h.g=0,h.b=0);if(n.emissive=h,n.uniforms.emissive.value=new THREE.Color(h.r,h.g,h.b),i.mapLight||i.mapLightPreview){var d=My,m=By;void 0!==l&&null!=l&&-100!==l?d=l:void 0!==i.mapLightIntensity&&(d=i.mapLightIntensity),void 0!==c&&null!=c&&-100!==c?m=c:void 0!==i.mapLightCenter&&(m=i.mapLightCenter),n.lightMapIntensity=d>=0?d:0,n.lightMapExposure=m,n.lightMapFalloff=void 0!==i.mapLightFalloff?i.mapLightFalloff:Uy,n.uniforms.lightMapIntensity.value=n.lightMapIntensity,n.uniforms.lightMapExposure.value=n.lightMapExposure,n.uniforms.lightMapFalloff.value=n.lightMapFalloff}r&&(r.castShadow=i.castRealTimeShadows,r.receiveShadow=i.receiveRealTimeShadows,r.material.needsUpdate=!0),n._texturesToBeLoaded={mapDiffuse:i.mapDiffuse,mapSpecular:i.mapSpecular,mapNormal:i.mapNormal,mapAlpha:i.mapAlpha,mapLight:i.mapLight,mapDiffusePreview:i.mapDiffusePreview,mapSpecularPreview:i.mapSpecularPreview,mapNormalPreview:i.mapNormalPreview,mapAlphaPreview:i.mapAlphaPreview,mapLightPreview:i.mapLightPreview};var g,v,y,_=i.mapDiffusePreview||i.mapSpecularPreview||i.mapNormalPreview||i.mapAlphaPreview||i.mapLightPreview,b=!Nl.isMobile&&Nl.webGl.supportsDds;return!b||_&&!n.firstTextureLoaded?(a&&(v=a+"TexturesLoRes"),g=_r(v,Ly,t,i,n,r,!1),y=!0):(a&&(v=a+"TexturesHiRes"),g=_r(v,Vy,t,i,n,r,!1),y=!1),g.then(function(){s&&s(),_&&(n.firstTextureLoaded=!0)}),y&&b&&g.then(function(){a&&(v=a+"TexturesHiRes"),_r(v,Vy,t,i,n,r,!1)}),g}function wr(e,t){for(var n=Math.cos(t*Math.PI/180),r=[0,0],i={},o=["a","b","c"],a=new THREE.Geometry,s=0,l=0;s<e.length/3;s+=3,l+=9)a.vertices[a.vertices.length]=new THREE.Vector3(e[l],e[l+1],e[l+2]),a.vertices[a.vertices.length]=new THREE.Vector3(e[l+3],e[l+4],e[l+5]),a.vertices[a.vertices.length]=new THREE.Vector3(e[l+6],e[l+7],e[l+8]),a.faces[a.faces.length]=new THREE.Face3(s,s+1,s+2,[],[]);a.mergeVertices(),a.computeFaceNormals();for(var c=a.vertices,u=a.faces,p=0,s=0,h=u.length;s<h;s++)for(var f=u[s],l=0;l<3;l++)r[0]=f[o[l]],r[1]=f[o[(l+1)%3]],r.sort(Cr),void 0===i[g=r.toString()]?(i[g]={vert1:r[0],vert2:r[1],face1:s,face2:void 0},p++):i[g].face2=s;var d=new Float32Array(2*p*3),m=0;for(var g in i){var v=i[g];if(void 0===v.face2||u[v.face1].normal.dot(u[v.face2].normal)<=n){var y=c[v.vert1];d[m++]=y.x,d[m++]=y.y,d[m++]=y.z,y=c[v.vert2],d[m++]=y.x,d[m++]=y.y,d[m++]=y.z}}return d}function Cr(e,t){return e-t}function Ar(e,t,n){if(e===t)return!0;if(e.length!==t.length)return!1;n=void 0===n?1:n;for(var r=~~(e.length/(e.length*n)),i=0,o=e.length;i<o;i+=r)if(e[i]!==t[i])return!1;return!0}function Er(e){var t=kr(e.preview);return{id:e.productResourceId,name:e.productDisplayName,description:e.description,manufacturer:e.manufacturer,designer:e.designer,thumb:"https://res.cloudinary.com/archilogic/image/fetch/c_limit,h_150,w_150/"+t,indexImage:t,images:e.images.map(kr),url:e.link,year:e.year,collectionIds:e.productCollectionResourceIds,tags:xr(e.tags),styles:xr(e.styles),categories:xr(e.categories),colors:xr(e.colours),boundingBox:e.boundingBox,boundingPoints:e.boundingPoints,data3dStorageId:e.fileKey,data3dUrl:kr(e.fileKey),sceneStructure:e.modelStructure,created:e.createdAt,updated:e.updatedAt}}function kr(e){if(e)return"/"!==e[0]&&(e="/"+e),"https://storage.3d.io"+e}function xr(e){return""===e[0]?e.slice(1):e}function jr(e,t){function n(){return e="isPublished:true "+e,e=e.trim().replace(/\s+/g," "),te("Product.search",{searchQuery:{query:e},limit:r}).then(function(e){return i=0,e.map(Er)},function(e){return console.error("Error fetching furniture:",e),++i<3?n():Promise.reject("Whoops, that did not work, please try another query.")})}var r=(t=t||{}).limit||50,i=0;return n()}function Ir(e){return te("Product.read",{resourceId:e}).then(function(e){return Er(e)})}function Sr(e){if("string"!=typeof e)throw new TypeError("Parameter 'path' must be a string, not "+typeof e);var t=Ky.exec(e).slice(1);if(!t||4!==t.length)throw new TypeError("Invalid path '"+e+"'");return t[2]=t[2]||"",t[3]=t[3]||"",{root:t[0],dir:t[0]+t[1].slice(0,-1),base:t[2],ext:t[3],name:t[2].slice(0,t[2].length-t[3].length)}}function Tr(){this._protocol=null,this._href="",this._port=-1,this._query=null,this.auth=null,this.slashes=null,this.host=null,this.hostname=null,this.hash=null,this.search=null,this.pathname=null,this._prependSlash=!1}function Pr(e){return e.replace(/[?#]/g,function(e){return encodeURIComponent(e)})}function Fr(e){return e.replace(/#/g,function(e){return encodeURIComponent(e)})}function Rr(e,t,n,r){for(var i=e.length,o=n;o<i;++o){var a=e.charCodeAt(o);if(a===t)return!0;if(1===r[a])return!1}return!1}function Or(e,t,n){for(var r=0,i=e.length;r<i;++r){var o=e.charCodeAt(r);if(o===t||o===n)return!0}return!1}function Dr(e){var t=new Uint8Array(128);return e.forEach(function(e){if("number"==typeof e)t[e]=1;else for(var n=e[0],r=e[1],i=n;i<=r;++i)t[i]=1}),t}function Nr(e,t){var n,r,i,o=(t=t||{}).url;if(o&&(n=Tr.parse(o),r=Xy.parse(n.path||n.pathname||"").dir,i=n.protocol+"//"+n.host),!e)return gu.reject("Missing buffer parameter.");"undefined"!=typeof Buffer&&e instanceof Buffer&&(e=e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength));var a=new Int32Array(e,0,s_/4),s=a[0],l=a[1],c=a[2],u=a[3],p=s_+c+u;if(s!==l_&&console.error("File header error: Wrong magic number. File is probably not data3d buffer format."),l!==c_&&console.error("File header error: Wrong version number: "+l+". Parser supports version: "+c_),e.byteLength!==p){var h="Can not parse Data3d buffer. Wrong buffer size: "+e.byteLength+" Expected: "+p;return console.error(h),gu.reject(h)}var f,d=new Uint16Array(e,s_,c/2),m=og.utf16(d);try{f=JSON.parse(m)}catch(e){return gu.reject(e)}var g=s_+c;return Mr(f.data3d,function(t){Lr(t,e,g,o),i&&t.materials&&Vr(t,i,r)}),gu.resolve(f.data3d)}function Vr(e,t,n){var r,i,o,a,s,l,c=e.materialKeys||Object.keys(e.materials||{});for(r=0,i=c.length;r<i;r++)for(s=e.materials[c[r]],o=0,a=u_.length;o<a;o++)s[l=u_[o]]&&(a_.test(s[l])?s[l]=s[l]:"/http"===s[l].substring(0,5)?s[l]=s[l].substring(1):"/"===s[l][0]?s[l]=t+s[l]:s[l]=t+n+"/"+s[l])}function Lr(e,t,n,r){var i,o,a,s=e.meshKeys||Object.keys(e.meshes||{});for(o=0,a=s.length;o<a;o++)void 0!==(i=e.meshes[s[o]]).positionsOffset&&void 0!==i.positionsLength&&(i.positions=new Float32Array(t,n+4*i.positionsOffset,i.positionsLength),delete i.positionsOffset,delete i.positionsLength),void 0!==i.normalsOffset&&void 0!==i.normalsLength&&(i.normals=new Float32Array(t,n+4*i.normalsOffset,i.normalsLength),delete i.normalsOffset,delete i.normalsLength),void 0!==i.uvsOffset&&void 0!==i.uvsLength&&(i.uvs=new Float32Array(t,n+4*i.uvsOffset,i.uvsLength),delete i.uvsOffset,delete i.uvsLength),void 0!==i.uvsLightmapOffset&&void 0!==i.uvsLightmapLength&&(i.uvsLightmap=new Float32Array(t,n+4*i.uvsLightmapOffset,i.uvsLightmapLength),delete i.uvsLightmapOffset,delete i.uvsLightmapLength),r&&(i.cacheKey=r+":"+s[o])}function Mr(e,t){if(t(e),e.children)for(var n=0,r=e.children.length;n<r;n++)Mr(e.children[n],t)}function Br(e,t){var n=e,r=p_.get(n);if(r)return r;var i=Gl(e,t).then(function(e){return e.arrayBuffer()}).then(function(t){return Nr(t,{url:e})});return p_.add(n,i),i}function Ur(e){return Ir(e).then(function(e){return Br(e.data3dUrl,{loadingQueuePrefix:"interior"}).then(function(t){return{info:e,data3d:t}})})}function Wr(e){return te("Product.read",{resourceId:e}).then(function(e){var t=Er(e);return(t&&t.data3dStorageId?t.data3dStorageId:null)||Promise.reject("This furniture has no own Storage ID (i.e. is a group of furniture objects)")})}function Zr(){var e={box:d_,"camera-bookmark":m_,closet:g_,curtain:v_,door:y_,floor:__,floorplan:b_,group:w_,interior:C_,kitchen:A_,level:E_,object:k_,plan:x_,polybox:j_,polyfloor:I_,railing:S_,stairs:T_,tag:P_,wall:F_,window:R_},t={};return Object.keys(e).forEach(function(n){t[n]={params:ng({},f_.params,e[n].params),possibleChildrenTypes:e[n].possibleChildrenTypes}}),t}function Hr(e){if(e&&e.type){var t=Zr()[e.type].params;return Object.keys(t).forEach(function(n){e[n]||("id"===n?e[n]=yu.generate():void 0!==t[n].defaultValue&&(e[n]=t[n].defaultValue))}),e}}function Gr(e){var t=Zr();if(t[e.type]){var n=t[e.type].params,r=t[e.type].possibleChildrenTypes;return Object.keys(e).forEach(function(t){n[t]||delete e[t]}),e.children&&e.children.length&&(e.children=e.children.filter(function(e){return r.indexOf(e.type)>-1})),e}}function zr(e){var t=Array.isArray(e),n=Qr(t?e:[e]);return Promise.resolve(t?n:n[0])}function Qr(e){return e.map(function(e){return(e=Gr(e))&&e.children&&e.children.length&&(e.children=Qr(e.children)),Hr(e)}).filter(function(e){return void 0!==e})}function Kr(e,t){var n=(t=t||{}).spaceId,r=t.label,i={};return Xr(e).then(function(e){if(!n){var t=e.children[0].children.filter(function(e){return"polyfloor"===e.type});n=t[0].id}return i[n]=r||"dining_living",te("Autofurnishing.furnish",{arguments:{floors:i,modelStructure:e,maxResults:1,tags:["generic"]}})}).then(Yr).catch(function(e){return console.error("HomeStaging error:",e),gu.reject("HomeStaging failed - check console for details")})}function Xr(e){if("plan"!==e.type)if(Array.isArray(e))if("level"!==e[0].type){var t=yu.generate();e={type:"plan",activeLevelId:t,children:[{type:"level",id:t,children:e}]}}else e={type:"plan",children:e};else{if("level"!==e.type)return console.error("Furnishing failed - input is invalid:",e),gu.reject("Furnishing failed - check console for details");e={type:"plan",children:[e]}}return zr(e)}function Yr(e){var t=Object.keys(e.furnishings)[0];if(t in e.errors)return gu.reject(e.errors[t]);var n=e.furnishings[t][0].groups;return gu.map(n,qr).then(zr)}function qr(e){return te("Product.read",{arguments:e.src.substring(1)}).then(function(t){var n=JSON.parse(t.modelStructure);return n=ng({},e,n),gu.resolve(n)})}function Jr(e){return e.query=e.query.trim().replace(/\s+/g," "),te("Product.search",{searchQuery:e,limit:200})}function $r(e,t){var n=O_.edgeAligned,r=e.tags;if(e=e.boundingPoints,t=t.boundingPoints,!e||!t)return{x:0,y:0,z:0};var i;return i=n.some(function(e){return r.includes(e)})?e.min[2]-t.min[2]:(e.max[2]+e.min[2])/2-(t.max[2]+t.min[2])/2,{x:(e.max[0]+e.min[0])/2-(t.max[0]+t.min[0])/2,y:0,z:i}}function ei(e){ti(e)||console.error('element is not an "a-entity" DOM element');var t=e.getAttribute("position"),n=e.getAttribute("rotation"),r=e.getAttribute("io3d-furniture"),i=e.getAttribute("io3d-uuid");return{x:t.x,y:t.y,z:t.z,ry:n.y,type:"interior",src:"!"+r.id,id:i||yu.generate()}}function ti(e){return"object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName&&"a-entity"===e.nodeName.toLowerCase()}function ni(e,t){var n=(t=t||{}).timeout||6e5,r=t.minInterval||1e3,i=t.maxInterval||5e3,o=t.intervalIncreaseFactor||1.05;return new gu(function(t,a,s){var l={isCancelled:!1};s&&s(function(){l.isCancelled=!0}),ri(e,t,a,r,i,o,0,n,l)})}function ri(e,t,n,r,i,o,a,s,l){return l.isCancelled?n("Poll request has been cancelled"):(r<i&&(r*=o),a>s?n("Poll request timed out"):(a+=r,void e(t,n,function(){window.setTimeout(function(){ri(e,t,n,r,i,o,a,s,l)},r)})))}function ii(e,t){var n=void 0===(t=t||{}).cdn||t.cdn,r=void 0===t.encode||t.encode;if(V_[e+n+r])return V_[e+n+r];if(N_.test(e))return V_[e+n+r]=e,e;var i=e,o=/^\/(.*)$/.exec(i);o&&(i=o[1]),r&&!/^[\.\-\_\/a-zA-Z0-9]+$/.test(i)&&(i=encodeURIComponent(i));var a="https://"+(n?Hl.storageDomain:Hl.storageDomainNoCdn)+"/"+i;return V_[e+n+r]=a,a}function oi(e,t){(t=t||{}).type=t.type||"data3d";var n=t.queueName,r=t.loadingQueuePrefix;switch(t.type){case"json":return Gl(ii(e,t)).then(function(e){return e.json()});default:return Br(ii(e),{queueName:n,loadingQueuePrefix:r})}}function ai(e,t){if(e){Nl.assertBrowser(),t=t||{};var n=Array.isArray(e),r=si(e=n?e:[e]),i=ui(e,n?r:r[0]);return i?(Array.isArray(r)?r:[r]).concat(i):n?r:r[0]}console.error("nothing to convert")}function si(e,t){var n=t?null:[];return e.forEach(function(e){if(L_.indexOf(e.type)>-1){var r=hi({attributes:li(e),parent:t});"level"===e.type&&ci(r,e),e.children&&e.children.length&&si(e.children,r),n&&n.push(r)}}),n}function li(e){var t={};switch(e.type){case"interior":if(t["io3d-furniture"]="id: "+e.src.substring(1),e.materials){var n=e.materials;if(Array.isArray(n)){var r={};n.forEach(function(e){e.mesh&&e.material&&(r[e.mesh]=e.material)}),n=r}"object"==typeof n&&Object.keys(n).forEach(function(e){e&&n[e]&&(t["io3d-furniture"]+="; material_"+e.replace(/\s/g,"_")+":"+n[e])})}t.shadow="cast: true; receive: false";break;case"object":t["io3d-data3d"]="key: "+e.object,t.shadow="cast: true; receive: true"}return t.position=e.x+" "+e.y+" "+e.z,t.rotation=(e.rx||0)+" "+e.ry+" 0",t["io3d-uuid"]=e.id,t}function ci(e,t){if(t.bakedModelUrl){var n={"io3d-data3d":"key: "+t.bakedModelUrl,shadow:"cast: false; receive: true"};t.lightMapIntensity&&(n["io3d-data3d"]+="; lightMapIntensity: "+t.lightMapIntensity+"; lightMapExposure: "+t.lightMapCenter);var r=hi({attributes:n,parent:e});(e.bakeRegularStatusFileKey||e.bakePreviewStatusFileKey)&&fi(r,t)}else console.warn("Level without bakedModelUrl: ",t)}function ui(e,t){var n=mi(e[0]).filter(function(e){return"camera-bookmark"===e.type});if(0!==n.length){var r=n.find(function(e){return"lastSavePosition"===e.name}),i="0 1.6 0",o="0 0 0";if(r){"bird"===r.mode&&(r.y+=r.distance);var a=pi(r);i=a.position,o=a.rotation}var s=hi({attributes:{camera:"",tour:"autoStart: false","wasd-controls":"","look-controls":"",position:i,rotation:o}});return n.filter(function(e){return"lastSavePosition"!==e.name}).forEach(function(e){var t=pi(e);hi({parent:s,attributes:{"tour-waypoint":e.name||"Waypoint","io3d-uuid":e.id,position:t.position,rotation:t.rotation}})}),s}}function pi(e){var t=-e.parent.ry*Math.PI/180,n=e.x*Math.cos(t)-e.z*Math.sin(t),r=e.z*Math.cos(t)+e.x*Math.sin(t),i={};i.x=e.parent.x+n,i.y=e.parent.y+e.y,i.z=e.parent.z+r;var o=e.rx*Math.PI/180,a=(e.parent.ry+e.ry)*Math.PI/180;i.x-=e.distance*Math.sin(a)*Math.cos(o),i.y-=e.distance*Math.sin(o),i.z-=e.distance*Math.cos(a)*Math.cos(o);var s={};return s.x=e.rx,s.y=180+e.parent.ry+e.ry,"bird"!==e.mode&&"floorplan"!==e.mode||(i.y=Math.max(e.distance-5,8)),{rotation:s.x+" "+s.y+" 0",position:i.x+" "+i.y+" "+i.z}}function hi(e){var t=e.tag||"a-entity",n=e.parent,r=e.attributes||{},i=document.createElement(t);return Object.keys(r).forEach(function(e){i.setAttribute(e,r[e])}),n?n.appendChild(i):i}function fi(e,t){di(t.bakeRegularStatusFileKey||t.bakePreviewStatusFileKey).then(function(n){var r="key: "+n;t.lightMapIntensity&&(r+="; lightMapIntensity: "+t.lightMapIntensity+"; lightMapExposure: "+t.lightMapCenter),e.setAttribute("io3d-data3d",r)})}function di(e){return ni(function(t,n,r){oi(e,{type:"json",cdn:!1}).then(function(e){if(e&&e.params)switch(e.params.status){case"SUCCESS":t(e.params.data);break;case"PROCESSING":case"ENQUEUED":r();break;default:n(e.params.data)}})})}function mi(e,t){var n=[];return e.parent=t,n.push(e),e.children&&e.children.forEach(function(t){n=n.concat(mi(t,e))}),n}function gi(e,t){var n,r=(t=t||{}).random||!0,i=yi(e);return i&&(e=ei(e)),zr(e).then(function(e){if(n=vi(e),0===Object.keys(n).length)return gu.reject("No valid furniture elements were found");var r=[];return Object.keys(n).forEach(function(e){r.push(new D_(e,t))}),gu.all(r)}).then(function(t){var o={};Object.keys(n).forEach(function(e,n){o[e]=t[n]});var a=_i(e,o,r);return i?ai(a):a}).catch(function(e){return console.error(e),gu.reject(e)})}function vi(e){var t={};return(e=Array.isArray(e)?e:[e]).forEach(function(e){"interior"===e.type&&e.src&&"string"==typeof e.src&&(t[e.src.substring(1)]=!0),e.children&&e.children.length&&(t=ng({},t,vi(e.children)))}),t}function yi(e){return"object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName}function _i(e,t,n){var r,i=e,o=0;return Object.keys(t).forEach(function(e){t[e]&&t[e].length&&(n&&(o=Math.floor(Math.random()*t[e].length)),r=t[e][o],i=bi(i,e,r))}),i}function bi(e,t,n){var r=Array.isArray(e);return e=r?e:[e],e=e.map(function(e){if("interior"===e.type&&e.src.substring(1)===t&&n.furniture){e.src="!"+n.furniture.id;var r=wi(e,n.offset);e.x=r.x,e.y=r.y,e.z=r.z}return e.children&&e.children.length&&(e.children=bi(e.children,t,n)),e}),r?e:e[0]}function wi(e,t){var n=Math.sin(e.ry/180*Math.PI),r=Math.cos(e.ry/180*Math.PI);return{x:e.x+t.x*r+t.z*n,y:e.y+t.y,z:e.z-t.x*n+t.z*r}}function Ci(e){e=e||6;for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<e;r++)t+=n.charAt(Math.floor(Math.random()*n.length));return t}function Ai(e){var t={email:e.email,password:e.password||yu.generate(),accountSetup:"3dio"};return te("User.logOut").then(function(){return Ul.debug('Sending API sign up request for email "'+t.email+'" ...'),te("User.create",t)}).then(function(e){return Ul.debug('API: User sign up with email "'+t.email+'" was successful.'),gu.resolve()},function(e){return Ul.debug('API: Could not sign up using email "'+t.email+'".',e),gu.reject(e)})}function Ei(e){var t=!!e.user,n={};return t&&(n.id=e.user.resourceId,n.username=e.user.resourceName,n.email=e.user.email),{isAuthenticated:t,user:n}}function ki(){return Ul.debug("Sending API session request..."),te("User.getSession").then(Ei).then(function(e){return Ul.debug("API: session data:\n",e),W_.next(e),e},function(e){return Ul.debug("API: error receiving session data.",e),gu.reject(e)})}function xi(e){var t={token:e.token,password:e.password};return te("User.logOut").then(function(){return Ul.debug("Setting new password ..."),te("User.changePassword",{token:t.token,oldPassword:null,newPassword:password})}).then(function(e){return Ul.debug("API: setting password successful."),ki()},function(e){return Ul.debug("API: setting password failed.",e),gu.reject(e)})}function ji(e){var t={email:e.email};return Ul.debug("Sending password reset request to API ..."),te("User.requestPasswordReset",t).then(function(e){return Ul.debug("API: requesting password reset successful."),gu.resolve()},function(e){return Ul.debug("API: requesting password reset failed.",e),gu.reject(e)})}function Ii(e){var t={email:e.email};return Ul.debug("Sending account activation request to API ..."),te("User.requestAccountActivation",t).then(function(e){return Ul.debug("API: requesting account activation successful."),gu.resolve()},function(e){return Ul.debug("API: requesting account activation failed.",e),gu.reject(e)})}function Si(e){var t={username:e.username||e.email,password:e.password||yu.generate()};return Ul.debug('Sending API login request for user "'+t.username+'" ...'),te("User.logOut").then(function(){return te("User.logIn",{loginData:{resourceName:t.username,password:t.password}})}).then(function(){return ki()}).then(function(e){return e.isAuthenticated?(Ul.debug('API: User "'+e.user.email+'" logged in successfully.'),e):Nl.isNode?gu.reject("io3d.auth.logIn cannot be used in node.js. Please use secret key authentication instead. See https://3d.io/docs/api/1/get-started-node-server.html#using-secret-api-key for further info."):gu.reject("Log in error: Session could not been established.")}).catch(function(e){return Ul.debug('API: Could not log in user "'+t.username+'".',e),gu.reject(e)})}function Ti(){return Ul.debug("Sending API log out request..."),te("User.logOut").then(function(e){return ki()}).then(function(e){return e.isAuthenticated?gu.reject("Log out error: Session has not been terminated."):(Ul.debug("API: Log out successful."),e)}).catch(function(e){return Ul.error("Log out error.",e),gu.reject(e)})}function Pi(){return Ul.debug("Sending API request to generate secret API key ..."),te("Organization.generateSecretApiKey").then(function(e){return Ul.debug("API: Generating secret API key successful: ",e),e},function(e){return Ul.error("API: Error generating secret key.",e),gu.reject(e)})}function Fi(){return Ul.debug("Sent API request reading secret key ..."),te("Organization.read").then(function(e){return e.secretApiKey?(Ul.debug("Received secret API key from API"),e.secretApiKey):(Ul.debug("User has no secret key. Sent request to generate one."),Pi())},function(e){return Ul.debug("Error receiving secret API key"),Promise.reject(e)})}function Ri(e){var t=e.allowedDomains;return Ul.debug("Sending API request to generate publishable API key ..."),te("Organization.generatePublishableApiKey",{allowedDomains:t}).then(function(e){return Ul.debug("API: Generating publishable API key successful: ",e),e},function(e){return Ul.error("API: Error generating publishable key.",e),gu.reject(e)})}function Oi(){return Ul.debug("Sending API request to list publishable API keys ..."),te("Organization.listPublishableApiKeys").then(function(e){return Ul.debug("API: Listing publishable API keys successful: ",e),e},function(e){return Ul.error("API: Error listing publishable keys.",e),gu.reject(e)})}function Di(e){var t=e.key,n=e.allowedDomains;return Ul.debug("Sending API request to update publishable API key domains ..."),te("Organization.updatePublishableApiKeyDomains",{key:t,allowedDomains:n}).then(function(e){return Ul.debug("API: Updating publishable API key domains successful: ",e),e},function(e){return Ul.error("API: Error updating publishable key domains.",e),gu.reject(e)})}function Ni(e){var t=e.key;return Ul.debug("Sending API request to generate publishable API key ..."),te("Organization.revokePublishableApiKey",{key:t}).then(function(e){return Ul.debug("API: Revoking publishable API key successful: ",e),e},function(e){return Ul.error("API: Error revoking publishable key.",e),gu.reject(e)})}function Vi(e){var t,n=H_;return e.indexOf(".")>-1&&(t=e.split(".").pop().toLowerCase(),G_[t]&&(n=G_[t])),n}function Li(e,t){if(t=t||{},Array.isArray(e)){var n=0,r=[],i=t.onProgress;return gu.map(e,function(e,o){return n+=e.size,Mi(e,{dir:t.dir,onProgress:function(e,t){r[o]=e,i&&i(r.reduce(function(e,t){return e+t},0),n)}})})}return Mi(e,t)}function Mi(e,t){var n=t.key,r=t.dir,i=t.filename||t.fileName||e.name||"unnamed.txt",o=t.onProgress;return Bi(n,r,i).then(Ui).then(function(t){return Wi(e,t,i)}).then(function(t){return Zi(e,t,o)})}function Bi(e,t,n){var r=!!((e=e||(t?("/"===t[t.length-1]?t:t+"/")+n:null))&&e.indexOf(Q_)>-1);return e&&!r?gu.resolve(e):Z_.getSession().then(function(t){if(r)return t.isAuthenticated||Hl.secretApiKey?e.replace("{{userId}}",t.user.id||Hl.secretApiKey):(console.error("Using key parameter with template syntax requires authentication."),gu.reject("Please log in to upload file."));var i=Gi()+"_"+Ci();return t.isAuthenticated?"/"+t.user.id+"/"+i+"/"+n:null})}function Ui(e){return e?K_.test(e)?gu.resolve(e):gu.reject("Key format validation failed.\n"+e+'\nKey must match the following pattern\n- must start with a slash\n- must not end with a slash\n- must have one or more directories\n- must not include double slashes like: "//"\n- allowed characters are: a-z A-Z 0-9 _ - . /'):gu.resolve(null)}function Wi(e,t,n){t&&"/"===t[0]&&(t=t.substring(1));var r={contentLength:e.size||e.length};if(t)r.contentType=Vi(t),r.key=t;else{if(!n)return gu.reject("Key or fileName param must be provided.");r.contentType=Vi(n),r.fileName=n}return te("S3.getCredentials",r)}function Zi(e,t,n){var r=new U_;return r.append("key",t.key),r.append("AWSAccessKeyId",t.AWSAccessKeyId),r.append("acl",t.acl),r.append("Content-Type",t.contentType),r.append("policy",t.policy),r.append("signature",t.signature),r.append("success_action_status","201"),t.contentEncoding&&r.append("Content-Encoding",t.contentEncoding),r.append("file",e),Nl.isBrowser?new gu(function(e,i){var o=new XMLHttpRequest;o.crossOrigin="Anonymous",o.onload=function(t){if(o.status>=200&&o.status<300){var n=Hi(o.responseText);n?e(n):i("Error Uploading File: "+o.responseText)}else i("Error Uploading File: "+o.responseText)},o.onerror=function(e){i(e)},n&&o.upload.addEventListener("progress",function(e){n(e.loaded,e.total)},!1),o.open("POST",t.url,!0),o.send(r)}):Gl(t.url,{method:"POST",body:r}).then(function(e){return e.text()}).then(function(e){return Hi(e)||gu.reject("Error Uploading File: "+e)})}function Hi(e){var t=/<Key>(.*)<\/Key>/gi.exec(e);return!!t&&"/"+t[1]}function Gi(){var e=new Date;return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()+"_"+e.getHours()+"-"+e.getMinutes()}function zi(e){return ii(e,{cdn:!1})}function Qi(e){if(X_[e])return X_[e];if(Y_.test(e)){var t=e.replace(Y_,"");return X_[e]=t,t}return void console.error("Provided URL is not a valid URL:",e)}function Ki(e,t){if(t(e),e.children)for(var n=0,r=e.children.length;n<r;n++)Ki(e.children[n],t)}function Xi(e){var t,n,r=new Float32Array(e.length/1.5),i=0;for(t=0,n=e.length;t<n;t+=9)r[i]=e[t+2],r[i+1]=e[t],r[i+2]=e[t+5],r[i+3]=e[t+3],r[i+4]=e[t+8],r[i+5]=e[t+6],i+=6;return r}function Yi(e){var t,n,r,i,o=new Float32Array(e.length/1.5),a=0;for(t=0,n=e.length;t<n;t+=9)(r=[(e[t+7]-e[t+4])*(e[t+2]-e[t+5])-(e[t+8]-e[t+5])*(e[t+1]-e[t+4]),(e[t+8]-e[t+5])*(e[t]-e[t+3])-(e[t+6]-e[t+3])*(e[t+2]-e[t+5]),(e[t+6]-e[t+3])*(e[t+1]-e[t+4])-(e[t+7]-e[t+4])*(e[t]-e[t+3])])[0]<0&&(r[0]*=-1),r[1]<0&&(r[1]*=-1),r[2]<0&&(r[2]*=-1),i=[1,0,2].sort(function(e,t){return r[e]-r[t]}),o[a]=e[t+i[1]],o[a+1]=e[t+i[0]],o[a+2]=e[t+3+i[1]],o[a+3]=e[t+3+i[0]],o[a+4]=e[t+6+i[1]],o[a+5]=e[t+6+i[0]],a+=6;return o}function qi(e){var t,n,r,i,o,a,s=new Float32Array(e.length),l=!1;for(t=0,n=e.length;t<n;t+=9)r=(e[t+7]-e[t+4])*(e[t+2]-e[t+5])-(e[t+8]-e[t+5])*(e[t+1]-e[t+4]),i=(e[t+8]-e[t+5])*(e[t]-e[t+3])-(e[t+6]-e[t+3])*(e[t+2]-e[t+5]),o=(e[t+6]-e[t+3])*(e[t+1]-e[t+4])-(e[t+7]-e[t+4])*(e[t]-e[t+3]),(a=1/Math.sqrt(r*r+i*i+o*o))==1/0&&(a=0,l=!0),s[t]=s[t+3]=s[t+6]=r*a,s[t+1]=s[t+4]=s[t+7]=i*a,s[t+2]=s[t+5]=s[t+8]=o*a;return J_&&l&&console.error("Geometry contains trigons that don't span an area."),s}function Ji(e){var t,n,r,i,o,a,s,l,c,u,p,h,f=new Float32Array(e.length),d=[],m={},g=!1;for(c=0,u=e.length;c<u;c+=9)for(o=(e[c+7]-e[c+4])*(e[c+2]-e[c+5])-(e[c+8]-e[c+5])*(e[c+1]-e[c+4]),a=(e[c+8]-e[c+5])*(e[c]-e[c+3])-(e[c+6]-e[c+3])*(e[c+2]-e[c+5]),s=(e[c+6]-e[c+3])*(e[c+1]-e[c+4])-(e[c+7]-e[c+4])*(e[c]-e[c+3]),(l=1/Math.sqrt(o*o+a*a+s*s))==1/0&&(g=!0,l=0),i=[o*l,a*l,s*l],p=0,h=9;p<h;p+=3)m[t=e[c+p]+"_"+e[c+p+1]+"_"+e[c+p+2]]?m[t].faceNormals.push(i):(m[t]={faceNormals:[i]},d[d.length]=t);var v,y,_;for(c=0,u=d.length;c<u;c++){for(v=0,y=0,_=0,p=0,h=(n=m[t=d[c]].faceNormals).length;p<h;p++)v+=n[p][0],y+=n[p][1],_+=n[p][2];(l=1/Math.sqrt(v*v+y*y+_*_))==1/0&&(g=!0,l=0),m[t].averageNormal=[v*l,y*l,_*l]}for(c=0,u=e.length;c<u;c+=3)r=m[t=e[c]+"_"+e[c+1]+"_"+e[c+2]].averageNormal,f[c]=r[0],f[c+1]=r[1],f[c+2]=r[2];return J_&&g&&console.error("Shade Smooth: Geometry contains trigons that don't span an area."),f}function $i(e){return e}function eo(e,t){var n=void 0===(t=t||{}).consolidateMaterials||t.consolidateMaterials,r=void 0===t.consolidateMeshes||t.consolidateMeshes,i=t.el3d,o=t.onWarning,a=[];return Ki(e=wu(e),function(e){e.nodeId=i?i.params.id:yu.generate(),e.meshes=e.meshes||{},e.meshKeys=e.meshKeys||Object.keys(e.meshes),e.materials=e.materials||{},e.materialKeys=e.materialKeys||Object.keys(e.materials),i&&!e._params&&(e._params=i.toObject({recursive:!1})),e.position||(e.position=i?[i.params.x||0,i.params.y||0,i.params.z||0]:[0,0,0]),e.rotRad||e.rotDeg?e.rotDeg?e.rotRad=[e.rotDeg[0]*nb,e.rotDeg[1]*nb,e.rotDeg[2]*nb]:e.rotDeg=[e.rotRad[0]*rb,e.rotRad[1]*rb,e.rotRad[2]*rb]:(e.rotDeg=i?[i.params.rx||0,i.params.ry||0,i.params.rz||0]:[0,0,0],e.rotRad=[e.rotDeg[0]*nb,e.rotDeg[1]*nb,e.rotDeg[2]*nb]),e.children||(e.children=[]),r&&(e.meshes=ro(e.meshes,i?i.params.id:null),e.meshKeys=Object.keys(e.meshes));var t,s,l,c,u,p,h=e.meshes,f=e.meshKeys,d=e.materials,m=i&&i.params?i.params.id:null;for(t=0,s=f.length;t<s;t++)c=(l=h[f[t]]).material,u=d&&d[c]?d[c]:null,l.positions,l.normals,l.uvs,l.uvsLightmap,l.position||(l.position=[0,0,0]),l.rotRad||l.rotDeg?l.rotDeg?l.rotRad=[l.rotDeg[0]*nb,l.rotDeg[1]*nb,l.rotDeg[2]*nb]:l.rotDeg=[l.rotRad[0]*rb,l.rotRad[1]*rb,l.rotRad[2]*rb]:(l.rotDeg=[0,0,0],l.rotRad=[0,0,0]),l.scale||(l.scale=[1,1,1]),u?(!to(u)||void 0!==l.uvs&&0!==l.uvs.length||(tb&&console.error('Mesh with material "'+c+'" has texture(s) has no UVs. Fallback to architectural UV mapping.'),o&&o('Mesh with material "'+c+'" has texture(s) has no UVs. Fallback to architectural UV mapping.'),l.uvs=q_.architectural(l.positions)),!u.mapLight&&!u.mapLightPreview||void 0!==l.uvsLightmap&&0!==l.uvsLightmap.length||(tb&&console.error('Mesh with material "'+c+'" has lightmap has no lightmap UVs. Lightmap will be ignored.'),o&&o('Mesh with material "'+c+'" has lightmap has no lightmap UVs. Lightmap will be ignored.'),delete u.mapLight,delete u.mapLightPreview)):(c?(console.error("Node:"+m+' Material by ID "'+c+'" not found.',d),o&&o('Material by ID "'+c+'" not found.')):(c=Ci(),l.material=c),d[c]={colorDiffuse:[.85,.85,.85]},p=!0);p&&(e.materialKeys=Object.keys(d)),n?a.push(no(e.materials).then(function(t){return e.materials=$i(t),e})):(e.materials=$i(e.materials),a.push(Promise.resolve(e)))}),Promise.all(a).then(function(){return e})}function to(e){return e.mapDiffuse||e.mapSpecular||e.mapNormal||e.mapAlpha||e.mapDiffusePreview||e.mapSpecularPreview||e.mapNormalPreview||e.mapAlphaPreview}function no(e){var t,n,r,i=[],o=[],a=e?Object.keys(e):[],s={};if(!a.length)return Promise.resolve(s);var l=a.length&&e[a[0]].attributes;for(n=0,r=a.length;n<r;n++)t=a[n],s[t]=l?e[t].attributes:e[t],"string"==typeof s[t]&&("#"===s[t][0]?s[t]={colorDiffuse:hexToRgb(s[t])}:(i[i.length]=t,o[o.length]=api.call("Material.get",s[t])));return 0===i.length?Promise.resolve($i(s)):Promise.all(o).then(function(e){for(n=0,r=i.length;n<r;n++)s[i[n]]=e[n].attributes;return $i(s)})}function ro(e,t){if(e){var n,r,i,o=Object.keys(e);for(n=0,r=o.length;n<r;n++)if(void 0!==(i=e[o[n]]).positions&&0!==i.positions.length){if(!(i.positions instanceof Float32Array)){if(!(i.positions instanceof Array)){tb&&console.error("Node:"+t+" Position vertices must be of type Float32Array or Array. Mesh will be ignored",i.position),delete e[o[n]];continue}i.positions=new Float32Array(i.positions)}i.positions.length/9%1==0?(void 0===i.normals||0===i.normals.length?i.normals=$_.flat(i.positions):"string"==typeof i.normals?$_[i.normals]?i.normals=$_[i.normals](i.positions):(tb&&console.error("Node:"+t+' Unknown normal shading method "'+i.normals+'". Fallback to flat shading.'),i.normals=$_.flat(i.positions)):i.normals instanceof Float32Array||(i.normals instanceof Array?i.normals=new Float32Array(i.normals):(tb&&console.error("Node:"+t+" Normal vertices should be of type Float32Array or Array. Fallback to flat shading.",i.normals),i.normals=$_.flat(i.positions))),i.normals.length!==i.positions.length&&(tb&&console.error("Node:"+t+" Position vertices and normal vertices count has to be the same. Fallback to flat Shading. ",i.normals.length,i.normals.length),i.normals=$_.flat(i.positions)),i.uvs&&("string"==typeof i.uvs?q_[i.uvs]?i.uvs=q_[i.uvs](i.positions):(tb&&console.error("Node:"+t+' Unknown UV1 mapping method "'+i.uvs+'". Fallback to architectural UV mapping.'),i.uvs=q_.architectural(i.positions)):i.uvs instanceof Float32Array||(i.uvs instanceof Array?i.uvs=new Float32Array(i.uvs):(tb&&console.error("Node:"+t+" UV Vertices should be of type Float32Array or Array. Fallback to architectural UV mapping.",i.uvs),i.uvs=q_.architectural(i.positions))),i.uvs.length&&1.5*i.uvs.length!==i.positions.length&&(tb&&console.error("Node:"+t+" Position Vertices and UV vertices count not in ratio of 3:2. Fallback to architectural UV mapping. ",i.positions.length,i.uvs.length),i.uvs=q_.architectural(i.positions))),i.uvsLightmap&&i.uvsLightmap.length&&1.5*i.uvs.length!==i.positions.length&&(tb&&console.error("Node:"+t+" Position Vertices and Lightmap UV Vertices count not in ratio of 3:2.",i.positions.length,i.uvs.length),delete i.uvsLightmap)):(tb&&console.error("Node:"+t+" Invalid position vertices count: "+i.positions.length+". Has to be multiple of 9. Mesh will be ignored."),delete e[o[n]])}else delete e[o[n]];return e}return e}function io(e,t){return new gu(function(n,r){setTimeout(function(){n(t)},e)})}function oo(e){return new gu(function(t,n){var r=document.createElement("img");r.crossOrigin="Anonymous",r.onload=function(){t(r)};var i=!1;r.onerror=function(){i?n("Error loading image "+e):(i=!0,r.src=(e.indexOf("?"),"&cacheBust="+(new Date).getTime()))},r.src=e})}function ao(e,t){Nl.assertBrowser();var n=(t=t||{}).maxWidth||ib,r=t.maxHeight||ob,i=!!t.powerOfTwo;return new gu(function(t,o){var a,s=e.width,l=e.height;i&&!(so(s)&&so(l))&&(s=lo(s),l=lo(l));var c=Math.min(s,n),u=Math.min(l,r);s<l?c=u*(s/l):u=c*(l/s),a=co(e,s,l),t(c/s<1?uo(a,c/s):a)})}function so(e){return 0==(e&e-1)&&0!==e}function lo(e){var t=Math.log(e)/Math.LN2;return Math.pow(2,Math.round(t))}function co(e,t,n){var r=document.createElement("canvas");r.width=t,r.height=n;var i=r.getContext("2d");return i.fillStyle="#FFFFFF",i.fillRect(0,0,t,n),i.drawImage(e,0,0,t,n),r}function uo(e,t){if(!(t<1&&t>0))throw"scale must be a positive number <1 ";t=ho(t);var n=new Float32Array(3*e.width*e.height),r=t*t,i=e.width,o=e.height,a=Math.floor(i*t),s=Math.floor(o*t),l=0,c=0,u=0,p=0,h=0,f=0,d=0,m=0,g=0,v=0,y=0,_=0,b=0,w=0,C=0,A=!1,E=!1,k=e.getContext("2d").getImageData(0,0,i,o).data,x=0,j=0,I=0;for(c=0;c<o;c++)for(f=3*(g=0|(h=c*t))*a,(E=g!==(0|h+t))&&(w=g+1-h,C=h+t-g-1),l=0;l<i;l++,u+=4)d=f+3*(m=0|(p=l*t)),(A=m!==(0|p+t))&&(_=m+1-p,b=p+t-m-1),x=k[u],j=k[u+1],I=k[u+2],A||E?A&&!E?(v=_*t,n[d]+=x*v,n[d+1]+=j*v,n[d+2]+=I*v,y=b*t,n[d+3]+=x*y,n[d+4]+=j*y,n[d+5]+=I*y):!A&&E?(v=w*t,n[d]+=x*v,n[d+1]+=j*v,n[d+2]+=I*v,y=C*t,n[d+3*a]+=x*y,n[d+3*a+1]+=j*y,n[d+3*a+2]+=I*y):(v=_*w,n[d]+=x*v,n[d+1]+=j*v,n[d+2]+=I*v,y=b*w,n[d+3]+=x*y,n[d+4]+=j*y,n[d+5]+=I*y,y=_*C,n[d+3*a]+=x*y,n[d+3*a+1]+=j*y,n[d+3*a+2]+=I*y,y=b*C,n[d+3*a+3]+=x*y,n[d+3*a+4]+=j*y,n[d+3*a+5]+=I*y):(n[d]+=x*r,n[d+1]+=j*r,n[d+2]+=I*r);var S=document.createElement("canvas");S.width=a,S.height=s;var T=S.getContext("2d"),P=T.getImageData(0,0,a,s),F=P.data,R=0;for(u=0,d=0;R<a*s;u+=3,d+=4,R++)F[d]=0|n[u],F[d+1]=0|n[u+1],F[d+2]=0|n[u+2],F[d+3]=255,n[u]=0,n[u+1]=0,n[u+2]=0;return T.putImageData(P,0,0),S}function po(e){var t=[2,12,240,65280,4294901760],n=[1,2,4,8,16],r=0,i=0;for(r=4;r>=0;r--)e&t[r]&&(e>>=n[r],i|=n[r]);return i}function ho(e){if(e>1)throw"s must be <1";for(var t=po(e=0|1/e),n=1<<t,r=4;r&&t;)n|=1<<--t,r--;return 1/(e&n)}function fo(){var e=new Date;return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()+"_"+e.getHours()+"-"+e.getMinutes()+"-"+e.getSeconds()+"_"+Ci()}function mo(e,t){Nl.assertBrowser();var n=(t=t||{}).mimeType||"image/jpeg",r=t.quality||98,i=t.fileName||fo()+("image/jpeg"===n?".jpg":".png");return new gu(function(t,o){e.toBlob(function(e){e.name=i,t(e)},n,r)})}function go(e,t){return Nl.assertBrowser(),new Promise(function(n,r){var i=new window.FileReader;i.onload=function(e){n(i.content||i.result)},i.onerror=function(e){r(e)},i[ab[t]](e)})}function vo(e,t){t=t||{};var n=e.name,r=n?n.split(".").pop().toLowerCase():"jpg";return"jpg"===r||"jpeg"===r||"jpe"===r||"png"===r?yo(e):"tga"===r?_o(e):gu.reject("Image of type "+r+" not supported")}function yo(e){var t=e.name;return new gu(function(n,r){var i=new Image,o=window.URL||window.webkitURL,a=o.createObjectURL(e);i.onload=function(){o.revokeObjectURL(a),n(i)},i.onerror=function(e){o.revokeObjectURL(a),console.error("Error converting image: "+t,e),r("Error converting image: "+t)},i.src=a})}function _o(e){return Yn(sb).then(function(t){return go(e,"arrayBuffer").then(function(n){return new gu(function(r,i){var o=new t,a=new Image;a.onload=function(){r(a)},a.onerror=function(t){console.error("Error converting image: "+e.name,t),i("Error converting image: "+e.name)},o.load(new Uint8Array(n)),a.src=o.getDataURL()})})})}function bo(e){var t={loRes:null,source:null,dds:null};return wo(e).then(function(e){return gu.all([Co(e).then(mo).then(Li).then(function(e){t.loRes=e}),mo(e).then(Li).then(function(e){return t.source=e,Ao(e).then(function(n){t.dds=e.replace(".jpg",".hi-res.gz.dds")})})])}).then(function(){return t})}function wo(e){return gu.resolve().then(function(){return"string"==typeof e?oo(e):e instanceof Blob?vo(e):e}).then(function(e){return ao(e,{powerOfTwo:!1,maxWidth:2048,maxHeight:2048})})}function Co(e){return ao(e,{powerOfTwo:!0,maxWidth:256,maxHeight:256})}function Ao(e){return e=e.substring(1),te("Processing.task.enqueue",{method:"convertImage",params:{inputFileKey:e,options:{outputFormat:"dds",outputDirectory:Xy.parse(e).dir}}})}function Eo(e,t){var n=t.getWorldPosition(),r=t.getWorldRotation(),i=t.getWorldScale();e.position=[n.x,n.y,n.z],e.rotRad=[r.x,r.y,r.z],e.scale=[i.x,i.y,i.z]}function ko(e,t,n,r,i){var o=t.geometry,a=e.meshes[n()]={};a.positions=o.attributes.position.array,o.attributes.normal&&(a.normals=o.attributes.normal.array),o.attributes.uv&&(a.uvs=o.attributes.uv.array),Io(e,a,t,t.material,r,i),Eo(a,t)}function xo(e,t,n,r,i){var o=t.geometry,a=e.meshes[n()]={},s=o.index.array,l=0,c=o.index.array.length,u=o.attributes.position.array,p=new Float32Array(3*c);for(l=0;l<c;l++)p[3*l]=u[3*s[l]],p[3*l+1]=u[3*s[l]+1],p[3*l+2]=u[3*s[l]+2];if(a.positions=p,o.attributes.normal){var h=o.attributes.normal.array,f=new Float32Array(3*c);for(l=0;l<c;l++)f[3*l]=h[3*s[l]],f[3*l+1]=h[3*s[l]+1],f[3*l+2]=h[3*s[l]+2];a.normals=f}if(o.attributes.uv){for(o.attributes.uv.array,new Float32Array(2*c),l=0;l<c;l++)f[2*l]=h[2*s[l]],f[2*l+1]=h[2*s[l]+1];a.normals=f}Io(e,a,t,t.material,r,i),Eo(a,t)}function jo(e,t,n,r){var i,o,a,s,l={},c=t.geometry,u=c.index.array,p=c.attributes.color.array,h=c.attributes.color.itemSize,f=3===h?1:null,d=0,m=c.index.array.length;for(d=0;d<m;d+=3)o=[p[u[d]*h],p[u[d]*h+1],p[u[d]*h+2]],s=f||p[u[d]*h+3],a=o.join("-")+"-"+s,l[a]?l[a].faceCount++:(i=r(),l[a]={faceCount:1,materialId:i},e.materials[i]={colorDiffuse:o,opacity:s});Object.keys(l).forEach(function(r,i){l[r].positions=new Float32Array(9*l[r].faceCount),l[r].positionIndex=0,c.attributes.normal&&(l[r].normals=new Float32Array(9*l[r].faceCount),l[r].normalIndex=0);var o=n();Eo(e.meshes[o]={positions:l[r].positions,normals:l[r].normals,material:l[r].materialId},t)});var g,v,y,_,b=c.attributes.position.array,w=c.attributes.normal.array;for(d=0;d<m;d+=3)o=[p[u[d]*h],p[u[d]*h+1],p[u[d]*h+2]],s=f||p[u[d]*h+3],a=o.join("-")+"-"+s,(g=l[a].positions)[v=l[a].positionIndex]=b[3*u[d]],g[v+1]=b[3*u[d]+1],g[v+2]=b[3*u[d]+2],g[v+3]=b[3*u[d+1]],g[v+4]=b[3*u[d+1]+1],g[v+5]=b[3*u[d+1]+2],g[v+6]=b[3*u[d+2]],g[v+7]=b[3*u[d+2]+1],g[v+8]=b[3*u[d+2]+2],l[a].positionIndex+=9,w&&((y=l[a].normals)[_=l[a].normalIndex]=w[3*u[d]],y[_+1]=w[3*u[d]+1],y[_+2]=w[3*u[d]+2],y[_+3]=w[3*u[d+1]],y[_+4]=w[3*u[d+1]+1],y[_+5]=w[3*u[d+1]+2],y[_+6]=w[3*u[d+2]],y[_+7]=w[3*u[d+2]+1],y[_+8]=w[3*u[d+2]+2],l[a].normalIndex+=9);return e}function Io(e,t,n,r,i,o){var a=i(),s=e.materials[a]={};t.material=a,So([["opacity","opacity"],["shininess","specularCoef"]],r,s),To(r,s),Po([["color","colorDiffuse"],["specular","colorSpecular"],["emissive","colorEmissive"]],r,s),Fo([["map","mapDiffuse"],["specularMap","mapSpecular"],["normalMap","mapNormal"],["alphaMap","mapAlpha"]],r,s,o)}function So(e,t,n){e.forEach(function(e){var r=e[0],i=e[1];void 0!==t[r]&&(n[i]=t[r])})}function To(e,t){e.normalScale&&(t.mapNormalFactor=e.normalScale.x)}function Po(e,t,n){e.forEach(function(e){var r=e[0],i=e[1];t[r]&&(n[i]=[t[r].r,t[r].g,t[r].b])})}function Fo(e,t,n,r){e.forEach(function(e){var i=e[0],o=e[1],a=t[i]?t[i].image:null;if(a&&a.src){var s=t[i].isCompressedTexture,l=t.userData&&t.userData.data3dMaterial?t.userData.data3dMaterial:null;s?l&&l[o+"Source"]&&l[o].indexOf(a.src)>-1?(n[o+"Source"]=Qi(l[o+"Source"]),n[o+"Preview"]=Qi(l[o+"Preview"]),n[o]=Qi(l[o])):console.warn('Texture "'+a.src+'" could not be converted into data3d texture set.'):r.push(bo(a).then(function(e){n[o+"Preview"]=e.loRes,n[o+"Source"]=e.source,n[o]=e.dds}))}})}function Ro(e){return Lo().then(function(t){return t.ungzip(e)})}function Oo(e){return Lo().then(function(t){return go(e,"arrayBuffer").then(t.ungzip).then(function(t){var n=new Blob([t],{type:Vi(e.name)});return e.name&&(n.name=e.name.replace(".gz.",".")),n})})}function Do(e){return Vo().then(function(t){return t.gzip(e)})}function No(e){return Vo().then(function(t){return go(e,"arrayBuffer").then(t.gzip).then(function(t){var n=new Blob([t],{type:"application/x-gzip"});return e.name&&(n.name=e.name.replace(".",".gz.")),n})})}function Vo(){return Nl.isBrowser?Yn(ub.deflate.url):Promise.resolve(require(ub.deflate.module))}function Lo(){return Nl.isBrowser?Yn(ub.inflate.url):Promise.resolve(require(ub.inflate.module))}function Mo(e,t){var n,r=void 0===(t=t||{}).createFile||t.createFile,i=void 0===t.gzipFile||t.gzipFile,o=t.filename||fo()+pb,a={buffer:null,file:null,warnings:[]};o.substring(o.length-pb.length)!==pb&&(o+=pb);var s,l,c,u,p,h,f=[],d=0,m=["positions","normals","uvs","uvsLightmap"],g=wu(e);Ki(g,function(e){for(s=e.meshes,l=e.meshKeys||Object.keys(s),c=0,u=l.length;c<u;c++)h=s[l[c]],m.forEach(function(e){(p=h[e])&&(p.length&&(h[e+"Offset"]=d,h[e+"Length"]=p.length,d+=p.length,f[f.length]=p),delete h[e])})});var v=4*d,y={version:db,data3d:g},_=JSON.stringify(y,function(e,t){return t instanceof Float32Array?Array.apply([],t):t}),b=2*_.length;Bo(b,4)||(_+=" ",b+=2);var w=new ArrayBuffer(hb+b+v),C=new Uint16Array(w,hb,b/2);for(c=0,u=_.length;c<u;c++)C[c]=_.charCodeAt(c);var A=hb+b,E=new Float32Array(w,A,v/4),k=0;for(c=0,u=f.length;c<u;c++)p=f[c],E.set(p,k),k+=p.length;var x=new Int32Array(w,0,hb/4);if(x[0]=fb,x[1]=db,x[2]=b,x[3]=v,a.buffer=w,r&&!i){var j=new Blob([new DataView(w)],{type:"application/octet-stream"});j.name=o,a.file=j}else r&&i&&(n=cb.deflate(w).then(function(e){var t=new Blob([e],{type:"application/x-gzip"});return t.name=o.replace(".",".gz."),a.file=t,a}));return n||(n=gu.resolve(a)),n.then(function(){return r?a.file:a.buffer})}function Bo(e,t){return Math.ceil(e/t)===e/t}function Uo(e){var t="___cacheBust="+Date.now();return e=e.indexOf("?")>-1?e.replace("?","?"+t+"&"):e.indexOf("#")>-1?e.replace("#","?"+t+"#"):e+"?"+t}function Wo(e){return e?Gl(Uo(e),{method:"HEAD",cache:"reload"}).then(function(e){return e.ok},function(){return!1}):Promise.reject("Please provide file URL string as param.")}function Zo(e,t){var n=(t=t||{}).filter,r={};return Ki.materials(e,function(t){for(var i,o,a,s,l=0,c=mb.length;l<c;l++)s=t[i=mb[l]],n&&(o=gb[i],a=vb[i],s=n(s,o,a,t,e)),s&&(r[s]=!0)}),Object.keys(r)}function Ho(e){return Go(e).then(function(e){var t=Zo(e,{filter:function(e,t,n,r,i){return"dds"===n?e:null}});return Promise.all(t.map(zo))})}function Go(e){var t=typeof e;return"string"===t?Br(ii(e)):e instanceof Blob?Nr(e):"object"===t?Promise.resolve(e):Promise.reject("Unknown param type")}function zo(e){var t=zi(e);return ni(function(e,n,r){Wo(t).then(function(t){t?e():r()})})}function Qo(e){return lb(e).then(Mo).then(Li)}function Ko(e){return Qo(document.querySelector(e).object3D)}function Xo(e){return Br(ii(e)).then(Zo).then(function(e){return e.map(Qi)})}function Yo(e){return function(t,n){var r=void 0!==(n=n||{}).filename?n.filename:null;return Xo(t).then(function(n){return te("Processing.task.enqueue",{method:"convert",params:{inputFileKey:t,options:{inputAssetKeys:n,outputFormat:e,outputFilename:r}}})})}}function qo(e){return yu.validate(e)?te("Model.read",{arguments:{resourceId:e}}).then(function(e){var t=e.modelStructure;return t.id=e.modelResourceId,t.v=1,t.modelDisplayName=e.modelDisplayName,t.modelResourceName=e.modelResourceName,t}):Promise.reject("id not valid")}function Jo(e){return qo(e).then(ai)}function $o(e){return"https://spaces.archilogic.com/3d/!"+e.sceneId}function ea(e){var t={isValid:!0,validatedSceneStructure:null,warnings:[],errors:[]},n=Array.isArray(e),r=ta(t,n?e:[e]);return t.validatedSceneStructure=n?r:r[0],Promise.resolve(t)}function ta(e,t,n){var r=[];return t.forEach(function(t){if(!n||wb[n].possibleChildrenTypes.indexOf(t.type)>-1)if(t&&t.type)if(wb[t.type]){var i={};na(e,wb[t.type],t,i)&&(r.push(i),i.children&&i.children.length&&(i.children=ta(e,i.children,i.type)))}else e.isValid=!1,o='Parameter "type" of value "'+t.type+'" is not supported',e.errors.push({message:o,item:t,code:bb.NOT_SUPPOPRTED});else e.isValid=!1,o='Missing "type" parameter',e.errors.push({message:o,item:t,code:bb.TYPE});else{e.isValid=!1;var o='"'+t.type+'" is invalid child for "'+n+'"';e.errors.push({message:o,item:t,code:bb.CHILDREN_TYPE})}}),r}function na(e,t,n,r){var i=!0;return Object.keys(t.params).sort().forEach(function(o){var a=t.params[o],s=n[o];if(void 0!==s){var l=ra(s);if(a.type!==l)return i=!1,c='Parameter "'+o+'" is of type "'+l+'" but should be type "'+a.type+'"',void e.errors.push({message:c,item:n,code:bb.TYPE});if(void 0!==a.possibleValues&&-1===a.possibleValues.indexOf(s))return i=!1,c='Parameter "'+o+'" has value "'+s+'" but should be one of: '+JSON.stringify(a.possibleValues),void e.errors.push({message:c,item:n,code:bb.VALUE});if(void 0!==a.min&&"number"===a.type&&s<=a.min)return i=!1,c='Parameter "'+o+'" has value '+s+" which is below allowed minimum of "+a.min,void e.errors.push({message:c,item:n,code:bb.MIN_VALUE});if(void 0!==a.max&&"number"===a.type&&s>=a.max)return i=!1,c='Parameter "'+o+'" has value '+s+" which is above allowed maximum of "+a.max,void e.errors.push({message:c,item:n,code:bb.MAX_VALUE});r[o]=s}else if(!a.optional){i=!1;var c='Parameter "'+o+'" is mandatory but not set';return void e.errors.push({message:c,item:n,code:bb.MISSED})}}),Object.keys(n).forEach(function(r){if(!t.params[r]){var i='Parameter "'+r+'" is not supported and will be ignored';e.warnings.push({message:i,item:n,code:bb.NOT_SUPPOPRTED})}}),i||(e.isValid=!1),i}function ra(e){return Array.isArray(e)?"array":typeof e}function ia(){return console.warn("io3d.scene.getHtml will be removed soon please use io3d.scene.getAframeElements"),Jo.apply(Jo,arguments)}function oa(){return console.warn("io3d.scene.getHtmlFromSceneStructure will be removed soon please use io3d.scene.getAframeElementsFromSceneStructure"),ai.apply(ai,arguments)}function aa(e){return te("FloorPlan.convertToBasic3dModel",{floorplan:e.floorPlan,address:e.address,callback:e.callback}).then(function(e){return e.conversionId}).catch(function(e){return gu.reject(e)})}function sa(e){return te("FloorPlan.getConversionStatus",{conversionId:e.conversionId}).catch(function(e){return gu.reject(e)})}function la(e){var t,n,r,i="string"==typeof e?document.querySelector(e):null;if(i){t=i.attributes.src.value,n=i.attributes.width.value,r=i.attributes.height.value;var o=i.components.material.material.map.image;return te("Recognizer.recognize",{arguments:e={colorCoded:!1,floorPlanUrl:t,pixelsPerMeter:ca(o.width,o.height,n,r),colorCoded:!0}}).then(function(e){return zr(e.planStructure)}).catch(function(e){return console.error("Recognition error:",e),Promise.reject("Recognition failed - check console for details")})}}function ca(e,t,n,r){var i=e*t,o=n*r;return Math.sqrt(i/o)}function ua(e){return ni(function(t,n,r){var i="https://"+Hl.storageDomainNoCdn+"/"+e;Gl(i).then(function(e){return e.json()}).then(function(e){var i=e.params.status;"ERROR"===i?n(e.params.data):"SUCCESS"===i?t(e.params.data):r()})})}function pa(e,t){t=t||{};var n=n||[.7487416646324341,-.47789104947352223,-.45935396425474223];return te("Processing.task.enqueue",{method:"bakePreview",params:{inputFileKey:e,options:{inputAssetKeys:[],sunDirection:n,cacheKey:null}}})}function ha(e){return"https://spaces.archilogic.com/3d/?mode=sdk&file="+e}function fa(e,t){Nl.assertBrowser();var n=document.createElement(e);return t&&Object.keys(t).forEach(function(e){"text"===e?n.appendChild(document.createTextNode(t.text)):"html"===e?n.innerHTML=t.html:"click"===e||"keydown"===e||"keyup"===e?n.addEventListener(e,t[e]):n.setAttribute(e,t[e])}),da(n),n}function da(e){e.remove=function(t){return t?e.removeChild(t):e.parentNode.removeChild(e),e},e.empty=function(){for(;e.lastChild;)e.removeChild(e.lastChild);return e},e.append=function(t){return t&&(ma(t)?e.appendChild(t):e.innerHTML=t),e},e.appendTo=function(t){return"body"===t?document.body.appendChild(e):t.appendChild(e),e},e.prependTo=function(t){return"body"===t?document.body.prepend(e):t.prepend(e),e},e.val=function(t){return t&&e.setAttribute("value",t),e.value},e.addClass=function(t){return e.classList.add(t),e},e.removeClass=function(t){return e.classList.remove(t),e},e.hide=function(){return e.___originalStyleDisplay=e.style.display,e.style.display="none",e},e.show=function(){return e.style.display=e.___originalStyleDisplay&&""!==e.___originalStyleDisplay?e.___originalStyleDisplay:"block",e},e.toggleSlide=function(){va(e)}}function ma(e){return"object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName}function ga(e){var t=window.getComputedStyle(e),n=t.display,r=t.position,i=t.visibility,o=t.maxHeight.replace("px","").replace("%",""),a=0;return"none"!==n&&"0"!==o?e.offsetHeight:(e.style.position="absolute",e.style.visibility="hidden",e.style.display="block",a=e.offsetHeight,e.style.display=n,e.style.position=r,e.style.visibility=i,a)}function va(e){var t=0;e.getAttribute("data-max-height")?"0"===e.style.maxHeight.replace("px","").replace("%","")?(e.style.maxHeight=e.getAttribute("data-max-height"),e.style.opacity=1):(e.style.maxHeight=0,e.style.opacity=0):(t=ga(e)+"px",e.style["-webkit-transition"]="opacity 0.5s ease-out, max-height 0.5s cubic-bezier(0.165, 0.84, 0.44, 1)",e.style.transition="opacity 0.5s ease-out, max-height 0.5s cubic-bezier(0.165, 0.84, 0.44, 1)",e.style.overflowY="hidden",e.style.maxHeight="0",e.setAttribute("data-max-height",t),e.style.display="block",setTimeout(function(){e.style.maxHeight=t,e.style.opacity=1},10))}function ya(e,t,n){if(Nl.assertBrowser(),!e||""===e)return gu.resolve();t=void 0!==t?t:4e3,n=n||"neutral";var r=!1,i=jb("<div>",{class:"message"}).prependTo(Ib).hide();jb("<div>",{class:"spacer"}).appendTo(i);var o=jb("<div>",{class:"text "+n}).appendTo(i);jb.isElement(e)?o.append(e):o.innerHTML=e;var a,s=new gu(function(e,t){a=e});return s.close=function(){r||(r=!0,i.toggleSlide(),setTimeout(function(){i.remove()},500),a())},i.toggleSlide(),t&&setTimeout(s.close,t),s}function _a(e,t){var n,r=(t=t||{}).onWarning||function(){},i=e.dataTransfer||e.originalEvent.dataTransfer;if(i.items&&i.items.length)n=wa(i.items).then(function(e){return Aa(ba(e,r))});else if(i.files)if(0===i.files.length||1===i.files.length&&i.files[0].name.indexOf(".")<0)n=Promise.reject("Sorry, but this browser doesn't support drag&drop of folders. (use Chrome)");else{var o,a,s,l,c=[];for(o=0,a=i.files.length;o<a;o++)s=i.files[o],(l=new Blob([s],{type:s.type})).name=s.name,c.push(l);n=Promise.resolve(ba(c,r))}else n=Promise.reject('Event does not contain "items" nor "files" property.');return n}function ba(e,t){for(var n,r,i,o=[],a=0,s=e.length;a<s;a++)if(n=e[a],"string"==typeof(r=n.name)){if("."===r[0]||"__MACOSX/"===r.substring(0,9))continue;(i=r.split(".").length>1?"."+r.split(".").pop().toLowerCase():null)?Sb.indexOf(i)>-1?o[o.length]=n:(console.error("File "+r+" is not supported and will be ignored."),t("File "+r+" is not supported and will be ignored.")):(console.error("File "+r+" has no extension and will be ignored."),t("File "+r+" has no extension and will be ignored."))}return o}function wa(e){for(var t,n=[],r=0,i=e.length;r<i;r++)t=e[r],n[n.length]=t.webkitGetAsEntry?t.webkitGetAsEntry():t.getAsFile();var o=[];return Ca(n,o).then(function(){return o})}function Ca(e,t){return Promise.all(e.map(function(e){if(e.isFile)return new Promise(function(n,r){e.file(function(r){var i=new Blob([r],{type:r.type});i.name=e.fullPath.substring(1),t[t.length]=i,n()})});if(e instanceof File){var n=new Blob([e],{type:e.type});n.name=e.name,t[t.length]=n}else if(e.isDirectory)return new Promise(function(n,r){e.createReader().readEntries(function(e){n(Ca(e,t))})})}))}function Aa(e){var t,n,r;if(!(e.length&&e[0].name&&e[0].name.indexOf("/")>-1))return e;for(t=e[0].name.split("/")[0],n=1,r=e.length;n<r;n++)if(!(e[n].name&&e[n].name.indexOf("/")>-1&&e[n].name.split("/")[0]===t))return e;for(n=0,r=e.length;n<r;n++)e[n].name=e[n].name.substring(t.length+1);return Aa(e)}function Ea(e){function t(e){c&&m.classList.add(c),u&&u(e),ka(e)}function n(e){c&&m.classList.remove(c),p&&p(e),ka(e)}function r(e){c&&m.classList.remove(c),ka(e),_a(e).then(function(t){o(t,e)}).catch(console.error)}function i(e){for(var t=[],n=e.target.files,r=0;r<n.length;r++)t[r]=n[r];o(t,e)}function o(e,t){(h?a(e):gu.resolve()).then(function(n){var r=e.map(function(e,t){var r={file:e,name:e.name,size:e.size,type:e.type};return n&&(r.storageId=n[t],r.url="https://storage.3d.io"+n[t]),r});l(r,t)})}function a(e){return v.style.width="0",v.style.display="block",Li(e,{onProgress:function(e,t){v.style.width=Math.min(100,Math.round(e/t*100))+"%",f&&f(e,t)}}).then(function(e){return v.style.display="none",v.style.width="0",e})}Nl.assertBrowser();var s=e.elementId,l=e.onInput,c=e.dragOverCssClass,u=e.onDragEnter,p=e.onDragLeave,h=void 0===e.upload||e.upload,f=e.onUploadProgress,d=e.uploadProgressBarCss||"background: rgba(0,0,0,0.2);",m=document.getElementById(s);if(m){var g=document.createElement("input");g.setAttribute("type","file"),g.setAttribute("multiple",!0),g.setAttribute("style","cursor:pointer; position:absolute; top:0; left:0; height:100%; width:100%; opacity:0;"),m.appendChild(g);var v=document.createElement("div");v.setAttribute("style","position:absolute; top:0; left:0; bottom:0; width:0; transition: width 1s linear;"+d),null===m.style.position&&(m.style.position="relative"),m.appendChild(v),window.addEventListener("dragover",ka,!1),window.addEventListener("drop",ka,!1),g.addEventListener("dragover",function(e){ka(e),e.dataTransfer.dropEffect="copy"},!1),g.addEventListener("dragenter",t,!1),g.addEventListener("dragleave",n,!1),g.addEventListener("dragend",n,!1),g.addEventListener("drop",r,!1),g.addEventListener("change",i,!1)}else console.error("file drop ui could not be created, element not found:",s)}function ka(e){e.stopPropagation(),e.preventDefault()}function xa(){function e(e){if(!s.isVisible)return s.isVisible=!0,r.style.opacity=0,r.style.display="block",r.style["-webkit-animation"]="600ms overlay-fade-in ease-out",r.style.animation="600ms overlay-fade-in ease-out",r.style["-webkit-animation-fill-mode"]="forwards",r.style["animation-fill-mode"]="forwards",i.style["-webkit-animation"]="600ms content-slide-in cubic-bezier(0.2, 0.80, 0.5, 1)",i.style.animation="600ms content-slide-in cubic-bezier(0.2, 0.80, 0.5, 1)",i.style["-webkit-animation-fill-mode"]="forwards",i.style["animation-fill-mode"]="forwards",e&&"function"==typeof e&&setTimeout(function(){e()},500),s}function t(e){if(s.isVisible)return s.isVisible=!1,r.style["-webkit-animation"]="600ms overlay-fade-out ease-out",r.style.animation="600ms overlay-fade-out ease-out",r.style["-webkit-animation-fill-mode"]="forwards",r.style["animation-fill-mode"]="forwards",i.style["-webkit-animation"]="600ms content-slide-out ease-in",i.style.animation="600ms content-slide-out ease-in",i.style["-webkit-animation-fill-mode"]="forwards",i.style["animation-fill-mode"]="forwards",setTimeout(function(){r.remove()},600),e&&"function"==typeof e&&setTimeout(function(){e()},300),s}function n(e){if(!s.isDestroyed)return t(function(){s.isDestroyed=!0,e&&"function"==typeof e&&e()}),s}Nl.assertBrowser();var r=jb("<div>",{class:"io3d-overlay"}).appendTo(document.body),i=jb("<div>",{class:"centered-content"}).appendTo(r),o=jb("<div>",{class:"bottom-container"}).appendTo(r),a=jb("<div>",{class:"bottom-content"}).appendTo(o),s={isDestroyed:!1,isVisible:!1,mainEl:r,centerEl:i,bottomEl:a,show:e,hide:t,destroy:n};return s}function ja(e,t){return Nl.assertBrowser(),new gu(function(t,n){function r(e){13===e.which&&passwordEl.focus()}function i(e){27===e.keyCode&&s(function(){n("User canceled action.")})}function o(){""!==h.val()?f.addClass("button-highlighted"):f.removeClass("button-highlighted")}function a(){p.hide(),d.show(),ji({email:h.val()}).then(function(){d.hide(),m.show()}).then()}function s(e){document.body.removeEventListener("keydown",i),h.removeEventListener("keydown",r),h.removeEventListener("input",o),c.destroy(e)}var l=(e=e||{}).email,c=xa().show();jb("<div>",{text:"x",class:"button close-button",click:function(){s(function(){n("User canceled action.")})}}).appendTo(c.mainEl);var u=jb("<div>",{style:Tb}).appendTo(c.centerEl),p=jb("<div>").appendTo(u);jb("<h1>",{text:"Reset Password"}).appendTo(p),jb("<p>",{text:"email:",class:"hint"}).appendTo(p);var h=jb("<input>",{type:"text"}).appendTo(p);l&&h.val(l),h.focus(),h.addEventListener("keydown",r),h.addEventListener("input",o);var f=jb("<div>",{text:"go",class:"button",click:a}).appendTo(p),d=jb("<div>",{text:"..."}).appendTo(u).hide(),m=jb("<div>").hide().appendTo(u);jb("<p>",{html:"Check your email for<br>support@archilogic.com<br>and follow instructions."}).appendTo(m),jb("<div>",{text:"ok",class:"button",click:function(){s(function(){t()})}}).appendTo(m),jb("<div>",{text:"Resend activation email.",style:Tb,class:"clickable",click:function(){s(function(){Sa({email:h.val()},{resendActivation:!0}).then(t,n)})}}).appendTo(c.bottomEl),jb("<div>",{text:"Already have an account? Log in.",style:Tb,class:"clickable",click:function(){s(function(){Ia({email:h.val()}).then(t,n)})}}).appendTo(c.bottomEl),document.body.addEventListener("keydown",i),o()})}function Ia(e){return Nl.assertBrowser(),new gu(function(t,n){function r(e){13===e.which&&f.focus()}function i(e){13===e.which&&s()}function o(e){27===e.keyCode&&l(function(){n("User canceled action.")})}function a(){""!==h.val()&&""!==f.val()?d.addClass("button-highlighted"):d.removeClass("button-highlighted")}function s(){Si({email:h.val(),password:f.val()}).then(function(){l(t)},function(e){ya.error(e),e.indexOf("check your email and activate your account first")>-1&&l(function(){Sa({email:h.val()},{resendActivation:!0}).then(t,n)})})}function l(e){document.body.removeEventListener("keydown",o),h.removeEventListener("keydown",r),h.removeEventListener("input",a),f.removeEventListener("keydown",i),f.removeEventListener("input",a),u.destroy(e)}var c={email:(e=e||{}).email,password:e.password},u=xa().show();jb("<div>",{text:"x",class:"button close-button",click:function(){l(function(){n("User canceled action.")})}}).appendTo(u.mainEl),jb("<div>",{text:"New? Sign up now.",style:Pb,class:"clickable",click:function(){l(function(){Sa({email:h.val()}).then(t,n)})}}).appendTo(u.bottomEl),jb("<div>",{text:"Lost Password? Get a new one.",style:Pb,class:"clickable",click:function(){l(function(){ja({email:h.val()}).then(t,n)})}}).appendTo(u.bottomEl);var p=jb("<div>",{style:Pb}).appendTo(u.centerEl);jb("<h1>",{text:"Log In"}).appendTo(p),jb("<p>",{text:"email:",class:"hint"}).appendTo(p);var h=jb("<input>",{type:"text"}).appendTo(p);c.email&&h.val(c.email),h.addEventListener("keydown",r),h.addEventListener("input",a),jb("<p>",{text:"password:",class:"hint"}).appendTo(p);var f=jb("<input>",{type:"password"}).appendTo(p);c.password&&f.val(c.password),f.addEventListener("keydown",i),f.addEventListener("input",a),c.email?c.password||f.focus():h.focus();var d=jb("<div>",{text:"go",class:"button",click:s}).appendTo(p);document.body.addEventListener("keydown",o),a()})}function Sa(e,t){return Nl.assertBrowser(),new gu(function(n,r){function i(e){13===e.which&&s()}function o(e){27===e.keyCode&&c(function(){r("User canceled action.")})}function a(){""!==g.val()?v.addClass("button-highlighted"):v.removeClass("button-highlighted")}function s(){Ta(g.val())?(m.hide(),y.show(),Ti().then(function(){return p?Ii({email:g.val()}):Ai({email:g.val()})}).then(function(){if(h)return l()},function(e){if(ya.error(e),!(e.indexOf("User with this email already exists")>-1))return y.hide(),m.show(),gu.reject(e);c(function(){Ia({email:g.val()}).then(n,r)})}).then(function(){c(n)})):ya.error("Please provide a valid email.")}function l(){return m.hide(),y.hide(),_.show(),ni(function(e,t,n){ki().then(function(t){t.isAuthenticated?e(t):n()})})}function c(e){document.body.removeEventListener("keydown",o),g.removeEventListener("keydown",i),g.removeEventListener("input",a),f.destroy(e)}e=e||{},t=t||{};var u=e.email,p=!!t.resendActivation,h=void 0===t.waitForActivation||t.waitForActivation,f=xa().show();jb("<div>",{text:"x",class:"button close-button",click:function(){c(function(){r("User canceled action.")})}}).appendTo(f.mainEl),jb("<div>",{text:"Already have an account? Log in.",style:Fb,class:"clickable",click:function(){c(function(){Ia({email:g.val()}).then(n,r)})}}).appendTo(f.bottomEl),jb("<div>",{text:"Lost Password? Get a new one.",style:Fb,class:"clickable",click:function(){c(function(){ja({email:g.val()}).then(n,r)})}}).appendTo(f.bottomEl);var d=jb("<div>",{style:Fb}).appendTo(f.centerEl),m=jb("<div>").appendTo(d);jb("<h1>",{text:p?"Resend Activation Email":"Sign Up"}).appendTo(m),jb("<p>",{text:"email:",class:"hint"}).appendTo(m);var g=jb("<input>",{type:"text"}).appendTo(m);u&&g.val(u),g.focus(),g.addEventListener("keydown",i),g.addEventListener("input",a);var v=jb("<div>",{text:"go",class:"button",click:s}).appendTo(m);document.body.addEventListener("keydown",o);var y=jb("<div>",{text:"..."}).appendTo(d).hide(),_=jb("<div>").hide().appendTo(d);jb("<p>",{html:"Check your email for<br>support@3d.io<br>and set your password.<br><br>Then simply return here ;)"}).appendTo(_),a()})}function Ta(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)}function Pa(e,t){return Nl.assertBrowser(),new Promise(function(n,r){function i(e){27===e.keyCode&&a()}function o(){s(function(){n(!0)})}function a(){s(function(){n(!1)})}function s(e){document.body.removeEventListener("keydown",i),y.destroy(e)}var l;if(jb.isElement(e)||"string"==typeof e)(l=t||{}).message=e;else{if("object"!=typeof e)throw"Argument mismatch https://3d.io/docs/api/1/ui.html";l=e}var c=l.title,u=l.message,p=l.bottom,h=l.width&&"number"==typeof l.width?l.width+"px":l.width,f=l.maxWidth&&"number"==typeof l.maxWidth?l.maxWidth+"px":l.maxWidth||"450px",d=Fa(l.closeButton,!0),m=Fa(l.confirmButton,!0),g=Fa(l.cancelButton,!0),v=h?"width:"+h+";":"max-width:"+f+";",y=xa().show();d&&jb("<div>",{text:"x",class:"button close-button",click:a}).appendTo(y.mainEl);var _=jb("<div>",{style:v}).appendTo(y.centerEl);c&&jb("<h1>").append(c).appendTo(_),u&&jb("<div>").append(u).appendTo(_),g&&jb("<div>",{text:"x",class:"button",click:a}).appendTo(_),m&&jb("<div>",{text:"ok",class:"button",click:o}).appendTo(_),p&&jb("<div>",{style:v}).append(p).appendTo(y.bottomEl),document.body.addEventListener("keydown",i)})}function Fa(e,t){return void 0!==e?e:t}function Ra(e,t){if(Nl.assertBrowser(),jb.isElement(e)||"string"==typeof e)(t=t||{}).closeButton=!1,t.cancelButton=!1,t.confirmButton=!0;else{if("object"!=typeof e)throw"Argument mismatch https://3d.io/docs/api/1/ui.html";e.closeButton=!1,e.cancelButton=!1,e.confirmButton=!0}return Pa(e,t)}function Oa(){return Ti().then(function(){return Ra("Log out successful")},function(e){return Ra("Log out error:<br><br>"+e)})}function Da(e,t){Nl.assertBrowser();var n;if(jb.isElement(e)||"string"==typeof e)(n=t||{}).message=e;else{if("object"!=typeof e)throw"Argument mismatch https://3d.io/docs/api/1/ui.html";n=e}var r=n.value||"",i=n.message,o=n.multiLine,a=n.multiLineHeight&&"number"==typeof n.multiLineHeight?n.multiLineHeight+"px":n.multiLineHeight;if(n.width=n.width?n.width:"500px",n.message=jb("<div>"),i&&n.message.append(i),o)s=i&&!jb.isElement(i)?"margin: 1em 0 0 0;":"margin: 0 0 0 0;",(l=jb("<textarea>",{style:s+="min-height: "+(a||"150px")+";",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:!1}).appendTo(n.message)).innerHTML=r;else var s=i&&!jb.isElement(i)?"margin: 1em 0 0.5em 0;":"margin: 0 0 0.5em 0;",l=jb("<input>",{value:r,style:s,autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:!1}).appendTo(n.message);return setTimeout(function(){l.focus()},100),Pa(n).then(function(e){return e?l.val():null})}function Na(e,t){return Nl.assertBrowser(),ki().then(function(e){return e.isAuthenticated?new Promise(function(e,t){function n(){r(function(){e(!1)})}function r(e){i.destroy(e)}var i=xa().show();jb("<div>",{text:"x",class:"button close-button",click:n}).appendTo(i.mainEl);var o=jb("<div>",{class:"publishable-api-keys",style:Rb}).appendTo(i.centerEl);jb("<h1>",{html:"Publishable API Keys"}).appendTo(o);var a=jb("<div>",{class:"list"}).appendTo(o);Oi().then(function(n){n.forEach(function(n){var i=jb("<div>",{class:"key-item"}).appendTo(a),o=jb("<input>",{class:"key",type:"text",value:n.key}).appendTo(i);o.addEventListener("click",o.select),jb("<div>",{class:"hint domains",html:"Domains: "+n.allowedDomains.join(" ")}).appendTo(i),jb("<div>",{class:"button delete-key-button",html:"x",click:function(){r(function(){Pa({width:500,title:"Delete Publishable API Key ?",message:"This action can not be undone.<br><br>Key:<br><b>"+n.key+"</b><br><br>Allowed domains:<br><b>"+n.allowedDomains.join(" ")+"</b>"}).then(function(e){if(e)return Ni({key:n.key}).then(function(){ya.success("Deleted publishable API key<br>"+n.key)})}).then(function(){Na().then(e,t)}).catch(function(n){ya.error("Error deleting publishable API key<br>"+n),Na().then(e,t)})})}}).appendTo(i),jb("<div>",{class:"button edit-domains-button",html:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 40 40" enable-background="new 0 0 40 40"><style type="text/css">.st0{fill:none;stroke:#fff;stroke-miterlimit:10;}</style><line class="st0" x1="14" y1="25.8" x2="28.6" y2="11.2"/><polygon class="st0" points="8.4,31.6 10.1,24.1 25.8,8.4 31.5,14.1 15.8,29.8"/></svg>',click:function(){r(function(){Da({title:"Allowed Domains",message:"Publishable API key:<br><b>"+n.key+'</b><br><br>Please specify allowed domains separated by empty space.<br>Example: "localhost *.3d.io mypage.com"',bottom:jb("<a>",{html:"Read more about allowed domains",href:"https://3d.io/docs/api/1/authentication.html",target:"_blank"}),value:n.allowedDomains.join(" ")}).then(function(e){if(e||""===e)return Di({key:n.key,allowedDomains:e.split(" ")}).then(function(){ya.success("Updated allowed domains to:<br>"+e)})}).then(function(){Na().then(e,t)}).catch(function(n){ya.error("Error updating publishable API key:<br>"+n),Na().then(e,t)})})}}).appendTo(i)})}),jb("<div>",{class:"generate-new-key-button",html:"Generate new key",click:function(){r(function(){Da({width:550,title:"Generate Publishable Api Key",message:'Please specify allowed domains separated by empty space.<br>Example: "localhost *.3d.io mypage.com"',bottom:jb("<a>",{html:"Read more about allowed domains",href:"https://3d.io/docs/api/1/authentication.html",target:"_blank"})}).then(function(e){if(e||""===e)return Ri({allowedDomains:e.split(" ")}).then(function(e){ya.success("Generated new publishable API key<br>"+e)})}).then(function(){Na().then(e,t)}).catch(function(n){ya.error("Error generating publishable API key:<br>"+n),Na().then(e,t)})})}}).appendTo(o),jb("<a>",{class:"clickable",style:"display:block;"+Rb,html:"Read documentaion about publishable API keys.",href:"https://3d.io/docs/api/1/authentication.html",target:"_blank"}).appendTo(i.bottomEl)}):(ya("Please sign up or log in to<br>access your publishable API keys."),Sa().then(function(){return Na()}))})}function Va(){return Nl.assertBrowser(),ki().then(function(e){return e.isAuthenticated?new gu(function(e,t){function n(t){27===t.keyCode&&r(e)}function r(e){document.body.removeEventListener("keydown",n),i.destroy(e)}var i=xa().show();jb("<div>",{text:"x",class:"button close-button",click:function(){r(function(){e()})}}).appendTo(i.mainEl),jb("<a>",{class:"clickable",style:"display:block;"+Ob,html:"Read documentation about secret API key.",href:"https://3d.io/docs/api/1/authentication.html",target:"_blank"}).appendTo(i.bottomEl);var o=jb("<div>",{style:Ob}).appendTo(i.centerEl);jb("<h1>",{text:"Secret API Key"}).appendTo(o);var a=jb("<div>").appendTo(o),s=(jb("<p>",{html:"Please use this key only in secure environments and expose it only to trusted 3rd parties."}).appendTo(a),jb("<p>",{style:"position:relative;"}).appendTo(a)),l=jb("<input>",{type:"text"}).appendTo(s),c=jb("<div>",{text:"reveal",class:"reveal-api-key-button",click:function(){c.hide(),Fi().then(function(e){l.val(e)})}}).appendTo(s);l.addEventListener("click",l.select),jb("<p>",{class:"regegenerate-secret-key-button",html:"Regenerate key",click:function(){r(function(){Pa({title:"Regenrate Key",message:"Are you sure you want to regenrate your secret key ?<br><br>This action can not be undone."}).then(function(e){if(e)return Pi().then(function(e){ya.success("Regenerated secret API key")})}).then(function(){Va().then(e,t)}).catch(function(n){ya.error("Error regenerating secret API key:<br>"+n),Va().then(e,t)})})}}).appendTo(a),document.body.addEventListener("keydown",n)}):(ya("Please sign up or log in to<br>access your secret API key."),Sa().then(function(){return Va()}))})}function La(){return Nl.assertBrowser(),ki().then(function(e){return e.isAuthenticated?new gu(function(t,n){function r(e){27===e.keyCode&&i(t)}function i(e){document.body.removeEventListener("keydown",r),o.destroy(e)}var o=xa().show();jb("<div>",{text:"x",class:"button close-button",click:function(){i(function(){t()})}}).appendTo(o.mainEl);var a=jb("<div>",{style:"white-space: nowrap;"}).appendTo(o.bottomEl);jb("<a>",{text:"Get started using 3d.io",style:"display: inline-block;",class:"clickable",href:"https://3d.io/docs/api/1/get-started.html",target:"_blank"}).appendTo(a),jb("<span>",{html:" | "}).appendTo(a),jb("<a>",{text:"Read more about keys",style:"display: inline-block;",class:"clickable",href:"https://3d.io/docs/api/1/authentication.html",target:"_blank"}).appendTo(a),jb("<span>",{html:" | "}).appendTo(a),jb("<div>",{text:"Change password",style:"display: inline-block;",class:"clickable",click:function(){i(function(){ja({email:c.val()}).then(function(){return La()},function(){return La()}).then(t,n)})}}).appendTo(a);var s=jb("<div>",{style:Db,class:"dev-dashobard"}).appendTo(o.centerEl);jb("<h1>",{text:"Dev Dashboard"}).appendTo(s);var l=jb("<div>").appendTo(s);jb("<p>",{text:"Email:",class:"hint"}).appendTo(l);var c=jb("<input>",{type:"text"}).appendTo(l);c.val(e.user.email);var u=jb("<div>",{class:"key-menu"}).appendTo(l);jb("<div>",{class:"key-image",html:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 172 127"><defs><style>.a{opacity:0.7;stroke-dasharray: 1, 4;}.b{fill:#fff;}.c{fill:none;stroke:#fff;stroke-linecap:round;stroke-miterlimit:10;stroke-width:1px;}.d{opacity:1;}</style></defs><g class="a"><circle class="c" cx="64" cy="64" r="62"/><line class="c" x1="150" y1="30" x2="130" y2="30"/><line class="c" x1="119" y1="36" x2="130" y2="30"/></g><g class="d"><circle class="c" cx="64" cy="64" r="36"/><line class="c" x1="150" y1="98" x2="130" y2="98"/><line class="c" x1="130" y1="98" x2="96.192" y2="82.337"/></g><polygon class="b" points="69.375 60.227 59.813 60.227 59.813 83.867 64.594 86.523 69.375 83.867 67.478 81.581 69.375 79.684 67.478 77.319 69.375 75.422 67.478 73.057 69.375 71.159 67.478 68.794 69.375 66.897 67.478 64.532 69.375 62.635 69.375 60.227"/><path class="b" d="M64.7,39.361A10.894,10.894,0,1,0,75.589,50.255,10.894,10.894,0,0,0,64.7,39.361Zm0,9.056a2.812,2.812,0,1,1,2.812-2.812A2.812,2.812,0,0,1,64.7,48.417Z"/></svg>'}).appendTo(u),jb("<div>",{class:"key-button go-to-publishable-api-key-ui",html:"Get Publishable API Keys",click:function(){i(function(){Na().then(function(){return La()}).then(t,n)})}}).appendTo(u),jb("<div>",{class:"key-button go-to-secret-api-key-ui",html:"Get Secret API Key",click:function(){i(function(){Va().then(function(){return La()}).then(t,n)})}}).appendTo(u),document.body.addEventListener("keydown",r)}):(ya("Please sign up or log in to<br>access your dev dashboard."),Sa().then(function(){return La()}))})}function Ma(e,t){var n=e[0],r=e[1],i=e[2],o=e[3];r=Ha(r=Ha(r=Ha(r=Ha(r=Za(r=Za(r=Za(r=Za(r=Wa(r=Wa(r=Wa(r=Wa(r=Ua(r=Ua(r=Ua(r=Ua(r,i=Ua(i,o=Ua(o,n=Ua(n,r,i,o,t[0],7,-680876936),r,i,t[1],12,-389564586),n,r,t[2],17,606105819),o,n,t[3],22,-1044525330),i=Ua(i,o=Ua(o,n=Ua(n,r,i,o,t[4],7,-176418897),r,i,t[5],12,1200080426),n,r,t[6],17,-1473231341),o,n,t[7],22,-45705983),i=Ua(i,o=Ua(o,n=Ua(n,r,i,o,t[8],7,1770035416),r,i,t[9],12,-1958414417),n,r,t[10],17,-42063),o,n,t[11],22,-1990404162),i=Ua(i,o=Ua(o,n=Ua(n,r,i,o,t[12],7,1804603682),r,i,t[13],12,-40341101),n,r,t[14],17,-1502002290),o,n,t[15],22,1236535329),i=Wa(i,o=Wa(o,n=Wa(n,r,i,o,t[1],5,-165796510),r,i,t[6],9,-1069501632),n,r,t[11],14,643717713),o,n,t[0],20,-373897302),i=Wa(i,o=Wa(o,n=Wa(n,r,i,o,t[5],5,-701558691),r,i,t[10],9,38016083),n,r,t[15],14,-660478335),o,n,t[4],20,-405537848),i=Wa(i,o=Wa(o,n=Wa(n,r,i,o,t[9],5,568446438),r,i,t[14],9,-1019803690),n,r,t[3],14,-187363961),o,n,t[8],20,1163531501),i=Wa(i,o=Wa(o,n=Wa(n,r,i,o,t[13],5,-1444681467),r,i,t[2],9,-51403784),n,r,t[7],14,1735328473),o,n,t[12],20,-1926607734),i=Za(i,o=Za(o,n=Za(n,r,i,o,t[5],4,-378558),r,i,t[8],11,-2022574463),n,r,t[11],16,1839030562),o,n,t[14],23,-35309556),i=Za(i,o=Za(o,n=Za(n,r,i,o,t[1],4,-1530992060),r,i,t[4],11,1272893353),n,r,t[7],16,-155497632),o,n,t[10],23,-1094730640),i=Za(i,o=Za(o,n=Za(n,r,i,o,t[13],4,681279174),r,i,t[0],11,-358537222),n,r,t[3],16,-722521979),o,n,t[6],23,76029189),i=Za(i,o=Za(o,n=Za(n,r,i,o,t[9],4,-640364487),r,i,t[12],11,-421815835),n,r,t[15],16,530742520),o,n,t[2],23,-995338651),i=Ha(i,o=Ha(o,n=Ha(n,r,i,o,t[0],6,-198630844),r,i,t[7],10,1126891415),n,r,t[14],15,-1416354905),o,n,t[5],21,-57434055),i=Ha(i,o=Ha(o,n=Ha(n,r,i,o,t[12],6,1700485571),r,i,t[3],10,-1894986606),n,r,t[10],15,-1051523),o,n,t[1],21,-2054922799),i=Ha(i,o=Ha(o,n=Ha(n,r,i,o,t[8],6,1873313359),r,i,t[15],10,-30611744),n,r,t[6],15,-1560198380),o,n,t[13],21,1309151649),i=Ha(i,o=Ha(o,n=Ha(n,r,i,o,t[4],6,-145523070),r,i,t[11],10,-1120210379),n,r,t[2],15,718787259),o,n,t[9],21,-343485551),e[0]=Xa(n,e[0]),e[1]=Xa(r,e[1]),e[2]=Xa(i,e[2]),e[3]=Xa(o,e[3])}function Ba(e,t,n,r,i,o){return t=Xa(Xa(t,e),Xa(r,o)),Xa(t<<i|t>>>32-i,n)}function Ua(e,t,n,r,i,o,a){return Ba(t&n|~t&r,e,t,i,o,a)}function Wa(e,t,n,r,i,o,a){return Ba(t&r|n&~r,e,t,i,o,a)}function Za(e,t,n,r,i,o,a){return Ba(t^n^r,e,t,i,o,a)}function Ha(e,t,n,r,i,o,a){return Ba(n^(t|~r),e,t,i,o,a)}function Ga(e){var t,n=e.length,r=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=e.length;t+=64)Ma(r,za(e.substring(t-64,t)));e=e.substring(t-64);var i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<e.length;t++)i[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(i[t>>2]|=128<<(t%4<<3),t>55)for(Ma(r,i),t=0;t<16;t++)i[t]=0;return i[14]=8*n,Ma(r,i),r}function za(e){var t,n=[];for(t=0;t<64;t+=4)n[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return n}function Qa(e){for(var t="",n=0;n<4;n++)t+=Lb[e>>8*n+4&15]+Lb[e>>8*n&15];return t}function Ka(e){for(var t=0;t<e.length;t++)e[t]=Qa(e[t]);return e.join("")}function Xa(e,t){return e+t&4294967295}function Ya(e){return Ka(Ga(e))}function qa(e){function t(e,t){return e<<t|e>>>32-t}function n(e){var t,n="";for(t=7;t>=0;t--)n+=(e>>>4*t&15).toString(16);return n}var r,i,o,a,s,l,c,u,p,h=new Array(80),f=1732584193,d=4023233417,m=2562383102,g=271733878,v=3285377520,y=(e=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):r>127&&r<2048?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(63&r|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(63&r|128))}return t}(e)).length,_=new Array;for(i=0;i<y-3;i+=4)o=e.charCodeAt(i)<<24|e.charCodeAt(i+1)<<16|e.charCodeAt(i+2)<<8|e.charCodeAt(i+3),_.push(o);switch(y%4){case 0:i=2147483648;break;case 1:i=e.charCodeAt(y-1)<<24|8388608;break;case 2:i=e.charCodeAt(y-2)<<24|e.charCodeAt(y-1)<<16|32768;break;case 3:i=e.charCodeAt(y-3)<<24|e.charCodeAt(y-2)<<16|e.charCodeAt(y-1)<<8|128}for(_.push(i);_.length%16!=14;)_.push(0);for(_.push(y>>>29),_.push(y<<3&4294967295),r=0;r<_.length;r+=16){for(i=0;i<16;i++)h[i]=_[r+i];for(i=16;i<=79;i++)h[i]=t(h[i-3]^h[i-8]^h[i-14]^h[i-16],1);for(a=f,s=d,l=m,c=g,u=v,i=0;i<=19;i++)p=t(a,5)+(s&l|~s&c)+u+h[i]+1518500249&4294967295,u=c,c=l,l=t(s,30),s=a,a=p;for(i=20;i<=39;i++)p=t(a,5)+(s^l^c)+u+h[i]+1859775393&4294967295,u=c,c=l,l=t(s,30),s=a,a=p;for(i=40;i<=59;i++)p=t(a,5)+(s&l|s&c|l&c)+u+h[i]+2400959708&4294967295,u=c,c=l,l=t(s,30),s=a,a=p;for(i=60;i<=79;i++)p=t(a,5)+(s^l^c)+u+h[i]+3395469782&4294967295,u=c,c=l,l=t(s,30),s=a,a=p;f=f+a&4294967295,d=d+s&4294967295,m=m+l&4294967295,g=g+c&4294967295,v=v+u&4294967295}return(p=n(f)+n(d)+n(m)+n(g)+n(v)).toLowerCase()}function Ja(e){return go(e,"binaryString").then(Ya)}var $a="2017/10/06 23:12",es="master",ts="966024f8b2e58d3e1455d714ff2368c62983938e",ns="3dio",rs="1.0.5",is="toolkit for interior apps",os=["3d","aframe","cardboard","components","oculus","vive","rift","vr","WebVR","WegGL","three","three.js","3D model","api","visualization","furniture","real estate","interior","building","architecture","3d.io"],as="https://3d.io",ss="archilogic-com/3dio-js",ls="MIT",cs={name:"archilogic",email:"dev.rocks@archilogic.com",url:"https://archilogic.com"},us="index.js",ps={start:"gulp dev-browser","dev-browser":"gulp dev-browser","dev-node":"gulp dev-node",test:"gulp test",build:"gulp build",release:"gulp release"},hs={bluebird:"^3.5.0","form-data":"^2.1.4","js-logger":"^1.3.0",lodash:"^4.17.4","node-fetch":"2.0.0-alpha.8",pako:"^1.0.5","performance-now":"^2.1.0",rxjs:"^5.4.2",three:"^0.85.2","whatwg-fetch":"^2.0.3"},fs={ava:"^0.22.0","babel-runtime":"^6.25.0",chalk:"^2.0.1","confirm-cli":"^0.4.0",del:"^3.0.0",gulp:"github:gulpjs/gulp#4.0","gulp-ava":"^0.18.0","gulp-git":"^2.4.1","gulp-gzip":"^1.4.0","gulp-less":"^3.3.2","gulp-s3":"^0.11.0","gulp-watch":"^4.3.11","lite-server":"^2.3.0",moment:"^2.18.1",rollup:"^0.41.6","rollup-plugin-commonjs":"^8.0.2","rollup-plugin-json":"^2.1.1","rollup-plugin-less":"^0.1.3","rollup-plugin-node-resolve":"^3.0.0",through2:"^2.0.3","uglify-js":"^3.0.10"},ds={name:ns,version:rs,description:is,keywords:os,homepage:as,repository:ss,license:ls,author:cs,main:us,scripts:ps,dependencies:hs,devDependencies:fs},ms,gs,vs,ys="undefined"!=typeof window&&window.document,_s=!ys,bs=ys?document:null,ws=[],Cs,As=new Promise(function(e){Cs=e});if(ys){if(document.addEventListener)document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1);else if(window.attachEvent){window.attachEvent("onload",n),gs=document.createElement("div");try{ms=null===window.frameElement}catch(e){}gs.doScroll&&ms&&window.external&&(vs=setInterval(function(){try{gs.doScroll(),n()}catch(e){}},30))}"complete"===document.readyState&&n()}var Es="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},ks="undefined"!=typeof window&&window,xs="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,js=void 0!==Es&&Es,Is=ks||js||xs,Ss=Is;!function(){if(!Is)throw new Error("RxJS could not find any global context (window, self, global)")}();var Ts={root:Ss},Ps=o,Fs={isFunction:Ps},Rs=Array.isArray||function(e){return e&&"number"==typeof e.length},Os={isArray:Rs},Ds=a,Ns={isObject:Ds},Vs={e:{}},Ls={errorObject:Vs},Ms,Bs=l,Us={tryCatch:Bs},Ws=Es&&Es.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},Zs=function(e){function t(t){e.call(this),this.errors=t;var n=Error.call(this,t?t.length+" errors occurred during unsubscription:\n  "+t.map(function(e,t){return t+1+") "+e.toString()}).join("\n  "):"");this.name=n.name="UnsubscriptionError",this.stack=n.stack,this.message=n.message}return Ws(t,e),t}(Error),Hs=Zs,Gs={UnsubscriptionError:Hs},zs=function(){function e(e){this.closed=!1,this._parent=null,this._parents=null,this._subscriptions=null,e&&(this._unsubscribe=e)}return e.prototype.unsubscribe=function(){var e,t=!1;if(!this.closed){var n=this,r=n._parent,i=n._parents,o=n._unsubscribe,a=n._subscriptions;this.closed=!0,this._parent=null,this._parents=null,this._subscriptions=null;for(var s=-1,l=i?i.length:0;r;)r.remove(this),r=++s<l&&i[s]||null;if(Fs.isFunction(o)&&(p=Us.tryCatch(o).call(this))===Ls.errorObject&&(t=!0,e=e||(Ls.errorObject.e instanceof Gs.UnsubscriptionError?c(Ls.errorObject.e.errors):[Ls.errorObject.e])),Os.isArray(a))for(s=-1,l=a.length;++s<l;){var u=a[s];if(Ns.isObject(u)){var p=Us.tryCatch(u.unsubscribe).call(u);if(p===Ls.errorObject){t=!0,e=e||[];var h=Ls.errorObject.e;h instanceof Gs.UnsubscriptionError?e=e.concat(c(h.errors)):e.push(h)}}}if(t)throw new Gs.UnsubscriptionError(e)}},e.prototype.add=function(t){if(!t||t===e.EMPTY)return e.EMPTY;if(t===this)return this;var n=t;switch(typeof t){case"function":n=new e(t);case"object":if(n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if("function"!=typeof n._addParent){var r=n;(n=new e)._subscriptions=[r]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}return(this._subscriptions||(this._subscriptions=[])).push(n),n._addParent(this),n},e.prototype.remove=function(e){var t=this._subscriptions;if(t){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}},e.prototype._addParent=function(e){var t=this,n=t._parent,r=t._parents;n&&n!==e?r?-1===r.indexOf(e)&&r.push(e):this._parents=[e]:this._parent=e},e.EMPTY=function(e){return e.closed=!0,e}(new e),e}(),Qs=zs,Ks={Subscription:Qs},Xs={closed:!0,next:function(e){},error:function(e){throw e},complete:function(){}},Ys={empty:Xs},qs=i(function(e,t){var n=Ts.root.Symbol;t.rxSubscriber="function"==typeof n&&"function"==typeof n.for?n.for("rxSubscriber"):"@@rxSubscriber",t.$$rxSubscriber=t.rxSubscriber}),Js=Es&&Es.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},$s=function(e){function t(n,r,i){switch(e.call(this),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=Ys.empty;break;case 1:if(!n){this.destination=Ys.empty;break}if("object"==typeof n){n instanceof t?(this.destination=n,this.destination.add(this)):(this.syncErrorThrowable=!0,this.destination=new tl(this,n));break}default:this.syncErrorThrowable=!0,this.destination=new tl(this,n,r,i)}}return Js(t,e),t.prototype[qs.rxSubscriber]=function(){return this},t.create=function(e,n,r){var i=new t(e,n,r);return i.syncErrorThrowable=!1,i},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this,t=e._parent,n=e._parents;return this._parent=null,this._parents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parent=t,this._parents=n,this},t}(Ks.Subscription),el=$s,tl=function(e){function t(t,n,r,i){e.call(this),this._parentSubscriber=t;var o,a=this;Fs.isFunction(n)?o=n:n&&(o=n.next,r=n.error,i=n.complete,n!==Ys.empty&&(a=Object.create(n),Fs.isFunction(a.unsubscribe)&&this.add(a.unsubscribe.bind(a)),a.unsubscribe=this.unsubscribe.bind(this))),this._context=a,this._next=o,this._error=r,this._complete=i}return Js(t,e),t.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}},t.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber;if(this._error)t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else{if(!t.syncErrorThrowable)throw this.unsubscribe(),e;t.syncErrorValue=e,t.syncErrorThrown=!0,this.unsubscribe()}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var n=function(){return e._complete.call(e._context)};t.syncErrorThrowable?(this.__tryOrSetError(t,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(e){throw this.unsubscribe(),e}},t.prototype.__tryOrSetError=function(e,t,n){try{t.call(this._context,n)}catch(t){return e.syncErrorValue=t,e.syncErrorThrown=!0,!0}return!1},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()},t}($s),nl={Subscriber:el},rl=u,il={toSubscriber:rl},ol=i(function(e,t){function n(e){var t,n=e.Symbol;return"function"==typeof n?n.observable?t=n.observable:(t=n("observable"),n.observable=t):t="@@observable",t}t.getSymbolObservable=n,t.observable=n(Ts.root),t.$$observable=t.observable}),al=function(){function e(e){this._isScalar=!1,e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r=this.operator,i=il.toSubscriber(e,t,n);if(r?r.call(i,this.source):i.add(this.source?this._subscribe(i):this._trySubscribe(i)),i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.syncErrorThrown=!0,e.syncErrorValue=t,e.error(t)}},e.prototype.forEach=function(e,t){var n=this;if(t||(Ts.root.Rx&&Ts.root.Rx.config&&Ts.root.Rx.config.Promise?t=Ts.root.Rx.config.Promise:Ts.root.Promise&&(t=Ts.root.Promise)),!t)throw new Error("no Promise impl found");return new t(function(t,r){var i;i=n.subscribe(function(t){if(i)try{e(t)}catch(e){r(e),i.unsubscribe()}else e(t)},r,t)})},e.prototype._subscribe=function(e){return this.source.subscribe(e)},e.prototype[ol.observable]=function(){return this},e.create=function(t){return new e(t)},e}(),sl=al,ll={Observable:sl},cl=Es&&Es.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},ul=function(e){function t(){var t=e.call(this,"object unsubscribed");this.name=t.name="ObjectUnsubscribedError",this.stack=t.stack,this.message=t.message}return cl(t,e),t}(Error),pl=ul,hl={ObjectUnsubscribedError:pl},fl=Es&&Es.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},dl=function(e){function t(t,n){e.call(this),this.subject=t,this.subscriber=n,this.closed=!1}return fl(t,e),t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var e=this.subject,t=e.observers;if(this.subject=null,t&&0!==t.length&&!e.isStopped&&!e.closed){var n=t.indexOf(this.subscriber);-1!==n&&t.splice(n,1)}}},t}(Ks.Subscription),ml=dl,gl={SubjectSubscription:ml},vl=Es&&Es.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},yl=function(e){function t(t){e.call(this,t),this.destination=t}return vl(t,e),t}(nl.Subscriber),_l=yl,bl=function(e){function t(){e.call(this),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}return vl(t,e),t.prototype[qs.rxSubscriber]=function(){return new yl(this)},t.prototype.lift=function(e){var t=new Cl(this,this);return t.operator=e,t},t.prototype.next=function(e){if(this.closed)throw new hl.ObjectUnsubscribedError;if(!this.isStopped)for(var t=this.observers,n=t.length,r=t.slice(),i=0;i<n;i++)r[i].next(e)},t.prototype.error=function(e){if(this.closed)throw new hl.ObjectUnsubscribedError;this.hasError=!0,this.thrownError=e,this.isStopped=!0;for(var t=this.observers,n=t.length,r=t.slice(),i=0;i<n;i++)r[i].error(e);this.observers.length=0},t.prototype.complete=function(){if(this.closed)throw new hl.ObjectUnsubscribedError;this.isStopped=!0;for(var e=this.observers,t=e.length,n=e.slice(),r=0;r<t;r++)n[r].complete();this.observers.length=0},t.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},t.prototype._trySubscribe=function(t){if(this.closed)throw new hl.ObjectUnsubscribedError;return e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){if(this.closed)throw new hl.ObjectUnsubscribedError;return this.hasError?(e.error(this.thrownError),Ks.Subscription.EMPTY):this.isStopped?(e.complete(),Ks.Subscription.EMPTY):(this.observers.push(e),new gl.SubjectSubscription(this,e))},t.prototype.asObservable=function(){var e=new ll.Observable;return e.source=this,e},t.create=function(e,t){return new Cl(e,t)},t}(ll.Observable),wl=bl,Cl=function(e){function t(t,n){e.call(this),this.destination=t,this.source=n}return vl(t,e),t.prototype.next=function(e){var t=this.destination;t&&t.next&&t.next(e)},t.prototype.error=function(e){var t=this.destination;t&&t.error&&this.destination.error(e)},t.prototype.complete=function(){var e=this.destination;e&&e.complete&&this.destination.complete()},t.prototype._subscribe=function(e){return this.source?this.source.subscribe(e):Ks.Subscription.EMPTY},t}(bl),Al=Cl,El={SubjectSubscriber:_l,Subject:wl,AnonymousSubject:Al},kl=Es&&Es.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},xl=function(e){function t(t){e.call(this),this._value=t}return kl(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return n&&!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new hl.ObjectUnsubscribedError;return this._value},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(El.Subject),jl=xl,Il={BehaviorSubject:jl},Sl=!("undefined"==typeof module||!module.exports||"undefined"==typeof process||"[object process]"!==Object.prototype.toString.call(process)),Tl=!Sl&&"undefined"!=typeof window&&"[object Window]"===Object.prototype.toString.call(window),Pl=h(),Fl=!(!Tl||!window.AFRAME),Rl=!(!Tl||!window.THREE),Ol=new Il.BehaviorSubject,Dl=new Il.BehaviorSubject,Nl={isDebugMode:!1,isNode:Sl,isBrowser:Tl,assertBrowser:p,isMobile:f(),domReady:r,isVisible$:Ol,isFocused$:Dl,has:{webGl:!!Pl,aframe:Fl,three:Rl},webGl:Pl,libInfo:{npmName:ds.name,version:ds.version,homepage:ds.homepage,githubRepository:ds.repository,gitBranchName:es,gitCommitHash:ts.substr(0,7),buildDate:$a,license:ds.license}};Tl&&r(function(e){Ol.next(d());var t;void 0!==document.hidden?t="visibilitychange":void 0!==document.mozHidden?t="mozvisibilitychange":void 0!==document.msHidden?t="msvisibilitychange":void 0!==document.webkitHidden&&(t="webkitvisibilitychange"),e.addEventListener(t,function(){Ol.next(d())},!1)}),Tl&&r(function(){Dl.next(document.hasFocus()),window.onfocus=function(){Dl.next(!0)},window.onblur=function(){Dl.next(!1)}});var Vl=i(function(e,t){!function(t){e.exports=function(){var e,t,n;return function e(t,n,r){function i(a,s){if(!n[a]){if(!t[a]){var l="function"==typeof _dereq_&&_dereq_;if(!s&&l)return l(a,!0);if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[a]={exports:{}};t[a][0].call(u.exports,function(e){return i(t[a][1][e]||e)},u,u.exports,e,t,n,r)}return n[a].exports}for(var o="function"==typeof _dereq_&&_dereq_,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,n){t.exports=function(e){function t(e){var t=new n(e),r=t.promise();return t.setHowMany(1),t.setUnwrap(),t.init(),r}var n=e._SomePromiseArray;e.any=function(e){return t(e)},e.prototype.any=function(){return t(this)}}},{}],2:[function(e,t,n){function r(){this._customScheduler=!1,this._isTickUsed=!1,this._lateQueue=new c(16),this._normalQueue=new c(16),this._haveDrainedQueues=!1,this._trampolineEnabled=!0;var e=this;this.drainQueues=function(){e._drainQueues()},this._schedule=l}function i(e,t,n){this._lateQueue.push(e,t,n),this._queueTick()}function o(e,t,n){this._normalQueue.push(e,t,n),this._queueTick()}function a(e){this._normalQueue._pushOne(e),this._queueTick()}var s;try{throw new Error}catch(e){s=e}var l=e("./schedule"),c=e("./queue"),u=e("./util");r.prototype.setScheduler=function(e){var t=this._schedule;return this._schedule=e,this._customScheduler=!0,t},r.prototype.hasCustomScheduler=function(){return this._customScheduler},r.prototype.enableTrampoline=function(){this._trampolineEnabled=!0},r.prototype.disableTrampolineIfNecessary=function(){u.hasDevTools&&(this._trampolineEnabled=!1)},r.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues},r.prototype.fatalError=function(e,t){t?(process.stderr.write("Fatal "+(e instanceof Error?e.stack:e)+"\n"),process.exit(2)):this.throwLater(e)},r.prototype.throwLater=function(e,t){if(1===arguments.length&&(t=e,e=function(){throw t}),"undefined"!=typeof setTimeout)setTimeout(function(){e(t)},0);else try{this._schedule(function(){e(t)})}catch(e){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}},u.hasDevTools?(r.prototype.invokeLater=function(e,t,n){this._trampolineEnabled?i.call(this,e,t,n):this._schedule(function(){setTimeout(function(){e.call(t,n)},100)})},r.prototype.invoke=function(e,t,n){this._trampolineEnabled?o.call(this,e,t,n):this._schedule(function(){e.call(t,n)})},r.prototype.settlePromises=function(e){this._trampolineEnabled?a.call(this,e):this._schedule(function(){e._settlePromises()})}):(r.prototype.invokeLater=i,r.prototype.invoke=o,r.prototype.settlePromises=a),r.prototype._drainQueue=function(e){for(;e.length()>0;){var t=e.shift();if("function"==typeof t){var n=e.shift(),r=e.shift();t.call(n,r)}else t._settlePromises()}},r.prototype._drainQueues=function(){this._drainQueue(this._normalQueue),this._reset(),this._haveDrainedQueues=!0,this._drainQueue(this._lateQueue)},r.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},r.prototype._reset=function(){this._isTickUsed=!1},t.exports=r,t.exports.firstLineError=s},{"./queue":26,"./schedule":29,"./util":36}],3:[function(e,t,n){t.exports=function(e,t,n,r){var i=!1,o=function(e,t){this._reject(t)},a=function(e,t){t.promiseRejectionQueued=!0,t.bindingPromise._then(o,o,null,this,e)},s=function(e,t){0==(50397184&this._bitField)&&this._resolveCallback(t.target)},l=function(e,t){t.promiseRejectionQueued||this._reject(e)};e.prototype.bind=function(o){i||(i=!0,e.prototype._propagateFrom=r.propagateFromFunction(),e.prototype._boundValue=r.boundValueFunction());var c=n(o),u=new e(t);u._propagateFrom(this,1);var p=this._target();if(u._setBoundTo(c),c instanceof e){var h={promiseRejectionQueued:!1,promise:u,target:p,bindingPromise:c};p._then(t,a,void 0,u,h),c._then(s,l,void 0,u,h),u._setOnCancel(c)}else u._resolveCallback(p);return u},e.prototype._setBoundTo=function(e){void 0!==e?(this._bitField=2097152|this._bitField,this._boundTo=e):this._bitField=-2097153&this._bitField},e.prototype._isBound=function(){return 2097152==(2097152&this._bitField)},e.bind=function(t,n){return e.resolve(n).bind(t)}}},{}],4:[function(e,t,n){function r(){try{Promise===o&&(Promise=i)}catch(e){}return o}var i;"undefined"!=typeof Promise&&(i=Promise);var o=e("./promise")();o.noConflict=r,t.exports=o},{"./promise":22}],5:[function(e,t,n){var r=Object.create;if(r){var i=r(null),o=r(null);i[" size"]=o[" size"]=0}t.exports=function(t){function n(e,n){var r;if(null!=e&&(r=e[n]),"function"!=typeof r){var i="Object "+a.classString(e)+" has no method '"+a.toString(n)+"'";throw new t.TypeError(i)}return r}function r(e){return n(e,this.pop()).apply(e,this)}function i(e){return e[this]}function o(e){var t=+this;return t<0&&(t=Math.max(0,t+e.length)),e[t]}var a=e("./util"),s=a.canEvaluate;a.isIdentifier,t.prototype.call=function(e){var t=[].slice.call(arguments,1);return t.push(e),this._then(r,void 0,void 0,t,void 0)},t.prototype.get=function(e){var t;if("number"==typeof e)t=o;else if(s){var n=(void 0)(e);t=null!==n?n:i}else t=i;return this._then(t,void 0,void 0,e,void 0)}}},{"./util":36}],6:[function(e,t,n){t.exports=function(t,n,r,i){var o=e("./util"),a=o.tryCatch,s=o.errorObj,l=t._async;t.prototype.break=t.prototype.cancel=function(){if(!i.cancellation())return this._warn("cancellation is disabled");for(var e=this,t=e;e._isCancellable();){if(!e._cancelBy(t)){t._isFollowing()?t._followee().cancel():t._cancelBranched();break}var n=e._cancellationParent;if(null==n||!n._isCancellable()){e._isFollowing()?e._followee().cancel():e._cancelBranched();break}e._isFollowing()&&e._followee().cancel(),e._setWillBeCancelled(),t=e,e=n}},t.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--},t.prototype._enoughBranchesHaveCancelled=function(){return void 0===this._branchesRemainingToCancel||this._branchesRemainingToCancel<=0},t.prototype._cancelBy=function(e){return e===this?(this._branchesRemainingToCancel=0,this._invokeOnCancel(),!0):(this._branchHasCancelled(),!!this._enoughBranchesHaveCancelled()&&(this._invokeOnCancel(),!0))},t.prototype._cancelBranched=function(){this._enoughBranchesHaveCancelled()&&this._cancel()},t.prototype._cancel=function(){this._isCancellable()&&(this._setCancelled(),l.invoke(this._cancelPromises,this,void 0))},t.prototype._cancelPromises=function(){this._length()>0&&this._settlePromises()},t.prototype._unsetOnCancel=function(){this._onCancelField=void 0},t.prototype._isCancellable=function(){return this.isPending()&&!this._isCancelled()},t.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()},t.prototype._doInvokeOnCancel=function(e,t){if(o.isArray(e))for(var n=0;n<e.length;++n)this._doInvokeOnCancel(e[n],t);else if(void 0!==e)if("function"==typeof e){if(!t){var r=a(e).call(this._boundValue());r===s&&(this._attachExtraTrace(r.e),l.throwLater(r.e))}}else e._resultCancelled(this)},t.prototype._invokeOnCancel=function(){var e=this._onCancel();this._unsetOnCancel(),l.invoke(this._doInvokeOnCancel,this,e)},t.prototype._invokeInternalOnCancel=function(){this._isCancellable()&&(this._doInvokeOnCancel(this._onCancel(),!0),this._unsetOnCancel())},t.prototype._resultCancelled=function(){this.cancel()}}},{"./util":36}],7:[function(e,t,n){t.exports=function(t){function n(e,n,s){return function(l){var c=s._boundValue();e:for(var u=0;u<e.length;++u){var p=e[u];if(p===Error||null!=p&&p.prototype instanceof Error){if(l instanceof p)return o(n).call(c,l)}else if("function"==typeof p){var h=o(p).call(c,l);if(h===a)return h;if(h)return o(n).call(c,l)}else if(r.isObject(l)){for(var f=i(p),d=0;d<f.length;++d){var m=f[d];if(p[m]!=l[m])continue e}return o(n).call(c,l)}}return t}}var r=e("./util"),i=e("./es5").keys,o=r.tryCatch,a=r.errorObj;return n}},{"./es5":13,"./util":36}],8:[function(e,t,n){t.exports=function(e){function t(){this._trace=new t.CapturedTrace(r())}function n(){if(i)return new t}function r(){var e=o.length-1;if(e>=0)return o[e]}var i=!1,o=[];return e.prototype._promiseCreated=function(){},e.prototype._pushContext=function(){},e.prototype._popContext=function(){return null},e._peekContext=e.prototype._peekContext=function(){},t.prototype._pushContext=function(){void 0!==this._trace&&(this._trace._promiseCreated=null,o.push(this._trace))},t.prototype._popContext=function(){if(void 0!==this._trace){var e=o.pop(),t=e._promiseCreated;return e._promiseCreated=null,t}return null},t.CapturedTrace=null,t.create=n,t.deactivateLongStackTraces=function(){},t.activateLongStackTraces=function(){var n=e.prototype._pushContext,o=e.prototype._popContext,a=e._peekContext,s=e.prototype._peekContext,l=e.prototype._promiseCreated;t.deactivateLongStackTraces=function(){e.prototype._pushContext=n,e.prototype._popContext=o,e._peekContext=a,e.prototype._peekContext=s,e.prototype._promiseCreated=l,i=!1},i=!0,e.prototype._pushContext=t.prototype._pushContext,e.prototype._popContext=t.prototype._popContext,e._peekContext=e.prototype._peekContext=r,e.prototype._promiseCreated=function(){var e=this._peekContext();e&&null==e._promiseCreated&&(e._promiseCreated=this)}},t}},{}],9:[function(e,t,n){t.exports=function(t,n){function r(e,t){return{promise:t}}function i(){return!1}function o(e,t,n){var r=this;try{e(t,n,function(e){if("function"!=typeof e)throw new TypeError("onCancel must be a function, got: "+L.toString(e));r._attachCancellationCallback(e)})}catch(e){return e}}function a(e){if(!this._isCancellable())return this;var t=this._onCancel();void 0!==t?L.isArray(t)?t.push(e):this._setOnCancel([t,e]):this._setOnCancel(e)}function s(){return this._onCancelField}function l(e){this._onCancelField=e}function c(){this._cancellationParent=void 0,this._onCancelField=void 0}function u(e,t){if(0!=(1&t)){this._cancellationParent=e;var n=e._branchesRemainingToCancel;void 0===n&&(n=0),e._branchesRemainingToCancel=n+1}0!=(2&t)&&e._isBound()&&this._setBoundTo(e._boundTo)}function p(e,t){0!=(2&t)&&e._isBound()&&this._setBoundTo(e._boundTo)}function h(){var e=this._boundTo;return void 0!==e&&e instanceof t?e.isFulfilled()?e.value():void 0:e}function f(){this._trace=new P(this._peekContext())}function d(e,t){if(M(e)){var n=this._trace;if(void 0!==n&&t&&(n=n._parent),void 0!==n)n.attachExtraTrace(e);else if(!e.__stackCleaned__){var r=A(e);L.notEnumerableProp(e,"stack",r.message+"\n"+r.stack.join("\n")),L.notEnumerableProp(e,"__stackCleaned__",!0)}}}function m(e,t,n,r,i){if(void 0===e&&null!==t&&X){if(void 0!==i&&i._returnedNonUndefined())return;if(0==(65535&r._bitField))return;n&&(n+=" ");var o="",a="";if(t._trace){for(var s=t._trace.stack.split("\n"),l=w(s),c=l.length-1;c>=0;--c){var u=l[c];if(!U.test(u)){var p=u.match(W);p&&(o="at "+p[1]+":"+p[2]+":"+p[3]+" ");break}}if(l.length>0)for(var h=l[0],c=0;c<s.length;++c)if(s[c]===h){c>0&&(a="\n"+s[c-1]);break}}var f="a promise was created in a "+n+"handler "+o+"but was not returned from it, see http://goo.gl/rRqMUw"+a;r._warn(f,!0,t)}}function g(e,t){var n=e+" is deprecated and will be removed in a future version.";return t&&(n+=" Use "+t+" instead."),v(n)}function v(e,n,r){if(oe.warnings){var i,o=new V(e);if(n)r._attachExtraTrace(o);else if(oe.longStackTraces&&(i=t._peekContext()))i.attachExtraTrace(o);else{var a=A(o);o.stack=a.message+"\n"+a.stack.join("\n")}ee("warning",o)||E(o,"",!0)}}function y(e,t){for(var n=0;n<t.length-1;++n)t[n].push("From previous event:"),t[n]=t[n].join("\n");return n<t.length&&(t[n]=t[n].join("\n")),e+"\n"+t.join("\n")}function _(e){for(var t=0;t<e.length;++t)(0===e[t].length||t+1<e.length&&e[t][0]===e[t+1][0])&&(e.splice(t,1),t--)}function b(e){for(var t=e[0],n=1;n<e.length;++n){for(var r=e[n],i=t.length-1,o=t[i],a=-1,s=r.length-1;s>=0;--s)if(r[s]===o){a=s;break}for(s=a;s>=0;--s){var l=r[s];if(t[i]!==l)break;t.pop(),i--}t=r}}function w(e){for(var t=[],n=0;n<e.length;++n){var r=e[n],i="    (No stack trace)"===r||Z.test(r),o=i&&ne(r);i&&!o&&(G&&" "!==r.charAt(0)&&(r="    "+r),t.push(r))}return t}function C(e){for(var t=e.stack.replace(/\s+$/g,"").split("\n"),n=0;n<t.length;++n){var r=t[n];if("    (No stack trace)"===r||Z.test(r))break}return n>0&&"SyntaxError"!=e.name&&(t=t.slice(n)),t}function A(e){var t=e.stack,n=e.toString();return t="string"==typeof t&&t.length>0?C(e):["    (No stack trace)"],{message:n,stack:"SyntaxError"==e.name?t:w(t)}}function E(e,t,n){if("undefined"!=typeof console){var r;if(L.isObject(e)){var i=e.stack;r=t+H(i,e)}else r=t+String(e);"function"==typeof O?O(r,n):"function"!=typeof console.log&&"object"!=typeof console.log||console.log(r)}}function k(e,t,n,r){var i=!1;try{"function"==typeof t&&(i=!0,"rejectionHandled"===e?t(r):t(n,r))}catch(e){N.throwLater(e)}"unhandledRejection"===e?ee(e,n,r)||i||E(n,"Unhandled rejection "):ee(e,r)}function x(e){var t;if("function"==typeof e)t="[function "+(e.name||"anonymous")+"]";else{if(t=e&&"function"==typeof e.toString?e.toString():L.toString(e),/\[object [a-zA-Z0-9$_]+\]/.test(t))try{t=JSON.stringify(e)}catch(e){}0===t.length&&(t="(empty array)")}return"(<"+j(t)+">, no stack trace)"}function j(e){return e.length<41?e:e.substr(0,38)+"..."}function I(){return"function"==typeof ie}function S(e){var t=e.match(re);if(t)return{fileName:t[1],line:parseInt(t[2],10)}}function T(e,t){if(I()){for(var n,r,i=e.stack.split("\n"),o=t.stack.split("\n"),a=-1,s=-1,l=0;l<i.length;++l)if(c=S(i[l])){n=c.fileName,a=c.line;break}for(l=0;l<o.length;++l){var c=S(o[l]);if(c){r=c.fileName,s=c.line;break}}a<0||s<0||!n||!r||n!==r||a>=s||(ne=function(e){if(B.test(e))return!0;var t=S(e);return!!(t&&t.fileName===n&&a<=t.line&&t.line<=s)})}}function P(e){this._parent=e,this._promisesCreated=0;var t=this._length=1+(void 0===e?0:e._length);ie(this,P),t>32&&this.uncycle()}var F,R,O,D=t._getDomain,N=t._async,V=e("./errors").Warning,L=e("./util"),M=L.canAttachTrace,B=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,U=/\((?:timers\.js):\d+:\d+\)/,W=/[\/<\(](.+?):(\d+):(\d+)\)?\s*$/,Z=null,H=null,G=!1,z=!(0==L.env("BLUEBIRD_DEBUG")),Q=!(0==L.env("BLUEBIRD_WARNINGS")||!z&&!L.env("BLUEBIRD_WARNINGS")),K=!(0==L.env("BLUEBIRD_LONG_STACK_TRACES")||!z&&!L.env("BLUEBIRD_LONG_STACK_TRACES")),X=0!=L.env("BLUEBIRD_W_FORGOTTEN_RETURN")&&(Q||!!L.env("BLUEBIRD_W_FORGOTTEN_RETURN"));t.prototype.suppressUnhandledRejections=function(){var e=this._target();e._bitField=-1048577&e._bitField|524288},t.prototype._ensurePossibleRejectionHandled=function(){0==(524288&this._bitField)&&(this._setRejectionIsUnhandled(),N.invokeLater(this._notifyUnhandledRejection,this,void 0))},t.prototype._notifyUnhandledRejectionIsHandled=function(){k("rejectionHandled",F,void 0,this)},t.prototype._setReturnedNonUndefined=function(){this._bitField=268435456|this._bitField},t.prototype._returnedNonUndefined=function(){return 0!=(268435456&this._bitField)},t.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var e=this._settledValue();this._setUnhandledRejectionIsNotified(),k("unhandledRejection",R,e,this)}},t.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=262144|this._bitField},t.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-262145&this._bitField},t.prototype._isUnhandledRejectionNotified=function(){return(262144&this._bitField)>0},t.prototype._setRejectionIsUnhandled=function(){this._bitField=1048576|this._bitField},t.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-1048577&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},t.prototype._isRejectionUnhandled=function(){return(1048576&this._bitField)>0},t.prototype._warn=function(e,t,n){return v(e,t,n||this)},t.onPossiblyUnhandledRejection=function(e){var t=D();R="function"==typeof e?null===t?e:L.domainBind(t,e):void 0},t.onUnhandledRejectionHandled=function(e){var t=D();F="function"==typeof e?null===t?e:L.domainBind(t,e):void 0};var Y=function(){};t.longStackTraces=function(){if(N.haveItemsQueued()&&!oe.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");if(!oe.longStackTraces&&I()){var e=t.prototype._captureStackTrace,r=t.prototype._attachExtraTrace;oe.longStackTraces=!0,Y=function(){if(N.haveItemsQueued()&&!oe.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");t.prototype._captureStackTrace=e,t.prototype._attachExtraTrace=r,n.deactivateLongStackTraces(),N.enableTrampoline(),oe.longStackTraces=!1},t.prototype._captureStackTrace=f,t.prototype._attachExtraTrace=d,n.activateLongStackTraces(),N.disableTrampolineIfNecessary()}},t.hasLongStackTraces=function(){return oe.longStackTraces&&I()};var q=function(){try{if("function"==typeof CustomEvent)return e=new CustomEvent("CustomEvent"),L.global.dispatchEvent(e),function(e,t){var n=new CustomEvent(e.toLowerCase(),{detail:t,cancelable:!0});return!L.global.dispatchEvent(n)};if("function"==typeof Event){var e=new Event("CustomEvent");return L.global.dispatchEvent(e),function(e,t){var n=new Event(e.toLowerCase(),{cancelable:!0});return n.detail=t,!L.global.dispatchEvent(n)}}return(e=document.createEvent("CustomEvent")).initCustomEvent("testingtheevent",!1,!0,{}),L.global.dispatchEvent(e),function(e,t){var n=document.createEvent("CustomEvent");return n.initCustomEvent(e.toLowerCase(),!1,!0,t),!L.global.dispatchEvent(n)}}catch(e){}return function(){return!1}}(),J=function(){return L.isNode?function(){return process.emit.apply(process,arguments)}:L.global?function(e){var t="on"+e.toLowerCase(),n=L.global[t];return!!n&&(n.apply(L.global,[].slice.call(arguments,1)),!0)}:function(){return!1}}(),$={promiseCreated:r,promiseFulfilled:r,promiseRejected:r,promiseResolved:r,promiseCancelled:r,promiseChained:function(e,t,n){return{promise:t,child:n}},warning:function(e,t){return{warning:t}},unhandledRejection:function(e,t,n){return{reason:t,promise:n}},rejectionHandled:r},ee=function(e){var t=!1;try{t=J.apply(null,arguments)}catch(e){N.throwLater(e),t=!0}var n=!1;try{n=q(e,$[e].apply(null,arguments))}catch(e){N.throwLater(e),n=!0}return n||t};t.config=function(e){if("longStackTraces"in(e=Object(e))&&(e.longStackTraces?t.longStackTraces():!e.longStackTraces&&t.hasLongStackTraces()&&Y()),"warnings"in e){var n=e.warnings;oe.warnings=!!n,X=oe.warnings,L.isObject(n)&&"wForgottenReturn"in n&&(X=!!n.wForgottenReturn)}if("cancellation"in e&&e.cancellation&&!oe.cancellation){if(N.haveItemsQueued())throw new Error("cannot enable cancellation after promises are in use");t.prototype._clearCancellationData=c,t.prototype._propagateFrom=u,t.prototype._onCancel=s,t.prototype._setOnCancel=l,t.prototype._attachCancellationCallback=a,t.prototype._execute=o,te=u,oe.cancellation=!0}return"monitoring"in e&&(e.monitoring&&!oe.monitoring?(oe.monitoring=!0,t.prototype._fireEvent=ee):!e.monitoring&&oe.monitoring&&(oe.monitoring=!1,t.prototype._fireEvent=i)),t},t.prototype._fireEvent=i,t.prototype._execute=function(e,t,n){try{e(t,n)}catch(e){return e}},t.prototype._onCancel=function(){},t.prototype._setOnCancel=function(e){},t.prototype._attachCancellationCallback=function(e){},t.prototype._captureStackTrace=function(){},t.prototype._attachExtraTrace=function(){},t.prototype._clearCancellationData=function(){},t.prototype._propagateFrom=function(e,t){};var te=p,ne=function(){return!1},re=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;L.inherits(P,Error),n.CapturedTrace=P,P.prototype.uncycle=function(){var e=this._length;if(!(e<2)){for(var t=[],n={},r=0,i=this;void 0!==i;++r)t.push(i),i=i._parent;for(r=(e=this._length=r)-1;r>=0;--r){var o=t[r].stack;void 0===n[o]&&(n[o]=r)}for(r=0;r<e;++r){var a=n[t[r].stack];if(void 0!==a&&a!==r){a>0&&(t[a-1]._parent=void 0,t[a-1]._length=1),t[r]._parent=void 0,t[r]._length=1;var s=r>0?t[r-1]:this;a<e-1?(s._parent=t[a+1],s._parent.uncycle(),s._length=s._parent._length+1):(s._parent=void 0,s._length=1);for(var l=s._length+1,c=r-2;c>=0;--c)t[c]._length=l,l++;return}}}},P.prototype.attachExtraTrace=function(e){if(!e.__stackCleaned__){this.uncycle();for(var t=A(e),n=t.message,r=[t.stack],i=this;void 0!==i;)r.push(w(i.stack.split("\n"))),i=i._parent;b(r),_(r),L.notEnumerableProp(e,"stack",y(n,r)),L.notEnumerableProp(e,"__stackCleaned__",!0)}};var ie=function(){var e=/^\s*at\s*/,t=function(e,t){return"string"==typeof e?e:void 0!==t.name&&void 0!==t.message?t.toString():x(t)};if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){Error.stackTraceLimit+=6,Z=e,H=t;var n=Error.captureStackTrace;return ne=function(e){return B.test(e)},function(e,t){Error.stackTraceLimit+=6,n(e,t),Error.stackTraceLimit-=6}}var r=new Error;if("string"==typeof r.stack&&r.stack.split("\n")[0].indexOf("stackDetection@")>=0)return Z=/@/,H=t,G=!0,function(e){e.stack=(new Error).stack};var i;try{throw new Error}catch(e){i="stack"in e}return"stack"in r||!i||"number"!=typeof Error.stackTraceLimit?(H=function(e,t){return"string"==typeof e?e:"object"!=typeof t&&"function"!=typeof t||void 0===t.name||void 0===t.message?x(t):t.toString()},null):(Z=e,H=t,function(e){Error.stackTraceLimit+=6;try{throw new Error}catch(t){e.stack=t.stack}Error.stackTraceLimit-=6})}();"undefined"!=typeof console&&void 0!==console.warn&&(O=function(e){console.warn(e)},L.isNode&&process.stderr.isTTY?O=function(e,t){var n=t?"[33m":"[31m";console.warn(n+e+"[0m\n")}:L.isNode||"string"!=typeof(new Error).stack||(O=function(e,t){console.warn("%c"+e,t?"color: darkorange":"color: red")}));var oe={warnings:Q,longStackTraces:!1,cancellation:!1,monitoring:!1};return K&&t.longStackTraces(),{longStackTraces:function(){return oe.longStackTraces},warnings:function(){return oe.warnings},cancellation:function(){return oe.cancellation},monitoring:function(){return oe.monitoring},propagateFromFunction:function(){return te},boundValueFunction:function(){return h},checkForgottenReturns:m,setBounds:T,warn:v,deprecated:g,CapturedTrace:P,fireDomEvent:q,fireGlobalEvent:J}}},{"./errors":12,"./util":36}],10:[function(e,t,n){t.exports=function(e){function t(){return this.value}function n(){throw this.reason}e.prototype.return=e.prototype.thenReturn=function(n){return n instanceof e&&n.suppressUnhandledRejections(),this._then(t,void 0,void 0,{value:n},void 0)},e.prototype.throw=e.prototype.thenThrow=function(e){return this._then(n,void 0,void 0,{reason:e},void 0)},e.prototype.catchThrow=function(e){if(arguments.length<=1)return this._then(void 0,n,void 0,{reason:e},void 0);var t=arguments[1],r=function(){throw t};return this.caught(e,r)},e.prototype.catchReturn=function(n){if(arguments.length<=1)return n instanceof e&&n.suppressUnhandledRejections(),this._then(void 0,t,void 0,{value:n},void 0);var r=arguments[1];r instanceof e&&r.suppressUnhandledRejections();var i=function(){return r};return this.caught(n,i)}}},{}],11:[function(e,t,n){t.exports=function(e,t){function n(){return o(this)}function r(e,n){return i(e,n,t,t)}var i=e.reduce,o=e.all;e.prototype.each=function(e){return i(this,e,t,0)._then(n,void 0,void 0,this,void 0)},e.prototype.mapSeries=function(e){return i(this,e,t,t)},e.each=function(e,r){return i(e,r,t,0)._then(n,void 0,void 0,e,void 0)},e.mapSeries=r}},{}],12:[function(e,t,n){function r(e,t){function n(r){if(!(this instanceof n))return new n(r);p(this,"message","string"==typeof r?r:t),p(this,"name",e),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this)}return u(n,Error),n}function i(e){if(!(this instanceof i))return new i(e);p(this,"name","OperationalError"),p(this,"message",e),this.cause=e,this.isOperational=!0,e instanceof Error?(p(this,"message",e.message),p(this,"stack",e.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}var o,a,s=e("./es5"),l=s.freeze,c=e("./util"),u=c.inherits,p=c.notEnumerableProp,h=r("Warning","warning"),f=r("CancellationError","cancellation error"),d=r("TimeoutError","timeout error"),m=r("AggregateError","aggregate error");try{o=TypeError,a=RangeError}catch(e){o=r("TypeError","type error"),a=r("RangeError","range error")}for(var g="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),v=0;v<g.length;++v)"function"==typeof Array.prototype[g[v]]&&(m.prototype[g[v]]=Array.prototype[g[v]]);s.defineProperty(m.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),m.prototype.isOperational=!0;var y=0;m.prototype.toString=function(){var e=Array(4*y+1).join(" "),t="\n"+e+"AggregateError of:\n";y++,e=Array(4*y+1).join(" ");for(var n=0;n<this.length;++n){for(var r=this[n]===this?"[Circular AggregateError]":this[n]+"",i=r.split("\n"),o=0;o<i.length;++o)i[o]=e+i[o];t+=(r=i.join("\n"))+"\n"}return y--,t},u(i,Error);var _=Error.__BluebirdErrorTypes__;_||(_=l({CancellationError:f,TimeoutError:d,OperationalError:i,RejectionError:i,AggregateError:m}),s.defineProperty(Error,"__BluebirdErrorTypes__",{value:_,writable:!1,enumerable:!1,configurable:!1})),t.exports={Error:Error,TypeError:o,RangeError:a,CancellationError:_.CancellationError,OperationalError:_.OperationalError,TimeoutError:_.TimeoutError,AggregateError:_.AggregateError,Warning:h}},{"./es5":13,"./util":36}],13:[function(e,t,n){var r=function(){return void 0===this}();if(r)t.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:r,propertyIsWritable:function(e,t){var n=Object.getOwnPropertyDescriptor(e,t);return!(n&&!n.writable&&!n.set)}};else{var i={}.hasOwnProperty,o={}.toString,a={}.constructor.prototype,s=function(e){var t=[];for(var n in e)i.call(e,n)&&t.push(n);return t},l=function(e,t){return{value:e[t]}},c=function(e,t,n){return e[t]=n.value,e},u=function(e){return e},p=function(e){try{return Object(e).constructor.prototype}catch(e){return a}},h=function(e){try{return"[object Array]"===o.call(e)}catch(e){return!1}};t.exports={isArray:h,keys:s,names:s,defineProperty:c,getDescriptor:l,freeze:u,getPrototypeOf:p,isES5:r,propertyIsWritable:function(){return!0}}}},{}],14:[function(e,t,n){t.exports=function(e,t){var n=e.map;e.prototype.filter=function(e,r){return n(this,e,r,t)},e.filter=function(e,r,i){return n(e,r,i,t)}}},{}],15:[function(e,t,n){t.exports=function(t,n,r){function i(e,t,n){this.promise=e,this.type=t,this.handler=n,this.called=!1,this.cancelPromise=null}function o(e){this.finallyHandler=e}function a(e,t){return null!=e.cancelPromise&&(arguments.length>1?e.cancelPromise._reject(t):e.cancelPromise._cancel(),e.cancelPromise=null,!0)}function s(){return c.call(this,this.promise._target()._settledValue())}function l(e){if(!a(this,e))return h.e=e,h}function c(e){var i=this.promise,c=this.handler;if(!this.called){this.called=!0;var u=this.isFinallyHandler()?c.call(i._boundValue()):c.call(i._boundValue(),e);if(u===r)return u;if(void 0!==u){i._setReturnedNonUndefined();var f=n(u,i);if(f instanceof t){if(null!=this.cancelPromise){if(f._isCancelled()){var d=new p("late cancellation observer");return i._attachExtraTrace(d),h.e=d,h}f.isPending()&&f._attachCancellationCallback(new o(this))}return f._then(s,l,void 0,this,void 0)}}}return i.isRejected()?(a(this),h.e=e,h):(a(this),e)}var u=e("./util"),p=t.CancellationError,h=u.errorObj,f=e("./catch_filter")(r);return i.prototype.isFinallyHandler=function(){return 0===this.type},o.prototype._resultCancelled=function(){a(this.finallyHandler)},t.prototype._passThrough=function(e,t,n,r){return"function"!=typeof e?this.then():this._then(n,r,void 0,new i(this,t,e),void 0)},t.prototype.lastly=t.prototype.finally=function(e){return this._passThrough(e,0,c,c)},t.prototype.tap=function(e){return this._passThrough(e,1,c)},t.prototype.tapCatch=function(e){var n=arguments.length;if(1===n)return this._passThrough(e,1,void 0,c);var r,i=new Array(n-1),o=0;for(r=0;r<n-1;++r){var a=arguments[r];if(!u.isObject(a))return t.reject(new TypeError("tapCatch statement predicate: expecting an object but got "+u.classString(a)));i[o++]=a}i.length=o;var s=arguments[r];return this._passThrough(f(i,s,this),1,void 0,c)},i}},{"./catch_filter":7,"./util":36}],16:[function(e,t,n){t.exports=function(t,n,r,i,o,a){function s(e,n,r){for(var o=0;o<n.length;++o){r._pushContext();var a=h(n[o])(e);if(r._popContext(),a===p){r._pushContext();var s=t.reject(p.e);return r._popContext(),s}var l=i(a,r);if(l instanceof t)return l}return null}function l(e,n,i,o){if(a.cancellation()){var s=new t(r),l=this._finallyPromise=new t(r);this._promise=s.lastly(function(){return l}),s._captureStackTrace(),s._setOnCancel(this)}else(this._promise=new t(r))._captureStackTrace();this._stack=o,this._generatorFunction=e,this._receiver=n,this._generator=void 0,this._yieldHandlers="function"==typeof i?[i].concat(f):f,this._yieldedPromise=null,this._cancellationPhase=!1}var c=e("./errors").TypeError,u=e("./util"),p=u.errorObj,h=u.tryCatch,f=[];u.inherits(l,o),l.prototype._isResolved=function(){return null===this._promise},l.prototype._cleanup=function(){this._promise=this._generator=null,a.cancellation()&&null!==this._finallyPromise&&(this._finallyPromise._fulfill(),this._finallyPromise=null)},l.prototype._promiseCancelled=function(){if(!this._isResolved()){var e;if(void 0!==this._generator.return)this._promise._pushContext(),e=h(this._generator.return).call(this._generator,void 0),this._promise._popContext();else{var n=new t.CancellationError("generator .return() sentinel");t.coroutine.returnSentinel=n,this._promise._attachExtraTrace(n),this._promise._pushContext(),e=h(this._generator.throw).call(this._generator,n),this._promise._popContext()}this._cancellationPhase=!0,this._yieldedPromise=null,this._continue(e)}},l.prototype._promiseFulfilled=function(e){this._yieldedPromise=null,this._promise._pushContext();var t=h(this._generator.next).call(this._generator,e);this._promise._popContext(),this._continue(t)},l.prototype._promiseRejected=function(e){this._yieldedPromise=null,this._promise._attachExtraTrace(e),this._promise._pushContext();var t=h(this._generator.throw).call(this._generator,e);this._promise._popContext(),this._continue(t)},l.prototype._resultCancelled=function(){if(this._yieldedPromise instanceof t){var e=this._yieldedPromise;this._yieldedPromise=null,e.cancel()}},l.prototype.promise=function(){return this._promise},l.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._promiseFulfilled(void 0)},l.prototype._continue=function(e){var n=this._promise;if(e===p)return this._cleanup(),this._cancellationPhase?n.cancel():n._rejectCallback(e.e,!1);var r=e.value;if(!0===e.done)return this._cleanup(),this._cancellationPhase?n.cancel():n._resolveCallback(r);var o=i(r,this._promise);if(o instanceof t||null!==(o=s(o,this._yieldHandlers,this._promise))){var a=(o=o._target())._bitField;0==(50397184&a)?(this._yieldedPromise=o,o._proxy(this,null)):0!=(33554432&a)?t._async.invoke(this._promiseFulfilled,this,o._value()):0!=(16777216&a)?t._async.invoke(this._promiseRejected,this,o._reason()):this._promiseCancelled()}else this._promiseRejected(new c("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/MqrFmX\n\n".replace("%s",String(r))+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")))},t.coroutine=function(e,t){if("function"!=typeof e)throw new c("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var n=Object(t).yieldHandler,r=l,i=(new Error).stack;return function(){var t=e.apply(this,arguments),o=new r(void 0,void 0,n,i),a=o.promise();return o._generator=t,o._promiseFulfilled(void 0),a}},t.coroutine.addYieldHandler=function(e){if("function"!=typeof e)throw new c("expecting a function but got "+u.classString(e));f.push(e)},t.spawn=function(e){if(a.deprecated("Promise.spawn()","Promise.coroutine()"),"function"!=typeof e)return n("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var r=new l(e,this),i=r.promise();return r._run(t.spawn),i}}},{"./errors":12,"./util":36}],17:[function(e,t,n){t.exports=function(t,n,r,i,o,a){var s=e("./util");s.canEvaluate,s.tryCatch,s.errorObj,t.join=function(){var e,t=arguments.length-1;t>0&&"function"==typeof arguments[t]&&(e=arguments[t]);var r=[].slice.call(arguments);e&&r.pop();var i=new n(r).promise();return void 0!==e?i.spread(e):i}}},{"./util":36}],18:[function(e,t,n){t.exports=function(t,n,r,i,o,a){function s(e,t,n,r){this.constructor$(e),this._promise._captureStackTrace();var i=c();this._callback=null===i?t:u.domainBind(i,t),this._preservedValues=r===o?new Array(this.length()):null,this._limit=n,this._inFlight=0,this._queue=[],f.invoke(this._asyncInit,this,void 0)}function l(e,n,i,o){if("function"!=typeof n)return r("expecting a function but got "+u.classString(n));var a=0;if(void 0!==i){if("object"!=typeof i||null===i)return t.reject(new TypeError("options argument must be an object but it is "+u.classString(i)));if("number"!=typeof i.concurrency)return t.reject(new TypeError("'concurrency' must be a number but it is "+u.classString(i.concurrency)));a=i.concurrency}return a="number"==typeof a&&isFinite(a)&&a>=1?a:0,new s(e,n,a,o).promise()}var c=t._getDomain,u=e("./util"),p=u.tryCatch,h=u.errorObj,f=t._async;u.inherits(s,n),s.prototype._asyncInit=function(){this._init$(void 0,-2)},s.prototype._init=function(){},s.prototype._promiseFulfilled=function(e,n){var r=this._values,o=this.length(),s=this._preservedValues,l=this._limit;if(n<0){if(n=-1*n-1,r[n]=e,l>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return!0}else{if(l>=1&&this._inFlight>=l)return r[n]=e,this._queue.push(n),!1;null!==s&&(s[n]=e);var c=this._promise,u=this._callback,f=c._boundValue();c._pushContext();var d=p(u).call(f,e,n,o),m=c._popContext();if(a.checkForgottenReturns(d,m,null!==s?"Promise.filter":"Promise.map",c),d===h)return this._reject(d.e),!0;var g=i(d,this._promise);if(g instanceof t){var v=(g=g._target())._bitField;if(0==(50397184&v))return l>=1&&this._inFlight++,r[n]=g,g._proxy(this,-1*(n+1)),!1;if(0==(33554432&v))return 0!=(16777216&v)?(this._reject(g._reason()),!0):(this._cancel(),!0);d=g._value()}r[n]=d}return++this._totalResolved>=o&&(null!==s?this._filter(r,s):this._resolve(r),!0)},s.prototype._drainQueue=function(){for(var e=this._queue,t=this._limit,n=this._values;e.length>0&&this._inFlight<t;){if(this._isResolved())return;var r=e.pop();this._promiseFulfilled(n[r],r)}},s.prototype._filter=function(e,t){for(var n=t.length,r=new Array(n),i=0,o=0;o<n;++o)e[o]&&(r[i++]=t[o]);r.length=i,this._resolve(r)},s.prototype.preservedValues=function(){return this._preservedValues},t.prototype.map=function(e,t){return l(this,e,t,null)},t.map=function(e,t,n,r){return l(e,t,n,r)}}},{"./util":36}],19:[function(e,t,n){t.exports=function(t,n,r,i,o){var a=e("./util"),s=a.tryCatch;t.method=function(e){if("function"!=typeof e)throw new t.TypeError("expecting a function but got "+a.classString(e));return function(){var r=new t(n);r._captureStackTrace(),r._pushContext();var i=s(e).apply(this,arguments),a=r._popContext();return o.checkForgottenReturns(i,a,"Promise.method",r),r._resolveFromSyncValue(i),r}},t.attempt=t.try=function(e){if("function"!=typeof e)return i("expecting a function but got "+a.classString(e));var r=new t(n);r._captureStackTrace(),r._pushContext();var l;if(arguments.length>1){o.deprecated("calling Promise.try with more than 1 argument");var c=arguments[1],u=arguments[2];l=a.isArray(c)?s(e).apply(u,c):s(e).call(u,c)}else l=s(e)();var p=r._popContext();return o.checkForgottenReturns(l,p,"Promise.try",r),r._resolveFromSyncValue(l),r},t.prototype._resolveFromSyncValue=function(e){e===a.errorObj?this._rejectCallback(e.e,!1):this._resolveCallback(e,!0)}}},{"./util":36}],20:[function(e,t,n){function r(e){return e instanceof Error&&c.getPrototypeOf(e)===Error.prototype}function i(e){var t;if(r(e)){(t=new l(e)).name=e.name,t.message=e.message,t.stack=e.stack;for(var n=c.keys(e),i=0;i<n.length;++i){var o=n[i];u.test(o)||(t[o]=e[o])}return t}return a.markAsOriginatingFromRejection(e),e}function o(e,t){return function(n,r){if(null!==e){if(n){var o=i(s(n));e._attachExtraTrace(o),e._reject(o)}else if(t){var a=[].slice.call(arguments,1);e._fulfill(a)}else e._fulfill(r);e=null}}}var a=e("./util"),s=a.maybeWrapAsError,l=e("./errors").OperationalError,c=e("./es5"),u=/^(?:name|message|stack|cause)$/;t.exports=o},{"./errors":12,"./es5":13,"./util":36}],21:[function(e,t,n){t.exports=function(t){function n(e,t){var n=this;if(!o.isArray(e))return r.call(n,e,t);var i=s(t).apply(n._boundValue(),[null].concat(e));i===l&&a.throwLater(i.e)}function r(e,t){var n=this._boundValue(),r=void 0===e?s(t).call(n,null):s(t).call(n,null,e);r===l&&a.throwLater(r.e)}function i(e,t){var n=this;if(!e){var r=new Error(e+"");r.cause=e,e=r}var i=s(t).call(n._boundValue(),e);i===l&&a.throwLater(i.e)}var o=e("./util"),a=t._async,s=o.tryCatch,l=o.errorObj;t.prototype.asCallback=t.prototype.nodeify=function(e,t){if("function"==typeof e){var o=r;void 0!==t&&Object(t).spread&&(o=n),this._then(o,i,void 0,this,e)}return this}}},{"./util":36}],22:[function(e,t,n){t.exports=function(){function n(){}function r(e,t){if(null==e||e.constructor!==i)throw new y("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n");if("function"!=typeof t)throw new y("expecting a function but got "+f.classString(t))}function i(e){e!==b&&r(this,e),this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._resolveFromExecutor(e),this._promiseCreated(),this._fireEvent("promiseCreated",this)}function o(e){this.promise._resolveCallback(e)}function a(e){this.promise._rejectCallback(e,!1)}function s(e){var t=new i(b);t._fulfillmentHandler0=e,t._rejectionHandler0=e,t._promise0=e,t._receiver0=e}var l,c=function(){return new y("circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n")},u=function(){return new i.PromiseInspection(this._target())},p=function(e){return i.reject(new y(e))},h={},f=e("./util");l=f.isNode?function(){var e=process.domain;return void 0===e&&(e=null),e}:function(){return null},f.notEnumerableProp(i,"_getDomain",l);var d=e("./es5"),m=e("./async"),g=new m;d.defineProperty(i,"_async",{value:g});var v=e("./errors"),y=i.TypeError=v.TypeError;i.RangeError=v.RangeError;var _=i.CancellationError=v.CancellationError;i.TimeoutError=v.TimeoutError,i.OperationalError=v.OperationalError,i.RejectionError=v.OperationalError,i.AggregateError=v.AggregateError;var b=function(){},w={},C={},A=e("./thenables")(i,b),E=e("./promise_array")(i,b,A,p,n),k=e("./context")(i),x=k.create,j=e("./debuggability")(i,k),I=(j.CapturedTrace,e("./finally")(i,A,C)),S=e("./catch_filter")(C),T=e("./nodeback"),P=f.errorObj,F=f.tryCatch;return i.prototype.toString=function(){return"[object Promise]"},i.prototype.caught=i.prototype.catch=function(e){var t=arguments.length;if(t>1){var n,r=new Array(t-1),i=0;for(n=0;n<t-1;++n){var o=arguments[n];if(!f.isObject(o))return p("Catch statement predicate: expecting an object but got "+f.classString(o));r[i++]=o}return r.length=i,e=arguments[n],this.then(void 0,S(r,e,this))}return this.then(void 0,e)},i.prototype.reflect=function(){return this._then(u,u,void 0,this,void 0)},i.prototype.then=function(e,t){if(j.warnings()&&arguments.length>0&&"function"!=typeof e&&"function"!=typeof t){var n=".then() only accepts functions but was passed: "+f.classString(e);arguments.length>1&&(n+=", "+f.classString(t)),this._warn(n)}return this._then(e,t,void 0,void 0,void 0)},i.prototype.done=function(e,t){this._then(e,t,void 0,void 0,void 0)._setIsFinal()},i.prototype.spread=function(e){return"function"!=typeof e?p("expecting a function but got "+f.classString(e)):this.all()._then(e,void 0,void 0,w,void 0)},i.prototype.toJSON=function(){var e={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(e.fulfillmentValue=this.value(),e.isFulfilled=!0):this.isRejected()&&(e.rejectionReason=this.reason(),e.isRejected=!0),e},i.prototype.all=function(){return arguments.length>0&&this._warn(".all() was passed arguments but it does not take any"),new E(this).promise()},i.prototype.error=function(e){return this.caught(f.originatesFromRejection,e)},i.getNewLibraryCopy=t.exports,i.is=function(e){return e instanceof i},i.fromNode=i.fromCallback=function(e){var t=new i(b);t._captureStackTrace();var n=arguments.length>1&&!!Object(arguments[1]).multiArgs,r=F(e)(T(t,n));return r===P&&t._rejectCallback(r.e,!0),t._isFateSealed()||t._setAsyncGuaranteed(),t},i.all=function(e){return new E(e).promise()},i.cast=function(e){var t=A(e);return t instanceof i||((t=new i(b))._captureStackTrace(),t._setFulfilled(),t._rejectionHandler0=e),t},i.resolve=i.fulfilled=i.cast,i.reject=i.rejected=function(e){var t=new i(b);return t._captureStackTrace(),t._rejectCallback(e,!0),t},i.setScheduler=function(e){if("function"!=typeof e)throw new y("expecting a function but got "+f.classString(e));return g.setScheduler(e)},i.prototype._then=function(e,t,n,r,o){var a=void 0!==o,s=a?o:new i(b),c=this._target(),u=c._bitField;a||(s._propagateFrom(this,3),s._captureStackTrace(),void 0===r&&0!=(2097152&this._bitField)&&(r=0!=(50397184&u)?this._boundValue():c===this?void 0:this._boundTo),this._fireEvent("promiseChained",this,s));var p=l();if(0!=(50397184&u)){var h,d,m=c._settlePromiseCtx;0!=(33554432&u)?(d=c._rejectionHandler0,h=e):0!=(16777216&u)?(d=c._fulfillmentHandler0,h=t,c._unsetRejectionIsUnhandled()):(m=c._settlePromiseLateCancellationObserver,d=new _("late cancellation observer"),c._attachExtraTrace(d),h=t),g.invoke(m,c,{handler:null===p?h:"function"==typeof h&&f.domainBind(p,h),promise:s,receiver:r,value:d})}else c._addCallbacks(e,t,s,r,p);return s},i.prototype._length=function(){return 65535&this._bitField},i.prototype._isFateSealed=function(){return 0!=(117506048&this._bitField)},i.prototype._isFollowing=function(){return 67108864==(67108864&this._bitField)},i.prototype._setLength=function(e){this._bitField=-65536&this._bitField|65535&e},i.prototype._setFulfilled=function(){this._bitField=33554432|this._bitField,this._fireEvent("promiseFulfilled",this)},i.prototype._setRejected=function(){this._bitField=16777216|this._bitField,this._fireEvent("promiseRejected",this)},i.prototype._setFollowing=function(){this._bitField=67108864|this._bitField,this._fireEvent("promiseResolved",this)},i.prototype._setIsFinal=function(){this._bitField=4194304|this._bitField},i.prototype._isFinal=function(){return(4194304&this._bitField)>0},i.prototype._unsetCancelled=function(){this._bitField=-65537&this._bitField},i.prototype._setCancelled=function(){this._bitField=65536|this._bitField,this._fireEvent("promiseCancelled",this)},i.prototype._setWillBeCancelled=function(){this._bitField=8388608|this._bitField},i.prototype._setAsyncGuaranteed=function(){g.hasCustomScheduler()||(this._bitField=134217728|this._bitField)},i.prototype._receiverAt=function(e){var t=0===e?this._receiver0:this[4*e-4+3];if(t!==h)return void 0===t&&this._isBound()?this._boundValue():t},i.prototype._promiseAt=function(e){return this[4*e-4+2]},i.prototype._fulfillmentHandlerAt=function(e){return this[4*e-4+0]},i.prototype._rejectionHandlerAt=function(e){return this[4*e-4+1]},i.prototype._boundValue=function(){},i.prototype._migrateCallback0=function(e){e._bitField;var t=e._fulfillmentHandler0,n=e._rejectionHandler0,r=e._promise0,i=e._receiverAt(0);void 0===i&&(i=h),this._addCallbacks(t,n,r,i,null)},i.prototype._migrateCallbackAt=function(e,t){var n=e._fulfillmentHandlerAt(t),r=e._rejectionHandlerAt(t),i=e._promiseAt(t),o=e._receiverAt(t);void 0===o&&(o=h),this._addCallbacks(n,r,i,o,null)},i.prototype._addCallbacks=function(e,t,n,r,i){var o=this._length();if(o>=65531&&(o=0,this._setLength(0)),0===o)this._promise0=n,this._receiver0=r,"function"==typeof e&&(this._fulfillmentHandler0=null===i?e:f.domainBind(i,e)),"function"==typeof t&&(this._rejectionHandler0=null===i?t:f.domainBind(i,t));else{var a=4*o-4;this[a+2]=n,this[a+3]=r,"function"==typeof e&&(this[a+0]=null===i?e:f.domainBind(i,e)),"function"==typeof t&&(this[a+1]=null===i?t:f.domainBind(i,t))}return this._setLength(o+1),o},i.prototype._proxy=function(e,t){this._addCallbacks(void 0,void 0,t,e,null)},i.prototype._resolveCallback=function(e,t){if(0==(117506048&this._bitField)){if(e===this)return this._rejectCallback(c(),!1);var n=A(e,this);if(!(n instanceof i))return this._fulfill(e);t&&this._propagateFrom(n,2);var r=n._target();if(r!==this){var o=r._bitField;if(0==(50397184&o)){var a=this._length();a>0&&r._migrateCallback0(this);for(var s=1;s<a;++s)r._migrateCallbackAt(this,s);this._setFollowing(),this._setLength(0),this._setFollowee(r)}else if(0!=(33554432&o))this._fulfill(r._value());else if(0!=(16777216&o))this._reject(r._reason());else{var l=new _("late cancellation observer");r._attachExtraTrace(l),this._reject(l)}}else this._reject(c())}},i.prototype._rejectCallback=function(e,t,n){var r=f.ensureErrorObject(e),i=r===e;if(!i&&!n&&j.warnings()){var o="a promise was rejected with a non-error: "+f.classString(e);this._warn(o,!0)}this._attachExtraTrace(r,!!t&&i),this._reject(e)},i.prototype._resolveFromExecutor=function(e){if(e!==b){var t=this;this._captureStackTrace(),this._pushContext();var n=!0,r=this._execute(e,function(e){t._resolveCallback(e)},function(e){t._rejectCallback(e,n)});n=!1,this._popContext(),void 0!==r&&t._rejectCallback(r,!0)}},i.prototype._settlePromiseFromHandler=function(e,t,n,r){var i=r._bitField;if(0==(65536&i)){r._pushContext();var o;t===w?n&&"number"==typeof n.length?o=F(e).apply(this._boundValue(),n):(o=P).e=new y("cannot .spread() a non-array: "+f.classString(n)):o=F(e).call(t,n);var a=r._popContext();0==(65536&(i=r._bitField))&&(o===C?r._reject(n):o===P?r._rejectCallback(o.e,!1):(j.checkForgottenReturns(o,a,"",r,this),r._resolveCallback(o)))}},i.prototype._target=function(){for(var e=this;e._isFollowing();)e=e._followee();return e},i.prototype._followee=function(){return this._rejectionHandler0},i.prototype._setFollowee=function(e){this._rejectionHandler0=e},i.prototype._settlePromise=function(e,t,r,o){var a=e instanceof i,s=this._bitField,l=0!=(134217728&s);0!=(65536&s)?(a&&e._invokeInternalOnCancel(),r instanceof I&&r.isFinallyHandler()?(r.cancelPromise=e,F(t).call(r,o)===P&&e._reject(P.e)):t===u?e._fulfill(u.call(r)):r instanceof n?r._promiseCancelled(e):a||e instanceof E?e._cancel():r.cancel()):"function"==typeof t?a?(l&&e._setAsyncGuaranteed(),this._settlePromiseFromHandler(t,r,o,e)):t.call(r,o,e):r instanceof n?r._isResolved()||(0!=(33554432&s)?r._promiseFulfilled(o,e):r._promiseRejected(o,e)):a&&(l&&e._setAsyncGuaranteed(),0!=(33554432&s)?e._fulfill(o):e._reject(o))},i.prototype._settlePromiseLateCancellationObserver=function(e){var t=e.handler,n=e.promise,r=e.receiver,o=e.value;"function"==typeof t?n instanceof i?this._settlePromiseFromHandler(t,r,o,n):t.call(r,o,n):n instanceof i&&n._reject(o)},i.prototype._settlePromiseCtx=function(e){this._settlePromise(e.promise,e.handler,e.receiver,e.value)},i.prototype._settlePromise0=function(e,t,n){var r=this._promise0,i=this._receiverAt(0);this._promise0=void 0,this._receiver0=void 0,this._settlePromise(r,e,i,t)},i.prototype._clearCallbackDataAtIndex=function(e){var t=4*e-4;this[t+2]=this[t+3]=this[t+0]=this[t+1]=void 0},i.prototype._fulfill=function(e){var t=this._bitField;if(!((117506048&t)>>>16)){if(e===this){var n=c();return this._attachExtraTrace(n),this._reject(n)}this._setFulfilled(),this._rejectionHandler0=e,(65535&t)>0&&(0!=(134217728&t)?this._settlePromises():g.settlePromises(this))}},i.prototype._reject=function(e){var t=this._bitField;if(!((117506048&t)>>>16)){if(this._setRejected(),this._fulfillmentHandler0=e,this._isFinal())return g.fatalError(e,f.isNode);(65535&t)>0?g.settlePromises(this):this._ensurePossibleRejectionHandled()}},i.prototype._fulfillPromises=function(e,t){for(var n=1;n<e;n++){var r=this._fulfillmentHandlerAt(n),i=this._promiseAt(n),o=this._receiverAt(n);this._clearCallbackDataAtIndex(n),this._settlePromise(i,r,o,t)}},i.prototype._rejectPromises=function(e,t){for(var n=1;n<e;n++){var r=this._rejectionHandlerAt(n),i=this._promiseAt(n),o=this._receiverAt(n);this._clearCallbackDataAtIndex(n),this._settlePromise(i,r,o,t)}},i.prototype._settlePromises=function(){var e=this._bitField,t=65535&e;if(t>0){if(0!=(16842752&e)){var n=this._fulfillmentHandler0;this._settlePromise0(this._rejectionHandler0,n,e),this._rejectPromises(t,n)}else{var r=this._rejectionHandler0;this._settlePromise0(this._fulfillmentHandler0,r,e),this._fulfillPromises(t,r)}this._setLength(0)}this._clearCancellationData()},i.prototype._settledValue=function(){var e=this._bitField;return 0!=(33554432&e)?this._rejectionHandler0:0!=(16777216&e)?this._fulfillmentHandler0:void 0},i.defer=i.pending=function(){return j.deprecated("Promise.defer","new Promise"),{promise:new i(b),resolve:o,reject:a}},f.notEnumerableProp(i,"_makeSelfResolutionError",c),e("./method")(i,b,A,p,j),e("./bind")(i,b,A,j),e("./cancel")(i,E,p,j),e("./direct_resolve")(i),e("./synchronous_inspection")(i),e("./join")(i,E,A,b,g,l),i.Promise=i,i.version="3.5.0",e("./map.js")(i,E,p,A,b,j),e("./call_get.js")(i),e("./using.js")(i,p,A,x,b,j),e("./timers.js")(i,b,j),e("./generators.js")(i,p,b,A,n,j),e("./nodeify.js")(i),e("./promisify.js")(i,b),e("./props.js")(i,E,A,p),e("./race.js")(i,b,A,p),e("./reduce.js")(i,E,p,A,b,j),e("./settle.js")(i,E,j),e("./some.js")(i,E,p),e("./filter.js")(i,b),e("./each.js")(i,b),e("./any.js")(i),f.toFastProperties(i),f.toFastProperties(i.prototype),s({a:1}),s({b:2}),s({c:3}),s(1),s(function(){}),s(void 0),s(!1),s(new i(b)),j.setBounds(m.firstLineError,f.lastLineError),i}},{"./any.js":1,"./async":2,"./bind":3,"./call_get.js":5,"./cancel":6,"./catch_filter":7,"./context":8,"./debuggability":9,"./direct_resolve":10,"./each.js":11,"./errors":12,"./es5":13,"./filter.js":14,"./finally":15,"./generators.js":16,"./join":17,"./map.js":18,"./method":19,"./nodeback":20,"./nodeify.js":21,"./promise_array":23,"./promisify.js":24,"./props.js":25,"./race.js":27,"./reduce.js":28,"./settle.js":30,"./some.js":31,"./synchronous_inspection":32,"./thenables":33,"./timers.js":34,"./using.js":35,"./util":36}],23:[function(e,t,n){t.exports=function(t,n,r,i,o){function a(e){switch(e){case-2:return[];case-3:return{};case-6:return new Map}}function s(e){var r=this._promise=new t(n);e instanceof t&&r._propagateFrom(e,3),r._setOnCancel(this),this._values=e,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var l=e("./util");return l.isArray,l.inherits(s,o),s.prototype.length=function(){return this._length},s.prototype.promise=function(){return this._promise},s.prototype._init=function e(n,o){var s=r(this._values,this._promise);if(s instanceof t){var c=(s=s._target())._bitField;if(this._values=s,0==(50397184&c))return this._promise._setAsyncGuaranteed(),s._then(e,this._reject,void 0,this,o);if(0==(33554432&c))return 0!=(16777216&c)?this._reject(s._reason()):this._cancel();s=s._value()}if(null!==(s=l.asArray(s)))0!==s.length?this._iterate(s):-5===o?this._resolveEmptyArray():this._resolve(a(o));else{var u=i("expecting an array or an iterable object but got "+l.classString(s)).reason();this._promise._rejectCallback(u,!1)}},s.prototype._iterate=function(e){var n=this.getActualLength(e.length);this._length=n,this._values=this.shouldCopyValues()?new Array(n):this._values;for(var i=this._promise,o=!1,a=null,s=0;s<n;++s){var l=r(e[s],i);a=l instanceof t?(l=l._target())._bitField:null,o?null!==a&&l.suppressUnhandledRejections():null!==a?0==(50397184&a)?(l._proxy(this,s),this._values[s]=l):o=0!=(33554432&a)?this._promiseFulfilled(l._value(),s):0!=(16777216&a)?this._promiseRejected(l._reason(),s):this._promiseCancelled(s):o=this._promiseFulfilled(l,s)}o||i._setAsyncGuaranteed()},s.prototype._isResolved=function(){return null===this._values},s.prototype._resolve=function(e){this._values=null,this._promise._fulfill(e)},s.prototype._cancel=function(){!this._isResolved()&&this._promise._isCancellable()&&(this._values=null,this._promise._cancel())},s.prototype._reject=function(e){this._values=null,this._promise._rejectCallback(e,!1)},s.prototype._promiseFulfilled=function(e,t){return this._values[t]=e,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},s.prototype._promiseCancelled=function(){return this._cancel(),!0},s.prototype._promiseRejected=function(e){return this._totalResolved++,this._reject(e),!0},s.prototype._resultCancelled=function(){if(!this._isResolved()){var e=this._values;if(this._cancel(),e instanceof t)e.cancel();else for(var n=0;n<e.length;++n)e[n]instanceof t&&e[n].cancel()}},s.prototype.shouldCopyValues=function(){return!0},s.prototype.getActualLength=function(e){return e},s}},{"./util":36}],24:[function(e,t,n){t.exports=function(t,n){function r(e){return!b.test(e)}function i(e){try{return!0===e.__isPromisified__}catch(e){return!1}}function o(e,t,n){var r=h.getDataPropertyOrDefault(e,t+n,y);return!!r&&i(r)}function a(e,t,n){for(var r=0;r<e.length;r+=2){var i=e[r];if(n.test(i))for(var o=i.replace(n,""),a=0;a<e.length;a+=2)if(e[a]===o)throw new v("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/MqrFmX\n".replace("%s",t))}}function s(e,t,n,r){for(var s=h.inheritedDataKeys(e),l=[],c=0;c<s.length;++c){var u=s[c],p=e[u],f=r===w||w(u,p,e);"function"!=typeof p||i(p)||o(e,u,t)||!r(u,p,e,f)||l.push(u,p)}return a(l,t,n),l}function l(e,r,i,o,a,s){function l(){var i=r;r===p&&(i=this);var o=new t(n);o._captureStackTrace();var a="string"==typeof u&&this!==c?this[u]:e,l=f(o,s);try{a.apply(i,d(arguments,l))}catch(e){o._rejectCallback(m(e),!0,!0)}return o._isFateSealed()||o._setAsyncGuaranteed(),o}var c=function(){return this}(),u=e;return"string"==typeof u&&(e=o),h.notEnumerableProp(l,"__isPromisified__",!0),l}function c(e,t,n,r,i){for(var o=new RegExp(C(t)+"$"),a=s(e,t,o,n),l=0,c=a.length;l<c;l+=2){var u=a[l],f=a[l+1],d=u+t;if(r===A)e[d]=A(u,p,u,f,t,i);else{var m=r(f,function(){return A(u,p,u,f,t,i)});h.notEnumerableProp(m,"__isPromisified__",!0),e[d]=m}}return h.toFastProperties(e),e}function u(e,t,n){return A(e,t,void 0,e,null,n)}var p={},h=e("./util"),f=e("./nodeback"),d=h.withAppended,m=h.maybeWrapAsError,g=h.canEvaluate,v=e("./errors").TypeError,y={__isPromisified__:!0},_=["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"],b=new RegExp("^(?:"+_.join("|")+")$"),w=function(e){return h.isIdentifier(e)&&"_"!==e.charAt(0)&&"constructor"!==e},C=function(e){return e.replace(/([$])/,"\\$")},A=g?void 0:l;t.promisify=function(e,t){if("function"!=typeof e)throw new v("expecting a function but got "+h.classString(e));if(i(e))return e;var n=u(e,void 0===(t=Object(t)).context?p:t.context,!!t.multiArgs);return h.copyDescriptors(e,n,r),n},t.promisifyAll=function(e,t){if("function"!=typeof e&&"object"!=typeof e)throw new v("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/MqrFmX\n");var n=!!(t=Object(t)).multiArgs,r=t.suffix;"string"!=typeof r&&(r="Async");var i=t.filter;"function"!=typeof i&&(i=w);var o=t.promisifier;if("function"!=typeof o&&(o=A),!h.isIdentifier(r))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/MqrFmX\n");for(var a=h.inheritedDataKeys(e),s=0;s<a.length;++s){var l=e[a[s]];"constructor"!==a[s]&&h.isClass(l)&&(c(l.prototype,r,i,o,n),c(l,r,i,o,n))}return c(e,r,i,o,n)}}},{"./errors":12,"./nodeback":20,"./util":36}],25:[function(e,t,n){t.exports=function(t,n,r,i){function o(e){var t,n=!1;if(void 0!==s&&e instanceof s)t=p(e),n=!0;else{var r=u.keys(e),i=r.length;t=new Array(2*i);for(var o=0;o<i;++o){var a=r[o];t[o]=e[a],t[o+i]=a}}this.constructor$(t),this._isMap=n,this._init$(void 0,n?-6:-3)}function a(e){var n,a=r(e);return c(a)?(n=a instanceof t?a._then(t.props,void 0,void 0,void 0,void 0):new o(a).promise(),a instanceof t&&n._propagateFrom(a,2),n):i("cannot await properties of a non-object\n\n    See http://goo.gl/MqrFmX\n")}var s,l=e("./util"),c=l.isObject,u=e("./es5");"function"==typeof Map&&(s=Map);var p=function(){function e(e,r){this[t]=e,this[t+n]=r,t++}var t=0,n=0;return function(r){n=r.size,t=0;var i=new Array(2*r.size);return r.forEach(e,i),i}}(),h=function(e){for(var t=new s,n=e.length/2|0,r=0;r<n;++r){var i=e[n+r],o=e[r];t.set(i,o)}return t};l.inherits(o,n),o.prototype._init=function(){},o.prototype._promiseFulfilled=function(e,t){if(this._values[t]=e,++this._totalResolved>=this._length){var n;if(this._isMap)n=h(this._values);else{n={};for(var r=this.length(),i=0,o=this.length();i<o;++i)n[this._values[i+r]]=this._values[i]}return this._resolve(n),!0}return!1},o.prototype.shouldCopyValues=function(){return!1},o.prototype.getActualLength=function(e){return e>>1},t.prototype.props=function(){return a(this)},t.props=function(e){return a(e)}}},{"./es5":13,"./util":36}],26:[function(e,t,n){function r(e,t,n,r,i){for(var o=0;o<i;++o)n[o+r]=e[o+t],e[o+t]=void 0}function i(e){this._capacity=e,this._length=0,this._front=0}i.prototype._willBeOverCapacity=function(e){return this._capacity<e},i.prototype._pushOne=function(e){var t=this.length();this._checkCapacity(t+1),this[this._front+t&this._capacity-1]=e,this._length=t+1},i.prototype.push=function(e,t,n){var r=this.length()+3;if(this._willBeOverCapacity(r))return this._pushOne(e),this._pushOne(t),void this._pushOne(n);var i=this._front+r-3;this._checkCapacity(r);var o=this._capacity-1;this[i+0&o]=e,this[i+1&o]=t,this[i+2&o]=n,this._length=r},i.prototype.shift=function(){var e=this._front,t=this[e];return this[e]=void 0,this._front=e+1&this._capacity-1,this._length--,t},i.prototype.length=function(){return this._length},i.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(this._capacity<<1)},i.prototype._resizeTo=function(e){var t=this._capacity;this._capacity=e,r(this,0,this,t,this._front+this._length&t-1)},t.exports=i},{}],27:[function(e,t,n){t.exports=function(t,n,r,i){function o(e,o){var l=r(e);if(l instanceof t)return s(l);if(null===(e=a.asArray(e)))return i("expecting an array or an iterable object but got "+a.classString(e));var c=new t(n);void 0!==o&&c._propagateFrom(o,3);for(var u=c._fulfill,p=c._reject,h=0,f=e.length;h<f;++h){var d=e[h];(void 0!==d||h in e)&&t.cast(d)._then(u,p,void 0,c,null)}return c}var a=e("./util"),s=function(e){return e.then(function(t){return o(t,e)})};t.race=function(e){return o(e,void 0)},t.prototype.race=function(){return o(this,void 0)}}},{"./util":36}],28:[function(e,t,n){t.exports=function(t,n,r,i,o,a){function s(e,n,r,i){this.constructor$(e);var a=h();this._fn=null===a?n:f.domainBind(a,n),void 0!==r&&(r=t.resolve(r))._attachCancellationCallback(this),this._initialValue=r,this._currentCancellable=null,this._eachValues=i===o?Array(this._length):0===i?null:void 0,this._promise._captureStackTrace(),this._init$(void 0,-5)}function l(e,t){this.isFulfilled()?t._resolve(e):t._reject(e)}function c(e,t,n,i){return"function"!=typeof t?r("expecting a function but got "+f.classString(t)):new s(e,t,n,i).promise()}function u(e){this.accum=e,this.array._gotAccum(e);var n=i(this.value,this.array._promise);return n instanceof t?(this.array._currentCancellable=n,n._then(p,void 0,void 0,this,void 0)):p.call(this,n)}function p(e){var n=this.array,r=n._promise,i=d(n._fn);r._pushContext();var o;(o=void 0!==n._eachValues?i.call(r._boundValue(),e,this.index,this.length):i.call(r._boundValue(),this.accum,e,this.index,this.length))instanceof t&&(n._currentCancellable=o);var s=r._popContext();return a.checkForgottenReturns(o,s,void 0!==n._eachValues?"Promise.each":"Promise.reduce",r),o}var h=t._getDomain,f=e("./util"),d=f.tryCatch;f.inherits(s,n),s.prototype._gotAccum=function(e){void 0!==this._eachValues&&null!==this._eachValues&&e!==o&&this._eachValues.push(e)},s.prototype._eachComplete=function(e){return null!==this._eachValues&&this._eachValues.push(e),this._eachValues},s.prototype._init=function(){},s.prototype._resolveEmptyArray=function(){this._resolve(void 0!==this._eachValues?this._eachValues:this._initialValue)},s.prototype.shouldCopyValues=function(){return!1},s.prototype._resolve=function(e){this._promise._resolveCallback(e),this._values=null},s.prototype._resultCancelled=function(e){if(e===this._initialValue)return this._cancel();this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof t&&this._currentCancellable.cancel(),this._initialValue instanceof t&&this._initialValue.cancel())},s.prototype._iterate=function(e){this._values=e;var n,r,i=e.length;if(void 0!==this._initialValue?(n=this._initialValue,r=0):(n=t.resolve(e[0]),r=1),this._currentCancellable=n,!n.isRejected())for(;r<i;++r){var o={accum:null,value:e[r],index:r,length:i,array:this};n=n._then(u,void 0,void 0,o,void 0)}void 0!==this._eachValues&&(n=n._then(this._eachComplete,void 0,void 0,this,void 0)),n._then(l,l,void 0,n,this)},t.prototype.reduce=function(e,t){return c(this,e,t,null)},t.reduce=function(e,t,n,r){return c(e,t,n,r)}}},{"./util":36}],29:[function(e,t,n){var r,i=e("./util"),o=function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")},a=i.getNativePromise();if(i.isNode&&"undefined"==typeof MutationObserver){var s=Es.setImmediate,l=process.nextTick;r=i.isRecentNode?function(e){s.call(Es,e)}:function(e){l.call(process,e)}}else if("function"==typeof a&&"function"==typeof a.resolve){var c=a.resolve();r=function(e){c.then(e)}}else r="undefined"==typeof MutationObserver||"undefined"!=typeof window&&window.navigator&&(window.navigator.standalone||window.cordova)?"undefined"!=typeof setImmediate?function(e){setImmediate(e)}:"undefined"!=typeof setTimeout?function(e){setTimeout(e,0)}:o:function(){var e=document.createElement("div"),t={attributes:!0},n=!1,r=document.createElement("div");new MutationObserver(function(){e.classList.toggle("foo"),n=!1}).observe(r,t);var i=function(){n||(n=!0,r.classList.toggle("foo"))};return function(n){var r=new MutationObserver(function(){r.disconnect(),n()});r.observe(e,t),i()}}();t.exports=r},{"./util":36}],30:[function(e,t,n){t.exports=function(t,n,r){function i(e){this.constructor$(e)}var o=t.PromiseInspection;e("./util").inherits(i,n),i.prototype._promiseResolved=function(e,t){return this._values[e]=t,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},i.prototype._promiseFulfilled=function(e,t){var n=new o;return n._bitField=33554432,n._settledValueField=e,this._promiseResolved(t,n)},i.prototype._promiseRejected=function(e,t){var n=new o;return n._bitField=16777216,n._settledValueField=e,this._promiseResolved(t,n)},t.settle=function(e){return r.deprecated(".settle()",".reflect()"),new i(e).promise()},t.prototype.settle=function(){return t.settle(this)}}},{"./util":36}],31:[function(e,t,n){t.exports=function(t,n,r){function i(e){this.constructor$(e),this._howMany=0,this._unwrap=!1,this._initialized=!1}function o(e,t){if((0|t)!==t||t<0)return r("expecting a positive integer\n\n    See http://goo.gl/MqrFmX\n");var n=new i(e),o=n.promise();return n.setHowMany(t),n.init(),o}var a=e("./util"),s=e("./errors").RangeError,l=e("./errors").AggregateError,c=a.isArray,u={};a.inherits(i,n),i.prototype._init=function(){if(this._initialized)if(0!==this._howMany){this._init$(void 0,-5);var e=c(this._values);!this._isResolved()&&e&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}else this._resolve([])},i.prototype.init=function(){this._initialized=!0,this._init()},i.prototype.setUnwrap=function(){this._unwrap=!0},i.prototype.howMany=function(){return this._howMany},i.prototype.setHowMany=function(e){this._howMany=e},i.prototype._promiseFulfilled=function(e){return this._addFulfilled(e),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values),!0)},i.prototype._promiseRejected=function(e){return this._addRejected(e),this._checkOutcome()},i.prototype._promiseCancelled=function(){return this._values instanceof t||null==this._values?this._cancel():(this._addRejected(u),this._checkOutcome())},i.prototype._checkOutcome=function(){if(this.howMany()>this._canPossiblyFulfill()){for(var e=new l,t=this.length();t<this._values.length;++t)this._values[t]!==u&&e.push(this._values[t]);return e.length>0?this._reject(e):this._cancel(),!0}return!1},i.prototype._fulfilled=function(){return this._totalResolved},i.prototype._rejected=function(){return this._values.length-this.length()},i.prototype._addRejected=function(e){this._values.push(e)},i.prototype._addFulfilled=function(e){this._values[this._totalResolved++]=e},i.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},i.prototype._getRangeError=function(e){var t="Input array must contain at least "+this._howMany+" items but contains only "+e+" items";return new s(t)},i.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},t.some=function(e,t){return o(e,t)},t.prototype.some=function(e){return o(this,e)},t._SomePromiseArray=i}},{"./errors":12,"./util":36}],32:[function(e,t,n){t.exports=function(e){function t(e){void 0!==e?(e=e._target(),this._bitField=e._bitField,this._settledValueField=e._isFateSealed()?e._settledValue():void 0):(this._bitField=0,this._settledValueField=void 0)}t.prototype._settledValue=function(){return this._settledValueField};var n=t.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},r=t.prototype.error=t.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},i=t.prototype.isFulfilled=function(){return 0!=(33554432&this._bitField)},o=t.prototype.isRejected=function(){return 0!=(16777216&this._bitField)},a=t.prototype.isPending=function(){return 0==(50397184&this._bitField)},s=t.prototype.isResolved=function(){return 0!=(50331648&this._bitField)};t.prototype.isCancelled=function(){return 0!=(8454144&this._bitField)},e.prototype.__isCancelled=function(){return 65536==(65536&this._bitField)},e.prototype._isCancelled=function(){return this._target().__isCancelled()},e.prototype.isCancelled=function(){return 0!=(8454144&this._target()._bitField)},e.prototype.isPending=function(){return a.call(this._target())},e.prototype.isRejected=function(){return o.call(this._target())},e.prototype.isFulfilled=function(){return i.call(this._target())},e.prototype.isResolved=function(){return s.call(this._target())},e.prototype.value=function(){return n.call(this._target())},e.prototype.reason=function(){var e=this._target();return e._unsetRejectionIsUnhandled(),r.call(e)},e.prototype._value=function(){return this._settledValue()},e.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()},e.PromiseInspection=t}},{}],33:[function(e,t,n){t.exports=function(t,n){function r(e,r){if(u(e)){if(e instanceof t)return e;var i=o(e);if(i===c)return r&&r._pushContext(),l=t.reject(i.e),r&&r._popContext(),l;if("function"==typeof i){if(a(e)){var l=new t(n);return e._then(l._fulfill,l._reject,void 0,l,null),l}return s(e,i,r)}}return e}function i(e){return e.then}function o(e){try{return i(e)}catch(e){return c.e=e,c}}function a(e){try{return p.call(e,"_promise0")}catch(e){return!1}}function s(e,r,i){function o(e){s&&(s._resolveCallback(e),s=null)}function a(e){s&&(s._rejectCallback(e,p,!0),s=null)}var s=new t(n),u=s;i&&i._pushContext(),s._captureStackTrace(),i&&i._popContext();var p=!0,h=l.tryCatch(r).call(e,o,a);return p=!1,s&&h===c&&(s._rejectCallback(h.e,!0,!0),s=null),u}var l=e("./util"),c=l.errorObj,u=l.isObject,p={}.hasOwnProperty;return r}},{"./util":36}],34:[function(e,t,n){t.exports=function(t,n,r){function i(e){this.handle=e}function o(e){return clearTimeout(this.handle),e}function a(e){throw clearTimeout(this.handle),e}var s=e("./util"),l=t.TimeoutError;i.prototype._resultCancelled=function(){clearTimeout(this.handle)};var c=function(e){return u(+this).thenReturn(e)},u=t.delay=function(e,o){var a,s;return void 0!==o?(a=t.resolve(o)._then(c,null,null,e,void 0),r.cancellation()&&o instanceof t&&a._setOnCancel(o)):(a=new t(n),s=setTimeout(function(){a._fulfill()},+e),r.cancellation()&&a._setOnCancel(new i(s)),a._captureStackTrace()),a._setAsyncGuaranteed(),a};t.prototype.delay=function(e){return u(e,this)};var p=function(e,t,n){var r;r="string"!=typeof t?t instanceof Error?t:new l("operation timed out"):new l(t),s.markAsOriginatingFromRejection(r),e._attachExtraTrace(r),e._reject(r),null!=n&&n.cancel()};t.prototype.timeout=function(e,t){e=+e;var n,s,l=new i(setTimeout(function(){n.isPending()&&p(n,t,s)},e));return r.cancellation()?(s=this.then(),(n=s._then(o,a,void 0,l,void 0))._setOnCancel(l)):n=this._then(o,a,void 0,l,void 0),n}}},{"./util":36}],35:[function(e,t,n){t.exports=function(t,n,r,i,o,a){function s(e){setTimeout(function(){throw e},0)}function l(e){var t=r(e);return t!==e&&"function"==typeof e._isDisposable&&"function"==typeof e._getDisposer&&e._isDisposable()&&t._setDisposable(e._getDisposer()),t}function c(e,n){function i(){if(a>=c)return u._fulfill();var o=l(e[a++]);if(o instanceof t&&o._isDisposable()){try{o=r(o._getDisposer().tryDispose(n),e.promise)}catch(e){return s(e)}if(o instanceof t)return o._then(i,s,null,null,null)}i()}var a=0,c=e.length,u=new t(o);return i(),u}function u(e,t,n){this._data=e,this._promise=t,this._context=n}function p(e,t,n){this.constructor$(e,t,n)}function h(e){return u.isDisposer(e)?(this.resources[this.index]._setDisposable(e),e.promise()):e}function f(e){this.length=e,this.promise=null,this[e-1]=null}var d=e("./util"),m=e("./errors").TypeError,g=e("./util").inherits,v=d.errorObj,y=d.tryCatch,_={};u.prototype.data=function(){return this._data},u.prototype.promise=function(){return this._promise},u.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():_},u.prototype.tryDispose=function(e){var t=this.resource(),n=this._context;void 0!==n&&n._pushContext();var r=t!==_?this.doDispose(t,e):null;return void 0!==n&&n._popContext(),this._promise._unsetDisposable(),this._data=null,r},u.isDisposer=function(e){return null!=e&&"function"==typeof e.resource&&"function"==typeof e.tryDispose},g(p,u),p.prototype.doDispose=function(e,t){return this.data().call(e,e,t)},f.prototype._resultCancelled=function(){for(var e=this.length,n=0;n<e;++n){var r=this[n];r instanceof t&&r.cancel()}},t.using=function(){var e=arguments.length;if(e<2)return n("you must pass at least 2 arguments to Promise.using");var i=arguments[e-1];if("function"!=typeof i)return n("expecting a function but got "+d.classString(i));var o,s=!0;2===e&&Array.isArray(arguments[0])?(e=(o=arguments[0]).length,s=!1):(o=arguments,e--);for(var l=new f(e),p=0;p<e;++p){var m=o[p];if(u.isDisposer(m)){var g=m;(m=m.promise())._setDisposable(g)}else{var _=r(m);_ instanceof t&&(m=_._then(h,null,null,{resources:l,index:p},void 0))}l[p]=m}for(var b=new Array(l.length),p=0;p<b.length;++p)b[p]=t.resolve(l[p]).reflect();var w=t.all(b).then(function(e){for(var t=0;t<e.length;++t){var n=e[t];if(n.isRejected())return v.e=n.error(),v;if(!n.isFulfilled())return void w.cancel();e[t]=n.value()}C._pushContext(),i=y(i);var r=s?i.apply(void 0,e):i(e),o=C._popContext();return a.checkForgottenReturns(r,o,"Promise.using",C),r}),C=w.lastly(function(){var e=new t.PromiseInspection(w);return c(l,e)});return l.promise=C,C._setOnCancel(l),C},t.prototype._setDisposable=function(e){this._bitField=131072|this._bitField,this._disposer=e},t.prototype._isDisposable=function(){return(131072&this._bitField)>0},t.prototype._getDisposer=function(){return this._disposer},t.prototype._unsetDisposable=function(){this._bitField=-131073&this._bitField,this._disposer=void 0},t.prototype.disposer=function(e){if("function"==typeof e)return new p(e,this,i());throw new m}}},{"./errors":12,"./util":36}],36:[function(e,t,n){function r(){try{var e=S;return S=null,e.apply(this,arguments)}catch(e){return I.e=e,I}}function i(e){return S=e,r}function o(e){return null==e||!0===e||!1===e||"string"==typeof e||"number"==typeof e}function a(e){return"function"==typeof e||"object"==typeof e&&null!==e}function s(e){return o(e)?new Error(g(e)):e}function l(e,t){var n,r=e.length,i=new Array(r+1);for(n=0;n<r;++n)i[n]=e[n];return i[n]=t,i}function c(e,t,n){if(!x.isES5)return{}.hasOwnProperty.call(e,t)?e[t]:void 0;var r=Object.getOwnPropertyDescriptor(e,t);return null!=r?null==r.get&&null==r.set?r.value:n:void 0}function u(e,t,n){if(o(e))return e;var r={value:n,configurable:!0,enumerable:!1,writable:!0};return x.defineProperty(e,t,r),e}function p(e){throw e}function h(e){try{if("function"==typeof e){var t=x.names(e.prototype),n=x.isES5&&t.length>1,r=t.length>0&&!(1===t.length&&"constructor"===t[0]),i=R.test(e+"")&&x.names(e).length>0;if(n||r||i)return!0}return!1}catch(e){return!1}}function f(e){function t(){}t.prototype=e;for(var n=8;n--;)new t;return e}function d(e){return O.test(e)}function m(e,t,n){for(var r=new Array(e),i=0;i<e;++i)r[i]=t+i+n;return r}function g(e){try{return e+""}catch(e){return"[no string representation]"}}function v(e){return null!==e&&"object"==typeof e&&"string"==typeof e.message&&"string"==typeof e.name}function y(e){try{u(e,"isOperational",!0)}catch(e){}}function _(e){return null!=e&&(e instanceof Error.__BluebirdErrorTypes__.OperationalError||!0===e.isOperational)}function b(e){return v(e)&&x.propertyIsWritable(e,"stack")}function w(e){return{}.toString.call(e)}function C(e,t,n){for(var r=x.names(e),i=0;i<r.length;++i){var o=r[i];if(n(o))try{x.defineProperty(t,o,x.getDescriptor(e,o))}catch(e){}}}function A(e){return M?process.env[e]:void 0}function E(){if("function"==typeof Promise)try{var e=new Promise(function(){});if("[object Promise]"==={}.toString.call(e))return Promise}catch(e){}}function k(e,t){return e.bind(t)}var x=e("./es5"),j="undefined"==typeof navigator,I={e:{}},S,T="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==Es?Es:void 0!==this?this:null,P=function(e,t){function n(){this.constructor=e,this.constructor$=t;for(var n in t.prototype)r.call(t.prototype,n)&&"$"!==n.charAt(n.length-1)&&(this[n+"$"]=t.prototype[n])}var r={}.hasOwnProperty;return n.prototype=t.prototype,e.prototype=new n,e.prototype},F=function(){var e=[Array.prototype,Object.prototype,Function.prototype],t=function(t){for(var n=0;n<e.length;++n)if(e[n]===t)return!0;return!1};if(x.isES5){var n=Object.getOwnPropertyNames;return function(e){for(var r=[],i=Object.create(null);null!=e&&!t(e);){var o;try{o=n(e)}catch(e){return r}for(var a=0;a<o.length;++a){var s=o[a];if(!i[s]){i[s]=!0;var l=Object.getOwnPropertyDescriptor(e,s);null!=l&&null==l.get&&null==l.set&&r.push(s)}}e=x.getPrototypeOf(e)}return r}}var r={}.hasOwnProperty;return function(n){if(t(n))return[];var i=[];e:for(var o in n)if(r.call(n,o))i.push(o);else{for(var a=0;a<e.length;++a)if(r.call(e[a],o))continue e;i.push(o)}return i}}(),R=/this\s*\.\s*\S+\s*=/,O=/^[a-z$_][a-z$_0-9]*$/i,D=function(){return"stack"in new Error?function(e){return b(e)?e:new Error(g(e))}:function(e){if(b(e))return e;try{throw new Error(g(e))}catch(e){return e}}}(),N=function(e){return x.isArray(e)?e:null};if("undefined"!=typeof Symbol&&Symbol.iterator){var V="function"==typeof Array.from?function(e){return Array.from(e)}:function(e){for(var t,n=[],r=e[Symbol.iterator]();!(t=r.next()).done;)n.push(t.value);return n};N=function(e){return x.isArray(e)?e:null!=e&&"function"==typeof e[Symbol.iterator]?V(e):null}}var L="undefined"!=typeof process&&"[object process]"===w(process).toLowerCase(),M="undefined"!=typeof process&&void 0!==process.env,B={isClass:h,isIdentifier:d,inheritedDataKeys:F,getDataPropertyOrDefault:c,thrower:p,isArray:x.isArray,asArray:N,notEnumerableProp:u,isPrimitive:o,isObject:a,isError:v,canEvaluate:j,errorObj:I,tryCatch:i,inherits:P,withAppended:l,maybeWrapAsError:s,toFastProperties:f,filledRange:m,toString:g,canAttachTrace:b,ensureErrorObject:D,originatesFromRejection:_,markAsOriginatingFromRejection:y,classString:w,copyDescriptors:C,hasDevTools:"undefined"!=typeof chrome&&chrome&&"function"==typeof chrome.loadTimes,isNode:L,hasEnvVariables:M,env:A,global:T,getNativePromise:E,domainBind:k};B.isRecentNode=B.isNode&&function(){var e=process.versions.node.split(".").map(Number);return 0===e[0]&&e[1]>10||e[0]>0}(),B.isNode&&B.toFastProperties(process);try{throw new Error}catch(e){B.lastLineError=e}t.exports=B},{"./es5":13}]},{},[4])(4)}()}(),"undefined"!=typeof window&&null!==window?window.P=window.Promise:"undefined"!=typeof self&&null!==self&&(self.P=self.Promise)});if(function(e){function t(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function n(e){return"string"!=typeof e&&(e=String(e)),e}function r(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return v.iterable&&(t[Symbol.iterator]=function(){return t}),t}function i(e){this.map={},e instanceof i?e.forEach(function(e,t){this.append(t,e)},this):Array.isArray(e)?e.forEach(function(e){this.append(e[0],e[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function o(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function a(e){return new Promise(function(t,n){e.onload=function(){t(e.result)},e.onerror=function(){n(e.error)}})}function s(e){var t=new FileReader,n=a(t);return t.readAsArrayBuffer(e),n}function l(e){var t=new FileReader,n=a(t);return t.readAsText(e),n}function c(e){for(var t=new Uint8Array(e),n=new Array(t.length),r=0;r<t.length;r++)n[r]=String.fromCharCode(t[r]);return n.join("")}function u(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function p(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e,e)if("string"==typeof e)this._bodyText=e;else if(v.blob&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(v.formData&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(v.searchParams&&URLSearchParams.prototype.isPrototypeOf(e))this._bodyText=e.toString();else if(v.arrayBuffer&&v.blob&&_(e))this._bodyArrayBuffer=u(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!v.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(e)&&!b(e))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=u(e)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):v.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},v.blob&&(this.blob=function(){var e=o(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?o(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(s)}),this.text=function(){var e=o(this);if(e)return e;if(this._bodyBlob)return l(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(c(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},v.formData&&(this.formData=function(){return this.text().then(d)}),this.json=function(){return this.text().then(JSON.parse)},this}function h(e){var t=e.toUpperCase();return w.indexOf(t)>-1?t:e}function f(e,t){var n=(t=t||{}).body;if(e instanceof f){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new i(e.headers)),this.method=e.method,this.mode=e.mode,n||null==e._bodyInit||(n=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"omit",!t.headers&&this.headers||(this.headers=new i(t.headers)),this.method=h(t.method||this.method||"GET"),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&n)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(n)}function d(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var n=e.split("="),r=n.shift().replace(/\+/g," "),i=n.join("=").replace(/\+/g," ");t.append(decodeURIComponent(r),decodeURIComponent(i))}}),t}function m(e){var t=new i;return e.split(/\r?\n/).forEach(function(e){var n=e.split(":"),r=n.shift().trim();if(r){var i=n.join(":").trim();t.append(r,i)}}),t}function g(e,t){t||(t={}),this.type="default",this.status="status"in t?t.status:200,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new i(t.headers),this.url=t.url||"",this._initBody(e)}if(!e.fetch){var v={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};if(v.arrayBuffer)var y=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],_=function(e){return e&&DataView.prototype.isPrototypeOf(e)},b=ArrayBuffer.isView||function(e){return e&&y.indexOf(Object.prototype.toString.call(e))>-1};i.prototype.append=function(e,r){e=t(e),r=n(r);var i=this.map[e];this.map[e]=i?i+","+r:r},i.prototype.delete=function(e){delete this.map[t(e)]},i.prototype.get=function(e){return e=t(e),this.has(e)?this.map[e]:null},i.prototype.has=function(e){return this.map.hasOwnProperty(t(e))},i.prototype.set=function(e,r){this.map[t(e)]=n(r)},i.prototype.forEach=function(e,t){for(var n in this.map)this.map.hasOwnProperty(n)&&e.call(t,this.map[n],n,this)},i.prototype.keys=function(){var e=[];return this.forEach(function(t,n){e.push(n)}),r(e)},i.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),r(e)},i.prototype.entries=function(){var e=[];return this.forEach(function(t,n){e.push([n,t])}),r(e)},v.iterable&&(i.prototype[Symbol.iterator]=i.prototype.entries);var w=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];f.prototype.clone=function(){return new f(this,{body:this._bodyInit})},p.call(f.prototype),p.call(g.prototype),g.prototype.clone=function(){return new g(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new i(this.headers),url:this.url})},g.error=function(){var e=new g(null,{status:0,statusText:""});return e.type="error",e};var C=[301,302,303,307,308];g.redirect=function(e,t){if(-1===C.indexOf(t))throw new RangeError("Invalid status code");return new g(null,{status:t,headers:{location:e}})},e.Headers=i,e.Request=f,e.Response=g,e.fetch=function(e,t){return new Promise(function(n,r){var i=new f(e,t),o=new XMLHttpRequest;o.onload=function(){var e={status:o.status,statusText:o.statusText,headers:m(o.getAllResponseHeaders()||"")};e.url="responseURL"in o?o.responseURL:e.headers.get("X-Request-URL");var t="response"in o?o.response:o.responseText;n(new g(t,e))},o.onerror=function(){r(new TypeError("Network request failed"))},o.ontimeout=function(){r(new TypeError("Network request failed"))},o.open(i.method,i.url,!0),"include"===i.credentials&&(o.withCredentials=!0),"responseType"in o&&v.blob&&(o.responseType="blob"),i.headers.forEach(function(e,t){o.setRequestHeader(t,e)}),o.send(void 0===i._bodyInit?null:i._bodyInit)})},e.fetch.polyfill=!0}}("undefined"!=typeof self?self:global),!console.time||!console.timeEnd){var Ll={};console.time=function(e){Ll[e]=(new Date).getTime()},console.timeEnd=function(e){Ll[key]&&(console.log(key+": "+((new Date).getTime()-Ll[key])+"ms"),delete Ll[key])}}if(void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}),void 0===Math.sign&&(Math.sign=function(e){return e<0?-1:e>0?1:+e}),void 0===Function.prototype.name&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&function(){Object.assign=function(e){if(void 0===e||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(void 0!==r&&null!==r)for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t}}(),Nl.isBrowser){if(window.performance||(window.performance={}),!window.performance.now){var Ml=performance.timing?performance.timing.navigationStart:null,Bl=Ml||Date.now();window.performance.now=function(){return Date.now()-Bl}}}else global.performance={now:require("performance-now")};var Ul=i(function(e){!function(t){var n={};n.VERSION="1.3.0";var r,i={},o=function(e,t){return function(){return t.apply(e,arguments)}},a=function(){var e,t,n=arguments,r=n[0];for(t=1;t<n.length;t++)for(e in n[t])e in r||!n[t].hasOwnProperty(e)||(r[e]=n[t][e]);return r},s=function(e,t){return{value:e,name:t}};n.DEBUG=s(1,"DEBUG"),n.INFO=s(2,"INFO"),n.TIME=s(3,"TIME"),n.WARN=s(4,"WARN"),n.ERROR=s(8,"ERROR"),n.OFF=s(99,"OFF");var l=function(e){this.context=e,this.setLevel(e.filterLevel),this.log=this.info};l.prototype={setLevel:function(e){e&&"value"in e&&(this.context.filterLevel=e)},enabledFor:function(e){var t=this.context.filterLevel;return e.value>=t.value},debug:function(){this.invoke(n.DEBUG,arguments)},info:function(){this.invoke(n.INFO,arguments)},warn:function(){this.invoke(n.WARN,arguments)},error:function(){this.invoke(n.ERROR,arguments)},time:function(e){"string"==typeof e&&e.length>0&&this.invoke(n.TIME,[e,"start"])},timeEnd:function(e){"string"==typeof e&&e.length>0&&this.invoke(n.TIME,[e,"end"])},invoke:function(e,t){r&&this.enabledFor(e)&&r(t,a({level:e},this.context))}};var c=new l({filterLevel:n.OFF});!function(){var e=n;e.enabledFor=o(c,c.enabledFor),e.debug=o(c,c.debug),e.time=o(c,c.time),e.timeEnd=o(c,c.timeEnd),e.info=o(c,c.info),e.warn=o(c,c.warn),e.error=o(c,c.error),e.log=e.info}(),n.setHandler=function(e){r=e},n.setLevel=function(e){c.setLevel(e);for(var t in i)i.hasOwnProperty(t)&&i[t].setLevel(e)},n.get=function(e){return i[e]||(i[e]=new l(a({name:e},c.context)))},n.createDefaultHandler=function(e){(e=e||{}).formatter=e.formatter||function(e,t){t.name&&e.unshift("["+t.name+"]")};var t={},r=function(e,t){Function.prototype.apply.call(e,console,t)};return"undefined"==typeof console?function(){}:function(i,o){i=Array.prototype.slice.call(i);var a,s=console.log;o.level===n.TIME?(a=(o.name?"["+o.name+"] ":"")+i[0],"start"===i[1]?console.time?console.time(a):t[a]=(new Date).getTime():console.timeEnd?console.timeEnd(a):r(s,[a+": "+((new Date).getTime()-t[a])+"ms"])):(o.level===n.WARN&&console.warn?s=console.warn:o.level===n.ERROR&&console.error?s=console.error:o.level===n.INFO&&console.info&&(s=console.info),e.formatter(i,o),r(s,i))}},n.useDefaults=function(e){n.setLevel(e&&e.defaultLevel||n.DEBUG),n.setHandler(n.createDefaultHandler(e))},e.exports?e.exports=n:(n._prevLogger=t.Logger,n.noConflict=function(){return t.Logger=n._prevLogger,n},t.Logger=n)}(Es)});Ul.useDefaults(),Nl.isBrowser&&console.log(as+" "+rs+" (@"+es+" #"+ts.substr(0,7)+" "+$a+")"),Nl.isNode&&(global.THREE=require("three"));var Wl=Object.freeze({logLevel:"warn",publishableApiKey:g(),secretApiKey:null,servicesUrl:"https://spaces.archilogic.com/api/v2",storageDomain:"storage.3d.io",storageDomainNoCdn:"storage-nocdn.3d.io"}),Zl={error:Ul.ERROR,warn:Ul.WARN,info:Ul.INFO,debug:Ul.DEBUG},Hl=function e(t){if(!t)return JSON.parse(JSON.stringify(this));t.logLevel&&(m(t.logLevel),delete t.logLevel),Nl.isBrowser&&t.secretApiKey&&Ul.error("The secret API key is not supposed to be used in browser environments!\nPlease see https://3d.io/docs/api/1/get-started-browser.html#secret-api-key for more information.");for(var n,r=Object.keys(t),i=0,o=r.length;i<o;i++)n=r[i],void 0!==Wl[n]?e[n]=t[n]:Ul.warn('Unknown config param "'+n+'". Available params are: '+Object.keys(Wl).join(", "));return this};Hl(JSON.parse(JSON.stringify(Wl)));var Gl=function(){return Nl.isNode?require("node-fetch"):"undefined"!=typeof fetch?fetch:(console.warn("Missing global fetch API."),function(){throw new Error("Missing global fetch API.")})}(),zl=i(function(e){var t=function(){return void 0===this}();if(t)e.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:t,propertyIsWritable:function(e,t){var n=Object.getOwnPropertyDescriptor(e,t);return!(n&&!n.writable&&!n.set)}};else{var n={}.hasOwnProperty,r={}.toString,i={}.constructor.prototype,o=function(e){var t=[];for(var r in e)n.call(e,r)&&t.push(r);return t},a=function(e,t){return{value:e[t]}},s=function(e,t,n){return e[t]=n.value,e},l=function(e){return e},c=function(e){try{return Object(e).constructor.prototype}catch(e){return i}},u=function(e){try{return"[object Array]"===r.call(e)}catch(e){return!1}};e.exports={isArray:u,keys:o,names:o,defineProperty:s,getDescriptor:a,freeze:l,getPrototypeOf:c,isES5:t,propertyIsWritable:function(){return!0}}}}),Ql="undefined"==typeof navigator,Kl={e:{}},Xl,Yl="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==Es?Es:void 0!==Es?Es:null,ql=function(e,t){function n(){this.constructor=e,this.constructor$=t;for(var n in t.prototype)r.call(t.prototype,n)&&"$"!==n.charAt(n.length-1)&&(this[n+"$"]=t.prototype[n])}var r={}.hasOwnProperty;return n.prototype=t.prototype,e.prototype=new n,e.prototype},Jl=function(){var e=[Array.prototype,Object.prototype,Function.prototype],t=function(t){for(var n=0;n<e.length;++n)if(e[n]===t)return!0;return!1};if(zl.isES5){var n=Object.getOwnPropertyNames;return function(e){for(var r=[],i=Object.create(null);null!=e&&!t(e);){var o;try{o=n(e)}catch(e){return r}for(var a=0;a<o.length;++a){var s=o[a];if(!i[s]){i[s]=!0;var l=Object.getOwnPropertyDescriptor(e,s);null!=l&&null==l.get&&null==l.set&&r.push(s)}}e=zl.getPrototypeOf(e)}return r}}var r={}.hasOwnProperty;return function(n){if(t(n))return[];var i=[];e:for(var o in n)if(r.call(n,o))i.push(o);else{for(var a=0;a<e.length;++a)if(r.call(e[a],o))continue e;i.push(o)}return i}}(),$l=/this\s*\.\s*\S+\s*=/,ec=/^[a-z$_][a-z$_0-9]*$/i,tc=function(){return"stack"in new Error?function(e){return N(e)?e:new Error(F(e))}:function(e){if(N(e))return e;try{throw new Error(F(e))}catch(e){return e}}}(),nc=function(e){return zl.isArray(e)?e:null};if("undefined"!=typeof Symbol&&Symbol.iterator){var rc="function"==typeof Array.from?function(e){return Array.from(e)}:function(e){for(var t,n=[],r=e[Symbol.iterator]();!(t=r.next()).done;)n.push(t.value);return n};nc=function(e){return zl.isArray(e)?e:null!=e&&"function"==typeof e[Symbol.iterator]?rc(e):null}}var ic="undefined"!=typeof process&&"[object process]"===V(process).toLowerCase(),oc="undefined"!=typeof process&&void 0!==process.env,ac={isClass:I,isIdentifier:T,inheritedDataKeys:Jl,getDataPropertyOrDefault:k,thrower:j,isArray:zl.isArray,asArray:nc,notEnumerableProp:x,isPrimitive:w,isObject:C,isError:R,canEvaluate:Ql,errorObj:Kl,tryCatch:b,inherits:ql,withAppended:E,maybeWrapAsError:A,toFastProperties:S,filledRange:P,toString:F,canAttachTrace:N,ensureErrorObject:tc,originatesFromRejection:D,markAsOriginatingFromRejection:O,classString:V,copyDescriptors:L,hasDevTools:"undefined"!=typeof chrome&&chrome&&"function"==typeof chrome.loadTimes,isNode:ic,hasEnvVariables:oc,env:M,global:Yl,getNativePromise:B,domainBind:U};ac.isRecentNode=ac.isNode&&function(){var e=process.versions.node.split(".").map(Number);return 0===e[0]&&e[1]>10||e[0]>0}(),ac.isNode&&ac.toFastProperties(process);try{throw new Error}catch(e){ac.lastLineError=e}var sc=ac,lc,cc=function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")},uc=sc.getNativePromise();if(sc.isNode&&"undefined"==typeof MutationObserver){var pc=Es.setImmediate,hc=process.nextTick;lc=sc.isRecentNode?function(e){pc.call(Es,e)}:function(e){hc.call(process,e)}}else if("function"==typeof uc&&"function"==typeof uc.resolve){var fc=uc.resolve();lc=function(e){fc.then(e)}}else lc="undefined"==typeof MutationObserver||"undefined"!=typeof window&&window.navigator&&(window.navigator.standalone||window.cordova)?"undefined"!=typeof setImmediate?function(e){setImmediate(e)}:"undefined"!=typeof setTimeout?function(e){setTimeout(e,0)}:cc:function(){var e=document.createElement("div"),t={attributes:!0},n=!1,r=document.createElement("div");new MutationObserver(function(){e.classList.toggle("foo"),n=!1}).observe(r,t);var i=function(){n||(n=!0,r.classList.toggle("foo"))};return function(n){var r=new MutationObserver(function(){r.disconnect(),n()});r.observe(e,t),i()}}();var dc=lc;Z.prototype._willBeOverCapacity=function(e){return this._capacity<e},Z.prototype._pushOne=function(e){var t=this.length();this._checkCapacity(t+1),this[this._front+t&this._capacity-1]=e,this._length=t+1},Z.prototype.push=function(e,t,n){var r=this.length()+3;if(this._willBeOverCapacity(r))return this._pushOne(e),this._pushOne(t),void this._pushOne(n);var i=this._front+r-3;this._checkCapacity(r);var o=this._capacity-1;this[i+0&o]=e,this[i+1&o]=t,this[i+2&o]=n,this._length=r},Z.prototype.shift=function(){var e=this._front,t=this[e];return this[e]=void 0,this._front=e+1&this._capacity-1,this._length--,t},Z.prototype.length=function(){return this._length},Z.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(this._capacity<<1)},Z.prototype._resizeTo=function(e){var t=this._capacity;this._capacity=e,W(this,0,this,t,this._front+this._length&t-1)};var mc=Z,gc;try{throw new Error}catch(e){gc=e}H.prototype.setScheduler=function(e){var t=this._schedule;return this._schedule=e,this._customScheduler=!0,t},H.prototype.hasCustomScheduler=function(){return this._customScheduler},H.prototype.enableTrampoline=function(){this._trampolineEnabled=!0},H.prototype.disableTrampolineIfNecessary=function(){sc.hasDevTools&&(this._trampolineEnabled=!1)},H.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues},H.prototype.fatalError=function(e,t){t?(process.stderr.write("Fatal "+(e instanceof Error?e.stack:e)+"\n"),process.exit(2)):this.throwLater(e)},H.prototype.throwLater=function(e,t){if(1===arguments.length&&(t=e,e=function(){throw t}),"undefined"!=typeof setTimeout)setTimeout(function(){e(t)},0);else try{this._schedule(function(){e(t)})}catch(e){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}},sc.hasDevTools?(H.prototype.invokeLater=function(e,t,n){this._trampolineEnabled?G.call(this,e,t,n):this._schedule(function(){setTimeout(function(){e.call(t,n)},100)})},H.prototype.invoke=function(e,t,n){this._trampolineEnabled?z.call(this,e,t,n):this._schedule(function(){e.call(t,n)})},H.prototype.settlePromises=function(e){this._trampolineEnabled?Q.call(this,e):this._schedule(function(){e._settlePromises()})}):(H.prototype.invokeLater=G,H.prototype.invoke=z,H.prototype.settlePromises=Q),H.prototype._drainQueue=function(e){for(;e.length()>0;){var t=e.shift();if("function"==typeof t){var n=e.shift(),r=e.shift();t.call(n,r)}else t._settlePromises()}},H.prototype._drainQueues=function(){this._drainQueue(this._normalQueue),this._reset(),this._haveDrainedQueues=!0,this._drainQueue(this._lateQueue)},H.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},H.prototype._reset=function(){this._isTickUsed=!1};var vc=H,yc=gc;vc.firstLineError=yc;var _c=zl.freeze,bc=sc.inherits,wc=sc.notEnumerableProp,Cc,Ac,Ec=K("Warning","warning"),kc=K("CancellationError","cancellation error"),xc=K("TimeoutError","timeout error"),jc=K("AggregateError","aggregate error");try{Cc=TypeError,Ac=RangeError}catch(e){Cc=K("TypeError","type error"),Ac=K("RangeError","range error")}for(var Ic="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),Sc=0;Sc<Ic.length;++Sc)"function"==typeof Array.prototype[Ic[Sc]]&&(jc.prototype[Ic[Sc]]=Array.prototype[Ic[Sc]]);zl.defineProperty(jc.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),jc.prototype.isOperational=!0;var Tc=0;jc.prototype.toString=function(){var e=Array(4*Tc+1).join(" "),t="\n"+e+"AggregateError of:\n";Tc++,e=Array(4*Tc+1).join(" ");for(var n=0;n<this.length;++n){for(var r=this[n]===this?"[Circular AggregateError]":this[n]+"",i=r.split("\n"),o=0;o<i.length;++o)i[o]=e+i[o];t+=(r=i.join("\n"))+"\n"}return Tc--,t},bc(X,Error);var Pc=Error.__BluebirdErrorTypes__;Pc||(Pc=_c({CancellationError:kc,TimeoutError:xc,OperationalError:X,RejectionError:X,AggregateError:jc}),zl.defineProperty(Error,"__BluebirdErrorTypes__",{value:Pc,writable:!1,enumerable:!1,configurable:!1}));var Fc={Error:Error,TypeError:Cc,RangeError:Ac,CancellationError:Pc.CancellationError,OperationalError:Pc.OperationalError,TimeoutError:Pc.TimeoutError,AggregateError:Pc.AggregateError,Warning:Ec},Rc=function(e,t){function n(n,r){if(c(n)){if(n instanceof e)return n;var s=i(n);if(s===l)return r&&r._pushContext(),u=e.reject(s.e),r&&r._popContext(),u;if("function"==typeof s){if(o(n)){var u=new e(t);return n._then(u._fulfill,u._reject,void 0,u,null),u}return a(n,s,r)}}return n}function r(e){return e.then}function i(e){try{return r(e)}catch(e){return l.e=e,l}}function o(e){try{return u.call(e,"_promise0")}catch(e){return!1}}function a(n,r,i){function o(e){c&&(c._resolveCallback(e),c=null)}function a(e){c&&(c._rejectCallback(e,p,!0),c=null)}var c=new e(t),u=c;i&&i._pushContext(),c._captureStackTrace(),i&&i._popContext();var p=!0,h=s.tryCatch(r).call(n,o,a);return p=!1,c&&h===l&&(c._rejectCallback(h.e,!0,!0),c=null),u}var s=sc,l=s.errorObj,c=s.isObject,u={}.hasOwnProperty;return n},Oc=function(e,t,n,r,i){function o(e){switch(e){case-2:return[];case-3:return{};case-6:return new Map}}function a(n){var r=this._promise=new e(t);n instanceof e&&r._propagateFrom(n,3),r._setOnCancel(this),this._values=n,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var s=sc;return s.isArray,s.inherits(a,i),a.prototype.length=function(){return this._length},a.prototype.promise=function(){return this._promise},a.prototype._init=function t(i,a){var l=n(this._values,this._promise);if(l instanceof e){var c=(l=l._target())._bitField;if(this._values=l,0==(50397184&c))return this._promise._setAsyncGuaranteed(),l._then(t,this._reject,void 0,this,a);if(0==(33554432&c))return 0!=(16777216&c)?this._reject(l._reason()):this._cancel();l=l._value()}if(null!==(l=s.asArray(l)))0!==l.length?this._iterate(l):-5===a?this._resolveEmptyArray():this._resolve(o(a));else{var u=r("expecting an array or an iterable object but got "+s.classString(l)).reason();this._promise._rejectCallback(u,!1)}},a.prototype._iterate=function(t){var r=this.getActualLength(t.length);this._length=r,this._values=this.shouldCopyValues()?new Array(r):this._values;for(var i=this._promise,o=!1,a=null,s=0;s<r;++s){var l=n(t[s],i);a=l instanceof e?(l=l._target())._bitField:null,o?null!==a&&l.suppressUnhandledRejections():null!==a?0==(50397184&a)?(l._proxy(this,s),this._values[s]=l):o=0!=(33554432&a)?this._promiseFulfilled(l._value(),s):0!=(16777216&a)?this._promiseRejected(l._reason(),s):this._promiseCancelled(s):o=this._promiseFulfilled(l,s)}o||i._setAsyncGuaranteed()},a.prototype._isResolved=function(){return null===this._values},a.prototype._resolve=function(e){this._values=null,this._promise._fulfill(e)},a.prototype._cancel=function(){!this._isResolved()&&this._promise._isCancellable()&&(this._values=null,this._promise._cancel())},a.prototype._reject=function(e){this._values=null,this._promise._rejectCallback(e,!1)},a.prototype._promiseFulfilled=function(e,t){return this._values[t]=e,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},a.prototype._promiseCancelled=function(){return this._cancel(),!0},a.prototype._promiseRejected=function(e){return this._totalResolved++,this._reject(e),!0},a.prototype._resultCancelled=function(){if(!this._isResolved()){var t=this._values;if(this._cancel(),t instanceof e)t.cancel();else for(var n=0;n<t.length;++n)t[n]instanceof e&&t[n].cancel()}},a.prototype.shouldCopyValues=function(){return!0},a.prototype.getActualLength=function(e){return e},a},Dc=function(e){function t(){this._trace=new t.CapturedTrace(r())}function n(){if(i)return new t}function r(){var e=o.length-1;if(e>=0)return o[e]}var i=!1,o=[];return e.prototype._promiseCreated=function(){},e.prototype._pushContext=function(){},e.prototype._popContext=function(){return null},e._peekContext=e.prototype._peekContext=function(){},t.prototype._pushContext=function(){void 0!==this._trace&&(this._trace._promiseCreated=null,o.push(this._trace))},t.prototype._popContext=function(){if(void 0!==this._trace){var e=o.pop(),t=e._promiseCreated;return e._promiseCreated=null,t}return null},t.CapturedTrace=null,t.create=n,t.deactivateLongStackTraces=function(){},t.activateLongStackTraces=function(){var n=e.prototype._pushContext,o=e.prototype._popContext,a=e._peekContext,s=e.prototype._peekContext,l=e.prototype._promiseCreated;t.deactivateLongStackTraces=function(){e.prototype._pushContext=n,e.prototype._popContext=o,e._peekContext=a,e.prototype._peekContext=s,e.prototype._promiseCreated=l,i=!1},i=!0,e.prototype._pushContext=t.prototype._pushContext,e.prototype._popContext=t.prototype._popContext,e._peekContext=e.prototype._peekContext=r,e.prototype._promiseCreated=function(){var e=this._peekContext();e&&null==e._promiseCreated&&(e._promiseCreated=this)}},t},Nc=function(e,t){function n(e,t){return{promise:t}}function r(){return!1}function i(e,t,n){var r=this;try{e(t,n,function(e){if("function"!=typeof e)throw new TypeError("onCancel must be a function, got: "+V.toString(e));r._attachCancellationCallback(e)})}catch(e){return e}}function o(e){if(!this._isCancellable())return this;var t=this._onCancel();void 0!==t?V.isArray(t)?t.push(e):this._setOnCancel([t,e]):this._setOnCancel(e)}function a(){return this._onCancelField}function s(e){this._onCancelField=e}function l(){this._cancellationParent=void 0,this._onCancelField=void 0}function c(e,t){if(0!=(1&t)){this._cancellationParent=e;var n=e._branchesRemainingToCancel;void 0===n&&(n=0),e._branchesRemainingToCancel=n+1}0!=(2&t)&&e._isBound()&&this._setBoundTo(e._boundTo)}function u(e,t){0!=(2&t)&&e._isBound()&&this._setBoundTo(e._boundTo)}function p(){var t=this._boundTo;return void 0!==t&&t instanceof e?t.isFulfilled()?t.value():void 0:t}function h(){this._trace=new T(this._peekContext())}function f(e,t){if(L(e)){var n=this._trace;if(void 0!==n&&t&&(n=n._parent),void 0!==n)n.attachExtraTrace(e);else if(!e.__stackCleaned__){var r=C(e);V.notEnumerableProp(e,"stack",r.message+"\n"+r.stack.join("\n")),V.notEnumerableProp(e,"__stackCleaned__",!0)}}}function d(e,t,n,r,i){if(void 0===e&&null!==t&&K){if(void 0!==i&&i._returnedNonUndefined())return;if(0==(65535&r._bitField))return;n&&(n+=" ");var o="",a="";if(t._trace){for(var s=t._trace.stack.split("\n"),l=b(s),c=l.length-1;c>=0;--c){var u=l[c];if(!B.test(u)){var p=u.match(U);p&&(o="at "+p[1]+":"+p[2]+":"+p[3]+" ");break}}if(l.length>0)for(var h=l[0],c=0;c<s.length;++c)if(s[c]===h){c>0&&(a="\n"+s[c-1]);break}}var f="a promise was created in a "+n+"handler "+o+"but was not returned from it, see http://goo.gl/rRqMUw"+a;r._warn(f,!0,t)}}function m(e,t){var n=e+" is deprecated and will be removed in a future version.";return t&&(n+=" Use "+t+" instead."),g(n)}function g(t,n,r){if(ie.warnings){var i,o=new N(t);if(n)r._attachExtraTrace(o);else if(ie.longStackTraces&&(i=e._peekContext()))i.attachExtraTrace(o);else{var a=C(o);o.stack=a.message+"\n"+a.stack.join("\n")}$("warning",o)||A(o,"",!0)}}function v(e,t){for(var n=0;n<t.length-1;++n)t[n].push("From previous event:"),t[n]=t[n].join("\n");return n<t.length&&(t[n]=t[n].join("\n")),e+"\n"+t.join("\n")}function y(e){for(var t=0;t<e.length;++t)(0===e[t].length||t+1<e.length&&e[t][0]===e[t+1][0])&&(e.splice(t,1),t--)}function _(e){for(var t=e[0],n=1;n<e.length;++n){for(var r=e[n],i=t.length-1,o=t[i],a=-1,s=r.length-1;s>=0;--s)if(r[s]===o){a=s;break}for(s=a;s>=0;--s){var l=r[s];if(t[i]!==l)break;t.pop(),i--}t=r}}function b(e){for(var t=[],n=0;n<e.length;++n){var r=e[n],i="    (No stack trace)"===r||W.test(r),o=i&&te(r);i&&!o&&(H&&" "!==r.charAt(0)&&(r="    "+r),t.push(r))}return t}function w(e){for(var t=e.stack.replace(/\s+$/g,"").split("\n"),n=0;n<t.length;++n){var r=t[n];if("    (No stack trace)"===r||W.test(r))break}return n>0&&"SyntaxError"!=e.name&&(t=t.slice(n)),t}function C(e){var t=e.stack,n=e.toString();return t="string"==typeof t&&t.length>0?w(e):["    (No stack trace)"],{message:n,stack:"SyntaxError"==e.name?t:b(t)}}function A(e,t,n){if("undefined"!=typeof console){var r;if(V.isObject(e)){var i=e.stack;r=t+Z(i,e)}else r=t+String(e);"function"==typeof R?R(r,n):"function"!=typeof console.log&&"object"!=typeof console.log||console.log(r)}}function E(e,t,n,r){var i=!1;try{"function"==typeof t&&(i=!0,"rejectionHandled"===e?t(r):t(n,r))}catch(e){D.throwLater(e)}"unhandledRejection"===e?$(e,n,r)||i||A(n,"Unhandled rejection "):$(e,r)}function k(e){var t;if("function"==typeof e)t="[function "+(e.name||"anonymous")+"]";else{if(t=e&&"function"==typeof e.toString?e.toString():V.toString(e),/\[object [a-zA-Z0-9$_]+\]/.test(t))try{t=JSON.stringify(e)}catch(e){}0===t.length&&(t="(empty array)")}return"(<"+x(t)+">, no stack trace)"}function x(e){return e.length<41?e:e.substr(0,38)+"..."}function j(){return"function"==typeof re}function I(e){var t=e.match(ne);if(t)return{fileName:t[1],line:parseInt(t[2],10)}}function S(e,t){if(j()){for(var n,r,i=e.stack.split("\n"),o=t.stack.split("\n"),a=-1,s=-1,l=0;l<i.length;++l)if(c=I(i[l])){n=c.fileName,a=c.line;break}for(l=0;l<o.length;++l){var c=I(o[l]);if(c){r=c.fileName,s=c.line;break}}a<0||s<0||!n||!r||n!==r||a>=s||(te=function(e){if(M.test(e))return!0;var t=I(e);return!!(t&&t.fileName===n&&a<=t.line&&t.line<=s)})}}function T(e){this._parent=e,this._promisesCreated=0;var t=this._length=1+(void 0===e?0:e._length);re(this,T),t>32&&this.uncycle()}var P,F,R,O=e._getDomain,D=e._async,N=Fc.Warning,V=sc,L=V.canAttachTrace,M=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,B=/\((?:timers\.js):\d+:\d+\)/,U=/[\/<\(](.+?):(\d+):(\d+)\)?\s*$/,W=null,Z=null,H=!1,G=!(0==V.env("BLUEBIRD_DEBUG")||!V.env("BLUEBIRD_DEBUG")&&"development"!==V.env("NODE_ENV")),z=!(0==V.env("BLUEBIRD_WARNINGS")||!G&&!V.env("BLUEBIRD_WARNINGS")),Q=!(0==V.env("BLUEBIRD_LONG_STACK_TRACES")||!G&&!V.env("BLUEBIRD_LONG_STACK_TRACES")),K=0!=V.env("BLUEBIRD_W_FORGOTTEN_RETURN")&&(z||!!V.env("BLUEBIRD_W_FORGOTTEN_RETURN"));e.prototype.suppressUnhandledRejections=function(){var e=this._target();e._bitField=-1048577&e._bitField|524288},e.prototype._ensurePossibleRejectionHandled=function(){0==(524288&this._bitField)&&(this._setRejectionIsUnhandled(),D.invokeLater(this._notifyUnhandledRejection,this,void 0))},e.prototype._notifyUnhandledRejectionIsHandled=function(){E("rejectionHandled",P,void 0,this)},e.prototype._setReturnedNonUndefined=function(){this._bitField=268435456|this._bitField},e.prototype._returnedNonUndefined=function(){return 0!=(268435456&this._bitField)},e.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var e=this._settledValue();this._setUnhandledRejectionIsNotified(),E("unhandledRejection",F,e,this)}},e.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=262144|this._bitField},e.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-262145&this._bitField},e.prototype._isUnhandledRejectionNotified=function(){return(262144&this._bitField)>0},e.prototype._setRejectionIsUnhandled=function(){this._bitField=1048576|this._bitField},e.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-1048577&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},e.prototype._isRejectionUnhandled=function(){return(1048576&this._bitField)>0},e.prototype._warn=function(e,t,n){return g(e,t,n||this)},e.onPossiblyUnhandledRejection=function(e){var t=O();F="function"==typeof e?null===t?e:V.domainBind(t,e):void 0},e.onUnhandledRejectionHandled=function(e){var t=O();P="function"==typeof e?null===t?e:V.domainBind(t,e):void 0};var X=function(){};e.longStackTraces=function(){if(D.haveItemsQueued()&&!ie.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");if(!ie.longStackTraces&&j()){var n=e.prototype._captureStackTrace,r=e.prototype._attachExtraTrace;ie.longStackTraces=!0,X=function(){if(D.haveItemsQueued()&&!ie.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");e.prototype._captureStackTrace=n,e.prototype._attachExtraTrace=r,t.deactivateLongStackTraces(),D.enableTrampoline(),ie.longStackTraces=!1},e.prototype._captureStackTrace=h,e.prototype._attachExtraTrace=f,t.activateLongStackTraces(),D.disableTrampolineIfNecessary()}},e.hasLongStackTraces=function(){return ie.longStackTraces&&j()};var Y=function(){try{if("function"==typeof CustomEvent)return e=new CustomEvent("CustomEvent"),V.global.dispatchEvent(e),function(e,t){var n=new CustomEvent(e.toLowerCase(),{detail:t,cancelable:!0});return!V.global.dispatchEvent(n)};if("function"==typeof Event){var e=new Event("CustomEvent");return V.global.dispatchEvent(e),function(e,t){var n=new Event(e.toLowerCase(),{cancelable:!0});return n.detail=t,!V.global.dispatchEvent(n)}}return(e=document.createEvent("CustomEvent")).initCustomEvent("testingtheevent",!1,!0,{}),V.global.dispatchEvent(e),function(e,t){var n=document.createEvent("CustomEvent");return n.initCustomEvent(e.toLowerCase(),!1,!0,t),!V.global.dispatchEvent(n)}}catch(e){}return function(){return!1}}(),q=function(){return V.isNode?function(){return process.emit.apply(process,arguments)}:V.global?function(e){var t="on"+e.toLowerCase(),n=V.global[t];return!!n&&(n.apply(V.global,[].slice.call(arguments,1)),!0)}:function(){return!1}}(),J={promiseCreated:n,promiseFulfilled:n,promiseRejected:n,promiseResolved:n,promiseCancelled:n,promiseChained:function(e,t,n){return{promise:t,child:n}},warning:function(e,t){return{warning:t}},unhandledRejection:function(e,t,n){return{reason:t,promise:n}},rejectionHandled:n},$=function(e){var t=!1;try{t=q.apply(null,arguments)}catch(e){D.throwLater(e),t=!0}var n=!1;try{n=Y(e,J[e].apply(null,arguments))}catch(e){D.throwLater(e),n=!0}return n||t};e.config=function(t){if("longStackTraces"in(t=Object(t))&&(t.longStackTraces?e.longStackTraces():!t.longStackTraces&&e.hasLongStackTraces()&&X()),"warnings"in t){var n=t.warnings;ie.warnings=!!n,K=ie.warnings,V.isObject(n)&&"wForgottenReturn"in n&&(K=!!n.wForgottenReturn)}if("cancellation"in t&&t.cancellation&&!ie.cancellation){if(D.haveItemsQueued())throw new Error("cannot enable cancellation after promises are in use");e.prototype._clearCancellationData=l,e.prototype._propagateFrom=c,e.prototype._onCancel=a,e.prototype._setOnCancel=s,e.prototype._attachCancellationCallback=o,e.prototype._execute=i,ee=c,ie.cancellation=!0}return"monitoring"in t&&(t.monitoring&&!ie.monitoring?(ie.monitoring=!0,e.prototype._fireEvent=$):!t.monitoring&&ie.monitoring&&(ie.monitoring=!1,e.prototype._fireEvent=r)),e},e.prototype._fireEvent=r,e.prototype._execute=function(e,t,n){try{e(t,n)}catch(e){return e}},e.prototype._onCancel=function(){},e.prototype._setOnCancel=function(e){},e.prototype._attachCancellationCallback=function(e){},e.prototype._captureStackTrace=function(){},e.prototype._attachExtraTrace=function(){},e.prototype._clearCancellationData=function(){},e.prototype._propagateFrom=function(e,t){};var ee=u,te=function(){return!1},ne=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;V.inherits(T,Error),t.CapturedTrace=T,T.prototype.uncycle=function(){var e=this._length;if(!(e<2)){for(var t=[],n={},r=0,i=this;void 0!==i;++r)t.push(i),i=i._parent;for(r=(e=this._length=r)-1;r>=0;--r){var o=t[r].stack;void 0===n[o]&&(n[o]=r)}for(r=0;r<e;++r){var a=n[t[r].stack];if(void 0!==a&&a!==r){a>0&&(t[a-1]._parent=void 0,t[a-1]._length=1),t[r]._parent=void 0,t[r]._length=1;var s=r>0?t[r-1]:this;a<e-1?(s._parent=t[a+1],s._parent.uncycle(),s._length=s._parent._length+1):(s._parent=void 0,s._length=1);for(var l=s._length+1,c=r-2;c>=0;--c)t[c]._length=l,l++;return}}}},T.prototype.attachExtraTrace=function(e){if(!e.__stackCleaned__){this.uncycle();for(var t=C(e),n=t.message,r=[t.stack],i=this;void 0!==i;)r.push(b(i.stack.split("\n"))),i=i._parent;_(r),y(r),V.notEnumerableProp(e,"stack",v(n,r)),V.notEnumerableProp(e,"__stackCleaned__",!0)}};var re=function(){var e=/^\s*at\s*/,t=function(e,t){return"string"==typeof e?e:void 0!==t.name&&void 0!==t.message?t.toString():k(t)};if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){Error.stackTraceLimit+=6,W=e,Z=t;var n=Error.captureStackTrace;return te=function(e){return M.test(e)},function(e,t){Error.stackTraceLimit+=6,n(e,t),Error.stackTraceLimit-=6}}var r=new Error;if("string"==typeof r.stack&&r.stack.split("\n")[0].indexOf("stackDetection@")>=0)return W=/@/,Z=t,H=!0,function(e){e.stack=(new Error).stack};var i;try{throw new Error}catch(e){i="stack"in e}return"stack"in r||!i||"number"!=typeof Error.stackTraceLimit?(Z=function(e,t){return"string"==typeof e?e:"object"!=typeof t&&"function"!=typeof t||void 0===t.name||void 0===t.message?k(t):t.toString()},null):(W=e,Z=t,function(e){Error.stackTraceLimit+=6;try{throw new Error}catch(t){e.stack=t.stack}Error.stackTraceLimit-=6})}();"undefined"!=typeof console&&void 0!==console.warn&&(R=function(e){console.warn(e)},V.isNode&&process.stderr.isTTY?R=function(e,t){var n=t?"[33m":"[31m";console.warn(n+e+"[0m\n")}:V.isNode||"string"!=typeof(new Error).stack||(R=function(e,t){console.warn("%c"+e,t?"color: darkorange":"color: red")}));var ie={warnings:z,longStackTraces:!1,cancellation:!1,monitoring:!1};return Q&&e.longStackTraces(),{longStackTraces:function(){return ie.longStackTraces},warnings:function(){return ie.warnings},cancellation:function(){return ie.cancellation},monitoring:function(){return ie.monitoring},propagateFromFunction:function(){return ee},boundValueFunction:function(){return p},checkForgottenReturns:d,setBounds:S,warn:g,deprecated:m,CapturedTrace:T,fireDomEvent:Y,fireGlobalEvent:q}},Vc=function(e){function t(t,a,s){return function(l){var c=s._boundValue();e:for(var u=0;u<t.length;++u){var p=t[u];if(p===Error||null!=p&&p.prototype instanceof Error){if(l instanceof p)return i(a).call(c,l)}else if("function"==typeof p){var h=i(p).call(c,l);if(h===o)return h;if(h)return i(a).call(c,l)}else if(n.isObject(l)){for(var f=r(p),d=0;d<f.length;++d){var m=f[d];if(p[m]!=l[m])continue e}return i(a).call(c,l)}}return e}}var n=sc,r=zl.keys,i=n.tryCatch,o=n.errorObj;return t},Lc=function(e,t,n){function r(e,t,n){this.promise=e,this.type=t,this.handler=n,this.called=!1,this.cancelPromise=null}function i(e){this.finallyHandler=e}function o(e,t){return null!=e.cancelPromise&&(arguments.length>1?e.cancelPromise._reject(t):e.cancelPromise._cancel(),e.cancelPromise=null,!0)}function a(){return l.call(this,this.promise._target()._settledValue())}function s(e){if(!o(this,e))return p.e=e,p}function l(r){var l=this.promise,c=this.handler;if(!this.called){this.called=!0;var h=this.isFinallyHandler()?c.call(l._boundValue()):c.call(l._boundValue(),r);if(h===n)return h;if(void 0!==h){l._setReturnedNonUndefined();var f=t(h,l);if(f instanceof e){if(null!=this.cancelPromise){if(f._isCancelled()){var d=new u("late cancellation observer");return l._attachExtraTrace(d),p.e=d,p}f.isPending()&&f._attachCancellationCallback(new i(this))}return f._then(a,s,void 0,this,void 0)}}}return l.isRejected()?(o(this),p.e=r,p):(o(this),r)}var c=sc,u=e.CancellationError,p=c.errorObj,h=Vc(n);return r.prototype.isFinallyHandler=function(){return 0===this.type},i.prototype._resultCancelled=function(){o(this.finallyHandler)},e.prototype._passThrough=function(e,t,n,i){return"function"!=typeof e?this.then():this._then(n,i,void 0,new r(this,t,e),void 0)},e.prototype.lastly=e.prototype.finally=function(e){return this._passThrough(e,0,l,l)},e.prototype.tap=function(e){return this._passThrough(e,1,l)},e.prototype.tapCatch=function(t){var n=arguments.length;if(1===n)return this._passThrough(t,1,void 0,l);var r,i=new Array(n-1),o=0;for(r=0;r<n-1;++r){var a=arguments[r];if(!c.isObject(a))return e.reject(new TypeError("tapCatch statement predicate: expecting an object but got "+c.classString(a)));i[o++]=a}i.length=o;var s=arguments[r];return this._passThrough(h(i,s,this),1,void 0,l)},r},Mc=sc.maybeWrapAsError,Bc=Fc.OperationalError,Uc=/^(?:name|message|stack|cause)$/,Wc=J,Zc=function(e,t,n,r,i){var o=sc,a=o.tryCatch;e.method=function(n){if("function"!=typeof n)throw new e.TypeError("expecting a function but got "+o.classString(n));return function(){var r=new e(t);r._captureStackTrace(),r._pushContext();var o=a(n).apply(this,arguments),s=r._popContext();return i.checkForgottenReturns(o,s,"Promise.method",r),r._resolveFromSyncValue(o),r}},e.attempt=e.try=function(n){if("function"!=typeof n)return r("expecting a function but got "+o.classString(n));var s=new e(t);s._captureStackTrace(),s._pushContext();var l;if(arguments.length>1){i.deprecated("calling Promise.try with more than 1 argument");var c=arguments[1],u=arguments[2];l=o.isArray(c)?a(n).apply(u,c):a(n).call(u,c)}else l=a(n)();var p=s._popContext();return i.checkForgottenReturns(l,p,"Promise.try",s),s._resolveFromSyncValue(l),s},e.prototype._resolveFromSyncValue=function(e){e===o.errorObj?this._rejectCallback(e.e,!1):this._resolveCallback(e,!0)}},Hc=function(e,t,n,r){var i=!1,o=function(e,t){this._reject(t)},a=function(e,t){t.promiseRejectionQueued=!0,t.bindingPromise._then(o,o,null,this,e)},s=function(e,t){0==(50397184&this._bitField)&&this._resolveCallback(t.target)},l=function(e,t){t.promiseRejectionQueued||this._reject(e)};e.prototype.bind=function(o){i||(i=!0,e.prototype._propagateFrom=r.propagateFromFunction(),e.prototype._boundValue=r.boundValueFunction());var c=n(o),u=new e(t);u._propagateFrom(this,1);var p=this._target();if(u._setBoundTo(c),c instanceof e){var h={promiseRejectionQueued:!1,promise:u,target:p,bindingPromise:c};p._then(t,a,void 0,u,h),c._then(s,l,void 0,u,h),u._setOnCancel(c)}else u._resolveCallback(p);return u},e.prototype._setBoundTo=function(e){void 0!==e?(this._bitField=2097152|this._bitField,this._boundTo=e):this._bitField=-2097153&this._bitField},e.prototype._isBound=function(){return 2097152==(2097152&this._bitField)},e.bind=function(t,n){return e.resolve(n).bind(t)}},Gc=function(e,t,n,r){var i=sc,o=i.tryCatch,a=i.errorObj,s=e._async;e.prototype.break=e.prototype.cancel=function(){if(!r.cancellation())return this._warn("cancellation is disabled");for(var e=this,t=e;e._isCancellable();){if(!e._cancelBy(t)){t._isFollowing()?t._followee().cancel():t._cancelBranched();break}var n=e._cancellationParent;if(null==n||!n._isCancellable()){e._isFollowing()?e._followee().cancel():e._cancelBranched();break}e._isFollowing()&&e._followee().cancel(),e._setWillBeCancelled(),t=e,e=n}},e.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--},e.prototype._enoughBranchesHaveCancelled=function(){return void 0===this._branchesRemainingToCancel||this._branchesRemainingToCancel<=0},e.prototype._cancelBy=function(e){return e===this?(this._branchesRemainingToCancel=0,this._invokeOnCancel(),!0):(this._branchHasCancelled(),!!this._enoughBranchesHaveCancelled()&&(this._invokeOnCancel(),!0))},e.prototype._cancelBranched=function(){this._enoughBranchesHaveCancelled()&&this._cancel()},e.prototype._cancel=function(){this._isCancellable()&&(this._setCancelled(),s.invoke(this._cancelPromises,this,void 0))},e.prototype._cancelPromises=function(){this._length()>0&&this._settlePromises()},e.prototype._unsetOnCancel=function(){this._onCancelField=void 0},e.prototype._isCancellable=function(){return this.isPending()&&!this._isCancelled()},e.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()},e.prototype._doInvokeOnCancel=function(e,t){if(i.isArray(e))for(var n=0;n<e.length;++n)this._doInvokeOnCancel(e[n],t);else if(void 0!==e)if("function"==typeof e){if(!t){var r=o(e).call(this._boundValue());r===a&&(this._attachExtraTrace(r.e),s.throwLater(r.e))}}else e._resultCancelled(this)},e.prototype._invokeOnCancel=function(){var e=this._onCancel();this._unsetOnCancel(),s.invoke(this._doInvokeOnCancel,this,e)},e.prototype._invokeInternalOnCancel=function(){this._isCancellable()&&(this._doInvokeOnCancel(this._onCancel(),!0),this._unsetOnCancel())},e.prototype._resultCancelled=function(){this.cancel()}},zc=function(e){function t(){return this.value}function n(){throw this.reason}e.prototype.return=e.prototype.thenReturn=function(n){return n instanceof e&&n.suppressUnhandledRejections(),this._then(t,void 0,void 0,{value:n},void 0)},e.prototype.throw=e.prototype.thenThrow=function(e){return this._then(n,void 0,void 0,{reason:e},void 0)},e.prototype.catchThrow=function(e){if(arguments.length<=1)return this._then(void 0,n,void 0,{reason:e},void 0);var t=arguments[1],r=function(){throw t};return this.caught(e,r)},e.prototype.catchReturn=function(n){if(arguments.length<=1)return n instanceof e&&n.suppressUnhandledRejections(),this._then(void 0,t,void 0,{value:n},void 0);var r=arguments[1];r instanceof e&&r.suppressUnhandledRejections();var i=function(){return r};return this.caught(n,i)}},Qc=function(e){function t(e){void 0!==e?(e=e._target(),this._bitField=e._bitField,this._settledValueField=e._isFateSealed()?e._settledValue():void 0):(this._bitField=0,this._settledValueField=void 0)}t.prototype._settledValue=function(){return this._settledValueField};var n=t.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},r=t.prototype.error=t.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},i=t.prototype.isFulfilled=function(){return 0!=(33554432&this._bitField)},o=t.prototype.isRejected=function(){return 0!=(16777216&this._bitField)},a=t.prototype.isPending=function(){return 0==(50397184&this._bitField)},s=t.prototype.isResolved=function(){return 0!=(50331648&this._bitField)};t.prototype.isCancelled=function(){return 0!=(8454144&this._bitField)},e.prototype.__isCancelled=function(){return 65536==(65536&this._bitField)},e.prototype._isCancelled=function(){return this._target().__isCancelled()},e.prototype.isCancelled=function(){return 0!=(8454144&this._target()._bitField)},e.prototype.isPending=function(){return a.call(this._target())},e.prototype.isRejected=function(){return o.call(this._target())},e.prototype.isFulfilled=function(){return i.call(this._target())},e.prototype.isResolved=function(){return s.call(this._target())},e.prototype.value=function(){return n.call(this._target())},e.prototype.reason=function(){var e=this._target();return e._unsetRejectionIsUnhandled(),r.call(e)},e.prototype._value=function(){return this._settledValue()},e.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()},e.PromiseInspection=t},Kc=function(e,t,n,r,i,o){var a,s=sc,l=s.canEvaluate,c=s.tryCatch,u=s.errorObj;if(l){for(var p=[],h=[],f=[],d=0;d<8;++d)p.push(function(t){for(var n=new Array(t),r=0;r<n.length;++r)n[r]="this.p"+(r+1);var o=n.join(" = ")+" = null;",a="var promise;\n"+n.map(function(e){return"                                                         \n                promise = "+e+";                                      \n                if (promise instanceof Promise) {                            \n                    promise.cancel();                                        \n                }                                                            \n            "}).join("\n"),s=n.join(", "),l="Holder$"+t,p="return function(tryCatch, errorObj, Promise, async) {    \n            'use strict';                                                    \n            function [TheName](fn) {                                         \n                [TheProperties]                                              \n                this.fn = fn;                                                \n                this.asyncNeeded = true;                                     \n                this.now = 0;                                                \n            }                                                                \n                                                                             \n            [TheName].prototype._callFunction = function(promise) {          \n                promise._pushContext();                                      \n                var ret = tryCatch(this.fn)([ThePassedArguments]);           \n                promise._popContext();                                       \n                if (ret === errorObj) {                                      \n                    promise._rejectCallback(ret.e, false);                   \n                } else {                                                     \n                    promise._resolveCallback(ret);                           \n                }                                                            \n            };                                                               \n                                                                             \n            [TheName].prototype.checkFulfillment = function(promise) {       \n                var now = ++this.now;                                        \n                if (now === [TheTotal]) {                                    \n                    if (this.asyncNeeded) {                                  \n                        async.invoke(this._callFunction, this, promise);     \n                    } else {                                                 \n                        this._callFunction(promise);                         \n                    }                                                        \n                                                                             \n                }                                                            \n            };                                                               \n                                                                             \n            [TheName].prototype._resultCancelled = function() {              \n                [CancellationCode]                                           \n            };                                                               \n                                                                             \n            return [TheName];                                                \n        }(tryCatch, errorObj, Promise, async);                               \n        ";return p=p.replace(/\[TheName\]/g,l).replace(/\[TheTotal\]/g,t).replace(/\[ThePassedArguments\]/g,s).replace(/\[TheProperties\]/g,o).replace(/\[CancellationCode\]/g,a),new Function("tryCatch","errorObj","Promise","async",p)(c,u,e,i)}(d+1)),h.push(function(e){return new Function("value","holder","                             \n            'use strict';                                                    \n            holder.pIndex = value;                                           \n            holder.checkFulfillment(this);                                   \n            ".replace(/Index/g,e))}(d+1)),f.push(function(e){return new Function("promise","holder","                           \n            'use strict';                                                    \n            holder.pIndex = promise;                                         \n            ".replace(/Index/g,e))}(d+1));a=function(e){this._reject(e)}}e.join=function(){var i,c=arguments.length-1;if(c>0&&"function"==typeof arguments[c]&&(i=arguments[c],c<=8&&l)){(C=new e(r))._captureStackTrace();for(var u=new(0,p[c-1])(i),d=h,m=0;m<c;++m){var g=n(arguments[m],C);if(g instanceof e){var v=(g=g._target())._bitField;0==(50397184&v)?(g._then(d[m],a,void 0,C,u),f[m](g,u),u.asyncNeeded=!1):0!=(33554432&v)?d[m].call(C,g._value(),u):0!=(16777216&v)?C._reject(g._reason()):C._cancel()}else d[m].call(C,g,u)}if(!C._isFateSealed()){if(u.asyncNeeded){var y=o();null!==y&&(u.fn=s.domainBind(y,u.fn))}C._setAsyncGuaranteed(),C._setOnCancel(u)}return C}for(var _=arguments.length,b=new Array(_),w=0;w<_;++w)b[w]=arguments[w];i&&b.pop();var C=new t(b).promise();return void 0!==i?C.spread(i):C}},Xc=function(e,t,n,r,i,o){function a(e,t,n,r){this.constructor$(e),this._promise._captureStackTrace();var o=l();this._callback=null===o?t:c.domainBind(o,t),this._preservedValues=r===i?new Array(this.length()):null,this._limit=n,this._inFlight=0,this._queue=[],h.invoke(this._asyncInit,this,void 0)}function s(t,r,i,o){if("function"!=typeof r)return n("expecting a function but got "+c.classString(r));var s=0;if(void 0!==i){if("object"!=typeof i||null===i)return e.reject(new TypeError("options argument must be an object but it is "+c.classString(i)));if("number"!=typeof i.concurrency)return e.reject(new TypeError("'concurrency' must be a number but it is "+c.classString(i.concurrency)));s=i.concurrency}return s="number"==typeof s&&isFinite(s)&&s>=1?s:0,new a(t,r,s,o).promise()}var l=e._getDomain,c=sc,u=c.tryCatch,p=c.errorObj,h=e._async;c.inherits(a,t),a.prototype._asyncInit=function(){this._init$(void 0,-2)},a.prototype._init=function(){},a.prototype._promiseFulfilled=function(t,n){var i=this._values,a=this.length(),s=this._preservedValues,l=this._limit;if(n<0){if(n=-1*n-1,i[n]=t,l>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return!0}else{if(l>=1&&this._inFlight>=l)return i[n]=t,this._queue.push(n),!1;null!==s&&(s[n]=t);var c=this._promise,h=this._callback,f=c._boundValue();c._pushContext();var d=u(h).call(f,t,n,a),m=c._popContext();if(o.checkForgottenReturns(d,m,null!==s?"Promise.filter":"Promise.map",c),d===p)return this._reject(d.e),!0;var g=r(d,this._promise);if(g instanceof e){var v=(g=g._target())._bitField;if(0==(50397184&v))return l>=1&&this._inFlight++,i[n]=g,g._proxy(this,-1*(n+1)),!1;if(0==(33554432&v))return 0!=(16777216&v)?(this._reject(g._reason()),!0):(this._cancel(),!0);d=g._value()}i[n]=d}return++this._totalResolved>=a&&(null!==s?this._filter(i,s):this._resolve(i),!0)},a.prototype._drainQueue=function(){for(var e=this._queue,t=this._limit,n=this._values;e.length>0&&this._inFlight<t;){if(this._isResolved())return;var r=e.pop();this._promiseFulfilled(n[r],r)}},a.prototype._filter=function(e,t){for(var n=t.length,r=new Array(n),i=0,o=0;o<n;++o)e[o]&&(r[i++]=t[o]);r.length=i,this._resolve(r)},a.prototype.preservedValues=function(){return this._preservedValues},e.prototype.map=function(e,t){return s(this,e,t,null)},e.map=function(e,t,n,r){return s(e,t,n,r)}},Yc=Object.create;if(Yc){var qc=Yc(null),Jc=Yc(null);qc[" size"]=Jc[" size"]=0}var $c=function(e){function t(t,n){var r;if(null!=t&&(r=t[n]),"function"!=typeof r){var i="Object "+s.classString(t)+" has no method '"+s.toString(n)+"'";throw new e.TypeError(i)}return r}function n(e){return t(e,this.pop()).apply(e,this)}function r(e){return e[this]}function i(e){var t=+this;return t<0&&(t=Math.max(0,t+e.length)),e[t]}var o,a,s=sc,l=s.canEvaluate,c=s.isIdentifier,u=function(e){return new Function("ensureMethod","                                    \n        return function(obj) {                                               \n            'use strict'                                                     \n            var len = this.length;                                           \n            ensureMethod(obj, 'methodName');                                 \n            switch(len) {                                                    \n                case 1: return obj.methodName(this[0]);                      \n                case 2: return obj.methodName(this[0], this[1]);             \n                case 3: return obj.methodName(this[0], this[1], this[2]);    \n                case 0: return obj.methodName();                             \n                default:                                                     \n                    return obj.methodName.apply(obj, this);                  \n            }                                                                \n        };                                                                   \n        ".replace(/methodName/g,e))(t)},p=function(e){return new Function("obj","                                             \n        'use strict';                                                        \n        return obj.propertyName;                                             \n        ".replace("propertyName",e))},h=function(e,t,n){var r=n[e];if("function"!=typeof r){if(!c(e))return null;if(r=t(e),n[e]=r,++n[" size"]>512){for(var i=Object.keys(n),o=0;o<256;++o)delete n[i[o]];n[" size"]=i.length-256}}return r};o=function(e){return h(e,u,qc)},a=function(e){return h(e,p,Jc)},e.prototype.call=function(e){for(var t=arguments.length,r=new Array(Math.max(t-1,0)),i=1;i<t;++i)r[i-1]=arguments[i];if(l){var a=o(e);if(null!==a)return this._then(a,void 0,void 0,r,void 0)}return r.push(e),this._then(n,void 0,void 0,r,void 0)},e.prototype.get=function(e){var t;if("number"==typeof e)t=i;else if(l){var n=a(e);t=null!==n?n:r}else t=r;return this._then(t,void 0,void 0,e,void 0)}},eu=function(e,t,n,r,i,o){function a(e){setTimeout(function(){throw e},0)}function s(e){var t=n(e);return t!==e&&"function"==typeof e._isDisposable&&"function"==typeof e._getDisposer&&e._isDisposable()&&t._setDisposable(e._getDisposer()),t}function l(t,r){function o(){if(l>=c)return u._fulfill();var i=s(t[l++]);if(i instanceof e&&i._isDisposable()){try{i=n(i._getDisposer().tryDispose(r),t.promise)}catch(e){return a(e)}if(i instanceof e)return i._then(o,a,null,null,null)}o()}var l=0,c=t.length,u=new e(i);return o(),u}function c(e,t,n){this._data=e,this._promise=t,this._context=n}function u(e,t,n){this.constructor$(e,t,n)}function p(e){return c.isDisposer(e)?(this.resources[this.index]._setDisposable(e),e.promise()):e}function h(e){this.length=e,this.promise=null,this[e-1]=null}var f=sc,d=Fc.TypeError,m=sc.inherits,g=f.errorObj,v=f.tryCatch,y={};c.prototype.data=function(){return this._data},c.prototype.promise=function(){return this._promise},c.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():y},c.prototype.tryDispose=function(e){var t=this.resource(),n=this._context;void 0!==n&&n._pushContext();var r=t!==y?this.doDispose(t,e):null;return void 0!==n&&n._popContext(),this._promise._unsetDisposable(),this._data=null,r},c.isDisposer=function(e){return null!=e&&"function"==typeof e.resource&&"function"==typeof e.tryDispose},m(u,c),u.prototype.doDispose=function(e,t){return this.data().call(e,e,t)},h.prototype._resultCancelled=function(){for(var t=this.length,n=0;n<t;++n){var r=this[n];r instanceof e&&r.cancel()}},e.using=function(){var r=arguments.length;if(r<2)return t("you must pass at least 2 arguments to Promise.using");var i=arguments[r-1];if("function"!=typeof i)return t("expecting a function but got "+f.classString(i));var a,s=!0;2===r&&Array.isArray(arguments[0])?(r=(a=arguments[0]).length,s=!1):(a=arguments,r--);for(var u=new h(r),d=0;d<r;++d){var m=a[d];if(c.isDisposer(m)){var y=m;(m=m.promise())._setDisposable(y)}else{var _=n(m);_ instanceof e&&(m=_._then(p,null,null,{resources:u,index:d},void 0))}u[d]=m}for(var b=new Array(u.length),d=0;d<b.length;++d)b[d]=e.resolve(u[d]).reflect();var w=e.all(b).then(function(e){for(var t=0;t<e.length;++t){var n=e[t];if(n.isRejected())return g.e=n.error(),g;if(!n.isFulfilled())return void w.cancel();e[t]=n.value()}C._pushContext(),i=v(i);var r=s?i.apply(void 0,e):i(e),a=C._popContext();return o.checkForgottenReturns(r,a,"Promise.using",C),r}),C=w.lastly(function(){var t=new e.PromiseInspection(w);return l(u,t)});return u.promise=C,C._setOnCancel(u),C},e.prototype._setDisposable=function(e){this._bitField=131072|this._bitField,this._disposer=e},e.prototype._isDisposable=function(){return(131072&this._bitField)>0},e.prototype._getDisposer=function(){return this._disposer},e.prototype._unsetDisposable=function(){this._bitField=-131073&this._bitField,this._disposer=void 0},e.prototype.disposer=function(e){if("function"==typeof e)return new u(e,this,r());throw new d}},tu=function(e,t,n){function r(e){this.handle=e}function i(e){return clearTimeout(this.handle),e}function o(e){throw clearTimeout(this.handle),e}var a=sc,s=e.TimeoutError;r.prototype._resultCancelled=function(){clearTimeout(this.handle)};var l=function(e){return c(+this).thenReturn(e)},c=e.delay=function(i,o){var a,s;return void 0!==o?(a=e.resolve(o)._then(l,null,null,i,void 0),n.cancellation()&&o instanceof e&&a._setOnCancel(o)):(a=new e(t),s=setTimeout(function(){a._fulfill()},+i),n.cancellation()&&a._setOnCancel(new r(s)),a._captureStackTrace()),a._setAsyncGuaranteed(),a};e.prototype.delay=function(e){return c(e,this)};var u=function(e,t,n){var r;r="string"!=typeof t?t instanceof Error?t:new s("operation timed out"):new s(t),a.markAsOriginatingFromRejection(r),e._attachExtraTrace(r),e._reject(r),null!=n&&n.cancel()};e.prototype.timeout=function(e,t){e=+e;var a,s,l=new r(setTimeout(function(){a.isPending()&&u(a,t,s)},e));return n.cancellation()?(s=this.then(),(a=s._then(i,o,void 0,l,void 0))._setOnCancel(l)):a=this._then(i,o,void 0,l,void 0),a}},nu=function(e,t,n,r,i,o){function a(t,n,i){for(var o=0;o<n.length;++o){i._pushContext();var a=p(n[o])(t);if(i._popContext(),a===u){i._pushContext();var s=e.reject(u.e);return i._popContext(),s}var l=r(a,i);if(l instanceof e)return l}return null}function s(t,r,i,a){if(o.cancellation()){var s=new e(n),l=this._finallyPromise=new e(n);this._promise=s.lastly(function(){return l}),s._captureStackTrace(),s._setOnCancel(this)}else(this._promise=new e(n))._captureStackTrace();this._stack=a,this._generatorFunction=t,this._receiver=r,this._generator=void 0,this._yieldHandlers="function"==typeof i?[i].concat(h):h,this._yieldedPromise=null,this._cancellationPhase=!1}var l=Fc.TypeError,c=sc,u=c.errorObj,p=c.tryCatch,h=[];c.inherits(s,i),s.prototype._isResolved=function(){return null===this._promise},s.prototype._cleanup=function(){this._promise=this._generator=null,o.cancellation()&&null!==this._finallyPromise&&(this._finallyPromise._fulfill(),this._finallyPromise=null)},s.prototype._promiseCancelled=function(){if(!this._isResolved()){var t;if(void 0!==this._generator.return)this._promise._pushContext(),t=p(this._generator.return).call(this._generator,void 0),this._promise._popContext();else{var n=new e.CancellationError("generator .return() sentinel");e.coroutine.returnSentinel=n,this._promise._attachExtraTrace(n),this._promise._pushContext(),t=p(this._generator.throw).call(this._generator,n),this._promise._popContext()}this._cancellationPhase=!0,this._yieldedPromise=null,this._continue(t)}},s.prototype._promiseFulfilled=function(e){this._yieldedPromise=null,this._promise._pushContext();var t=p(this._generator.next).call(this._generator,e);this._promise._popContext(),this._continue(t)},s.prototype._promiseRejected=function(e){this._yieldedPromise=null,this._promise._attachExtraTrace(e),this._promise._pushContext();var t=p(this._generator.throw).call(this._generator,e);this._promise._popContext(),this._continue(t)},s.prototype._resultCancelled=function(){if(this._yieldedPromise instanceof e){var t=this._yieldedPromise;this._yieldedPromise=null,t.cancel()}},s.prototype.promise=function(){return this._promise},s.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._promiseFulfilled(void 0)},s.prototype._continue=function(t){var n=this._promise;if(t===u)return this._cleanup(),this._cancellationPhase?n.cancel():n._rejectCallback(t.e,!1);var i=t.value;if(!0===t.done)return this._cleanup(),this._cancellationPhase?n.cancel():n._resolveCallback(i);var o=r(i,this._promise);if(o instanceof e||null!==(o=a(o,this._yieldHandlers,this._promise))){var s=(o=o._target())._bitField;0==(50397184&s)?(this._yieldedPromise=o,o._proxy(this,null)):0!=(33554432&s)?e._async.invoke(this._promiseFulfilled,this,o._value()):0!=(16777216&s)?e._async.invoke(this._promiseRejected,this,o._reason()):this._promiseCancelled()}else this._promiseRejected(new l("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/MqrFmX\n\n".replace("%s",String(i))+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")))},e.coroutine=function(e,t){if("function"!=typeof e)throw new l("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var n=Object(t).yieldHandler,r=s,i=(new Error).stack;return function(){var t=e.apply(this,arguments),o=new r(void 0,void 0,n,i),a=o.promise();return o._generator=t,o._promiseFulfilled(void 0),a}},e.coroutine.addYieldHandler=function(e){if("function"!=typeof e)throw new l("expecting a function but got "+c.classString(e));h.push(e)},e.spawn=function(n){if(o.deprecated("Promise.spawn()","Promise.coroutine()"),"function"!=typeof n)return t("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var r=new s(n,this),i=r.promise();return r._run(e.spawn),i}},ru=function(e){function t(e,t){var r=this;if(!i.isArray(e))return n.call(r,e,t);var l=a(t).apply(r._boundValue(),[null].concat(e));l===s&&o.throwLater(l.e)}function n(e,t){var n=this._boundValue(),r=void 0===e?a(t).call(n,null):a(t).call(n,null,e);r===s&&o.throwLater(r.e)}function r(e,t){var n=this;if(!e){var r=new Error(e+"");r.cause=e,e=r}var i=a(t).call(n._boundValue(),e);i===s&&o.throwLater(i.e)}var i=sc,o=e._async,a=i.tryCatch,s=i.errorObj;e.prototype.asCallback=e.prototype.nodeify=function(e,i){if("function"==typeof e){var o=n;void 0!==i&&Object(i).spread&&(o=t),this._then(o,r,void 0,this,e)}return this}},iu=function(e,t){function n(e){return!b.test(e)}function r(e){try{return!0===e.__isPromisified__}catch(e){return!1}}function i(e,t,n){var i=h.getDataPropertyOrDefault(e,t+n,y);return!!i&&r(i)}function o(e,t,n){for(var r=0;r<e.length;r+=2){var i=e[r];if(n.test(i))for(var o=i.replace(n,""),a=0;a<e.length;a+=2)if(e[a]===o)throw new v("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/MqrFmX\n".replace("%s",t))}}function a(e,t,n,a){for(var s=h.inheritedDataKeys(e),l=[],c=0;c<s.length;++c){var u=s[c],p=e[u],f=a===w||w(u,p,e);"function"!=typeof p||r(p)||i(e,u,t)||!a(u,p,e,f)||l.push(u,p)}return o(l,t,n),l}function s(n,r,i,o,a,s){function l(){var i=r;r===p&&(i=this);var o=new e(t);o._captureStackTrace();var a="string"==typeof u&&this!==c?this[u]:n,l=f(o,s);try{a.apply(i,d(arguments,l))}catch(e){o._rejectCallback(m(e),!0,!0)}return o._isFateSealed()||o._setAsyncGuaranteed(),o}var c=function(){return this}(),u=n;return"string"==typeof u&&(n=o),h.notEnumerableProp(l,"__isPromisified__",!0),l}function l(e,t,n,r,i){for(var o=new RegExp(C(t)+"$"),s=a(e,t,o,n),l=0,c=s.length;l<c;l+=2){var u=s[l],f=s[l+1],d=u+t;if(r===j)e[d]=j(u,p,u,f,t,i);else{var m=r(f,function(){return j(u,p,u,f,t,i)});h.notEnumerableProp(m,"__isPromisified__",!0),e[d]=m}}return h.toFastProperties(e),e}function c(e,t,n){return j(e,t,void 0,e,null,n)}var u,p={},h=sc,f=Wc,d=h.withAppended,m=h.maybeWrapAsError,g=h.canEvaluate,v=Fc.TypeError,y={__isPromisified__:!0},_=["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"],b=new RegExp("^(?:"+_.join("|")+")$"),w=function(e){return h.isIdentifier(e)&&"_"!==e.charAt(0)&&"constructor"!==e},C=function(e){return e.replace(/([$])/,"\\$")},A=function(e){for(var t=[e],n=Math.max(0,e-1-3),r=e-1;r>=n;--r)t.push(r);for(r=e+1;r<=3;++r)t.push(r);return t},E=function(e){return h.filledRange(e,"_arg","")},k=function(e){return h.filledRange(Math.max(e,3),"_arg","")},x=function(e){return"number"==typeof e.length?Math.max(Math.min(e.length,1024),0):0};u=function(n,r,i,o,a,s){function l(e){var t=E(e).join(", "),n=e>0?", ":"";return(g?"ret = callback.call(this, {{args}}, nodeback); break;\n":void 0===r?"ret = callback({{args}}, nodeback); break;\n":"ret = callback.call(receiver, {{args}}, nodeback); break;\n").replace("{{args}}",t).replace(", ",n)}var c=Math.max(0,x(o)-1),u=A(c),g="string"==typeof n||r===p,v="string"==typeof n?"this != null ? this['"+n+"'] : fn":"fn",y="'use strict';                                                \n        var ret = function (Parameters) {                                    \n            'use strict';                                                    \n            var len = arguments.length;                                      \n            var promise = new Promise(INTERNAL);                             \n            promise._captureStackTrace();                                    \n            var nodeback = nodebackForPromise(promise, "+s+");   \n            var ret;                                                         \n            var callback = tryCatch([GetFunctionCode]);                      \n            switch(len) {                                                    \n                [CodeForSwitchCase]                                          \n            }                                                                \n            if (ret === errorObj) {                                          \n                promise._rejectCallback(maybeWrapAsError(ret.e), true, true);\n            }                                                                \n            if (!promise._isFateSealed()) promise._setAsyncGuaranteed();     \n            return promise;                                                  \n        };                                                                   \n        notEnumerableProp(ret, '__isPromisified__', true);                   \n        return ret;                                                          \n    ".replace("[CodeForSwitchCase]",function(){for(var e="",t=0;t<u.length;++t)e+="case "+u[t]+":"+l(u[t]);return e+="                                                             \n        default:                                                             \n            var args = new Array(len + 1);                                   \n            var i = 0;                                                       \n            for (var i = 0; i < len; ++i) {                                  \n               args[i] = arguments[i];                                       \n            }                                                                \n            args[i] = nodeback;                                              \n            [CodeForCall]                                                    \n            break;                                                           \n        ".replace("[CodeForCall]",g?"ret = callback.apply(this, args);\n":"ret = callback.apply(receiver, args);\n")}()).replace("[GetFunctionCode]",v);return y=y.replace("Parameters",k(c)),new Function("Promise","fn","receiver","withAppended","maybeWrapAsError","nodebackForPromise","tryCatch","errorObj","notEnumerableProp","INTERNAL",y)(e,o,r,d,m,f,h.tryCatch,h.errorObj,h.notEnumerableProp,t)};var j=g?u:s;e.promisify=function(e,t){if("function"!=typeof e)throw new v("expecting a function but got "+h.classString(e));if(r(e))return e;var i=c(e,void 0===(t=Object(t)).context?p:t.context,!!t.multiArgs);return h.copyDescriptors(e,i,n),i},e.promisifyAll=function(e,t){if("function"!=typeof e&&"object"!=typeof e)throw new v("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/MqrFmX\n");var n=!!(t=Object(t)).multiArgs,r=t.suffix;"string"!=typeof r&&(r="Async");var i=t.filter;"function"!=typeof i&&(i=w);var o=t.promisifier;if("function"!=typeof o&&(o=j),!h.isIdentifier(r))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/MqrFmX\n");for(var a=h.inheritedDataKeys(e),s=0;s<a.length;++s){var c=e[a[s]];"constructor"!==a[s]&&h.isClass(c)&&(l(c.prototype,r,i,o,n),l(c,r,i,o,n))}return l(e,r,i,o,n)}},ou=function(e,t,n,r){function i(e){var t,n=!1;if(void 0!==a&&e instanceof a)t=u(e),n=!0;else{var r=c.keys(e),i=r.length;t=new Array(2*i);for(var o=0;o<i;++o){var s=r[o];t[o]=e[s],t[o+i]=s}}this.constructor$(t),this._isMap=n,this._init$(void 0,n?-6:-3)}function o(t){var o,a=n(t);return l(a)?(o=a instanceof e?a._then(e.props,void 0,void 0,void 0,void 0):new i(a).promise(),a instanceof e&&o._propagateFrom(a,2),o):r("cannot await properties of a non-object\n\n    See http://goo.gl/MqrFmX\n")}var a,s=sc,l=s.isObject,c=zl;"function"==typeof Map&&(a=Map);var u=function(){function e(e,r){this[t]=e,this[t+n]=r,t++}var t=0,n=0;return function(r){n=r.size,t=0;var i=new Array(2*r.size);return r.forEach(e,i),i}}(),p=function(e){for(var t=new a,n=e.length/2|0,r=0;r<n;++r){var i=e[n+r],o=e[r];t.set(i,o)}return t};s.inherits(i,t),i.prototype._init=function(){},i.prototype._promiseFulfilled=function(e,t){if(this._values[t]=e,++this._totalResolved>=this._length){var n;if(this._isMap)n=p(this._values);else{n={};for(var r=this.length(),i=0,o=this.length();i<o;++i)n[this._values[i+r]]=this._values[i]}return this._resolve(n),!0}return!1},i.prototype.shouldCopyValues=function(){return!1},i.prototype.getActualLength=function(e){return e>>1},e.prototype.props=function(){return o(this)},e.props=function(e){return o(e)}},au=function(e,t,n,r){function i(i,s){var l=n(i);if(l instanceof e)return a(l);if(null===(i=o.asArray(i)))return r("expecting an array or an iterable object but got "+o.classString(i));var c=new e(t);void 0!==s&&c._propagateFrom(s,3);for(var u=c._fulfill,p=c._reject,h=0,f=i.length;h<f;++h){var d=i[h];(void 0!==d||h in i)&&e.cast(d)._then(u,p,void 0,c,null)}return c}var o=sc,a=function(e){return e.then(function(t){return i(t,e)})};e.race=function(e){return i(e,void 0)},e.prototype.race=function(){return i(this,void 0)}},su=function(e,t,n,r,i,o){function a(t,n,r,o){this.constructor$(t);var a=p();this._fn=null===a?n:h.domainBind(a,n),void 0!==r&&(r=e.resolve(r))._attachCancellationCallback(this),this._initialValue=r,this._currentCancellable=null,this._eachValues=o===i?Array(this._length):0===o?null:void 0,this._promise._captureStackTrace(),this._init$(void 0,-5)}function s(e,t){this.isFulfilled()?t._resolve(e):t._reject(e)}function l(e,t,r,i){return"function"!=typeof t?n("expecting a function but got "+h.classString(t)):new a(e,t,r,i).promise()}function c(t){this.accum=t,this.array._gotAccum(t);var n=r(this.value,this.array._promise);return n instanceof e?(this.array._currentCancellable=n,n._then(u,void 0,void 0,this,void 0)):u.call(this,n)}function u(t){var n=this.array,r=n._promise,i=f(n._fn);r._pushContext();var a;(a=void 0!==n._eachValues?i.call(r._boundValue(),t,this.index,this.length):i.call(r._boundValue(),this.accum,t,this.index,this.length))instanceof e&&(n._currentCancellable=a);var s=r._popContext();return o.checkForgottenReturns(a,s,void 0!==n._eachValues?"Promise.each":"Promise.reduce",r),a}var p=e._getDomain,h=sc,f=h.tryCatch;h.inherits(a,t),a.prototype._gotAccum=function(e){void 0!==this._eachValues&&null!==this._eachValues&&e!==i&&this._eachValues.push(e)},a.prototype._eachComplete=function(e){return null!==this._eachValues&&this._eachValues.push(e),this._eachValues},a.prototype._init=function(){},a.prototype._resolveEmptyArray=function(){this._resolve(void 0!==this._eachValues?this._eachValues:this._initialValue)},a.prototype.shouldCopyValues=function(){return!1},a.prototype._resolve=function(e){this._promise._resolveCallback(e),this._values=null},a.prototype._resultCancelled=function(t){if(t===this._initialValue)return this._cancel();this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof e&&this._currentCancellable.cancel(),this._initialValue instanceof e&&this._initialValue.cancel())},a.prototype._iterate=function(t){this._values=t;var n,r,i=t.length;if(void 0!==this._initialValue?(n=this._initialValue,r=0):(n=e.resolve(t[0]),r=1),this._currentCancellable=n,!n.isRejected())for(;r<i;++r){var o={accum:null,value:t[r],index:r,length:i,array:this};n=n._then(c,void 0,void 0,o,void 0)}void 0!==this._eachValues&&(n=n._then(this._eachComplete,void 0,void 0,this,void 0)),n._then(s,s,void 0,n,this)},e.prototype.reduce=function(e,t){return l(this,e,t,null)},e.reduce=function(e,t,n,r){return l(e,t,n,r)}},lu=function(e,t,n){function r(e){this.constructor$(e)}var i=e.PromiseInspection;sc.inherits(r,t),r.prototype._promiseResolved=function(e,t){return this._values[e]=t,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},r.prototype._promiseFulfilled=function(e,t){var n=new i;return n._bitField=33554432,n._settledValueField=e,this._promiseResolved(t,n)},r.prototype._promiseRejected=function(e,t){var n=new i;return n._bitField=16777216,n._settledValueField=e,this._promiseResolved(t,n)},e.settle=function(e){return n.deprecated(".settle()",".reflect()"),new r(e).promise()},e.prototype.settle=function(){return e.settle(this)}},cu=function(e,t,n){function r(e){this.constructor$(e),this._howMany=0,this._unwrap=!1,this._initialized=!1}function i(e,t){if((0|t)!==t||t<0)return n("expecting a positive integer\n\n    See http://goo.gl/MqrFmX\n");var i=new r(e),o=i.promise();return i.setHowMany(t),i.init(),o}var o=sc,a=Fc.RangeError,s=Fc.AggregateError,l=o.isArray,c={};o.inherits(r,t),r.prototype._init=function(){if(this._initialized)if(0!==this._howMany){this._init$(void 0,-5);var e=l(this._values);!this._isResolved()&&e&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}else this._resolve([])},r.prototype.init=function(){this._initialized=!0,this._init()},r.prototype.setUnwrap=function(){this._unwrap=!0},r.prototype.howMany=function(){return this._howMany},r.prototype.setHowMany=function(e){this._howMany=e},r.prototype._promiseFulfilled=function(e){return this._addFulfilled(e),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values),!0)},r.prototype._promiseRejected=function(e){return this._addRejected(e),this._checkOutcome()},r.prototype._promiseCancelled=function(){return this._values instanceof e||null==this._values?this._cancel():(this._addRejected(c),this._checkOutcome())},r.prototype._checkOutcome=function(){if(this.howMany()>this._canPossiblyFulfill()){for(var e=new s,t=this.length();t<this._values.length;++t)this._values[t]!==c&&e.push(this._values[t]);return e.length>0?this._reject(e):this._cancel(),!0}return!1},r.prototype._fulfilled=function(){return this._totalResolved},r.prototype._rejected=function(){return this._values.length-this.length()},r.prototype._addRejected=function(e){this._values.push(e)},r.prototype._addFulfilled=function(e){this._values[this._totalResolved++]=e},r.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},r.prototype._getRangeError=function(e){var t="Input array must contain at least "+this._howMany+" items but contains only "+e+" items";return new a(t)},r.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},e.some=function(e,t){return i(e,t)},e.prototype.some=function(e){return i(this,e)},e._SomePromiseArray=r},uu=function(e,t){var n=e.map;e.prototype.filter=function(e,r){return n(this,e,r,t)},e.filter=function(e,r,i){return n(e,r,i,t)}},pu=function(e,t){function n(){return o(this)}function r(e,n){return i(e,n,t,t)}var i=e.reduce,o=e.all;e.prototype.each=function(e){return i(this,e,t,0)._then(n,void 0,void 0,this,void 0)},e.prototype.mapSeries=function(e){return i(this,e,t,t)},e.each=function(e,r){return i(e,r,t,0)._then(n,void 0,void 0,e,void 0)},e.mapSeries=r},hu=function(e){function t(e){var t=new n(e),r=t.promise();return t.setHowMany(1),t.setUnwrap(),t.init(),r}var n=e._SomePromiseArray;e.any=function(e){return t(e)},e.prototype.any=function(){return t(this)}},fu=i(function(e){e.exports=function(){function t(){}function n(e,t){if(null==e||e.constructor!==r)throw new v("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n");if("function"!=typeof t)throw new v("expecting a function but got "+h.classString(t))}function r(e){e!==_&&n(this,e),this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._resolveFromExecutor(e),this._promiseCreated(),this._fireEvent("promiseCreated",this)}function i(e){this.promise._resolveCallback(e)}function o(e){this.promise._rejectCallback(e,!1)}function a(e){var t=new r(_);t._fulfillmentHandler0=e,t._rejectionHandler0=e,t._promise0=e,t._receiver0=e}var s,l=function(){return new v("circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n")},c=function(){return new r.PromiseInspection(this._target())},u=function(e){return r.reject(new v(e))},p={},h=sc;s=h.isNode?function(){var e=process.domain;return void 0===e&&(e=null),e}:function(){return null},h.notEnumerableProp(r,"_getDomain",s);var f=zl,d=vc,m=new d;f.defineProperty(r,"_async",{value:m});var g=Fc,v=r.TypeError=g.TypeError;r.RangeError=g.RangeError;var y=r.CancellationError=g.CancellationError;r.TimeoutError=g.TimeoutError,r.OperationalError=g.OperationalError,r.RejectionError=g.OperationalError,r.AggregateError=g.AggregateError;var _=function(){},b={},w={},C=Rc(r,_),A=Oc(r,_,C,u,t),E=Dc(r),k=E.create,x=Nc(r,E),j=(x.CapturedTrace,Lc(r,C,w)),I=Vc(w),S=Wc,T=h.errorObj,P=h.tryCatch;return r.prototype.toString=function(){return"[object Promise]"},r.prototype.caught=r.prototype.catch=function(e){var t=arguments.length;if(t>1){var n,r=new Array(t-1),i=0;for(n=0;n<t-1;++n){var o=arguments[n];if(!h.isObject(o))return u("Catch statement predicate: expecting an object but got "+h.classString(o));r[i++]=o}return r.length=i,e=arguments[n],this.then(void 0,I(r,e,this))}return this.then(void 0,e)},r.prototype.reflect=function(){return this._then(c,c,void 0,this,void 0)},r.prototype.then=function(e,t){if(x.warnings()&&arguments.length>0&&"function"!=typeof e&&"function"!=typeof t){var n=".then() only accepts functions but was passed: "+h.classString(e);arguments.length>1&&(n+=", "+h.classString(t)),this._warn(n)}return this._then(e,t,void 0,void 0,void 0)},r.prototype.done=function(e,t){this._then(e,t,void 0,void 0,void 0)._setIsFinal()},r.prototype.spread=function(e){return"function"!=typeof e?u("expecting a function but got "+h.classString(e)):this.all()._then(e,void 0,void 0,b,void 0)},r.prototype.toJSON=function(){var e={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(e.fulfillmentValue=this.value(),e.isFulfilled=!0):this.isRejected()&&(e.rejectionReason=this.reason(),e.isRejected=!0),e},r.prototype.all=function(){return arguments.length>0&&this._warn(".all() was passed arguments but it does not take any"),new A(this).promise()},r.prototype.error=function(e){return this.caught(h.originatesFromRejection,e)},r.getNewLibraryCopy=e.exports,r.is=function(e){return e instanceof r},r.fromNode=r.fromCallback=function(e){var t=new r(_);t._captureStackTrace();var n=arguments.length>1&&!!Object(arguments[1]).multiArgs,i=P(e)(S(t,n));return i===T&&t._rejectCallback(i.e,!0),t._isFateSealed()||t._setAsyncGuaranteed(),t},r.all=function(e){return new A(e).promise()},r.cast=function(e){var t=C(e);return t instanceof r||((t=new r(_))._captureStackTrace(),t._setFulfilled(),t._rejectionHandler0=e),t},r.resolve=r.fulfilled=r.cast,r.reject=r.rejected=function(e){var t=new r(_);return t._captureStackTrace(),t._rejectCallback(e,!0),t},r.setScheduler=function(e){if("function"!=typeof e)throw new v("expecting a function but got "+h.classString(e));return m.setScheduler(e)},r.prototype._then=function(e,t,n,i,o){var a=void 0!==o,l=a?o:new r(_),c=this._target(),u=c._bitField;a||(l._propagateFrom(this,3),l._captureStackTrace(),void 0===i&&0!=(2097152&this._bitField)&&(i=0!=(50397184&u)?this._boundValue():c===this?void 0:this._boundTo),this._fireEvent("promiseChained",this,l));var p=s();if(0!=(50397184&u)){var f,d,g=c._settlePromiseCtx;0!=(33554432&u)?(d=c._rejectionHandler0,f=e):0!=(16777216&u)?(d=c._fulfillmentHandler0,f=t,c._unsetRejectionIsUnhandled()):(g=c._settlePromiseLateCancellationObserver,d=new y("late cancellation observer"),c._attachExtraTrace(d),f=t),m.invoke(g,c,{handler:null===p?f:"function"==typeof f&&h.domainBind(p,f),promise:l,receiver:i,value:d})}else c._addCallbacks(e,t,l,i,p);return l},r.prototype._length=function(){return 65535&this._bitField},r.prototype._isFateSealed=function(){return 0!=(117506048&this._bitField)},r.prototype._isFollowing=function(){return 67108864==(67108864&this._bitField)},r.prototype._setLength=function(e){this._bitField=-65536&this._bitField|65535&e},r.prototype._setFulfilled=function(){this._bitField=33554432|this._bitField,this._fireEvent("promiseFulfilled",this)},r.prototype._setRejected=function(){this._bitField=16777216|this._bitField,this._fireEvent("promiseRejected",this)},r.prototype._setFollowing=function(){this._bitField=67108864|this._bitField,this._fireEvent("promiseResolved",this)},r.prototype._setIsFinal=function(){this._bitField=4194304|this._bitField},r.prototype._isFinal=function(){return(4194304&this._bitField)>0},r.prototype._unsetCancelled=function(){this._bitField=-65537&this._bitField},r.prototype._setCancelled=function(){this._bitField=65536|this._bitField,this._fireEvent("promiseCancelled",this)},r.prototype._setWillBeCancelled=function(){this._bitField=8388608|this._bitField},r.prototype._setAsyncGuaranteed=function(){m.hasCustomScheduler()||(this._bitField=134217728|this._bitField)},r.prototype._receiverAt=function(e){var t=0===e?this._receiver0:this[4*e-4+3];if(t!==p)return void 0===t&&this._isBound()?this._boundValue():t},r.prototype._promiseAt=function(e){return this[4*e-4+2]},r.prototype._fulfillmentHandlerAt=function(e){return this[4*e-4+0]},r.prototype._rejectionHandlerAt=function(e){return this[4*e-4+1]},r.prototype._boundValue=function(){},r.prototype._migrateCallback0=function(e){e._bitField;var t=e._fulfillmentHandler0,n=e._rejectionHandler0,r=e._promise0,i=e._receiverAt(0);void 0===i&&(i=p),this._addCallbacks(t,n,r,i,null)},r.prototype._migrateCallbackAt=function(e,t){var n=e._fulfillmentHandlerAt(t),r=e._rejectionHandlerAt(t),i=e._promiseAt(t),o=e._receiverAt(t);void 0===o&&(o=p),this._addCallbacks(n,r,i,o,null)},r.prototype._addCallbacks=function(e,t,n,r,i){var o=this._length();if(o>=65531&&(o=0,this._setLength(0)),0===o)this._promise0=n,this._receiver0=r,"function"==typeof e&&(this._fulfillmentHandler0=null===i?e:h.domainBind(i,e)),"function"==typeof t&&(this._rejectionHandler0=null===i?t:h.domainBind(i,t));else{var a=4*o-4;this[a+2]=n,this[a+3]=r,"function"==typeof e&&(this[a+0]=null===i?e:h.domainBind(i,e)),"function"==typeof t&&(this[a+1]=null===i?t:h.domainBind(i,t))}return this._setLength(o+1),o},r.prototype._proxy=function(e,t){this._addCallbacks(void 0,void 0,t,e,null)},r.prototype._resolveCallback=function(e,t){if(0==(117506048&this._bitField)){if(e===this)return this._rejectCallback(l(),!1);var n=C(e,this);if(!(n instanceof r))return this._fulfill(e);t&&this._propagateFrom(n,2);var i=n._target();if(i!==this){var o=i._bitField;if(0==(50397184&o)){var a=this._length();a>0&&i._migrateCallback0(this);for(var s=1;s<a;++s)i._migrateCallbackAt(this,s);this._setFollowing(),this._setLength(0),this._setFollowee(i)}else if(0!=(33554432&o))this._fulfill(i._value());else if(0!=(16777216&o))this._reject(i._reason());else{var c=new y("late cancellation observer");i._attachExtraTrace(c),this._reject(c)}}else this._reject(l())}},r.prototype._rejectCallback=function(e,t,n){var r=h.ensureErrorObject(e),i=r===e;if(!i&&!n&&x.warnings()){var o="a promise was rejected with a non-error: "+h.classString(e);this._warn(o,!0)}this._attachExtraTrace(r,!!t&&i),this._reject(e)},r.prototype._resolveFromExecutor=function(e){if(e!==_){var t=this;this._captureStackTrace(),this._pushContext();var n=!0,r=this._execute(e,function(e){t._resolveCallback(e)},function(e){t._rejectCallback(e,n)});n=!1,this._popContext(),void 0!==r&&t._rejectCallback(r,!0)}},r.prototype._settlePromiseFromHandler=function(e,t,n,r){var i=r._bitField;if(0==(65536&i)){r._pushContext();var o;t===b?n&&"number"==typeof n.length?o=P(e).apply(this._boundValue(),n):(o=T).e=new v("cannot .spread() a non-array: "+h.classString(n)):o=P(e).call(t,n);var a=r._popContext();0==(65536&(i=r._bitField))&&(o===w?r._reject(n):o===T?r._rejectCallback(o.e,!1):(x.checkForgottenReturns(o,a,"",r,this),r._resolveCallback(o)))}},r.prototype._target=function(){for(var e=this;e._isFollowing();)e=e._followee();return e},r.prototype._followee=function(){return this._rejectionHandler0},r.prototype._setFollowee=function(e){this._rejectionHandler0=e},r.prototype._settlePromise=function(e,n,i,o){var a=e instanceof r,s=this._bitField,l=0!=(134217728&s);0!=(65536&s)?(a&&e._invokeInternalOnCancel(),i instanceof j&&i.isFinallyHandler()?(i.cancelPromise=e,P(n).call(i,o)===T&&e._reject(T.e)):n===c?e._fulfill(c.call(i)):i instanceof t?i._promiseCancelled(e):a||e instanceof A?e._cancel():i.cancel()):"function"==typeof n?a?(l&&e._setAsyncGuaranteed(),this._settlePromiseFromHandler(n,i,o,e)):n.call(i,o,e):i instanceof t?i._isResolved()||(0!=(33554432&s)?i._promiseFulfilled(o,e):i._promiseRejected(o,e)):a&&(l&&e._setAsyncGuaranteed(),0!=(33554432&s)?e._fulfill(o):e._reject(o))},r.prototype._settlePromiseLateCancellationObserver=function(e){var t=e.handler,n=e.promise,i=e.receiver,o=e.value;"function"==typeof t?n instanceof r?this._settlePromiseFromHandler(t,i,o,n):t.call(i,o,n):n instanceof r&&n._reject(o)},r.prototype._settlePromiseCtx=function(e){this._settlePromise(e.promise,e.handler,e.receiver,e.value)},r.prototype._settlePromise0=function(e,t,n){var r=this._promise0,i=this._receiverAt(0);this._promise0=void 0,this._receiver0=void 0,this._settlePromise(r,e,i,t)},r.prototype._clearCallbackDataAtIndex=function(e){var t=4*e-4;this[t+2]=this[t+3]=this[t+0]=this[t+1]=void 0},r.prototype._fulfill=function(e){var t=this._bitField;if(!((117506048&t)>>>16)){if(e===this){var n=l();return this._attachExtraTrace(n),this._reject(n)}this._setFulfilled(),this._rejectionHandler0=e,(65535&t)>0&&(0!=(134217728&t)?this._settlePromises():m.settlePromises(this))}},r.prototype._reject=function(e){var t=this._bitField;if(!((117506048&t)>>>16)){if(this._setRejected(),this._fulfillmentHandler0=e,this._isFinal())return m.fatalError(e,h.isNode);(65535&t)>0?m.settlePromises(this):this._ensurePossibleRejectionHandled()}},r.prototype._fulfillPromises=function(e,t){for(var n=1;n<e;n++){var r=this._fulfillmentHandlerAt(n),i=this._promiseAt(n),o=this._receiverAt(n);this._clearCallbackDataAtIndex(n),this._settlePromise(i,r,o,t)}},r.prototype._rejectPromises=function(e,t){for(var n=1;n<e;n++){var r=this._rejectionHandlerAt(n),i=this._promiseAt(n),o=this._receiverAt(n);this._clearCallbackDataAtIndex(n),this._settlePromise(i,r,o,t)}},r.prototype._settlePromises=function(){var e=this._bitField,t=65535&e;if(t>0){if(0!=(16842752&e)){var n=this._fulfillmentHandler0;this._settlePromise0(this._rejectionHandler0,n,e),this._rejectPromises(t,n)}else{var r=this._rejectionHandler0;this._settlePromise0(this._fulfillmentHandler0,r,e),this._fulfillPromises(t,r)}this._setLength(0)}this._clearCancellationData()},r.prototype._settledValue=function(){var e=this._bitField;return 0!=(33554432&e)?this._rejectionHandler0:0!=(16777216&e)?this._fulfillmentHandler0:void 0},r.defer=r.pending=function(){return x.deprecated("Promise.defer","new Promise"),{promise:new r(_),resolve:i,reject:o}},h.notEnumerableProp(r,"_makeSelfResolutionError",l),Zc(r,_,C,u,x),Hc(r,_,C,x),Gc(r,A,u,x),zc(r),Qc(r),Kc(r,A,C,_,m,s),r.Promise=r,r.version="3.5.0",Xc(r,A,u,C,_,x),$c(r),eu(r,u,C,k,_,x),tu(r,_,x),nu(r,u,_,C,t,x),ru(r),iu(r,_),ou(r,A,C,u),au(r,_,C,u),su(r,A,u,C,_,x),lu(r,A,x),cu(r,A,u),uu(r,_),pu(r,_),hu(r),h.toFastProperties(r),h.toFastProperties(r.prototype),a({a:1}),a({b:2}),a({c:3}),a(1),a(function(){}),a(void 0),a(!1),a(new r(_)),x.setBounds(d.firstLineError,h.lastLineError),r}}),du;"undefined"!=typeof Promise&&(du=Promise);var mu=fu();mu.noConflict=$;var gu=mu,vu=/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i,yu={};yu.generate=function(){var e=Date.now();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:3&n|8).toString(16)})},yu.validate=function(e){return!(!e||"string"!=typeof e)&&vu.test(e)},ee.prototype={_handleError:function(e,t){console.error(e,t)},_closeRequest:function(e){delete this._openRequests[e],this._closedRequestIds.push(e)},createRequest:function(e,t){var n=this,r=yu.generate(),i=Date.now(),o={id:r,message:{jsonrpc:"2.0",method:e,params:t,id:r},timestamp:i},a=new gu(function(e,t){o._resolve=e,o._reject=t,o.cancel=t});return o.promise=a,n._openRequests[r]=o,a.finally(function(){n._closeRequest(r)}).catch(function(){n._closeRequest(r)}),o},handleResponse:function(e){var t=e.id,n=this._openRequests[t];void 0===t?Nl.isDebugMode&&console.error("Incoming message is not a valid JSON-RPC2 response (ID should be present as string, number or null).",e):n?e.error?e.error.message?(Nl.isDebugMode&&console.error('API error response: "'+e.error.message+'"\nResponse JSON-RPC2 ID: '+t+"\nOriginal JSON-RPC2 request: "+JSON.stringify(n.message,null,2)),n._reject(e.error.message)):(console.error("API error (not JSON-RPC2 standard): "+JSON.stringify(e)+"\nOriginal JSON-RPC2 request: "+JSON.stringify(n.message,null,2)),n._reject("Undefined Error. Check console for details.")):n._resolve(e.result):-1!==this._closedRequestIds.indexOf(t)?Nl.isDebugMode&&console.error("JSON-RPC2 request has already been responded, canceled or timed out.",t):null===t?Nl.isDebugMode&&console.error("Incoming JSON-RPC2 response has ID = null.",e):Nl.isDebugMode&&console.error("Incoming JSON-RPC2 response has an unknown ID.",t)}};var _u=new ee,bu={schema:{url:{type:"string",default:""},key:{type:"string",default:""},scene:{type:"string",default:""},lightMapIntensity:{type:"float",default:1.2,parse:function(e){return parseFloat(e)>=0?parseFloat(e):-100}},lightMapExposure:{type:"float",default:.6,parse:function(e){return parseFloat(e)?parseFloat(e):-100}}},init:function(){},update:function(){var e=this,t=e.data.url||e.data.URL,n=e.data.key||e.data.KEY,r=e.data.scene,i=e.data.lightMapIntensity,o=e.data.lightMapExposure;""!==r&&te("Model.read",{arguments:{resourceId:r}}).then(function(t){var i=t.modelStructure.children.filter(function(e){return"level"===e.type})[0];if(i)if(i.bakedModelUrl){var o=i.bakedModelUrl;"buffer"===o.split(".")[o.split(".").length-1]?(e.data.key=o,n=o,console.log("Loading scene",n),e.data.scene="",e.update()):console.error("Unable to load data3d from scene "+r+": The scene is not in Data3D format. Disable and enable realistic lighting on this scene. Error was: No buffer3d found.")}else console.error("Unable to load data3d from scene "+r+": The scene is not baked. Enable realistic lighting on this scene. Error was: No baked data3d present.");else console.error("Unable to load data3d from scene "+r+": The scene does not contain data in the expected format. Error was: No level found.")}).catch(function(e){console.error("Unable to load data3d from scene "+r+": The API returned an error. Error was:",e)}),(t&&""!==t||n&&""!==n)&&(e.remove(),e.mesh=new THREE.Object3D,e.data3dView=new io3d.aframe.three.Data3dView({parent:e.mesh}),e.el.data3dView=e.data3dView,Promise.resolve().then(function(){return n?io3d.storage.get(n,{loadingQueuePrefix:"architecture"}):io3d.utils.data3d.load(t,{loadingQueuePrefix:"architecture"})}).then(function(t){e.el.data3d=t,e.data3dView.set(t,{lightMapIntensity:i,lightMapExposure:o,loadingQueuePrefix:"architecture"}),e.el.setObject3D("mesh",e.mesh),e.el.emit("model-loaded",{format:"data3d",model:e.mesh})}))},remove:function(){this.data3dView&&(this.data3dView.destroy(),this.data3dView=null,this.el.data3dView=null),this.mesh&&(this.el.removeObject3D("mesh"),this.mesh=null)}},wu=re;wu.withPayload=ie,wu.meshes=ae,wu.meshe=oe,wu.materials=le,wu.material=se;var Cu={schema:{id:{type:"string",default:"10344b13-d981-47a0-90ac-f048ee2780a6"}},init:function(){},update:function(){var e=this,t=this.el,n=this.data,r=n.id;r&&""!==r&&(e.remove(),e.mesh=new THREE.Object3D,e.data3dView=new io3d.aframe.three.Data3dView({parent:e.mesh}),e.el.data3dView=e.data3dView,io3d.furniture.get(r).then(function(i){var o=i.info,a=i.data3d,s={};e.info=o,e.data3d=a,e.availableMaterials=s;var l=o.sceneStructure&&JSON.parse(o.sceneStructure).materials;Object.keys(a.meshes).forEach(function(r){s[r]=a.alternativeMaterialsByMeshKey?a.alternativeMaterialsByMeshKey[r]:a.meshes[r].material,a=e.data3d=wu(a);var i="material_"+r.replace(/\s/g,"_"),o=n[i]||(l?l[r]:null);if(o&&(a.meshes[r].material=o,t.emit("material-changed",{mesh:r,material:o})),a.alternativeMaterialsByMeshKey&&a.alternativeMaterialsByMeshKey[r]){var c={};c[i]={type:"string",default:a.meshes[r].material,oneOf:a.alternativeMaterialsByMeshKey[r]},e.extendSchema(c),e.data[i]=a.meshes[r].material}}),e.data3dView.set(a,{loadingQueuePrefix:"interior"}),e.el.data3d=a,e.el.setObject3D("mesh",e.mesh),e._previousFurnitureId!==r&&(e.el.emit("model-loaded",{format:"data3d",model:e.mesh}),e._previousFurnitureId=r)}))},remove:function(){this.data3dView&&(this.data3dView.destroy(),this.data3dView=null,this.el.data3dView=null),this.mesh&&(this.el.removeObject3D("mesh"),this.mesh=null)}},Au=ce,Eu=ue,ku=pe,xu=Array.prototype,ju=xu.splice,Iu=he,Su=fe,Tu=de,Pu=me;ge.prototype.clear=Au,ge.prototype.delete=Iu,ge.prototype.get=Su,ge.prototype.has=Tu,ge.prototype.set=Pu;var Fu=ge,Ru=ve,Ou=ye,Du=_e,Nu=be,Vu="object"==typeof Es&&Es&&Es.Object===Object&&Es,Lu=Vu,Mu="object"==typeof self&&self&&self.Object===Object&&self,Bu=Lu||Mu||Function("return this")(),Uu=Bu,Wu=Uu.Symbol,Zu=Wu,Hu=Object.prototype,Gu=Hu.hasOwnProperty,zu=Hu.toString,Qu=Zu?Zu.toStringTag:void 0,Ku=we,Xu=Object.prototype,Yu=Xu.toString,qu=Ce,Ju="[object Null]",$u="[object Undefined]",ep=Zu?Zu.toStringTag:void 0,tp=Ae,np=Ee,rp="[object AsyncFunction]",ip="[object Function]",op="[object GeneratorFunction]",ap="[object Proxy]",sp=ke,lp=Uu["__core-js_shared__"],cp=lp,up=function(){var e=/[^.]+$/.exec(cp&&cp.keys&&cp.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),pp=xe,hp=Function.prototype,fp=hp.toString,dp=je,mp=/[\\^$.*+?()[\]{}|]/g,gp=/^\[object .+?Constructor\]$/,vp=Function.prototype,yp=Object.prototype,_p=vp.toString,bp=yp.hasOwnProperty,wp=RegExp("^"+_p.call(bp).replace(mp,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Cp=Ie,Ap=Se,Ep=Te,kp=Ep(Uu,"Map"),xp=kp,jp=Ep(Object,"create"),Ip=jp,Sp=Pe,Tp=Fe,Pp="__lodash_hash_undefined__",Fp=Object.prototype,Rp=Fp.hasOwnProperty,Op=Re,Dp=Object.prototype,Np=Dp.hasOwnProperty,Vp=Oe,Lp="__lodash_hash_undefined__",Mp=De;Ne.prototype.clear=Sp,Ne.prototype.delete=Tp,Ne.prototype.get=Op,Ne.prototype.has=Vp,Ne.prototype.set=Mp;var Bp=Ne,Up=Ve,Wp=Le,Zp=Me,Hp=Be,Gp=Ue,zp=We,Qp=Ze;He.prototype.clear=Up,He.prototype.delete=Hp,He.prototype.get=Gp,He.prototype.has=zp,He.prototype.set=Qp;var Kp=He,Xp=200,Yp=Ge;ze.prototype.clear=Ru,ze.prototype.delete=Ou,ze.prototype.get=Du,ze.prototype.has=Nu,ze.prototype.set=Yp;var qp=ze,Jp=Qe,$p=function(){try{var e=Ep(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),eh=$p,th=Ke,nh=Object.prototype,rh=nh.hasOwnProperty,ih=Xe,oh=Ye,ah=qe,sh=Je,lh="[object Arguments]",ch=$e,uh=Object.prototype,ph=uh.hasOwnProperty,hh=uh.propertyIsEnumerable,fh=ch(function(){return arguments}())?ch:function(e){return sh(e)&&ph.call(e,"callee")&&!hh.call(e,"callee")},dh=fh,mh=Array.isArray,gh=mh,vh=et,yh=i(function(e,t){var n=t&&!t.nodeType&&t,r=n&&!0&&e&&!e.nodeType&&e,i=r&&r.exports===n?Uu.Buffer:void 0,o=(i?i.isBuffer:void 0)||vh;e.exports=o}),_h=9007199254740991,bh=/^(?:0|[1-9]\d*)$/,wh=tt,Ch=9007199254740991,Ah=nt,Eh="[object Arguments]",kh="[object Array]",xh="[object Boolean]",jh="[object Date]",Ih="[object Error]",Sh="[object Function]",Th="[object Map]",Ph="[object Number]",Fh="[object Object]",Rh="[object RegExp]",Oh="[object Set]",Dh="[object String]",Nh="[object WeakMap]",Vh="[object ArrayBuffer]",Lh="[object DataView]",Mh="[object Float32Array]",Bh="[object Float64Array]",Uh="[object Int8Array]",Wh="[object Int16Array]",Zh="[object Int32Array]",Hh="[object Uint8Array]",Gh="[object Uint8ClampedArray]",zh="[object Uint16Array]",Qh="[object Uint32Array]",Kh={};Kh[Mh]=Kh[Bh]=Kh[Uh]=Kh[Wh]=Kh[Zh]=Kh[Hh]=Kh[Gh]=Kh[zh]=Kh[Qh]=!0,Kh[Eh]=Kh[kh]=Kh[Vh]=Kh[xh]=Kh[Lh]=Kh[jh]=Kh[Ih]=Kh[Sh]=Kh[Th]=Kh[Ph]=Kh[Fh]=Kh[Rh]=Kh[Oh]=Kh[Dh]=Kh[Nh]=!1;var Xh=rt,Yh=it,qh=i(function(e,t){var n=t&&!t.nodeType&&t,r=n&&!0&&e&&!e.nodeType&&e,i=r&&r.exports===n&&Lu.process,o=function(){try{return i&&i.binding&&i.binding("util")}catch(e){}}();e.exports=o}),Jh=qh&&qh.isTypedArray,$h=Jh?Yh(Jh):Xh,ef=$h,tf=Object.prototype,nf=tf.hasOwnProperty,rf=ot,of=Object.prototype,af=at,sf=st,lf=sf(Object.keys,Object),cf=lf,uf=Object.prototype,pf=uf.hasOwnProperty,hf=lt,ff=ct,df=ut,mf=pt,gf=ht,vf=Object.prototype,yf=vf.hasOwnProperty,_f=ft,bf=dt,wf=mt,Cf=i(function(e,t){function n(e,t){if(t)return e.slice();var n=e.length,r=a?a(n):new e.constructor(n);return e.copy(r),r}var r=t&&!t.nodeType&&t,i=r&&!0&&e&&!e.nodeType&&e,o=i&&i.exports===r?Uu.Buffer:void 0,a=o?o.allocUnsafe:void 0;e.exports=n}),Af=gt,Ef=vt,kf=yt,xf=Object.prototype,jf=xf.propertyIsEnumerable,If=Object.getOwnPropertySymbols,Sf=If?function(e){return null==e?[]:(e=Object(e),Ef(If(e),function(t){return jf.call(e,t)}))}:kf,Tf=Sf,Pf=_t,Ff=bt,Rf=sf(Object.getPrototypeOf,Object),Of=Rf,Df=Object.getOwnPropertySymbols,Nf=Df?function(e){for(var t=[];e;)Ff(t,Tf(e)),e=Of(e);return t}:kf,Vf=Nf,Lf=wt,Mf=Ct,Bf=At,Uf=Et,Wf=Ep(Uu,"DataView"),Zf=Wf,Hf=Ep(Uu,"Promise"),Gf=Hf,zf=Ep(Uu,"Set"),Qf=zf,Kf=Ep(Uu,"WeakMap"),Xf=Kf,Yf="[object Map]",qf="[object Object]",Jf="[object Promise]",$f="[object Set]",ed="[object WeakMap]",td="[object DataView]",nd=dp(Zf),rd=dp(xp),id=dp(Gf),od=dp(Qf),ad=dp(Xf),sd=tp;(Zf&&sd(new Zf(new ArrayBuffer(1)))!=td||xp&&sd(new xp)!=Yf||Gf&&sd(Gf.resolve())!=Jf||Qf&&sd(new Qf)!=$f||Xf&&sd(new Xf)!=ed)&&(sd=function(e){var t=tp(e),n=t==qf?e.constructor:void 0,r=n?dp(n):"";if(r)switch(r){case nd:return td;case rd:return Yf;case id:return Jf;case od:return $f;case ad:return ed}return t});var ld=sd,cd=Object.prototype,ud=cd.hasOwnProperty,pd=kt,hd=Uu.Uint8Array,fd=hd,dd=xt,md=jt,gd=It,vd=St,yd=Tt,_d=1,bd=Pt,wd=/\w*$/,Cd=Ft,Ad=Rt,Ed=Ot,kd=1,xd=Dt,jd=Zu?Zu.prototype:void 0,Id=jd?jd.valueOf:void 0,Sd=Nt,Td=Vt,Pd="[object Boolean]",Fd="[object Date]",Rd="[object Map]",Od="[object Number]",Dd="[object RegExp]",Nd="[object Set]",Vd="[object String]",Ld="[object Symbol]",Md="[object ArrayBuffer]",Bd="[object DataView]",Ud="[object Float32Array]",Wd="[object Float64Array]",Zd="[object Int8Array]",Hd="[object Int16Array]",Gd="[object Int32Array]",zd="[object Uint8Array]",Qd="[object Uint8ClampedArray]",Kd="[object Uint16Array]",Xd="[object Uint32Array]",Yd=Lt,qd=Object.create,Jd=function(){function e(){}return function(t){if(!np(t))return{};if(qd)return qd(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}(),$d=Jd,em=Mt,tm=1,nm=2,rm=4,im="[object Arguments]",om="[object Array]",am="[object Boolean]",sm="[object Date]",lm="[object Error]",cm="[object Function]",um="[object GeneratorFunction]",pm="[object Map]",hm="[object Number]",fm="[object Object]",dm="[object RegExp]",mm="[object Set]",gm="[object String]",vm="[object Symbol]",ym="[object WeakMap]",_m="[object ArrayBuffer]",bm="[object DataView]",wm="[object Float32Array]",Cm="[object Float64Array]",Am="[object Int8Array]",Em="[object Int16Array]",km="[object Int32Array]",xm="[object Uint8Array]",jm="[object Uint8ClampedArray]",Im="[object Uint16Array]",Sm="[object Uint32Array]",Tm={};Tm[im]=Tm[om]=Tm[_m]=Tm[bm]=Tm[am]=Tm[sm]=Tm[wm]=Tm[Cm]=Tm[Am]=Tm[Em]=Tm[km]=Tm[pm]=Tm[hm]=Tm[fm]=Tm[dm]=Tm[mm]=Tm[gm]=Tm[vm]=Tm[xm]=Tm[jm]=Tm[Im]=Tm[Sm]=!0,Tm[lm]=Tm[cm]=Tm[ym]=!1;var Pm=Bt,Fm=4,Rm=Ut,Om=Wt,Dm=Zt,Nm=Math.max,Vm=Ht,Lm=Gt,Mm=eh?function(e,t){return eh(e,"toString",{configurable:!0,enumerable:!1,value:Lm(t),writable:!0})}:Dm,Bm=Mm,Um=800,Wm=16,Zm=Date.now,Hm=zt,Gm=Hm(Bm),zm=Gm,Qm=Qt,Km=Kt,Xm=Xt,Ym=Xm(function(e,t,n,r){oh(t,bf(t),e,r)}),qm=Ym,Jm=Object.prototype,$m=Jm.hasOwnProperty,eg=Yt,tg=Qm(function(e){return e.push(void 0,eg),Om(qm,void 0,e)}),ng=tg,rg={schema:{autoStart:{type:"boolean",default:!0},loop:{type:"boolean",default:!0},wait:{type:"number",default:2e3},move:{type:"number",default:3e3}},init:function(){this._currentWayPoint=-1,this.el.setAttribute("animation__move",{startEvents:"doNotFire",pauseEvents:"pauseTour",resumeEvents:"resumeTour",property:"position",easing:"easeInOutSine",dur:100}),this.el.setAttribute("animation__turn",{startEvents:"doNotFire",pauseEvents:"pauseTour",resumeEvents:"resumeTour",property:"rotation",easing:"easeInOutSine",dur:100}),this._nextWaypointHandler=this._nextWaypoint.bind(this),this.el.addEventListener("animation__move-complete",this._nextWaypointHandler)},update:function(){this._waypoints=Array.from(this.el.querySelectorAll("[tour-waypoint]")),this.data.autoStart&&this.playTour()},playTour:function(){if(this._waypoints&&this._waypoints.length)if(this._isPlaying)this._isChangingAnimation?(clearTimeout(this._nextAnimationTimeout),this.goTo(this._waypoints[this._currentWayPoint].getAttribute("io3d-uuid"),this._isPlaying)):this.el.dispatchEvent(new CustomEvent("resumeTour")),this._isPaused=!1;else{this._isPlaying=!0,this._isPaused=!1;var e=this._waypoints[++this._currentWayPoint];e?this.goTo(e.getAttribute("io3d-uuid"),!0):this.data.loop&&(this._currentWayPoint=0,this.goTo(this._waypoints[0].getAttribute("io3d-uuid"),!0))}else console.warn("camera tour has no waypoints")},pauseTour:function(){this._isPaused=!0,this.el.dispatchEvent(new CustomEvent("pauseTour"))},stopTour:function(){this.pauseTour(),this._isPlaying=!1,this._isPaused=!1},goTo:function(e,t){this._isPlaying=!!t;var n=this._waypoints.find(function(t){return t.getAttribute("io3d-uuid")===e});n?this.animate(n):console.error("The given waypoint "+e+" does not exist. Available waypoints:",this._waypoints.map(function(e){return e.getAttribute("io3d-uuid")}))},updateViewPoint:function(e){if("object"==typeof(e=e||{})){var t=e.position||{},n=e.rotation||{};this._isPlaying=!1;var r={position:ng({},t,Rm(this.el.getAttribute("position"))),rotation:ng({},n,Rm(this.el.getAttribute("rotation")))};this.animate(r)}else console.error("not supported camera view point: "+e)},animate:function(e){var t=en(e),n=this.el,r=t?e.getAttribute("position"):e.position,i=t?e.getAttribute("rotation"):e.rotation,o=n.getAttribute("position"),a=n.getAttribute("rotation"),s=qt(a,i);i=s.end,a=s.start;var l=$t(o,r),c=Math.abs(a.y-i.y),u=Math.round((void 0===this.data.move?3e3:this.data.move+1)/6*(l+c/30));if(u>Math.max(5e3,this.data.move)&&(u=Math.max(5e3,this.data.move)),!u)return this._nextWaypoint();n.components.animation__move.pauseAnimation(),n.components.animation__turn.pauseAnimation(),n.components.animation__move.data.dur=u,n.components.animation__move.data.from=o,n.components.animation__move.data.to=r,n.components.animation__move.update(),n.components.animation__turn.data.dur=u,n.components.animation__turn.data.from=a,n.components.animation__turn.data.to=i,n.components.animation__turn.update(),n.components.animation__move.resumeAnimation(),n.components.animation__turn.resumeAnimation(),this._isChangingAnimation=!1},_nextWaypoint:function(){if(this.el.setAttribute("position",AFRAME.utils.coordinates.stringify(this.el.getAttribute("position"))),!this._isPlaying)return this.stopTour();if(this._currentWayPoint===this._waypoints.length-1){if(!this.data.loop)return;this._currentWayPoint=-1}this._isChangingAnimation=!0;var e=this._waypoints[++this._currentWayPoint];this._nextAnimationTimeout=setTimeout(function(){this.goTo(e.getAttribute("io3d-uuid"),this._isPlaying)}.bind(this),void 0===this.data.wait?0:this.data.wait)}},ig={"utf-8":tn,"UTF-8":tn,"utf-16":nn,"UTF-16":nn},og={utf8:rn("utf-8"),utf16:rn("utf-16")},ag=Zu?Zu.isConcatSpreadable:void 0,sg=on,lg=an,cg=sn,ug="__lodash_hash_undefined__",pg=ln,hg=cn;un.prototype.add=un.prototype.push=pg,un.prototype.has=hg;var fg=un,dg=pn,mg=hn,gg=1,vg=2,yg=fn,_g=1,bg=2,wg="[object Boolean]",Cg="[object Date]",Ag="[object Error]",Eg="[object Map]",kg="[object Number]",xg="[object RegExp]",jg="[object Set]",Ig="[object String]",Sg="[object Symbol]",Tg="[object ArrayBuffer]",Pg="[object DataView]",Fg=Zu?Zu.prototype:void 0,Rg=Fg?Fg.valueOf:void 0,Og=dn,Dg=1,Ng=Object.prototype,Vg=Ng.hasOwnProperty,Lg=mn,Mg=1,Bg="[object Arguments]",Ug="[object Array]",Wg="[object Object]",Zg=Object.prototype,Hg=Zg.hasOwnProperty,Gg=gn,zg=vn,Qg=1,Kg=2,Xg=yn,Yg=_n,qg=bn,Jg=wn,$g=Cn,ev="[object Symbol]",tv=An,nv=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,rv=/^\w*$/,iv=En,ov="Expected a function";kn.Cache=Kp;var av=kn,sv=500,lv=xn,cv=/^\./,uv=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,pv=/\\(\\)?/g,hv=lv(function(e){var t=[];return cv.test(e)&&t.push(""),e.replace(uv,function(e,n,r,i){t.push(r?i.replace(pv,"$1"):n||e)}),t}),fv=hv,dv=1/0,mv=Zu?Zu.prototype:void 0,gv=mv?mv.toString:void 0,vv=jn,yv=In,_v=Sn,bv=1/0,wv=Tn,Cv=Pn,Av=Fn,Ev=Rn,kv=On,xv=Dn,jv=1,Iv=2,Sv=Nn,Tv=Vn,Pv=Ln,Fv=Mn,Rv=Bn,Ov=Un,Dv=Ov(),Nv=Dv,Vv=Wn,Lv=Zn,Mv=Lv(Vv),Bv=Mv,Uv=Hn,Wv=Gn,Zv=zn,Hv=Qn,Gv=Kn,zv=Qm(function(e,t){if(null==e)return[];var n=t.length;return n>1&&Km(e,t[0],t[1])?t=[]:n>2&&Km(t[0],t[1],t[2])&&(t=[t[0]]),Gv(e,lg(t,1),[])}),Qv=zv;Xn.prototype={add:function(e,t){var n=this;if(this._pendingPromises[e])return this._pendingPromises[e];if(this._resolvedPromises[e])return this._resolvedPromises[e];var r={key:e,timestamp:Date.now(),promise:t};return this._pendingPromises[e]=r,t.then(function(t){var r=n._pendingPromises[e];delete n._pendingPromises[e],r.data=t,n._resolvedPromises[e]=r},function(){delete n._pendingPromises[e]}),this._collectGarbage(),r},get:function(e){var t=this._pendingPromises[e]||this._resolvedPromises[e];return!!t&&(t.timestamp=Date.now(),t.promise)},purge:function(){for(var e in this._resolvedPromises)delete this._resolvedPromises[e]},_collectGarbage:function(){var e=Qv(this._resolvedPromises,function(e){return e.timestamp}),t=e.length-this.maxResolvedCache;if(!(t<=0))for(var n=0;n<t;n++)delete this._resolvedPromises[e[n].key]}};for(var Kv=new Xn,Xv={text:"uniform vec3 u_color;\r\nuniform float u_metallic;\r\nuniform float u_roughness;\r\nuniform vec3 u_light0Pos;\r\nuniform vec3 u_light0Color;\r\nuniform vec3 u_light1Pos;\r\nuniform vec3 u_light1Color;\r\nuniform mat4 u_modelMatrix;\r\nuniform sampler2D u_reflectionCube;\r\nuniform sampler2D u_reflectionCubeBlur;",base64:"data:text/plain;base64,dW5pZm9ybSB2ZWMzIHVfY29sb3I7DQp1bmlmb3JtIGZsb2F0IHVfbWV0YWxsaWM7DQp1bmlmb3JtIGZsb2F0IHVfcm91Z2huZXNzOw0KdW5pZm9ybSB2ZWMzIHVfbGlnaHQwUG9zOw0KdW5pZm9ybSB2ZWMzIHVfbGlnaHQwQ29sb3I7DQp1bmlmb3JtIHZlYzMgdV9saWdodDFQb3M7DQp1bmlmb3JtIHZlYzMgdV9saWdodDFDb2xvcjsNCnVuaWZvcm0gbWF0NCB1X21vZGVsTWF0cml4Ow0KdW5pZm9ybSBzYW1wbGVyMkQgdV9yZWZsZWN0aW9uQ3ViZTsNCnVuaWZvcm0gc2FtcGxlcjJEIHVfcmVmbGVjdGlvbkN1YmVCbHVyOw=="},Yv={text:"varying vec3 v_normal;\r\nvarying vec3 v_position;\r\nvarying vec3 v_binormal;\r\nvarying vec3 v_tangent;\r\n",base64:"data:text/plain;base64,dmFyeWluZyB2ZWMzIHZfbm9ybWFsOw0KdmFyeWluZyB2ZWMzIHZfcG9zaXRpb247DQp2YXJ5aW5nIHZlYzMgdl9iaW5vcm1hbDsNCnZhcnlpbmcgdmVjMyB2X3RhbmdlbnQ7DQo="},qv="https://cdn.rawgit.com/mrdoob/three.js/r86/examples/js/loaders/GLTFLoader.js",Jv="https://gblock.3d.io/api/get-gltf-url/?url=",$v=new Xn,ey={schema:{type:"asset"},init:function(){this.model=null},update:function(){var e=this,t=this.el,n=this.data;n&&(this.remove(),gu.all([qn(n),Jn()]).then(function(r){var i=r[0];(new(0,r[1])).load(i,function(n){e.model=n.scene||n.scenes[0],e.model.traverse(function(e){e.material&&(e.material=new THREE.MeshPhongMaterial({vertexColors:THREE.VertexColors}))}),e.model.animations=n.animations,t.setObject3D("mesh",e.model),t.emit("model-loaded",{format:"gltf",model:e.model})},function(){},function(e){console.error('ERROR loading gblock model "'+n+'" : '+e),t.emit("model-error",{message:e})})}).catch(function(e){console.error('ERROR loading gblock model from "'+n+'" : '+e),t.emit("model-error",{message:e})}))},remove:function(){this.model&&this.el.removeObject3D("mesh")}},ty,ny={schema:{preset:{type:"string",default:"studio"},intensity:{type:"float",default:1},saturation:{type:"float",default:1}},init:function(){var e=document.querySelector("a-entity[camera]")||document.querySelector("a-camera");e?(this.cam=e.object3D,this.staticLights=document.createElement("a-entity"),this.staticLights.id="static-lights",this.movingWithCamera=document.createElement("a-entity"),this.movingWithCamera.id="moving-lights",this.rotatingWithCamera=document.createElement("a-entity"),this.rotatingWithCamera.id="rotating-lights",this.el.appendChild(this.staticLights),this.el.appendChild(this.movingWithCamera),this.el.appendChild(this.rotatingWithCamera)):console.warn("this scene has no camera, add one to make the lighting work")},update:function(){for(this.camera&&(this.cam=this.camera.object3D);this.movingWithCamera.hasChildNodes();)this.movingWithCamera.removeChild(this.movingWithCamera.lastChild);for(;this.rotatingWithCamera.hasChildNodes();)this.rotatingWithCamera.removeChild(this.rotatingWithCamera.lastChild);for(;this.staticLights.hasChildNodes();)this.staticLights.removeChild(this.staticLights.lastChild);ly[this.data.preset](this.movingWithCamera,this.rotatingWithCamera,this.staticLights,this.data.intensity,this.data.saturation)},remove:function(){this.el.removeChild(this.staticLights),this.el.removeChild(this.movingWithCamera),this.el.removeChild(this.rotatingWithCamera)},tick:function(e){if(this.movingWithCamera){this.movingWithCamera.setAttribute("position",this.cam.position);var t={x:0,y:180*this.cam.rotation.y/Math.PI,z:0};this.rotatingWithCamera.setAttribute("rotation",AFRAME.utils.coordinates.stringify(t))}}},ry=1,iy=60,oy=20,ay=1024,sy=.001,ly={studio:function(e,t,n,r,i){$n({id:"light-target",position:{x:0,y:0,z:-2}},e),$n({light:{type:"directional",color:"#333",intensity:1,target:"#light-target",castShadow:!0,shadowCameraLeft:-oy/2,shadowCameraRight:oy/2,shadowCameraBottom:-oy/2,shadowCameraTop:oy/2,shadowMapHeight:ay,shadowMapWidth:ay,shadowBias:sy,shadowCameraNear:ry,shadowCameraFar:iy},position:{x:0,y:10,z:-2},id:"shadow-light"},e),$n({light:{type:"hemisphere",color:"hsl(35, "+Math.round(15*i)+"%, 60%)",groundColor:"hsl(220, "+Math.round(10*i)+"%, 65%)",intensity:.4*r},position:{x:-2,y:0,z:0},rotation:{x:0,y:45,z:0},id:"hemisphere-color"},t),$n({light:{type:"hemisphere",color:"hsl(0, 0%, 0%)",groundColor:"hsl(0, 0%, 80%)",intensity:.3*r},position:{x:0,y:1,z:0},id:"hemisphere-white"},t),$n({light:{type:"directional",color:"hsl(200, "+Math.round(10*i)+"%, 60%)",intensity:.25*r},position:{x:2,y:2,z:-1},id:"specular-blue"},t),$n({light:{type:"directional",color:"hsl(35, "+Math.round(10*i)+"%, 60%)",intensity:.35*r},position:{x:-2,y:1,z:2},id:"specular-yellow"},t),$n({light:{type:"ambient",color:"#FFF",intensity:.45},id:"ambient-light"},n)}},cy="https://dist.3d.io/3dio-inspector-plugins/0.x.x/3dio-inspector-plugins.js",uy={init:er},py=542327876,hy=131072,fy=512,dy=4,my=tr("DXT1"),gy=tr("DXT3"),vy=tr("DXT5"),yy=Nl.has.webGl?Nl.webGl.maxTextureSize||2048:2048,_y=15,by=["architectureGeometries","architectureTexturesLoRes","interiorGeometries","interiorTexturesLoRes","architectureTexturesHiRes","interiorTexturesHiRes"],wy=[!1,!1,!0,!1,!1],Cy={},wy={},Ay=!1,Ey={},ky=by.length,xy=0,jy={},Iy,Sy=0,Ty=ky;Sy<Ty;Sy++)Iy=by[Sy],Cy[Iy]=[],wy[Iy]=wy[Sy],Ey[Iy]={requestCount:0},jy[Iy]=0;var Py={enqueue:fr,dequeue:dr,info:Ey},Fy=new Xn,Ry={".dds":ar,".jpg":ur,".jpeg":ur,".jpe":ur,".png":ur,".gif":ur,".svg":ur},Oy={mapDiffuse:"map",mapSpecular:"specularMap",mapNormal:"normalMap",mapAlpha:"alphaMap",mapLight:"lightMap",mapDiffusePreview:"map",mapSpecularPreview:"specularMap",mapNormalPreview:"normalMap",mapAlphaPreview:"alphaMap",mapLightPreview:"lightMap"},Dy={repeat:1e3,mirror:1002,clamp:1001},Ny={},Vy={UV1:["mapDiffuse","mapSpecular","mapNormal","mapAlpha"],UV2:"mapLight"},Ly={UV1:["mapDiffusePreview","mapSpecularPreview","mapNormalPreview","mapAlphaPreview"],UV2:"mapLightPreview"},My=1.2,By=.6,Uy=0,Wy={text:"uniform vec3 color;\r\nuniform vec3 emissive;\r\nuniform vec3 specular;\r\nuniform float shininess;\r\nuniform float opacity;\r\n\r\n#include <common>\r\n#include <packing>\r\n#include <uv_pars_fragment>\r\n#include <uv2_pars_fragment>\r\n#include <map_pars_fragment>\r\n#include <alphamap_pars_fragment>\r\n\r\n// Replaces <lightmap_pars_fragment>;\r\n\r\n#ifdef USE_LIGHTMAP\r\n\tuniform sampler2D lightMap;\r\n\tuniform float lightMapIntensity;\r\n\tuniform float lightMapExposure;\r\n\tuniform float lightMapFalloff;\r\n#endif\r\n\r\n#include <normalmap_pars_fragment>\r\n#include <specularmap_pars_fragment>\r\n\r\n#include <bsdfs>\r\n#include <lights_pars>\r\n#include <lights_phong_pars_fragment>\r\n#include <shadowmap_pars_fragment>\r\n\r\n\r\nvoid main() {\r\n\r\n    vec4 diffuseColor = vec4( color, opacity );\r\n    ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\r\n\r\n    vec3 totalEmissiveRadiance = emissive;\r\n\r\n    #include <map_fragment>\r\n    #include <alphamap_fragment>\r\n    #include <alphatest_fragment>\r\n    #include <specularmap_fragment>\r\n\r\n    // Start of <normal_fragment> replace block\r\n    #ifdef FLAT_SHADED\r\n\r\n      // Workaround for Adreno/Nexus5 not able able to do dFdx( vViewPosition ) ...\r\n\r\n      vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\r\n      vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\r\n      vec3 normal = normalize( cross( fdx, fdy ) );\r\n\r\n    #else\r\n\r\n      vec3 normal = normalize( vNormal );\r\n\r\n      #ifdef DOUBLE_SIDED\r\n\r\n        normal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\r\n\r\n      #endif\r\n\r\n    #endif\r\n\r\n    #ifdef USE_NORMALMAP\r\n\r\n      normal = perturbNormal2Arb( -vViewPosition, normal );\r\n\r\n    #elif defined( USE_BUMPMAP )\r\n\r\n      normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\r\n\r\n    #endif\r\n    // End of <normal_fragment> replace block\r\n\r\n    // accumulation\r\n    #include <lights_phong_fragment>\r\n\r\n    // Start of <light-template> replace block\r\n    GeometricContext geometry;\r\n\r\n    geometry.position = - vViewPosition;\r\n    geometry.normal = normal;\r\n    geometry.viewDir = normalize( vViewPosition );\r\n\r\n    IncidentLight directLight;\r\n\r\n    #if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\r\n\r\n        PointLight pointLight;\r\n\r\n        for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\r\n\r\n            pointLight = pointLights[ i ];\r\n\r\n            getPointDirectLightIrradiance( pointLight, geometry, directLight );\r\n\r\n            #ifdef USE_SHADOWMAP\r\n            directLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\r\n            #endif\r\n\r\n            RE_Direct( directLight, geometry, material, reflectedLight );\r\n\r\n        }\r\n\r\n    #endif\r\n\r\n    #if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\r\n\r\n        SpotLight spotLight;\r\n\r\n        for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\r\n\r\n            spotLight = spotLights[ i ];\r\n\r\n            getSpotDirectLightIrradiance( spotLight, geometry, directLight );\r\n\r\n            #ifdef USE_SHADOWMAP\r\n            directLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\r\n            #endif\r\n\r\n            RE_Direct( directLight, geometry, material, reflectedLight );\r\n\r\n        }\r\n\r\n    #endif\r\n\r\n    #if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\r\n\r\n        DirectionalLight directionalLight;\r\n\r\n        for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\r\n\r\n            directionalLight = directionalLights[ i ];\r\n\r\n            getDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\r\n\r\n            #ifdef USE_SHADOWMAP\r\n            directLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\r\n            #endif\r\n\r\n            RE_Direct( directLight, geometry, material, reflectedLight );\r\n\r\n        }\r\n\r\n    #endif\r\n\r\n    #if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\r\n\r\n        RectAreaLight rectAreaLight;\r\n\r\n        for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\r\n\r\n            rectAreaLight = rectAreaLights[ i ];\r\n            RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\r\n\r\n        }\r\n\r\n    #endif\r\n\r\n    #if defined( RE_IndirectDiffuse )\r\n\r\n        vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\r\n\r\n        #ifdef USE_LIGHTMAP\r\n\r\n            // compute the light value\r\n            vec3 unit = vec3(1.0);\r\n            vec3 light = 2.0 * (texture2D( lightMap, vUv2 ).xyz - lightMapExposure * unit);\r\n            // compute the light intensity modifier\r\n            vec3 modifier = -lightMapFalloff * light * light + unit;\r\n            // apply light\r\n            vec3 lightMapIrradiance = light * modifier * lightMapIntensity;\r\n\r\n            #ifndef PHYSICALLY_CORRECT_LIGHTS\r\n\r\n                lightMapIrradiance *= PI; // factor of PI should not be present; included here to prevent breakage\r\n\r\n            #endif\r\n\r\n            irradiance += lightMapIrradiance;\r\n\r\n        #endif\r\n\r\n        #if ( NUM_HEMI_LIGHTS > 0 )\r\n\r\n            for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\r\n\r\n                irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\r\n\r\n            }\r\n\r\n        #endif\r\n\r\n        RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\r\n\r\n    #endif\r\n    // End of <light-template> replace block\r\n\r\n    vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\r\n\r\n    gl_FragColor = vec4( outgoingLight, diffuseColor.a );\r\n\r\n}",base64:"data:text/plain;base64,dW5pZm9ybSB2ZWMzIGNvbG9yOw0KdW5pZm9ybSB2ZWMzIGVtaXNzaXZlOw0KdW5pZm9ybSB2ZWMzIHNwZWN1bGFyOw0KdW5pZm9ybSBmbG9hdCBzaGluaW5lc3M7DQp1bmlmb3JtIGZsb2F0IG9wYWNpdHk7DQoNCiNpbmNsdWRlIDxjb21tb24+DQojaW5jbHVkZSA8cGFja2luZz4NCiNpbmNsdWRlIDx1dl9wYXJzX2ZyYWdtZW50Pg0KI2luY2x1ZGUgPHV2Ml9wYXJzX2ZyYWdtZW50Pg0KI2luY2x1ZGUgPG1hcF9wYXJzX2ZyYWdtZW50Pg0KI2luY2x1ZGUgPGFscGhhbWFwX3BhcnNfZnJhZ21lbnQ+DQoNCi8vIFJlcGxhY2VzIDxsaWdodG1hcF9wYXJzX2ZyYWdtZW50PjsNCg0KI2lmZGVmIFVTRV9MSUdIVE1BUA0KCXVuaWZvcm0gc2FtcGxlcjJEIGxpZ2h0TWFwOw0KCXVuaWZvcm0gZmxvYXQgbGlnaHRNYXBJbnRlbnNpdHk7DQoJdW5pZm9ybSBmbG9hdCBsaWdodE1hcEV4cG9zdXJlOw0KCXVuaWZvcm0gZmxvYXQgbGlnaHRNYXBGYWxsb2ZmOw0KI2VuZGlmDQoNCiNpbmNsdWRlIDxub3JtYWxtYXBfcGFyc19mcmFnbWVudD4NCiNpbmNsdWRlIDxzcGVjdWxhcm1hcF9wYXJzX2ZyYWdtZW50Pg0KDQojaW5jbHVkZSA8YnNkZnM+DQojaW5jbHVkZSA8bGlnaHRzX3BhcnM+DQojaW5jbHVkZSA8bGlnaHRzX3Bob25nX3BhcnNfZnJhZ21lbnQ+DQojaW5jbHVkZSA8c2hhZG93bWFwX3BhcnNfZnJhZ21lbnQ+DQoNCg0Kdm9pZCBtYWluKCkgew0KDQogICAgdmVjNCBkaWZmdXNlQ29sb3IgPSB2ZWM0KCBjb2xvciwgb3BhY2l0eSApOw0KICAgIFJlZmxlY3RlZExpZ2h0IHJlZmxlY3RlZExpZ2h0ID0gUmVmbGVjdGVkTGlnaHQoIHZlYzMoIDAuMCApLCB2ZWMzKCAwLjAgKSwgdmVjMyggMC4wICksIHZlYzMoIDAuMCApICk7DQoNCiAgICB2ZWMzIHRvdGFsRW1pc3NpdmVSYWRpYW5jZSA9IGVtaXNzaXZlOw0KDQogICAgI2luY2x1ZGUgPG1hcF9mcmFnbWVudD4NCiAgICAjaW5jbHVkZSA8YWxwaGFtYXBfZnJhZ21lbnQ+DQogICAgI2luY2x1ZGUgPGFscGhhdGVzdF9mcmFnbWVudD4NCiAgICAjaW5jbHVkZSA8c3BlY3VsYXJtYXBfZnJhZ21lbnQ+DQoNCiAgICAvLyBTdGFydCBvZiA8bm9ybWFsX2ZyYWdtZW50PiByZXBsYWNlIGJsb2NrDQogICAgI2lmZGVmIEZMQVRfU0hBREVEDQoNCiAgICAgIC8vIFdvcmthcm91bmQgZm9yIEFkcmVuby9OZXh1czUgbm90IGFibGUgYWJsZSB0byBkbyBkRmR4KCB2Vmlld1Bvc2l0aW9uICkgLi4uDQoNCiAgICAgIHZlYzMgZmR4ID0gdmVjMyggZEZkeCggdlZpZXdQb3NpdGlvbi54ICksIGRGZHgoIHZWaWV3UG9zaXRpb24ueSApLCBkRmR4KCB2Vmlld1Bvc2l0aW9uLnogKSApOw0KICAgICAgdmVjMyBmZHkgPSB2ZWMzKCBkRmR5KCB2Vmlld1Bvc2l0aW9uLnggKSwgZEZkeSggdlZpZXdQb3NpdGlvbi55ICksIGRGZHkoIHZWaWV3UG9zaXRpb24ueiApICk7DQogICAgICB2ZWMzIG5vcm1hbCA9IG5vcm1hbGl6ZSggY3Jvc3MoIGZkeCwgZmR5ICkgKTsNCg0KICAgICNlbHNlDQoNCiAgICAgIHZlYzMgbm9ybWFsID0gbm9ybWFsaXplKCB2Tm9ybWFsICk7DQoNCiAgICAgICNpZmRlZiBET1VCTEVfU0lERUQNCg0KICAgICAgICBub3JtYWwgPSBub3JtYWwgKiAoIGZsb2F0KCBnbF9Gcm9udEZhY2luZyApICogMi4wIC0gMS4wICk7DQoNCiAgICAgICNlbmRpZg0KDQogICAgI2VuZGlmDQoNCiAgICAjaWZkZWYgVVNFX05PUk1BTE1BUA0KDQogICAgICBub3JtYWwgPSBwZXJ0dXJiTm9ybWFsMkFyYiggLXZWaWV3UG9zaXRpb24sIG5vcm1hbCApOw0KDQogICAgI2VsaWYgZGVmaW5lZCggVVNFX0JVTVBNQVAgKQ0KDQogICAgICBub3JtYWwgPSBwZXJ0dXJiTm9ybWFsQXJiKCAtdlZpZXdQb3NpdGlvbiwgbm9ybWFsLCBkSGR4eV9md2QoKSApOw0KDQogICAgI2VuZGlmDQogICAgLy8gRW5kIG9mIDxub3JtYWxfZnJhZ21lbnQ+IHJlcGxhY2UgYmxvY2sNCg0KICAgIC8vIGFjY3VtdWxhdGlvbg0KICAgICNpbmNsdWRlIDxsaWdodHNfcGhvbmdfZnJhZ21lbnQ+DQoNCiAgICAvLyBTdGFydCBvZiA8bGlnaHQtdGVtcGxhdGU+IHJlcGxhY2UgYmxvY2sNCiAgICBHZW9tZXRyaWNDb250ZXh0IGdlb21ldHJ5Ow0KDQogICAgZ2VvbWV0cnkucG9zaXRpb24gPSAtIHZWaWV3UG9zaXRpb247DQogICAgZ2VvbWV0cnkubm9ybWFsID0gbm9ybWFsOw0KICAgIGdlb21ldHJ5LnZpZXdEaXIgPSBub3JtYWxpemUoIHZWaWV3UG9zaXRpb24gKTsNCg0KICAgIEluY2lkZW50TGlnaHQgZGlyZWN0TGlnaHQ7DQoNCiAgICAjaWYgKCBOVU1fUE9JTlRfTElHSFRTID4gMCApICYmIGRlZmluZWQoIFJFX0RpcmVjdCApDQoNCiAgICAgICAgUG9pbnRMaWdodCBwb2ludExpZ2h0Ow0KDQogICAgICAgIGZvciAoIGludCBpID0gMDsgaSA8IE5VTV9QT0lOVF9MSUdIVFM7IGkgKysgKSB7DQoNCiAgICAgICAgICAgIHBvaW50TGlnaHQgPSBwb2ludExpZ2h0c1sgaSBdOw0KDQogICAgICAgICAgICBnZXRQb2ludERpcmVjdExpZ2h0SXJyYWRpYW5jZSggcG9pbnRMaWdodCwgZ2VvbWV0cnksIGRpcmVjdExpZ2h0ICk7DQoNCiAgICAgICAgICAgICNpZmRlZiBVU0VfU0hBRE9XTUFQDQogICAgICAgICAgICBkaXJlY3RMaWdodC5jb2xvciAqPSBhbGwoIGJ2ZWMyKCBwb2ludExpZ2h0LnNoYWRvdywgZGlyZWN0TGlnaHQudmlzaWJsZSApICkgPyBnZXRQb2ludFNoYWRvdyggcG9pbnRTaGFkb3dNYXBbIGkgXSwgcG9pbnRMaWdodC5zaGFkb3dNYXBTaXplLCBwb2ludExpZ2h0LnNoYWRvd0JpYXMsIHBvaW50TGlnaHQuc2hhZG93UmFkaXVzLCB2UG9pbnRTaGFkb3dDb29yZFsgaSBdICkgOiAxLjA7DQogICAgICAgICAgICAjZW5kaWYNCg0KICAgICAgICAgICAgUkVfRGlyZWN0KCBkaXJlY3RMaWdodCwgZ2VvbWV0cnksIG1hdGVyaWFsLCByZWZsZWN0ZWRMaWdodCApOw0KDQogICAgICAgIH0NCg0KICAgICNlbmRpZg0KDQogICAgI2lmICggTlVNX1NQT1RfTElHSFRTID4gMCApICYmIGRlZmluZWQoIFJFX0RpcmVjdCApDQoNCiAgICAgICAgU3BvdExpZ2h0IHNwb3RMaWdodDsNCg0KICAgICAgICBmb3IgKCBpbnQgaSA9IDA7IGkgPCBOVU1fU1BPVF9MSUdIVFM7IGkgKysgKSB7DQoNCiAgICAgICAgICAgIHNwb3RMaWdodCA9IHNwb3RMaWdodHNbIGkgXTsNCg0KICAgICAgICAgICAgZ2V0U3BvdERpcmVjdExpZ2h0SXJyYWRpYW5jZSggc3BvdExpZ2h0LCBnZW9tZXRyeSwgZGlyZWN0TGlnaHQgKTsNCg0KICAgICAgICAgICAgI2lmZGVmIFVTRV9TSEFET1dNQVANCiAgICAgICAgICAgIGRpcmVjdExpZ2h0LmNvbG9yICo9IGFsbCggYnZlYzIoIHNwb3RMaWdodC5zaGFkb3csIGRpcmVjdExpZ2h0LnZpc2libGUgKSApID8gZ2V0U2hhZG93KCBzcG90U2hhZG93TWFwWyBpIF0sIHNwb3RMaWdodC5zaGFkb3dNYXBTaXplLCBzcG90TGlnaHQuc2hhZG93Qmlhcywgc3BvdExpZ2h0LnNoYWRvd1JhZGl1cywgdlNwb3RTaGFkb3dDb29yZFsgaSBdICkgOiAxLjA7DQogICAgICAgICAgICAjZW5kaWYNCg0KICAgICAgICAgICAgUkVfRGlyZWN0KCBkaXJlY3RMaWdodCwgZ2VvbWV0cnksIG1hdGVyaWFsLCByZWZsZWN0ZWRMaWdodCApOw0KDQogICAgICAgIH0NCg0KICAgICNlbmRpZg0KDQogICAgI2lmICggTlVNX0RJUl9MSUdIVFMgPiAwICkgJiYgZGVmaW5lZCggUkVfRGlyZWN0ICkNCg0KICAgICAgICBEaXJlY3Rpb25hbExpZ2h0IGRpcmVjdGlvbmFsTGlnaHQ7DQoNCiAgICAgICAgZm9yICggaW50IGkgPSAwOyBpIDwgTlVNX0RJUl9MSUdIVFM7IGkgKysgKSB7DQoNCiAgICAgICAgICAgIGRpcmVjdGlvbmFsTGlnaHQgPSBkaXJlY3Rpb25hbExpZ2h0c1sgaSBdOw0KDQogICAgICAgICAgICBnZXREaXJlY3Rpb25hbERpcmVjdExpZ2h0SXJyYWRpYW5jZSggZGlyZWN0aW9uYWxMaWdodCwgZ2VvbWV0cnksIGRpcmVjdExpZ2h0ICk7DQoNCiAgICAgICAgICAgICNpZmRlZiBVU0VfU0hBRE9XTUFQDQogICAgICAgICAgICBkaXJlY3RMaWdodC5jb2xvciAqPSBhbGwoIGJ2ZWMyKCBkaXJlY3Rpb25hbExpZ2h0LnNoYWRvdywgZGlyZWN0TGlnaHQudmlzaWJsZSApICkgPyBnZXRTaGFkb3coIGRpcmVjdGlvbmFsU2hhZG93TWFwWyBpIF0sIGRpcmVjdGlvbmFsTGlnaHQuc2hhZG93TWFwU2l6ZSwgZGlyZWN0aW9uYWxMaWdodC5zaGFkb3dCaWFzLCBkaXJlY3Rpb25hbExpZ2h0LnNoYWRvd1JhZGl1cywgdkRpcmVjdGlvbmFsU2hhZG93Q29vcmRbIGkgXSApIDogMS4wOw0KICAgICAgICAgICAgI2VuZGlmDQoNCiAgICAgICAgICAgIFJFX0RpcmVjdCggZGlyZWN0TGlnaHQsIGdlb21ldHJ5LCBtYXRlcmlhbCwgcmVmbGVjdGVkTGlnaHQgKTsNCg0KICAgICAgICB9DQoNCiAgICAjZW5kaWYNCg0KICAgICNpZiAoIE5VTV9SRUNUX0FSRUFfTElHSFRTID4gMCApICYmIGRlZmluZWQoIFJFX0RpcmVjdF9SZWN0QXJlYSApDQoNCiAgICAgICAgUmVjdEFyZWFMaWdodCByZWN0QXJlYUxpZ2h0Ow0KDQogICAgICAgIGZvciAoIGludCBpID0gMDsgaSA8IE5VTV9SRUNUX0FSRUFfTElHSFRTOyBpICsrICkgew0KDQogICAgICAgICAgICByZWN0QXJlYUxpZ2h0ID0gcmVjdEFyZWFMaWdodHNbIGkgXTsNCiAgICAgICAgICAgIFJFX0RpcmVjdF9SZWN0QXJlYSggcmVjdEFyZWFMaWdodCwgZ2VvbWV0cnksIG1hdGVyaWFsLCByZWZsZWN0ZWRMaWdodCApOw0KDQogICAgICAgIH0NCg0KICAgICNlbmRpZg0KDQogICAgI2lmIGRlZmluZWQoIFJFX0luZGlyZWN0RGlmZnVzZSApDQoNCiAgICAgICAgdmVjMyBpcnJhZGlhbmNlID0gZ2V0QW1iaWVudExpZ2h0SXJyYWRpYW5jZSggYW1iaWVudExpZ2h0Q29sb3IgKTsNCg0KICAgICAgICAjaWZkZWYgVVNFX0xJR0hUTUFQDQoNCiAgICAgICAgICAgIC8vIGNvbXB1dGUgdGhlIGxpZ2h0IHZhbHVlDQogICAgICAgICAgICB2ZWMzIHVuaXQgPSB2ZWMzKDEuMCk7DQogICAgICAgICAgICB2ZWMzIGxpZ2h0ID0gMi4wICogKHRleHR1cmUyRCggbGlnaHRNYXAsIHZVdjIgKS54eXogLSBsaWdodE1hcEV4cG9zdXJlICogdW5pdCk7DQogICAgICAgICAgICAvLyBjb21wdXRlIHRoZSBsaWdodCBpbnRlbnNpdHkgbW9kaWZpZXINCiAgICAgICAgICAgIHZlYzMgbW9kaWZpZXIgPSAtbGlnaHRNYXBGYWxsb2ZmICogbGlnaHQgKiBsaWdodCArIHVuaXQ7DQogICAgICAgICAgICAvLyBhcHBseSBsaWdodA0KICAgICAgICAgICAgdmVjMyBsaWdodE1hcElycmFkaWFuY2UgPSBsaWdodCAqIG1vZGlmaWVyICogbGlnaHRNYXBJbnRlbnNpdHk7DQoNCiAgICAgICAgICAgICNpZm5kZWYgUEhZU0lDQUxMWV9DT1JSRUNUX0xJR0hUUw0KDQogICAgICAgICAgICAgICAgbGlnaHRNYXBJcnJhZGlhbmNlICo9IFBJOyAvLyBmYWN0b3Igb2YgUEkgc2hvdWxkIG5vdCBiZSBwcmVzZW50OyBpbmNsdWRlZCBoZXJlIHRvIHByZXZlbnQgYnJlYWthZ2UNCg0KICAgICAgICAgICAgI2VuZGlmDQoNCiAgICAgICAgICAgIGlycmFkaWFuY2UgKz0gbGlnaHRNYXBJcnJhZGlhbmNlOw0KDQogICAgICAgICNlbmRpZg0KDQogICAgICAgICNpZiAoIE5VTV9IRU1JX0xJR0hUUyA+IDAgKQ0KDQogICAgICAgICAgICBmb3IgKCBpbnQgaSA9IDA7IGkgPCBOVU1fSEVNSV9MSUdIVFM7IGkgKysgKSB7DQoNCiAgICAgICAgICAgICAgICBpcnJhZGlhbmNlICs9IGdldEhlbWlzcGhlcmVMaWdodElycmFkaWFuY2UoIGhlbWlzcGhlcmVMaWdodHNbIGkgXSwgZ2VvbWV0cnkgKTsNCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICNlbmRpZg0KDQogICAgICAgIFJFX0luZGlyZWN0RGlmZnVzZSggaXJyYWRpYW5jZSwgZ2VvbWV0cnksIG1hdGVyaWFsLCByZWZsZWN0ZWRMaWdodCApOw0KDQogICAgI2VuZGlmDQogICAgLy8gRW5kIG9mIDxsaWdodC10ZW1wbGF0ZT4gcmVwbGFjZSBibG9jaw0KDQogICAgdmVjMyBvdXRnb2luZ0xpZ2h0ID0gcmVmbGVjdGVkTGlnaHQuZGlyZWN0RGlmZnVzZSArIHJlZmxlY3RlZExpZ2h0LmluZGlyZWN0RGlmZnVzZSArIHJlZmxlY3RlZExpZ2h0LmRpcmVjdFNwZWN1bGFyICsgcmVmbGVjdGVkTGlnaHQuaW5kaXJlY3RTcGVjdWxhciArIHRvdGFsRW1pc3NpdmVSYWRpYW5jZTsNCg0KICAgIGdsX0ZyYWdDb2xvciA9IHZlYzQoIG91dGdvaW5nTGlnaHQsIGRpZmZ1c2VDb2xvci5hICk7DQoNCn0="},Zy={text:"varying vec3 vViewPosition;\r\n\r\n#ifndef FLAT_SHADED\r\n\tvarying vec3 vNormal;\r\n#endif\r\n\r\n#include <uv_pars_vertex>\r\n#include <uv2_pars_vertex>\r\n#include <shadowmap_pars_vertex>\r\n\r\nvoid main()\r\n{\r\n//  vUv = uv;\r\n  #include <uv_vertex>\r\n  #include <uv2_vertex>\r\n\r\n  #include <beginnormal_vertex>\r\n  #include <defaultnormal_vertex>\r\n\r\n  #ifndef FLAT_SHADED\r\n    // Normal computed with derivatives when FLAT_SHADED\r\n  \tvNormal = normalize( transformedNormal );\r\n  #endif\r\n\r\n  #include <begin_vertex>\r\n  #include <project_vertex>\r\n\r\n  vViewPosition = - mvPosition.xyz;\r\n\r\n  #include <worldpos_vertex>\r\n  #include <shadowmap_vertex>\r\n\r\n}",base64:"data:text/plain;base64,dmFyeWluZyB2ZWMzIHZWaWV3UG9zaXRpb247DQoNCiNpZm5kZWYgRkxBVF9TSEFERUQNCgl2YXJ5aW5nIHZlYzMgdk5vcm1hbDsNCiNlbmRpZg0KDQojaW5jbHVkZSA8dXZfcGFyc192ZXJ0ZXg+DQojaW5jbHVkZSA8dXYyX3BhcnNfdmVydGV4Pg0KI2luY2x1ZGUgPHNoYWRvd21hcF9wYXJzX3ZlcnRleD4NCg0Kdm9pZCBtYWluKCkNCnsNCi8vICB2VXYgPSB1djsNCiAgI2luY2x1ZGUgPHV2X3ZlcnRleD4NCiAgI2luY2x1ZGUgPHV2Ml92ZXJ0ZXg+DQoNCiAgI2luY2x1ZGUgPGJlZ2lubm9ybWFsX3ZlcnRleD4NCiAgI2luY2x1ZGUgPGRlZmF1bHRub3JtYWxfdmVydGV4Pg0KDQogICNpZm5kZWYgRkxBVF9TSEFERUQNCiAgICAvLyBOb3JtYWwgY29tcHV0ZWQgd2l0aCBkZXJpdmF0aXZlcyB3aGVuIEZMQVRfU0hBREVEDQogIAl2Tm9ybWFsID0gbm9ybWFsaXplKCB0cmFuc2Zvcm1lZE5vcm1hbCApOw0KICAjZW5kaWYNCg0KICAjaW5jbHVkZSA8YmVnaW5fdmVydGV4Pg0KICAjaW5jbHVkZSA8cHJvamVjdF92ZXJ0ZXg+DQoNCiAgdlZpZXdQb3NpdGlvbiA9IC0gbXZQb3NpdGlvbi54eXo7DQoNCiAgI2luY2x1ZGUgPHdvcmxkcG9zX3ZlcnRleD4NCiAgI2luY2x1ZGUgPHNoYWRvd21hcF92ZXJ0ZXg+DQoNCn0="},Hy=v({three:!0,aframe:!1},function(){function e(e){THREE.ShaderMaterial.call(this,e);var e=e||{};this.lightMapExposure=e.lightMapExposure||n,this.lightMapFalloff=e.lightMapFalloff||r,this.uniforms=THREE.UniformsUtils.merge([THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{color:{value:e.color||new THREE.Color(1,1,1)},map:{value:e.map||null},specularMap:{value:e.specularMap||null},alphaMap:{value:e.alphaMap||null},lightMap:{value:e.lightMap||null},lightMapIntensity:{value:e.lightMapIntensity||t},lightMapFalloff:{value:e.lightMapFalloff||r},lightMapExposure:{value:e.lightMapExposure||n},normalMap:{value:e.normalMap||null},normalScale:{value:e.normalScale||i},shininess:{value:e.shininess||1},specular:{value:e.specular||new THREE.Color(.25,.25,.25)},emissive:{value:e.emissive||new THREE.Color(0,0,0)},opacity:{value:e.opacity||1},offsetRepeat:{value:e.offsetRepeat||new THREE.Vector4(0,0,1,1)}}]),this.vertexShader=Zy.text,this.fragmentShader=Wy.text,this.lights=!0}var t=1.2,n=.6,r=0,i=new THREE.Vector2(.8,.8);return e.prototype=Object.create(THREE.ShaderMaterial.prototype),e.prototype.constructor=e,e}),Gy=v({three:!0,aframe:!1},function(){function e(){this._wireframeGeometry=new THREE.BufferGeometry,this._wireframeGeometry.addAttribute("position",new THREE.BufferAttribute(new Float32Array(0),3)),this._wireframeMaterial=new THREE.LineBasicMaterial,this._positions=null,this._buffer=null,this._thresholdAngle=10,this._thickness=1,this._color=[0,0,0],this._opacity=1,this.isLineSegments=!0,THREE.Line.call(this,this._wireframeGeometry,this._wireframeMaterial)}return e.prototype=Object.create(THREE.Line.prototype),e.prototype.constructor=e,e.prototype.update=function(e){var t=e.positions,n=void 0===e.thresholdAngle?this._thresholdAngle:e.thresholdAngle,r=void 0===e.thickness?this._thickness:e.thickness,i=void 0===e.color?this._color:e.color,o=void 0===e.opacity?this._opacity:e.opacity;if(0===r)this.visible=!1;else{if(this._buffer&&n===this._thresholdAngle&&Ar(this._positions,t))0===this._thickness&&(this.visible=!0);else{var a=wr(t,n);a.length?(this._wireframeGeometry.attributes.position.setArray(a),this.visible=!0):this.visible=!1,this._buffer=a,this._positions=t,this._thresholdAngle=n}this._wireframeMaterial.color.r=i[0],this._wireframeMaterial.color.g=i[1],this._wireframeMaterial.color.b=i[2],this._wireframeMaterial.opacity=o,this._wireframeMaterial.linewidth=r,this._color=i,this._opacity=o}this._thickness=r},e.prototype.destroy=function(){this._wireframeGeometry=null,this._wireframeMaterial=null,this._positions=null,this._buffer=null,this._thresholdAngle=null,this._thickness=null,this._color=null,this._opacity=null},e}),zy=v({three:!0,aframe:!1},function(){function e(e){this.threeParent=e.parent,this.meshKeys=[],this.meshes={},this.materialKeys=[],this.materials={},this._meshes3d={},this._wireframes3d={},this._materials3d={}}function t(e){return e?(o[e]?o[e].refCount++:o[e]={geometry3d:new THREE.BufferGeometry,refCount:1},o[e].geometry3d):new THREE.BufferGeometry}function n(e,t){e&&o[e]?--o[e].refCount<1&&(o[e].geometry3d.dispose(),delete o[e]):t.dispose()}var r={front:0,back:1,both:2},i=Math.PI/180,o=(Math.PI,{});return e.prototype={set:function(e,o){o=o||{};var a,s,l,c,u,p,h,f,d,m,g,v,y,_,b,w,C,A=e.meshes||this.meshes,E=e.meshKeys,k=e.materials||this.materials,x=e.materialKeys,j=e.loadingQueuePrefix||o.loadingQueuePrefix||"architecture",I=o.onFirstTextureSetLoaded,S=o.lightMapIntensity,T=o.lightMapExposure,P=this;if(A){for(E||(E=Object.keys(A)),b=0,w=E.length;b<w;b++)a=E[b],s=(F=A[a]).material,c=F.positions,u=F.uvs,p=F.uvsLightmap,f=F.normals,v=F.position,y=F.rotRad,_=F.rotDeg,h=F.scale,P._materials3d[a]||((g=new Hy).name=s,k||br({material3d:g}),P._materials3d[a]=g),P._materials3d[a].side=r[A[a].side]||r.front,P._meshes3d[a]?m=(d=P._meshes3d[a]).geometry:(m=t(F.cacheKey),d=new THREE.Mesh(m,g),P.threeParent.add(d),P._meshes3d[a]=d,l=new Gy,P._meshes3d[a].add(l),P._wireframes3d[a]=l),h&&d.scale.set(h[0],h[1],h[2]),v&&d.position.set(v[0],v[1],v[2]),y?d.rotation.set(y[0],y[1],y[2]):_&&d.rotation.set(_[0]*i,_[1]*i,_[2]*i),void 0===m.attributes.position?m.addAttribute("position",new THREE.BufferAttribute(c,3)):m.attributes.position.array!==c&&(m.attributes.position.array=c,m.attributes.position.needsUpdate=!0,m.computeBoundingSphere()),void 0===m.attributes.normal?m.addAttribute("normal",new THREE.BufferAttribute(f,3)):m.attributes.normal.array!==f&&(m.attributes.normal.array=f,m.attributes.normal.needsUpdate=!0),u?void 0===m.attributes.uv?m.attributes.uv=new THREE.BufferAttribute(u,2):m.attributes.uv.array!==u&&(m.attributes.uv.array=u,m.attributes.uv.needsUpdate=!0,delete m.attributes.uv._scaleU,delete m.attributes.uv._scaleV,delete m.attributes.uv._source):m.attributes.uv&&delete m.attributes.uv,p?void 0===m.attributes.uv2?m.attributes.uv2=new THREE.BufferAttribute(p,2):m.attributes.uv2.array!==p&&(m.attributes.uv2.array=p,m.attributes.uv2.needsUpdate=!0):m.attributes.uv2&&delete m.attributes.uv2,m.attributesKeys=Object.keys(m.attributes),k[s]&&P._wireframes3d[a].update({positions:c,thickness:void 0===k[s].wireframeThickness?0:k[s].wireframeThickness,thresholdAngle:k[s].wireframeThresholdAngle,color:k[s].wireframeColor,opacity:k[s].wireframeOpacity});var F;Object.keys(P._meshes3d).forEach(function(e,t){if(F=P._meshes3d[e],!A[e]){var r=P._wireframes3d[e];r.parent&&(r.parent.remove(r),r.geometry.dispose());var i=P._meshes3d[e].geometry;n(P.meshes[e].cacheKey,i);var o=P._meshes3d[e];o.parent&&o.parent.remove(o);var a=P._materials3d[e];a.map&&a.map.disposeIfPossible(),a.specularMap&&a.specularMap.disposeIfPossible(),a.normalMap&&a.normalMap.disposeIfPossible(),a.alphaMap&&a.alphaMap.disposeIfPossible(),a.lightMap&&a.lightMap.disposeIfPossible(),a.dispose(),delete P._meshes3d[e],delete P._wireframes3d[e],delete P._materials3d[e]}}),P.meshKeys=E,P.meshes=A}if(k){var R,O=[];for(b=0,w=P.meshKeys.length;b<w;b++)a=P.meshKeys[b],(R=k[s=P.meshes[a].material])&&Object.keys(R).length&&(O[b]=br({vm:P.vm,loadingQueuePrefix:j,mesh3d:P._meshes3d[a],material3d:P._materials3d[a],attributes:k[s],onFirstTextureSetLoaded:I,lightMapIntensity:S,lightMapExposure:T}));C=gu.all(O),P.materialKeys=x,P.materials=k}return C||gu.resolve()},hasMeshes:function(){return Object.keys(this._meshes3d).length>0},setMeshes:function(e){this.set({meshes:e})},setMaterials:function(e,t){this.set({materials:e},t)},reset:function(){this.set({meshes:{},materials:{}})},destroy:function(){this.isDestroyed=!0,this.reset(),this.threeParent=null,this.meshKeys=null,this.meshes=null,this.materialKeys=null,this.materials=null,this._meshes3d=null,this._materials3d=null}},e});v({three:!1,aframe:!0,onError:function(){Nl.isBrowser&&console.warn("AFRAME library not found: related features will be disabled.")}},function(){AFRAME.registerComponent("io3d-data3d",bu),AFRAME.registerComponent("io3d-furniture",Cu),AFRAME.registerComponent("tour",rg),AFRAME.registerComponent("io3d-lighting",ny),AFRAME.components.gblock?console.error('3dio.js error: Please remove any other "<script>" tags registering the "gblock" A-Frame component. This component is included in 3dio.js'):AFRAME.registerComponent("gblock",ey),uy.init()});var Qy={three:{Data3dView:zy}},Ky=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,Xy={parse:Sr};Tr.prototype.parse=function(e,t,n,r){if("string"!=typeof e)throw new TypeError("Parameter 'url' must be a string, not "+typeof e);"undefined"==typeof window||e.match(/^[^:]+:\/\//)||"//"===e.substr(0,2)||("/"===e[0]&&(e=e.slice(1)),e=window.location.protocol+"//"+window.location.host+window.location.pathname+e,console.error("mutated",e)),"//"===e.substr(0,2)&&"undefined"!=typeof window&&window.location&&window.location.protocol&&(e=window.location.protocol+e);for(var i=0,o=e.length-1;e.charCodeAt(i)<=32;)i++;for(;e.charCodeAt(o)<=32;)o--;if(i=this._parseProtocol(e,i,o),"javascript"!==this._protocol){i=this._parseHost(e,i,o,n);var a=this._protocol;!this.hostname&&(this.slashes||a&&!o_[a])&&(this.hostname=this.host="")}if(i<=o){var s=e.charCodeAt(i);47===s||92===s?this._parsePath(e,i,o,r):63===s?this._parseQuery(e,i,o,r):35===s?this._parseHash(e,i,o,r):"javascript"!==this._protocol?this._parsePath(e,i,o,r):this.pathname=e.slice(i,o+1)}if(!this.pathname&&this.hostname&&this._slashProtocols[this._protocol]&&(this.pathname="/"),t){var l=this.search;null==l&&(l=this.search=""),63===l.charCodeAt(0)&&(l=l.slice(1)),this.query=Tr.queryString.parse(l)}},Tr.prototype.resolve=function(e){return this.resolveObject(Tr.parse(e,!1,!0)).format()},Tr.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",n=this.pathname||"",r=this.hash||"",i=this.search||"",o="",a=this.hostname||"",s=this.port||"",l=!1,c="",u=this.query;u&&"object"==typeof u&&(o=Tr.queryString.stringify(u)),i||(i=o?"?"+o:""),t&&58!==t.charCodeAt(t.length-1)&&(t+=":"),this.host?l=e+this.host:a&&(a.indexOf(":")>-1&&(a="["+a+"]"),l=e+a+(s?":"+s:""));var p=this.slashes||(!t||o_[t])&&!1!==l;return t?c=t+(p?"//":""):p&&(c="//"),p&&n&&47!==n.charCodeAt(0)&&(n="/"+n),i&&63!==i.charCodeAt(0)&&(i="?"+i),r&&35!==r.charCodeAt(0)&&(r="#"+r),n=Yy(n),i=qy(i),c+(!1===l?"":l)+n+i+r},Tr.prototype.resolveObject=function(e){"string"==typeof e&&(e=Tr.parse(e,!1,!0));var t=this._clone();if(t.hash=e.hash,!e.href)return t._href="",t;if(e.slashes&&!e._protocol)return e._copyPropsTo(t,!0),o_[t._protocol]&&t.hostname&&!t.pathname&&(t.pathname="/"),t._href="",t;if(e._protocol&&e._protocol!==t._protocol){if(!o_[e._protocol])return e._copyPropsTo(t,!1),t._href="",t;if(t._protocol=e._protocol,e.host||"javascript"===e._protocol)t.pathname=e.pathname;else{for(s=(e.pathname||"").split("/");s.length&&!(e.host=s.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==s[0]&&s.unshift(""),s.length<2&&s.unshift(""),t.pathname=s.join("/")}return t.search=e.search,t.host=e.host||"",t.auth=e.auth,t.hostname=e.hostname||e.host,t._port=e._port,t.slashes=t.slashes||e.slashes,t._href="",t}var n=t.pathname&&47===t.pathname.charCodeAt(0),r=e.host||e.pathname&&47===e.pathname.charCodeAt(0),i=r||n||t.host&&e.pathname,o=i,a=t.pathname&&t.pathname.split("/")||[],s=e.pathname&&e.pathname.split("/")||[],l=t._protocol&&!o_[t._protocol];if(l&&(t.hostname="",t._port=-1,t.host&&(""===a[0]?a[0]=t.host:a.unshift(t.host)),t.host="",e._protocol&&(e.hostname="",e._port=-1,e.host&&(""===s[0]?s[0]=e.host:s.unshift(e.host)),e.host=""),i=i&&(""===s[0]||""===a[0])),r)t.host=e.host?e.host:t.host,t.hostname=e.hostname?e.hostname:t.hostname,t.search=e.search,a=s;else if(s.length)a||(a=[]),a.pop(),a=a.concat(s),t.search=e.search;else if(e.search)return l&&(t.hostname=t.host=a.shift(),(d=!!(t.host&&t.host.indexOf("@")>0)&&t.host.split("@"))&&(t.auth=d.shift(),t.host=t.hostname=d.shift())),t.search=e.search,t._href="",t;if(!a.length)return t.pathname=null,t._href="",t;for(var c=a.slice(-1)[0],u=(t.host||e.host)&&("."===c||".."===c)||""===c,p=0,h=a.length;h>=0;h--)"."===(c=a[h])?a.splice(h,1):".."===c?(a.splice(h,1),p++):p&&(a.splice(h,1),p--);if(!i&&!o)for(;p--;p)a.unshift("..");!i||""===a[0]||a[0]&&47===a[0].charCodeAt(0)||a.unshift(""),u&&"/"!==a.join("/").substr(-1)&&a.push("");var f=""===a[0]||a[0]&&47===a[0].charCodeAt(0);if(l){t.hostname=t.host=f?"":a.length?a.shift():"";var d=!!(t.host&&t.host.indexOf("@")>0)&&t.host.split("@");d&&(t.auth=d.shift(),t.host=t.hostname=d.shift())}return(i=i||t.host&&a.length)&&!f&&a.unshift(""),t.pathname=0===a.length?null:a.join("/"),t.auth=e.auth||t.auth,t.slashes=t.slashes||e.slashes,t._href="",t};var Yy=Tr.prototype._escapePathName=function(e){return Or(e,35,63)?Pr(e):e},qy=Tr.prototype._escapeSearch=function(e){return Or(e,35,-1)?Fr(e):e};Tr.prototype._parseProtocol=function(e,t,n){for(var r=!1,i=this._protocolCharacters,o=t;o<=n;++o){var a=e.charCodeAt(o);if(58===a){var s=e.slice(t,o);return r&&(s=s.toLowerCase()),this._protocol=s,o+1}if(1!==i[a])return t;a<97&&(r=!0)}return t},Tr.prototype._parseAuth=function(e,t,n,r){var i=e.slice(t,n+1);r&&(i=decodeURIComponent(i)),this.auth=i},Tr.prototype._parsePort=function(e,t,n){for(var r=0,i=!1,o=!0,a=t;a<=n;++a){var s=e.charCodeAt(a);if(!(48<=s&&s<=57)){o=!1,92!==s&&47!==s||(o=!0);break}r=10*r+(s-48),i=!0}return 0===r&&!i||!o?(o||(this._port=-2),0):(this._port=r,a-t)},Tr.prototype._parseHost=function(e,t,n,r){var i=this._hostEndingCharacters,o=e.charCodeAt(t),a=e.charCodeAt(t+1);if(47!==o&&92!==o||47!==a&&92!==a){if(!this._protocol||o_[this._protocol])return t}else{if(this.slashes=!0,0===t){if(n<2)return t;if(!Rr(e,64,2,i)&&!r)return this.slashes=null,t}t+=2}for(var s=!1,l=t,c=n,u=0,p=0,h=!1,f=-1,d=t;d<=n;++d)if(64===(m=e.charCodeAt(d)))f=d;else if(37===m)h=!0;else if(1===i[m])break;if(f>-1&&(this._parseAuth(e,t,f-1,h),t=l=f+1),91===e.charCodeAt(t)){for(d=t+1;d<=n;++d)if(93===(m=e.charCodeAt(d)))return 58===e.charCodeAt(d+1)&&(u=this._parsePort(e,d+2,n)+1),g=e.slice(t+1,d).toLowerCase(),this.hostname=g,this.host=this._port>0?"["+g+"]:"+this._port:"["+g+"]",this.pathname="/",d+u+1;return t}for(d=t;d<=n;++d){if(p>62)return this.hostname=this.host=e.slice(t,d),d;var m=e.charCodeAt(d);if(58===m){u=this._parsePort(e,d+1,n)+1,c=d-1;break}if(m<97){if(46===m)p=-1;else if(65<=m&&m<=90)s=!0;else if(!(45===m||95===m||43===m||48<=m&&m<=57)){0===i[m]&&0===this._noPrependSlashHostEnders[m]&&(this._prependSlash=!0),c=d-1;break}}else if(m>=123&&m<=126){0===this._noPrependSlashHostEnders[m]&&(this._prependSlash=!0),c=d-1;break}p++}if(c+1!==t&&c-l<=256){var g=e.slice(l,c+1);s&&(g=g.toLowerCase()),this.hostname=g,this.host=this._port>0?g+":"+this._port:g}return c+1+u},Tr.prototype._copyPropsTo=function(e,t){t||(e._protocol=this._protocol),e._href=this._href,e._port=this._port,e._prependSlash=this._prependSlash,e.auth=this.auth,e.slashes=this.slashes,e.host=this.host,e.hostname=this.hostname,e.hash=this.hash,e.search=this.search,e.pathname=this.pathname},Tr.prototype._clone=function(){var e=new Tr;return e._protocol=this._protocol,e._href=this._href,e._port=this._port,e._prependSlash=this._prependSlash,e.auth=this.auth,e.slashes=this.slashes,e.host=this.host,e.hostname=this.hostname,e.hash=this.hash,e.search=this.search,e.pathname=this.pathname,e},Tr.prototype._getComponentEscaped=function(e,t,n,r){for(var i=t,o=t,a="",s=r?this._afterQueryAutoEscapeMap:this._autoEscapeMap;o<=n;++o){var l=s[e.charCodeAt(o)];""!==l&&void 0!==l&&(i<o&&(a+=e.slice(i,o)),a+=l,i=o+1)}return i<o+1&&(a+=e.slice(i,o)),a},Tr.prototype._parsePath=function(e,t,n,r){for(var i=t,o=n,a=!1,s=this._autoEscapeCharacters,l=-2===this._port?"/:":"",c=t;c<=n;++c){var u=e.charCodeAt(c);if(35===u){this._parseHash(e,c,n,r),o=c-1;break}if(63===u){this._parseQuery(e,c,n,r),o=c-1;break}r||a||1!==s[u]||(a=!0)}if(i>o)this.pathname=""===l?"/":l;else{var p;p=a?this._getComponentEscaped(e,i,o,!1):e.slice(i,o+1),this.pathname=""===l?this._prependSlash?"/"+p:p:l+p}},Tr.prototype._parseQuery=function(e,t,n,r){for(var i=t,o=n,a=!1,s=this._autoEscapeCharacters,l=t;l<=n;++l){var c=e.charCodeAt(l);if(35===c){this._parseHash(e,l,n,r),o=l-1;break}r||a||1!==s[c]||(a=!0)}if(i>o)this.search="";else{var u;u=a?this._getComponentEscaped(e,i,o,!0):e.slice(i,o+1),this.search=u}},Tr.prototype._parseHash=function(e,t,n,r){this.hash=t>n?"":r?e.slice(t,n+1):this._getComponentEscaped(e,t,n,!0)},Object.defineProperty(Tr.prototype,"port",{get:function(){return this._port>=0?""+this._port:null},set:function(e){this._port=null==e?-1:parseInt(e,10)}}),Object.defineProperty(Tr.prototype,"query",{get:function(){var e=this._query;if(null!=e)return e;var t=this.search;return t&&(63===t.charCodeAt(0)&&(t=t.slice(1)),""!==t)?(this._query=t,t):t},set:function(e){this._query=e}}),Object.defineProperty(Tr.prototype,"path",{get:function(){var e=this.pathname||"",t=this.search||"";return e||t?e+t:null==e&&t?"/"+t:null},set:function(){}}),Object.defineProperty(Tr.prototype,"protocol",{get:function(){var e=this._protocol;return e?e+":":e},set:function(e){if("string"==typeof e){var t=e.length-1;58===e.charCodeAt(t)?this._protocol=e.slice(0,t):this._protocol=e}else null==e&&(this._protocol=null)}}),Object.defineProperty(Tr.prototype,"href",{get:function(){var e=this._href;return e||(e=this._href=this.format()),e},set:function(e){this._href=e}}),Tr.parse=function(e,t,n,r){if(e instanceof Tr)return e;var i=new Tr;return i.parse(e,!!t,!!n,!!r),i},Tr.format=function(e){return"string"==typeof e&&(e=Tr.parse(e)),e instanceof Tr?e.format():Tr.prototype.format.call(e)},Tr.resolve=function(e,t){return Tr.parse(e,!1,!0).resolve(t)},Tr.resolveObject=function(e,t){return e?Tr.parse(e,!1,!0).resolveObject(t):t};for(var Jy=["<",">",'"',"`"," ","\r","\n","\t","{","}","|","\\","^","`","'"],$y=new Array(128),e_=0,t_=$y.length;e_<t_;++e_)$y[e_]="";for(var e_=0,t_=Jy.length;e_<t_;++e_){var n_=Jy[e_],r_=encodeURIComponent(n_);r_===n_&&(r_=escape(n_)),$y[n_.charCodeAt(0)]=r_}var i_=$y.slice();$y[92]="/";var o_=Tr.prototype._slashProtocols={http:!0,https:!0,gopher:!0,file:!0,ftp:!0,"http:":!0,"https:":!0,"gopher:":!0,"file:":!0,"ftp:":!0};Tr.prototype._protocolCharacters=Dr([[97,122],[65,90],46,43,45]),Tr.prototype._hostEndingCharacters=Dr([35,63,47,92]),Tr.prototype._autoEscapeCharacters=Dr(Jy.map(function(e){return e.charCodeAt(0)})),Tr.prototype._noPrependSlashHostEnders=Dr(["<",">","'","`"," ","\r","\n","\t","{","}","|","^","`",'"',"%",";"].map(function(e){return e.charCodeAt(0)})),Tr.prototype._autoEscapeMap=$y,Tr.prototype._afterQueryAutoEscapeMap=i_;var a_=new RegExp("^http:\\/\\/.*$|^https:\\/\\/.*$"),s_=16,l_=1094988612,c_=1,u_=["mapDiffuseSource","mapSpecularSource","mapNormalSource","mapAlphaSource","mapLightSource","mapDiffuse","mapSpecular","mapNormal","mapAlpha","mapLight","mapDiffusePreview","mapSpecularPreview","mapNormalPreview","mapAlphaPreview","mapLightPreview"],p_=new Xn,h_={search:jr,get:Ur,getInfo:Ir,getData3dStorageId:Wr},f_={params:{type:{type:"string",possibleValues:["box","camera-bookmark","closet","curtain","door","floor","floorplan","group","interior","kitchen","level","plan","polybox","polyfloor","railing","stairs","tag","wall","window"],optional:!1},x:{type:"number",defaultValue:0,optional:!0},y:{type:"number",defaultValue:0,optional:!0},z:{type:"number",defaultValue:0,optional:!0},ry:{type:"number",defaultValue:0,optional:!0},children:{type:"array",defaultValue:[],optional:!0},id:{type:"string",optional:!0}}},d_={params:{w:{type:"number",defaultValue:1,optional:!1,min:.01},h:{type:"number",defaultValue:1,optional:!1,min:.01},l:{type:"number",defaultValue:1,optional:!1,min:.01}},possibleChildrenTypes:[]},m_={params:{distance:{type:"number"}}},g_={params:{w:{type:"number",defaultValue:.6,optional:!1,min:.01},h:{type:"number",defaultValue:2.4,optional:!1,min:.01},l:{type:"number",defaultValue:1.8,optional:!1,min:.01},baseboard:{type:"number",defaultValue:.1,optional:!0,min:.01},doorWidth:{type:"number",defaultValue:.02,optional:!0,min:.01},handleLength:{type:"number",defaultValue:.02,optional:!0,min:.01},handleWidth:{type:"number",defaultValue:.02,optional:!0,min:.01},handleHeight:{type:"number",defaultValue:.3,optional:!0,min:.01}},possibleChildrenTypes:[]},v_={params:{w:{type:"number",defaultValue:.2,optional:!1,min:.01},h:{type:"number",defaultValue:2.4,optional:!1,min:.01},l:{type:"number",defaultValue:1.8,optional:!1,min:.01},folds:{type:"number",defaultValue:14,optional:!0,min:.01}},possibleChildrenTypes:[]},y_={params:{v:{type:"number",defaultValue:3,possibleValues:[3],optional:!1},w:{type:"number",defaultValue:.05,optional:!1,min:.01},h:{type:"number",defaultValue:2,optional:!1,min:.01},l:{type:"number",defaultValue:.9,optional:!1,min:.01},frameLength:{type:"number",defaultValue:.05,optional:!0,min:.01},frameOffset:{type:"number",defaultValue:0,optional:!0},leafWidth:{type:"number",defaultValue:.03,optional:!0},leafOffset:{type:"number",defaultValue:.005,optional:!0},doorType:{type:"string",defaultValue:"singleSwing",optional:!1,possibleValues:["singleSwing","doubleSwing","swingFix","swingDoubleFix","doubleSwingDoubleFix","slidingDoor","opening"]},fixLeafRatio:{type:"number",defaultValue:.3,optional:!0},doorAngle:{type:"number",defaultValue:92,optional:!0},hinge:{type:"string",defaultValue:"right",optional:!1,possibleValues:["right","left"]},side:{type:"string",defaultValue:"back",optional:!1,possibleValues:["front","back"]},thresholdHeight:{type:"number",defaultValue:.01,optional:!0}},possibleChildrenTypes:[]},__={params:{w:{type:"number",optional:!1,min:.01},h:{type:"number",optional:!1,min:.01},l:{type:"number",optional:!1,min:.01},hasCeiling:{type:"boolean",optional:!1},hCeiling:{type:"number",optional:!1}},possibleChildrenTypes:[]},b_={params:{w:{type:"number",optional:!1,min:.01},l:{type:"number",optional:!1,min:.01},file:{type:"string",optional:!1}},possibleChildrenTypes:[]},w_={params:{src:{type:"string",optional:!0}},possibleChildrenTypes:["interior","object","wall","box","group","polybox"]},C_={params:{src:{type:"string",optional:!1}},possibleChildrenTypes:["interior","object","tag"]},A_={params:{w:{type:"number",defaultValue:.6,optional:!1,min:.01},h:{type:"number",defaultValue:2.4,optional:!1,min:.01},l:{type:"number",defaultValue:1.8,optional:!1,min:.01}},possibleChildrenTypes:[]},E_={params:{},possibleChildrenTypes:["box","closet","curtain","floor","floorplan","group","interior","kitchen","object","polybox","polyfloor","railing","stairs","tag","wall"]},k_={params:{object:{type:"string",optional:!1},sourceScale:{type:"number",optional:!0}},possibleChildrenTypes:["interior"]},x_={params:{modelDisplayName:{type:"string",optional:!1},v:{type:"number",possibleValues:[1],optional:!1}},possibleChildrenTypes:["level","camera-bookmark"]},j_={params:{h:{type:"number",defaultValue:1,optional:!1,min:.01},polygon:{type:"array",optional:!1}},possibleChildrenTypes:[]},I_={params:{h:{type:"number",defaultValue:.2,optional:!1,min:.01},polygon:{type:"array",optional:!1},hasCeiling:{type:"boolean",optional:!1},hCeiling:{type:"number",optional:!1},usage:{type:"string",optional:!0}},possibleChildrenTypes:[]},S_={params:{w:{type:"number",optional:!1,min:.01},h:{type:"number",optional:!1,min:.01},l:{type:"number",optional:!1,min:.01}},possibleChildrenTypes:[]},T_={params:{w:{type:"number",defaultValue:1.2,optional:!1,min:.01},h:{type:"number",defaultValue:2.4,optional:!1,min:.01},l:{type:"number",defaultValue:4,optional:!1,min:.01},stepWidth:{type:"number",defaultValue:1.2,optional:!0,min:.01},stairType:{type:"string",defaultValue:"straight",optional:!0,min:.01}},possibleChildrenTypes:[]},P_={params:{title:{type:"string",optional:!1},notes:{type:"string",optional:!0}},possibleChildrenTypes:[]},F_={params:{w:{type:"number",defaultValue:.15,optional:!1,min:.01},h:{type:"number",defaultValue:2.4,optional:!1,min:.01},l:{type:"number",defaultValue:1,optional:!1,min:.01},baseHeight:{type:"number",optional:!0,defaultValue:0},frontHasBase:{type:"boolean",optional:!0,defaultValue:!1},backHasBase:{type:"boolean",optional:!0,defaultValue:!1}},possibleChildrenTypes:["window","door"]},R_={params:{h:{type:"number",defaultValue:1.5,optional:!1,min:.01},l:{type:"number",optional:!1,min:.01},rowRatios:{type:"array",optional:!0},columnRatios:{type:"array",optional:!0},frameLength:{type:"number",optional:!0,min:.01},frameWidth:{type:"number",optional:!0,min:.01},y:{defaultValue:.9}},possibleChildrenTypes:[]},O_={default_margin:.1,default_search:"isPublished:true -generic",tag_black_list:["simplygon","hasChangeableMaterials","autofurnish","wallAttached","2 seater","3 seater","4 seater"],tag_white_list:["shelf","armchair","sofa","plant","sideboard","coffee table","dining table","round","TV","lamps","free standing lamp","living","dining","relaxing","picture"],edgeAligned:["sofa","shelf","armchair","sideboad","double bed","single bed","bed"]},D_=function(e,t){if("string"!=typeof e)return Promise.reject("invalid input");t=t||{},this.userQuery=t.query||null,this.searchCount=0,this.margin=O_.default_margin,this.furnitureInfo=null;var n=this;return Ir(e).then(function(e){return n.furnitureInfo=e,Jr(n.getQuery(n.furnitureInfo))}).then(function(t){return n.verifyResult(t,e)}).catch(function(e){console.error(e)})};D_.prototype.verifyResult=function(e,t){if(this.searchCount>10)return Promise.reject(new Error("No furniture was found"));var n=e.filter(function(e){return e.productResourceId!==t}),r=this;if(n.length<1){this.searchCount>=3&&(this.margin+=.1);var i=this.getQuery(this.furnitureInfo);return this.searchCount+=1,Jr(i).then(function(e){return r.verifyResult(e,t)}).catch(function(e){return console.error("catch",i.query,e),Promise.reject("No alternatives were found")})}var o=n.map(Er).map(function(e){return{furniture:e,offset:$r(r.furnitureInfo,e)}});return Promise.resolve(o)},D_.prototype.getQuery=function(e){var t=O_.default_search,n=this.searchCount<6?e.tags.concat(e.categories):e.tags;n=n.filter(function(e){return O_.tag_black_list.indexOf(e)<0&&!/^\d+P$/.test(e)}),this.searchCount>2&&(n=n.filter(function(e){return O_.tag_white_list.indexOf(e)>-1})),t+=" "+n.join(" "),this.userQuery&&n.indexOf("TV")<0&&(t+=" "+this.userQuery);var r={query:t},i=e.boundingBox,o=this;return i&&["length","height","width"].forEach(function(e){i[e]-o.margin>0&&(r[e+"Min"]=Math.round(100*(i[e]-o.margin))/100,r[e+"Max"]=Math.round(100*(i[e]+o.margin))/100)}),r};var N_=new RegExp("^http:\\/\\/.*$|^https:\\/\\/.*$"),V_={},L_=["interior","group","level","plan","object"],M_={getFurnishings:Kr,replaceFurniture:gi},B_;Nl.isNode?B_=require("form-data"):"undefined"!=typeof FormData?B_=FormData:(console.warn("Missing FormData API."),B_=function(){throw new Error("Missing FormData API.")});var U_=B_,W_=new Il.BehaviorSubject(Ei({}));ki().catch(function(e){console.warn("Session info not available: ",e)}),Nl.isBrowser&&Nl.isFocused$.subscribe(function(e){e&&ki()});var Z_={getSession:ki,session$:W_,signUp:Ai,signup:Ai,logIn:Si,login:Si,logOut:Ti,logout:Ti,setPassword:xi,requestPasswordReset:ji,resendActivationEmail:Ii,getSecretApiKey:Fi,regenerateSecretApiKey:Pi,generatePublishableApiKey:Ri,listPublishableApiKeys:Oi,updatePublishableApiKeyDomains:Di,revokePublishableApiKey:Ni},H_="application/octet-stream",G_={obj:"text/plain",dds:"application/octet-stream",dwg:"application/acad",dxf:"application/dxf",jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",txt:"text/plain",log:"text/plain",svg:"svg+xml",html:"text/html",htm:"text/html",js:"application/javascript",json:"application/json",md:"text/markdown",csv:"text/csv",gz:"application/x-gzip",gzip:"application/x-gzip",zip:"application/x-zip",pdf:"application/pdf","3ds":"application/x-3ds"},z_="anonymous-uploads",Q_="{{userId}}",K_=/^\/([a-zA-Z0-9\.\-\_]+\/)+([a-zA-Z0-9\.\-\_]+)$/,X_={},Y_=new RegExp("^(http(s?))\\:\\/\\/("+Hl.storageDomain+"|"+Hl.storageDomainNoCdn+")");Ki.materials=function(e,t){!function e(t,n){for(var r=t.materialKeys||Object.keys(t.materials||{}),i=0;i<r.length;i++)n(t.materials[r[i]],t);if(t.children)for(var i=0,o=t.children.length;i<o;i++)e(t.children[i],n)}(e,t)},Ki.meshes=function(e,t){!function e(t,n){for(var r,i=t.meshKeys||Object.keys(t.meshes||{}),o=0;o<i.length;o++)n(r=t.meshes[i[o]],t.materials[r.material],t);if(t.children)for(var o=0,a=t.children.length;o<a;o++)e(t.children[o],n)}(e,t)},Xi.title="Project Top Down",Yi.title="Architectural";var q_={architectural:Yi,projectAxisY:Xi},J_=!0;qi.title="Flat",Ji.title="Smooth";var $_={flat:qi,smooth:Ji},eb=eo;eb.meshes=ro,eb.materials=no;var tb=!0,nb=Math.PI/180,rb=180/Math.PI,ib=2048,ob=2048,ab={undefined:"readAsText",text:"readAsText",dataUrl:"readAsDataURL",binaryString:"readAsBinaryString",arrayBuffer:"readAsArrayBuffer"},sb="https://cdn.rawgit.com/archilogic-com/roBrowser/e4b5b53a/src/Loaders/Targa.js",lb=v({three:!0,aframe:!1},function(){return function(e){function t(){return"mesh_"+ ++o}function n(){return"material_"+ ++a}var r=[],i={meshes:{},materials:{}},o=0,a=0;return function e(o){if(o.updateMatrixWorld(),o.geometry){var a=o.geometry;-1===a.type.indexOf("BufferGeometry")&&(a=(new THREE.BufferGeometry).fromGeometry(a)),a.attributes.position.array.length&&(a.index?a.attributes.color?jo(i,o,t,n):xo(i,o,t,n,r):ko(i,o,t,n,r))}o.children.forEach(function(t){e(t)})}(e),gu.all(r).then(function(){return eb(i)})}}),cb={inflate:Ro,inflateFile:Oo,deflate:Do,deflateFile:No},ub={deflate:{url:"https://cdnjs.cloudflare.com/ajax/libs/pako/1.0.5/pako_deflate.min.js",module:"pako/deflate"},inflate:{url:"https://cdnjs.cloudflare.com/ajax/libs/pako/1.0.5/pako_inflate.min.js",module:"pako/inflate"}},pb=".data3d.buffer",hb=16,fb=1094988612,db=1,mb=["mapDiffuse","mapDiffusePreview","mapDiffuseSource","mapSpecular","mapSpecularPreview","mapSpecularSource","mapNormal","mapNormalPreview","mapNormalSource","mapAlpha","mapAlphaPreview","mapAlphaSource"],gb={mapDiffuse:"diffuse",mapDiffusePreview:"diffuse",mapDiffuseSource:"diffuse",mapSpecular:"specular",mapSpecularPreview:"specular",mapSpecularSource:"specular",mapNormal:"normal",mapNormalPreview:"normal",mapNormalSource:"normal",mapAlpha:"alpha",mapAlphaPreview:"alpha",mapAlphaSource:"alpha"},vb={mapDiffusePreview:"loRes",mapSpecularPreview:"loRes",mapNormalPreview:"loRes",mapAlphaPreview:"loRes",mapDiffuseSource:"source",mapSpecularSource:"source",mapNormalSource:"source",mapAlphaSource:"source",mapDiffuse:"dds",mapSpecular:"dds",mapNormal:"dds",mapAlpha:"dds"},yb={export3ds:Yo("3ds"),exportBlend:Yo("blend"),exportDae:Yo("dae"),exportFbx:Yo("fbx"),exportObj:Yo("obj")},_b={get:oi,put:Li,importThreeObject:Qo,importAframeElement:Ko,export3ds:yb.export3ds,exportBlend:yb.exportBlend,exportDae:yb.exportDae,exportFbx:yb.exportFbx,exportObj:yb.exportObj,getUrlFromStorageId:ii,getNoCdnUrlFromStorageId:zi,getStorageIdFromUrl:Qi},bb={OK:0,MIN_VALUE:1,MAX_VALUE:2,MISSED:3,NOT_SUPPOPRTED:4,VALUE:5,TYPE:6,CHILDREN_TYPE:7},wb=Zr(),Cb={getStructure:qo,getHtml:ia,getAframeElements:Jo,getViewerUrl:$o,validateSceneStructure:ea,normalizeSceneStructure:zr,getHtmlFromSceneStructure:oa,getAframeElementsFromSceneStructure:ai},Ab={convertToBasic3dModel:aa,getConversionStatus:sa,recognize:la},Eb={bake:pa},kb=".io3d-message-list {\n  z-index: 100001;\n  position: fixed;\n  top: 0;\n  left: 50%;\n  margin-left: -200px;\n  width: 400px;\n  font-family: Gill Sans, Gill Sans MT, Calibri, sans-serif;\n  font-weight: normal;\n  letter-spacing: 1px;\n  line-height: 1.3;\n  text-align: center;\n}\n.io3d-message-list .message {\n  display: block;\n  opacity: 0;\n}\n.io3d-message-list .message .spacer {\n  display: block;\n  height: 10px;\n}\n.io3d-message-list .message .text {\n  display: inline-block;\n  padding: 10px 12px 10px 12px;\n  border-radius: 3px;\n  color: white;\n  font-size: 18px;\n}\n.io3d-message-list .message .text a {\n  color: white;\n  text-decoration: none;\n  padding-bottom: 0px;\n  border-bottom: 2px solid white;\n}\n.io3d-message-list .message .neutral {\n  background: rgba(0, 0, 0, 0.9);\n}\n.io3d-message-list .message .success {\n  background: linear-gradient(50deg, rgba(35, 165, 9, 0.93), rgba(102, 194, 10, 0.93));\n}\n.io3d-message-list .message .warning {\n  background: linear-gradient(50deg, rgba(165, 113, 9, 0.93), rgba(194, 169, 10, 0.93));\n}\n.io3d-message-list .message .error {\n  background: linear-gradient(50deg, rgba(165, 9, 22, 0.93), rgba(194, 56, 10, 0.93));\n}\n.io3d-overlay {\n  -webkit-box-sizing: border-box;\n  -moz-box-sizing: border-box;\n  box-sizing: border-box;\n  z-index: 100000;\n  position: fixed;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  left: 0;\n  height: 100%;\n  width: 100%;\n  font-family: Gill Sans, Gill Sans MT, Calibri, sans-serif;\n  font-weight: 200;\n  font-size: 18px;\n  letter-spacing: 1px;\n  color: white;\n  text-align: center;\n  line-height: 1.3;\n  background: linear-gradient(70deg, rgba(20, 17, 34, 0.96), rgba(51, 68, 77, 0.96));\n}\n@-webkit-keyframes overlay-fade-in {\n  0% {\n    opacity: 0;\n  }\n  100% {\n    opacity: 1;\n  }\n}\n@keyframes overlay-fade-in {\n  0% {\n    opacity: 0;\n  }\n  100% {\n    opacity: 1;\n  }\n}\n@-webkit-keyframes overlay-fade-out {\n  0% {\n    opacity: 1;\n  }\n  100% {\n    opacity: 0;\n  }\n}\n@keyframes overlay-fade-out {\n  0% {\n    opacity: 1;\n  }\n  100% {\n    opacity: 0;\n  }\n}\n.io3d-overlay .centered-content {\n  display: inline-block;\n  position: relative;\n  top: 50%;\n  text-align: left;\n}\n.io3d-overlay .centered-content .button {\n  margin-right: 4px;\n  margin-top: 1.5em;\n}\n.io3d-overlay .bottom-container {\n  width: 100%;\n  display: block;\n  position: absolute;\n  bottom: 1em;\n}\n.io3d-overlay .bottom-container .bottom-content {\n  display: inline-block;\n  position: relative;\n  margin-left: auto;\n  margin-right: auto;\n  text-align: left;\n  color: rgba(255, 255, 255, 0.35);\n}\n.io3d-overlay .bottom-container .bottom-content .clickable {\n  cursor: pointer;\n  -webkit-transition: color 500ms;\n  transition: color 500ms;\n}\n.io3d-overlay .bottom-container .bottom-content .clickable:hover {\n  color: white;\n}\n.io3d-overlay .bottom-container .bottom-content a {\n  color: rgba(255, 255, 255, 0.35);\n  text-decoration: none;\n  -webkit-transition: color 500ms;\n  transition: color 500ms;\n}\n.io3d-overlay .bottom-container .bottom-content a:hover {\n  color: white;\n}\n@-webkit-keyframes content-slide-in {\n  0% {\n    -webkit-transform: translateY(-40%);\n  }\n  100% {\n    -webkit-transform: translateY(-50%);\n  }\n}\n@keyframes content-slide-in {\n  0% {\n    transform: translateY(-40%);\n  }\n  100% {\n    transform: translateY(-50%);\n  }\n}\n@-webkit-keyframes content-slide-out {\n  0% {\n    -webkit-transform: translateY(-50%);\n  }\n  100% {\n    -webkit-transform: translateY(-40%);\n  }\n}\n@keyframes content-slide-out {\n  0% {\n    transform: translateY(-50%);\n  }\n  100% {\n    transform: translateY(-40%);\n  }\n}\n.io3d-overlay h1 {\n  margin: 0 0 0.5em 0;\n  font-size: 42px;\n  font-weight: 200;\n  color: white;\n}\n.io3d-overlay p {\n  margin: 1em 0 0 0;\n  font-size: 18px;\n  font-weight: 200;\n}\n.io3d-overlay .hint {\n  position: relative;\n  margin: 1em 0 0 0;\n  color: rgba(255, 255, 255, 0.35);\n  font-size: 18px;\n  font-weight: 200;\n}\n.io3d-overlay .hint a {\n  color: rgba(255, 255, 255, 0.35);\n  text-decoration: none;\n  -webkit-transition: color 600ms;\n  transition: color 600ms;\n}\n.io3d-overlay .hint a:hover {\n  color: white;\n}\n.io3d-overlay .button {\n  cursor: pointer;\n  display: inline-block;\n  color: rgba(255, 255, 255, 0.35);\n  width: 40px;\n  height: 40px;\n  line-height: 32px;\n  border: 2px solid rgba(255, 255, 255, 0.35);\n  border-radius: 50%;\n  text-align: center;\n  font-size: 18px;\n  font-weight: 200;\n  -webkit-transition: opacity 300ms, color 300ms;\n  transition: opacity 300ms, color 300ms;\n}\n.io3d-overlay .button:hover {\n  background-color: rgba(255, 255, 255, 0.1);\n  color: white;\n  border: 2px solid white;\n}\n.io3d-overlay .button-highlighted {\n  color: white;\n  border: 2px solid white;\n}\n.io3d-overlay .close-button {\n  display: block;\n  position: absolute;\n  top: 20px;\n  right: 20px;\n  font-size: 18px;\n  font-weight: 200;\n}\n.io3d-overlay input,\n.io3d-overlay select,\n.io3d-overlay option,\n.io3d-overlay textarea {\n  font-family: Gill Sans, Gill Sans MT, Calibri, sans-serif;\n  font-size: 24px;\n  font-weight: normal;\n  letter-spacing: 1px;\n  outline: none;\n  margin: 0 0 0 0;\n  color: white;\n}\n.io3d-overlay select,\n.io3d-overlay option,\n.io3d-overlay input:not([type='checkbox']):not([type='range']) {\n  padding: 0.2em 0 0.4em 0;\n  width: 100%;\n  line-height: 20px;\n  -webkit-appearance: none;\n  -moz-appearance: none;\n  appearance: none;\n  border-radius: 0px;\n  border: 0px;\n  background: transparent;\n  border-bottom: 2px solid rgba(255, 255, 255, 0.3);\n  -webkit-transition: border-color 1s;\n  transition: border-color 1s;\n}\n.io3d-overlay select:focus,\n.io3d-overlay option:focus,\n.io3d-overlay input:not([type='checkbox']):not([type='range']):focus {\n  border-color: white;\n}\n.io3d-overlay textarea {\n  display: box;\n  -webkit-appearance: none;\n  -moz-appearance: none;\n  appearance: none;\n  padding: 0.2em 0 0.4em 0;\n  min-width: 100%;\n  max-width: 100%;\n  line-height: 26px;\n  border: 0px;\n  background: rgba(255, 255, 255, 0.08);\n  border-bottom: 2px solid rgba(255, 255, 255, 0.3);\n}\n.io3d-overlay input[type='checkbox'] {\n  position: relative;\n  height: 20px;\n  vertical-align: bottom;\n  margin: 0;\n}\n.io3d-overlay .reveal-api-key-button {\n  cursor: pointer;\n  position: absolute;\n  background: rgba(255, 255, 255, 0.1);\n  border-radius: 2px;\n  bottom: 0.7em;\n  padding: 0.1em 0.2em 0.2em 0.2em;\n  line-height: 20px;\n  -webkit-transition: color 600ms;\n  transition: color 600ms;\n}\n.io3d-overlay .reveal-api-key-button:hover {\n  color: white;\n}\n.io3d-overlay a {\n  color: white;\n  text-decoration: none;\n}\n.io3d-overlay .key-menu {\n  position: relative;\n  margin: 3em 0 0 0;\n}\n.io3d-overlay .key-menu .key-image {\n  width: 172px;\n  height: 127px;\n}\n.io3d-overlay .key-menu .key-button {\n  position: absolute;\n  left: 156px;\n  height: 36px;\n  line-height: 36px;\n  background: rgba(255, 255, 255, 0.1);\n  cursor: pointer;\n  padding: 0 14px 0 14px;\n  border-radius: 2px;\n  -webkit-transition: background 300ms linear;\n  transition: background 300ms linear;\n}\n.io3d-overlay .key-menu .key-button:hover {\n  background: rgba(255, 255, 255, 0.3);\n}\n.io3d-overlay .key-menu .go-to-publishable-api-key-ui {\n  top: 11px;\n}\n.io3d-overlay .key-menu .go-to-secret-api-key-ui {\n  bottom: 11px;\n}\n.io3d-overlay .regegenerate-secret-key-button {\n  cursor: pointer;\n}\n.io3d-overlay .publishable-api-keys .list {\n  max-height: 50vh;\n  overflow: auto;\n  padding: 0 15px 0 0;\n}\n.io3d-overlay .publishable-api-keys .list .key-item {\n  position: relative;\n  background: rgba(255, 255, 255, 0.1);\n  border-radius: 3px;\n  margin-bottom: 12px;\n  padding: 4px 5px 3px 8px;\n}\n.io3d-overlay .publishable-api-keys .list .key {\n  font-weight: 200 !important;\n  border-bottom: 0 !important;\n  margin-bottom: 0 !important;\n  padding: 0 !important;\n}\n.io3d-overlay .publishable-api-keys .list .domains {\n  margin: 0 0 0 0 !important;\n}\n.io3d-overlay .publishable-api-keys .list .button {\n  position: absolute !important;\n  margin: 0 !important;\n  background-repeat: no-repeat;\n  background-position: center;\n  color: white;\n  opacity: 0.5;\n}\n.io3d-overlay .publishable-api-keys .list .button:hover {\n  opacity: 1;\n}\n.io3d-overlay .publishable-api-keys .list .delete-key-button {\n  right: 8px;\n  top: 9px;\n}\n.io3d-overlay .publishable-api-keys .list .edit-domains-button {\n  positions: absolute;\n  right: 56px;\n  top: 9px;\n  background-size: 75%;\n  padding: 5px;\n}\n.io3d-overlay .publishable-api-keys .generate-new-key-button {\n  margin: 1.5em 0 0 0;\n  display: inline-block;\n  cursor: pointer;\n}\n",xb=/^<(\S+)>$/i,jb=function(e,t){if(Nl.assertBrowser(),e){if("string"==typeof e){var n=xb.exec(e),r=n?n[1]:null;if(r)return fa(r,t);throw'Only basic tags like "<div>" without attributes are currently supported. (No queries and no HTML strings)'}if(!ma(e))throw'Please provide html element string (i.e. "<div>") or element object as first argument.';da(e)}};jb.isElement=ma;var Ib;Nl.isBrowser&&Nl.domReady(function(){Ib=jb("<div>",{class:"io3d-message-list"}).appendTo("body")}),ya.success=function(e,t){return ya(e,t,"success")},ya.warning=function(e,t){return ya(e,t,"warning")},ya.error=function(e,t){return ya(e,void 0!==t?t:5e3,"error")};var Sb=[".json",".buffer",".js",".md",".txt",".csv",".obj",".mtl",".ifc",".fbx",".gltf",".bin",".jpg",".jpeg",".jpe",".png",".gif",".tga",".dds",".svg",".pdf",".dxf"],Tb="width:300px;",Pb="width:300px;",Fb="width:300px;",Rb="width:620px;",Ob="width:510px;",Db="width:440px;";if(Nl.isBrowser){var Nb=document.createElement("style");Nb.setAttribute("media","screen"),Nb.appendChild(document.createTextNode(kb)),document.head.appendChild(Nb)}var Vb={fileDrop:Ea,signUp:Sa,signup:Sa,logIn:Ia,login:Ia,logOut:Oa,logout:Oa,requestPasswordReset:ja,devDashboard:La,publishableApiKeys:Na,secretApiKey:Va,message:ya,alert:Ra,confirm:Pa,prompt:Da},Lb="0123456789abcdef".split("");Ya("hello");var Mb={data3d:{load:Br,encodeBinary:Mo,decodeBinary:Nr,fromThreeJs:lb,clone:wu,traverse:Ki,getInspectorUrl:ha},ui:Vb,auth:Z_,io:{fetch:Gl,fetchScript:Yn,checkIfFileExists:Wo},image:{scaleDown:ao,getFromFile:vo,getBlobFromCanvas:mo},math:{md5:Ya,sha1:qa},services:{call:te},file:{getMimeTypeFromFilename:Vi,gzip:cb,read:go,getMd5Hash:Ja},processing:{whenDone:ua,whenHiResTexturesReady:Ho},url:Tr,uuid:yu,getShortId:Ci,path:Xy,wait:io,bluebird:gu},Bb={aFrame:Qy,aframe:Qy,furniture:h_,staging:M_,storage:_b,scene:Cb,floorPlan:Ab,light:Eb,auth:Mb.auth,ui:Mb.ui,utils:Mb,runtime:Nl,configs:Hl,config:Hl};return Nl.isBrowser&&(window.IO3D=Bb),Bb});
//# sourceMappingURL=3dio.min.js.map